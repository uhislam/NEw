!function(){var e=angular.module("admin",["mv.forms","ngTable"]);e.controller("ProjectListController",["$scope","$http","$filter","api","NgTableParams","$resource","$q","$uibModal","ProjectsService","patronicityConfig",function(c,a,t,e,n,o,i,l,r,u){c.loading=!0,c.projects=[],c.statuses=[],c.managers=[],c.sponsors=[],c.stats={totalPledged:0,totalProjects:0};var s=t("orderBy"),d={Email:"",ID:0,Name:"(no manager assigned)"},p={ID:0,Name:"(no sponsor assigned)"};c.resetStats=function(){c.stats.totalPledged=0,c.stats.totalProjects=0},a.get(u.databaseEndpointUrl("status")).success(function(e){e.success?(c.statuses=e.result,c.statuses=s(c.statuses,"order")):alert(e.message)}),a.get(u.databaseEndpointUrl("sponsors")).success(function(e){e.success?(c.sponsors=e.result,c.sponsors=r.convertFields(c.sponsors),c.sponsors=s(c.sponsors,"Name")):alert(e.message),c.sponsors.unshift(p)}),a.get(u.databaseEndpointUrl("managers")).success(function(e){e.success?(c.managers=e.result,c.managers=r.convertFields(c.managers),c.managers=s(c.managers,"Name")):alert(e.message),c.managers.unshift(d)});r.ListProjects().then(function(e){c.projects=e,c.tableParams.page(1),c.tableParams.reload(),c.loading=!1}),c.statusChange=function(i,r){a.post(u.databaseEndpointUrl("status/update/"+i+"/"+r),{force:!0}).success(function(e,t,n,a){var o;e.success?(o=c.findProjectKey(i),c.projects[o].Status=r):alert(e.message)}).error(function(e,t,n,a){})},c.editNotes=function(t){var n=l.open({templateUrl:u.urlForTemplate("admin-notes-modal.html"),scope:c,controller:["$scope","$uibModalInstance",function(i,e){var r=i.findProjectKey(t);i.Notes=i.projects[r].Notes,i.save=function(){i.fullResults={projectID:t,notes:i.Notes},e.close(i.fullResults)},i.cancel=function(){e.dismiss("cancel")},n.result.then(function(o){var e={notes:o.notes};a.post(u.dataBaseEndpointURL("notes/save/"+t),e).success(function(e,t,n,a){e.success?i.projects[r].Notes=o.notes:alert(e.message)}).error(function(e,t,n,a){})})}],size:"",resolve:{project:function(){return c.project}}})},c.appoveOrReject=function(s){var t=l.open({templateUrl:u.urlForTemplate("admin-approve-reject-modal.html"),scope:c,controller:["$scope","$uibModalInstance",function(r,e){r.reason="",r.approve=function(){r.fullResults={projectID:s,status:"approve",reason:r.reason},e.close(r.fullResults)},r.reject=function(){r.fullResults={projectID:s,status:"reject",reason:r.reason},e.close(r.fullResults)},r.cancel=function(){e.dismiss("cancel")},t.result.then(function(e){var i=0;"approve"===e.status?i=4:"reject"===e.status&&(i=7),a.post(u.databaseEndpointUrl("status/update/"+s+"/"+i),e).success(function(e,t,n,a){var o=r.findProjectKey(s);r.projects[o].Status=i}).error(function(e,t,n,a){})})}],size:"",resolve:{project:function(){return c.project}}})},c.findProjectKey=function(e){return r.findProjectKey(c.projects,e)},c.toggleFeatured=function(e){var t=c.findProjectKey(e);a.get("/admin/projects/toggleFeatured/"+e).success(function(e){e.success?c.projects[t].IsFeatured=e.result.Featured:alert(e.message)})},c.deactivate=function(r){var t=l.open({templateUrl:u.urlForTemplate("admin-confirm-delete-modal.html"),scope:c,controller:["$scope","$uibModalInstance",function(i,e){i.confirm=function(){i.fullResults={confirm:!0},e.close(i.fullResults)},i.cancel=function(){e.dismiss("cancel")},t.result.then(function(e){a.post(u.databaseEndpointUrl("/deactivate/"+r)).success(function(e,t,n,a){var o=i.findProjectKey(r);i.projects.splice(o,1),i.tableParams.reload()}).error(function(e,t,n,a){})})}],size:"",resolve:{project:function(){return c.project}}})},c.managerChange=function(o,i){console.log("new manager for "+o+": "+i),a.post(u.databaseEndpointUrl("managers/update/"+o+"/"+i)).success(function(e,t,n,a){e.success?console.log("Updated manager for project "+o+" to "+i):alert(e.message)}).error(function(e,t,n,a){alert("Error saving manager")})},c.calcStats=function(e){c.resetStats(),angular.forEach(e,function(e,t){c.stats.totalProjects+=1,c.stats.totalPledged+=e.PledgeAmount})},c.justContacted=function(e){var i=c.findProjectKey(e);a.post(u.databaseEndpointUrl("just-contacted/"+e)).success(function(e,t,n,a){var o;e.success?(o=new Date(e.result.LastContactedDate.replace(/-/g,"/")),c.projects[i].LastContactedDate=o):alert(e.message)})},c.isValidDate=function(e){return"[object Date]"===Object.prototype.toString.call(e)&&!isNaN(e.getTime())},c.statusesOnOurPlate=[1,4,-1,5,8,-2],c.tableParams=new n({page:1,count:100,sorting:{AddedDate:"desc"},filter:{Status:c.statusesOnOurPlate}},{$scope:c,getData:function(a){console.log("getting data"),console.log(a);var e=t("filter")(c.projects,function(e){var t,n=a.filter();for(t in n)switch(t){case"Status":case"ManagerID":case"SponsorID":if(n[t].indexOf(e[t])<0)return!1;break;case"Name":case"Username":case"SponsorName":if(e[t].toLowerCase().indexOf(n[t])<0)return!1;break;default:window.console.log("What is "+t)}return!0}),e=(c.calcStats(e),a.sorting()?t("orderBy")(e,a.orderBy()):e);return a.total(e.length),e=e.slice((a.page()-1)*a.count(),a.page()*a.count())}})}]),e.directive("editBanner",["api","$uibModal","imageUpload","BannerService",function(e,t,n,a){return{restrict:"E",controller:["$scope",function(t){t.blankBanner={},t.newBanner=function(){t.blankBanner={Active:"0",AddedDate:"",ButtonText:"",CreatedBy:"",DestinationURL:"",ID:"new",ImageURL:"",MediaID:null,NewWindow:"0",Order:99,OverlayText:"",Valid:!1,Available:"1",ActiveDate:"",Subtext:""},t.editBanner(t.blankBanner)},t.editBanner=function(e){a.editBanner(e).then(function(e){console.log("result of edited banner:"),console.log(e),"true"===t.isNew?t.$emit("banner-add-save",e):(t.banner=e,t.$emit("banner-save"))})},t.bannerAction=function(e){"true"===t.isNew?(console.log("new banner"),t.newBanner()):t.editBanner(e)},t.isNew="false",t.buttonLabel=function(){var e="Edit";return e="true"===t.isNew?"New Banner...":e}}],template:'<button type="button" ng-click="bannerAction(banner)">{{buttonLabel()}}</button>',scope:{banner:"=",isNew:"@"}}}]),e.controller("bannerUpload",["$scope","imageUpload","api","$timeout","Dialogs","BannerService",function(a,e,t,n,o,i){a.selectImage=function(){e.selectImage("banner",3,!1,"banner").result.then(function(e){console.log(e)})},a.banners={},a.list=[];var r=[];a.sortingLog=[],a.saving=!1,a.loading=!0,a.bannerDetails=function(){a.loading=!0,t.banners().then(function(e){console.log(e),a.banners=e,a.loading=!1})},a.createBanner=function(){t.bannerNew().then(function(e){i.editBanner(e).then(function(e){a.$emit("banner-add-save",e)})})},a.blankBanner={},a.newBanner=function(){return a.blankBanner={Active:"0",AddedDate:"",ButtonText:"",CreatedBy:"",DestinationURL:"",ID:"new",ImageURL:"",MediaID:null,NewWindow:"0",Order:99,OverlayText:"",Valid:!1,Available:"1",ActiveDate:"",Subtext:""},a.blankBanner},a.$on("banner-save",function(e,t){e.stopPropagation(),a.saveChanges()}),a.$on("banner-add-save",function(e,t){e.stopPropagation(),a.banners.push(t),a.saveChanges()}),a.saveChanges=function(){a.saving=!0,n(function(){t.bannerSave(a.banners).then(function(){a.saving=!1,a.bannerDetails()})},0)},a.archive=function(e){o.Confirm("Are you sure you wish to archive this banner?  It won't be deleted, but you won't be able to recover this easily.","Archive Banner").then(function(){t.bannerArchive(e).then(function(){a.bannerDetails()})})},a.activate=function(e){t.bannerActivate(e).then(function(){a.bannerDetails()})},a.deactivate=function(e){t.bannerDeactivate(e).then(function(){a.bannerDetails()})},a.isValidDate=function(e){return"[object Date]"===Object.prototype.toString.call(e)&&!isNaN(e.getTime())},a.sortBanners=function(){for(var e=0;e<a.banners.length;e++)a.banners[e].Order=e},a.sortableOptions={update:function(e,t){var n=r.map(function(e){return e.value}).join(", ");a.sortingLog.push("Update: "+n)},stop:function(e,t){var n=r.map(function(e){return e.value}).join(", ");a.sortingLog.push("Stop: "+n),a.sortBanners(),a.saveChanges()}},a.bannerDetails()}]),e.service("BannerService",["$uibModal","imageUpload","patronicityConfig",function(e,a,n){this.editBanner=function(t){return e.open({templateUrl:n.urlForTemplate("admin-edit-banner-modal.html"),windowClass:"center-modal",controller:["$scope","$uibModalInstance",function(n,e){n.cancel=function(){e.dismiss("cancel")},n.save=function(){e.close(n.editBanner)},n.cloneBanner=function(e){return{Active:e.Active,AddedDate:e.AddedDate,ButtonText:e.ButtonText,CreatedBy:e.CreatedBy,DestinationURL:e.DestinationURL,ID:e.ID,ImageURL:e.ImageURL,MediaID:e.MediaID,NewWindow:e.NewWindow,Order:e.Order,OverlayText:e.OverlayText,Valid:e.Valid,Available:e.Available,ActiveDate:e.ActiveDate,Subtext:e.Subtext}},n.editBanner=n.cloneBanner(t),n.selectImage=function(){a.selectImage("banner",n.editBanner.ID,!1,"banner").result.then(function(e){console.log(e),n.editBanner.ImageURL=e.url,n.editBanner.MediaID=e.guid})},n.$watch("editBanner.MediaID",function(e,t){console.log(n.editBanner.MediaID),e!==t&&(console.log("MediaID changed: "+e+" "+t),t||(n.editBanner.Active="1"))})}],backdrop:"static",resolve:{}}).result}}]),e.service("ProjectsService",["$http","patronicityConfig",function(e,t){var n=this;this.ListProjects=function(){return e.get(t.databaseEndpointUrl("json/all/simple")).success(function(e){e.success||alert(e.message)}).then(this.handleSuccess)},this.handleSuccess=function(e){if(e.data.success)return n.convertFields(e.data.result)},this.findProjectKey=function(e,t){for(var n,a=0;a<e.length;a++)if(e[a].ID===t){n=a;break}return n},this.convertFields=function(e){var n=[];return angular.forEach(e,function(e,t){var a=[parseInt(e.ID)];angular.forEach(e,function(e,t){switch(t){case"PledgeAmount":case"Goal":case"DonorCount":case"ID":case"Status":case"ManagerID":case"AmountDueToProject":case"CCFeeAmount":case"ActualProcessingFee":case"PlatformFeeAmount":case"ActualPlatformFees":case"TipSum":var n=parseFloat(e,10);a[t]=n;break;case"AddedDate":case"LaunchDate":case"StartDate":case"EndDate":case"LastContactedDate":e&&(n=new Date(e.replace(/-/g,"/")),a[t]=n);break;case"User":a.Username=e.Name,a.UserEmail=e.Email;break;case"Sponsor":e&&(n=parseFloat(e.ID,10),isNaN(n)&&(n=0),a.SponsorID=n,a.SponsorName=e.Name);break;default:a[t]=e}}),n.push(a)}),n}}]),e.directive("csvTimeRange",["api","$httpParamSerializer",function(e,a){return{restrict:"E",templateUrl:"csvTimeRange.html",link:function(n,e,t){n.startDate=null,n.endDate=null,n.popupStart={opened:!1},n.popupEnd={opened:!1},n.startDateOptions={formatYear:"yy",startingDay:1},n.endDateOptions={formatYear:"yy",startingDay:1},n.openStart=function(e){e.preventDefault(),e.stopPropagation(),n.popupStart.opened=!0},n.openEnd=function(e){e.preventDefault(),e.stopPropagation(),n.popupEnd.opened=!0},n.downloadUrlStatic="/project/data/json/all/csv?startDate=2016-01-01&endDate=2016-01-04",n.downloadUrl=function(){var e="/project/data/json/all/csv",t={startDate:n.startDate,endDate:n.endDate},t=a(t);return t&&(e+="?"+t),e}}}}])}(),function(){var e=angular.module("patronicity.admin.batches",["patronicity.api","user","ngTable","ui.bootstrap"]);e.directive("adminTransferBatchList",["api","patronicityConfig","NgTableParams","$stateParams",function(a,e,o,i){return{restrict:"E",scope:{},templateUrl:e.urlForTemplate("newadmin/batches/list.html"),link:function(n){n.error_message="";var e=i.state||"",t={};e.length&&(t={State:e}),n.tableParams=new o({page:1,count:25,filter:t,exact:{},sorting:{CreatedAt:"desc"}},{getData:function(t){return n.loading=!0,a.admin.batches.list({page:t.page(),count:t.count(),sorting:t.sorting(),filter:t.filter()}).then(function(e){return t.total(e.total),n.loading=!1,e.items})}}),n.$on("load-batches",function(){n.tableParams.reload()})}}}]),e.directive("adminTransferBatch",["api","patronicityConfig","$stateParams","$uibModal",function(t,e,a,o){return{restrict:"E",scope:{},templateUrl:e.urlForTemplate("newadmin/batches/detail.html"),link:function(n){n.data={loading:!0,error_message:""},n.prefund=function(){0==(1&n.data.Flags)?o.open({templateUrl:"prefundModalDialog.html",controller:["$scope","$uibModalInstance",function(e,t){e.data={date:new Date,identifier:""},e.cancel=function(){t.dismiss()},e.ok=function(){t.close(e.data)}}],backdrop:"static"}).result.then(function(e){t.admin.batches.prefund(a.id,e.date,e.identifier).then(function(e){for(var t in n.data.error_message="",e)n.data[t]=e[t]},function(e){n.data.error_message=e})},function(){}):alert("This has already been prefunded!")},n.markBatchComplete=function(){o.open({templateUrl:"completeModalDialog.html",controller:["$scope","$uibModalInstance",function(e,t){e.data={date:new Date,identifier:""},e.cancel=function(){t.dismiss()},e.ok=function(){t.close(e.data)}}],backdrop:"static"}).result.then(function(e){t.admin.batches.complete(a.id,e.date,e.identifier).then(function(e){for(var t in n.data.error_message="",e)n.data[t]=e[t]},function(e){n.data.error_message=e})},function(){})},t.admin.batches.get(a.id).then(function(e){for(var t in n.data.loading=!1,n.data.error_message="",e)n.data[t]=e[t]},function(e){n.data.error_message=e})}}}])}(),function(){var e=angular.module("patronicity.admin.bluesnap",["patronicity.api","user","ngTable","ui.bootstrap"]);e.directive("adminBluesnap",function(){return{restrict:"E",scope:{},templateUrl:"adminBluesnap.html"}}),e.directive("bluesnapManager",["api","NgTableParams",function(e,t){return{restrict:"E",scope:{},templateUrl:"bluesnapManager.html",link:function(n){n.listDetails={},e.admin.blueSnap.getLists().then(function(e){n.listDetails.payoutStatusList=e.payoutStatus,n.listDetails.processingStatusList=e.processingStatus}),n.tableParams=new t({page:1,count:25,filter:{},exact:{},sorting:{CreatedAt:"desc"}},{getData:function(t){return n.loading=!0,e.admin.blueSnap.load({page:t.page(),count:t.count(),sorting:t.sorting(),filter:t.filter()}).then(function(e){return t.total(e.total),n.loading=!1,e.items})}}),n.$on("load-accounts",function(){n.tableParams.reload()})}}}]),e.directive("adminBluesnapAccountDetail",["api","$stateParams","patronicityConfig","Dialogs","$sce",function(o,i,e,r,s){return{restrict:"E",scope:{},templateUrl:e.urlForTemplate("newadmin/bluesnap/account-detail.html"),link:function(n){function a(e){n.accountDetail=e.account,n.accountDetail.cannotCloseReason&&(n.accountDetail.cannotCloseReason=s.trustAsHtml(n.accountDetail.cannotCloseReason))}function t(){o.admin.blueSnap.loadAccount(i.id).then(function(e){a(e)})}function e(){o.admin.blueSnap.loadNotes(i.id).then(function(e){n.notes=e.notes})}n.data={processing:!1},t(),o.admin.blueSnap.loadProjects(i.id).then(function(e){n.projects=e.projects}),e(),o.admin.blueSnap.loadPayouts(i.id).then(function(e){n.data.payouts=e.payouts,n.data.transfers=e.transfers}),n.closeAccount=function(){r.Confirm("Are you sure you want to close this account?","Close Account?",[{name:"Close",type:"ok"},{name:"Cancel",type:"cancel"}]).then(function(e){"ok"==e.type&&(n.data.processing=!0,o.admin.blueSnap.closeAccount(n.accountDetail.id).then(function(e){a(e)}).finally(function(){n.data.processing=!1}))},function(){})},n.openAccount=function(){r.Confirm("Are you sure you want to re-open this account?","Re-Open Account?",[{name:"Open",type:"ok"},{name:"Cancel",type:"cancel"}]).then(function(e){"ok"==e.type&&(n.data.processing=!0,o.admin.blueSnap.openAccount(n.accountDetail.id).then(function(e){a(e)}).finally(function(){n.data.processing=!1}))},function(){})},n.sync=function(e){e.preventDefault(),n.data.processing=!0,o.admin.blueSnap.syncAccount(n.accountDetail.id).then(function(e){a(e)}).finally(function(){n.data.processing=!1})},n.setReserve=function(e,t){e.preventDefault(),n.data.processing=!0,o.admin.blueSnap.setReserve(n.accountDetail.id,t).then(function(e){a(e)}).finally(function(){n.data.processing=!1})},n.$on("load-note",function(){e()}),n.deleteDocument=function(e){r.Confirm("Are you sure you want to delete document "+e.medianame," Delete Document ").then(function(){o.admin.blueSnap.deleteDoc(e).then(function(e){t()})})}}}}]),e.directive("accountNoteEdit",["$uibModal","patronicityConfig","api","User",function(t,n,o,i){return{restrict:"E",scope:{accountId:"=",note:"="},template:'<button ng-click="openEditModal()" class="btn btn-primary">{{label}}</button>',link:function(e){e.label="Edit",e.note||(e.label="Add Note"),e.openEditModal=function(){t.open({templateUrl:n.urlForTemplate("newadmin/bluesnap/account-note-edit.html"),controller:["$scope","$uibModalInstance","accountId","note",function(t,n,e,a){i.get().then(function(){t.user=i.current(),t.isNewNote=!1,a?t.editNote=angular.copy(a):(t.editNote={ID:"new",AccountID:e,UserID:t.user.ID},t.isNewNote=!0)}),t.save=function(){o.admin.blueSnap.saveNote(t.editNote).then(function(e){angular.copy(e,a),t.isNewNote&&t.$root.$broadcast("load-note","note"),n.close({})},function(e){t.messageText=e})},t.cancel=function(){n.dismiss({})}}],size:"md",resolve:{note:function(){return e.note},accountId:function(){return e.accountId}}})}}}}]),e.directive("accountNoteDelete",["api","Dialogs",function(n,e){return{restrict:"E",template:'<button ng-click="delete()" class="btn btn-primary">{{label}}</button>',scope:{note:"=?"},link:function(t){t.label="Delete",t.delete=function(){e.Confirm("Are you sure want to delete this note?","Note Delete").then(function(e){"OK"==e.name&&n.admin.blueSnap.deleteNote(t.note).then(function(e){t.$root.$broadcast("load-note","note")})})}}}}])}(),function(){var e=angular.module("patronicity.admin.challenges",["patronicity.api","user","ngTable","ui.bootstrap","googlechart"]);e.directive("adminChallenges",["api","patronicityConfig","$uibModal",function(a,e,t){return{restrict:"E",scope:{},templateUrl:e.urlForTemplate("newadmin/challenges/landing.html"),link:function(e){e.loadChallenge=function(){e.challenges=a.challenges.challenge.query()},e.loadChallenge(),e.$on("load-challenge",function(){e.loadChallenge()}),e.showReportsList=function(e){t.open({templateUrl:"day_report_modal.html",controller:["$scope","$uibModalInstance","challenge",function(t,e,n){t.data={name:n.name,links:[],loading:!0},t.data.loading=!0,a.giving.admin.reports("challenge",n.id).then(function(e){t.data.links=e.links},function(e){alert(e)}).finally(function(){t.data.loading=!1}),t.done=function(){e.close()}}],size:"md",backdrop:!1,resolve:{challenge:function(){return e}}})}}}}]),e.directive("adminChallengeEdit",["api","$uibModal","patronicityConfig","moment",function(o,t,n,e){return{restrict:"E",scope:{challenge:"="},template:'<button ng-click="openEditModal()" class="btn btn-primary btn-sm">{{label}}</button>',link:function(e){e.label="Edit",e.challenge||(e.label="Add Challenge"),e.openEditModal=function(){t.open({templateUrl:n.urlForTemplate("newadmin/challenges/edit.html"),controller:["$scope","$uibModalInstance","challenge","moment",function(t,n,e,a){e?(t.editChallenge=angular.copy(e),console.log("Editing Challenge"),t.title="Edit Challenge "+e.name,t.editChallenge.startDate=a(t.editChallenge.startDate).toDate(),t.editChallenge.endDate=a(t.editChallenge.endDate).toDate(),t.editChallenge.active=1==t.editChallenge.active):(console.log("Creating new Challenge"),t.editChallenge={Id:"new"},t.title="Add New Challenge"),t.presave=function(){o.challenges.save(t.editChallenge).then(function(e){t.$root.$broadcast("load-challenge"),n.close()},function(e){})},t.cancel=function(){n.close()},t.saveButtonText="Save"}],size:"md",backdrop:!1,resolve:{challenge:function(){return e.challenge}}})}}}}]),e.directive("adminChallengeStats",["api","NgTableParams","$stateParams","patronicityConfig",function(a,e,t,n){return{restrict:"E",scope:{id:"@?"},templateUrl:n.urlForTemplate("newadmin/challenges/challengeStats.html"),link:function(n){n.challengeId=t.id,n.otherParams={isLoading:!1},n.totalSignup=0,n.totalAuto=0,n.totalManual=0,n.totalGoal=0,n.filter={Currency:"*",StartDate:null,EndDate:null},n.tableParams=new e({id:t.id,page:1,count:50,filter:n.filter,sorting:{signedUp:"desc"}},{getData:function(e){n.otherParams.isLoading=!0;var t=jQuery.param(e.url());return n.url=t,a.challenges.adminChallengeStats.get(e.url()).$promise.then(function(e){n.challengeStats=e.result,n.otherParams.isLoading=!1})}}),n.averageDonation=function(e,t){return e/t}}}}]),e.filter("sumStats",function(){return function(e,t){var n,a=0;for(n in e)e[n][t]?a+=+e[n][t]:e[n].stats[t]&&(a+=+e[n].stats[t]);return a}}),e.directive("adminChallengeUserStats",["api","NgTableParams","$stateParams","patronicityConfig","Dialogs","$state","User",function(i,e,t,n,r,s,c){return{restrict:"E",scope:{id:"@?"},templateUrl:n.urlForTemplate("newadmin/challenges/userStats.html"),link:function(a){a.otherParams={isLoading:!1},a.challenge=i.challenges.challenge.get({id:t.id});var n=t.id||a.id,o={};a.$on("user:login-change",function(e,t){a.isAdmin=c.isAdmin()}),a.tableParams=new e({id:n,page:1,count:50,filter:{},sorting:{name:"desc"}},{getData:function(t){a.otherParams.isLoading=!0;var e=jQuery.param(t.url());return a.url=e,i.challenges.adminChallengeUserStats(n,t.url()).then(function(e){return a.user=e.items,a.total=e.total[0].count,a.otherParams.isLoading=!1,t.total(a.total),a.user.forEach(function(e){e.profile_url="/user"+s.href("user.editprofile",{username:e.UserName}),e.referusername&&(e.refer_profile_url="/user"+s.href("user.editprofile",{username:e.referusername})),2&e.status?e.isSuspended=!0:e.isSuspended=!1},function(e){alert(e)}),a.user})}}),a.flagSet=function(e,t){return(e&t)==t},a.$on("reload-data",function(){a.tableParams.reload()}),a.setStatus=function(e,t){o.id=n,o.type="challenge",o.newstatus=t,o.userID=e.userID,o.slug=e.slug,("Active"==t?r.Confirm("Are you sure you want to activate this user in this challenge? ",t+" User",[{name:"Activate",type:"ok"},{name:"Cancel",type:"cancel"}]):r.Confirm("Are you sure you want to "+t+" "+e.name+" ("+e.email+") ?",t+" User",[{name:t,type:"ok"},{name:"Cancel",type:"cancel"}])).then(function(){a.saveNewStatus(o)},function(){})},a.saveNewStatus=function(n){i.giving.setStatus(n).then(function(e){a.tableParams.reload();var t={ramadan:!1,dhul_hijjah:!1,friday_givers:!1};i.user.getGivingEnrollment().then(function(e){angular.forEach(e,function(e){1==e.value&&(t[e.type]=!0)});e={ramadan_challenge_2023:"ramadan",dhul_hijjah_2022:"dhul_hijjah","friday-givers":"friday_givers"}[n.slug];t[e]=!1,i.user.saveGivingEnrollment(void 0,t.ramadan,t.dhul_hijjah,t.friday_givers).then(function(e){})})},function(e){console.log("Remove failed: "+e)})}}}}]),e.directive("adminChallengeUsers",["api","$stateParams","patronicityConfig",function(n,a,e){return{restrict:"E",scope:{id:"@?"},templateUrl:e.urlForTemplate("newadmin/challenges/users.html"),link:function(t){t.challengeId=a.id,t.loading=!0,t.challengeStats=n.challenges.adminChallengeUsers(a.id).then(function(e){t.loading=!1,t.challengeUsers=e}),t.pauseUser=function(e){n.giving.admin.settings.save("challenge",a.id,e,{donation_method:"manual"}).then(function(e){alert("User is successfully paused")})}}}}]),e.directive("adminChallengeGraphStats",["api","$stateParams","patronicityConfig",function(e,n,t){return{restrict:"E",scope:{id:"@"},templateUrl:t.urlForTemplate("newadmin/graph-stats.html"),link:function(t){e.challenges.challenge.get({id:n.id}).$promise.then(function(e){t.stats=e}),t.type="challenge"}}}]),e.directive("manualAutomaticSourceChart",["api","$stateParams","patronicityConfig",function(e,n,t){return{restrict:"E",scope:{givingtype:"=",currency:"=",challenge:"=",type:"@"},template:'<button class="btn btn-primary" ng-click="reloadData()">Reload</button><div google-chart chart="manualSourceChartObject" style="height:600px; width:100%;"></div>',link:function(t){t.manualSourceChartObject={},t.manualSourceChartObject.type="BarChart",t.manualSourceChartObject.options={title:t.type+" donations per source"},t.reloadData=function(){e.admin.manualAutomaticSourceChart(n.id,t.givingtype,t.type,t.currency).then(function(e){t.manualSourceChartObject.data=e})},t.reloadData(),t.$watch("currency",function(){t.reloadData()},!0)}}}]),e.directive("adminChallengeSourceSummary",["api","NgTableParams","$stateParams","patronicityConfig",function(a,e,t,n){return{restrict:"E",scope:{id:"@?"},templateUrl:n.urlForTemplate("newadmin/challenges/sourcesummary.html"),link:function(n){n.otherParams={isLoading:!1},n.head=a.challenges.challenge.get({id:t.id}),n.tableParams=new e({id:t.id,page:1,count:50,filter:{source:""},sorting:{counted:"desc"}},{getData:function(e){console.log("getting data"),n.otherParams.isLoading=!0;var t=jQuery.param(e.url());return n.url=t,a.challenges.ChallengeSourceSummary.get(e.url()).$promise.then(function(e){return n.user=e.result.items,n.otherParams.isLoading=!1,n.user},function(e){})}})}}}]),e.directive("adminChallengeReferralSummary",["api","NgTableParams","$stateParams","patronicityConfig","$state",function(a,e,t,n,o){return{restrict:"E",scope:{id:"@?"},templateUrl:n.urlForTemplate("newadmin/challenges/referralsummary.html"),link:function(n){n.otherParams={isLoading:!1},n.head=a.challenges.challenge.get({id:t.id}),n.tableParams=new e({id:t.id,page:1,count:50,filter:{user:""},sorting:{referral_count:"desc"}},{getData:function(e){console.log("getting data"),n.otherParams.isLoading=!0;var t=jQuery.param(e.url());return n.url=t,a.challenges.ChallengeReferralSummary.get(e.url()).$promise.then(function(e){return n.user=e.result.items,n.otherParams.isLoading=!1,n.user.forEach(function(e){e.userName&&(e.profileurl="/user"+o.href("user.editprofile",{username:e.userName}))}),n.user},function(e){})}})}}}]),e.directive("adminChallengePreview",["api","$stateParams","$compile",function(a,o,i){return{restrict:"E",scope:{},link:function(t,n,e){o.id;a.challenges.challenge.query({"exact[id]":o.id}).$promise.then(function(e){e.length?(n.html('<challenge-page slug="'+e[0].slug+'"></challenge-page>'),n.replaceWith(i(n.html())(t))):n.html("<h2>No matching challenge found!</h2>")})}}}]),e.directive("adminChallengeSourceStats",[function(){return{restrict:"E",scope:{users:"="},templateUrl:"adminChallengeSourceStats.html",link:function(n){n.$watch("users",function(e,t){e!==t&&n.sourceStats()}),n.sources={},n.userStats={},n.sourceStats=function(){angular.forEach(n.users,function(e){e.source?n.sources[e.source]?n.sources[e.source]+=1:n.sources[e.source]=1:n.sources.none?n.sources.none+=1:n.sources.none=1,e.referringUser&&(n.userStats[e.referringUser.id]?n.userStats[e.referringUser.id].count+=1:(n.userStats[e.referringUser.id]=e.referringUser,n.userStats[e.referringUser.id].count=1)),n.sourcesArray=[],angular.forEach(n.sources,function(e,t){n.sourcesArray.push({source:t,count:e})}),n.userStatsArray=[],angular.forEach(n.userStats,function(e,t){n.userStatsArray.push({userId:t,user:e})}),n.userStatsArray.sort(function(e,t){return-(e.user.count-t.user.count)})})}}}}]),e.directive("adminChallengeLeaderboard",["api","$stateParams","patronicityConfig","$uibModal",function(e,t,a,o){return{restrict:"E",template:"<a class='btn btn-primary btn-sm' ng-click='openEditModal()'> {{buttonLabel}} </a>",scope:{challengeId:"@?",startDate:"=?",endDate:"=?",countBy:"=?",type:"@?",sponsorIds:"=?"},link:function(e,t,n){null==e.type||""==e.type?(e.buttonLabel="Leaderboard",e.type="challenge"):"challenge"==e.type?e.buttonLabel="Leaderboard":"givingtuesday"==e.type?e.buttonLabel="GT Leaderboard":"rasul"==e.type&&(e.buttonLabel="Rasul Leaderboard"),e.openEditModal=function(){o.open({templateUrl:a.urlForTemplate("newadmin/challenges/leaderboard.html"),controller:["$scope","$uibModalInstance","challengeId","startDate","endDate","countBy","type","sponsorIds",function(a,e,o,t,n,i,r,s){null==r||""==r?a.type="challenge":(a.type=r,a.countBy=i,a.startDate=t,a.endDate=n),void 0===r&&"rasul"!=r||(a.sponsorIdsForReport="",a.sponsorIds=s,angular.forEach(s,function(e){a.sponsorIdsForReport+=e+" "})),a.cancel=function(){e.close()},a.downloadUrl=function(e,t,n){return"challenge"==n?"/api/challenges/leaderboardReport/"+o+"/"+e+"/"+t:"rasul"==n?"/api/challenges/leaderboardReport/rasul/"+e+"/"+t+"/0/"+a.sponsorIdsForReport:"/api/challenges/leaderboardReport/givingtuesday/"+e+"/"+t},a.downloadDefaultUrl=function(e,t,n){return"/api/challenges/leaderboardReport/default/"+e+"/"+t},a.downloadCountryUrl=function(e,t,n){return"/api/challenges/leaderboardReport/country/"+e+"/"+t+"/0/null/MY "},a.showLeaderboard=!1}],size:"md",backdrop:!1,resolve:{challengeId:function(){return e.challengeId},startDate:function(){return e.startDate},endDate:function(){return e.endDate},countBy:function(){return e.countBy},type:function(){return e.type},sponsorIds:function(){return e.sponsorIds}}})}}}}])}(),function(){var e=angular.module("patronicity.admin.clubs",["patronicity.api","user","ngTable","ui.bootstrap","googlechart"]);e.directive("adminClubs",["api","patronicityConfig","$uibModal",function(a,e,t){return{restrict:"E",scope:{},templateUrl:e.urlForTemplate("newadmin/clubs/landing.html"),link:function(e){e.loadClub=function(){e.clubs=a.clubs.clubLoad.query()},e.loadClub(),e.$on("load-clubs",function(){e.loadClub()}),e.showReportsList=function(e){t.open({templateUrl:"club_day_report_modal.html",controller:["$scope","$uibModalInstance","club",function(t,e,n){t.data={name:n.name,links:[],loading:!0},t.data.loading=!0,a.giving.admin.reports("club",n.id).then(function(e){t.data.links=e.links},function(e){alert(e)}).finally(function(){t.data.loading=!1}),t.done=function(){e.close()}}],size:"md",backdrop:!1,resolve:{club:function(){return e}}})}}}}]),e.directive("adminClubEdit",["api","$uibModal","patronicityConfig","moment",function(o,t,n,e){return{restrict:"E",scope:{club:"="},template:'<button ng-click="openEditModal()" class="btn btn-primary btn-sm">{{label}}</button>',link:function(e){e.label="Edit",e.club||(e.label="Add Giving Club"),e.openEditModal=function(){t.open({templateUrl:n.urlForTemplate("newadmin/clubs/add.html"),controller:["$scope","$uibModalInstance","club","moment",function(t,n,e,a){e?(t.editClub=angular.copy(e),console.log("Editing club"),t.title="Edit Club "+e.name,t.editClub.startDate=a(t.editClub.startDate).toDate(),t.editClub.endDate=a(t.editClub.endDate).toDate(),t.editClub.flags=1==t.editClub.flags):(console.log("Creating new club"),t.editClub={Id:"new"},t.title="Add New Club"),t.presave=function(){o.clubs.save(t.editClub).then(function(e){t.$root.$broadcast("load-clubs"),n.close()},function(e){})},t.cancel=function(){n.close()},t.saveButtonText="Save"}],size:"md",backdrop:!1,resolve:{club:function(){return e.club}}})}}}}]),e.directive("adminClubStats",["api","NgTableParams","$stateParams","patronicityConfig","Dialogs","$state",function(o,e,t,n,i,r){return{restrict:"E",scope:{id:"@?"},templateUrl:n.urlForTemplate("newadmin/clubs/stats.html"),link:function(a){a.club=o.clubs.clubLoad.get({id:t.id}),a.otherParams={isLoading:!1},a.filter={Currency:"*"},a.tableParams=new e({id:t.id,page:1,count:50,filter:a.filter,sorting:{name:"desc"}},{getData:function(t){console.log("getting data"),a.otherParams.isLoading=!0;var n=a.filter.Currency,e=jQuery.param(t.url());return a.url=e,o.clubs.userStats.get(t.url()).$promise.then(function(e){return a.user=e.result.items,a.total=e.result.total[0].count,a.otherParams.isLoading=!1,a.selectedCurrency="*"==n?"USD":n,t.total(a.total),console.log(a.total),a.user.forEach(function(e){1&e.status?e.isActive=!0:e.isActive=!1,2&e.status?e.isSuspended=!0:e.isSuspended=!1,4&e.status?e.isMigrated=!0:e.isMigrated=!1,e.referusername&&(e.profileurl="/user"+r.href("user.editprofile",{username:e.referusername}))},function(e){}),a.user})}}),a.pauseUser=function(e){a.donation_method_setting="automatic"==e.donation_method?"manual":"automatic",o.giving.admin.settings.save("club",t.id,e.id,{donation_method:a.donation_method_setting}).then(function(e){a.tableParams.reload()},function(e){console.log("Pause failed: "+e),a.messageText=e})},a.removeUser=function(e){i.Confirm("Are you sure you want to remove this user?","Remove User",[{name:"Remove",type:"ok"},{name:"Cancel",type:"cancel"}]).then(function(){o.giving.admin.settings.save("club",t.id,e,{newState:"inactive"}).then(function(e){a.tableParams.reload()},function(e){console.log("Remove failed: "+e),a.messageText=e})},function(){})},a.$on("reload-data",function(){console.log("reload requested"),a.tableParams.reload()}),a.$watch("filter",function(e,t){e!=t&&a.tableParams.reload()},!0),a.statusCheck=function(e){return 2&e?"InActive":"Active"}}}}]),e.directive("adminClubGraphStats",["api","$stateParams","patronicityConfig",function(t,n,e){return{restrict:"E",scope:{id:"@?"},templateUrl:e.urlForTemplate("newadmin/graph-stats.html"),link:function(e){e.stats=t.clubs.clubLoad.get({id:n.id}),e.type="club",e.$watch("currency",function(){e.$root.$broadcast("load-graph",e.currency)},!0)}}}]),e.directive("adminClubSourceSummary",["api","NgTableParams","$stateParams","patronicityConfig",function(a,e,t,n){return{restrict:"E",scope:{id:"@?"},templateUrl:n.urlForTemplate("newadmin/challenges/sourcesummary.html"),link:function(n){n.otherParams={isLoading:!1},n.head=a.clubs.clubLoad.get({id:t.id}),n.tableParams=new e({id:t.id,page:1,count:50,filter:{source:""},sorting:{counted:""}},{getData:function(e){console.log("getting data"),n.otherParams.isLoading=!0;var t=jQuery.param(e.url());return n.url=t,a.clubs.ClubSourceSummary.get(e.url()).$promise.then(function(e){return n.user=e.result.items,n.otherParams.isLoading=!1,n.user},function(e){})}})}}}]),e.directive("adminClubReferralSummary",["api","NgTableParams","$stateParams","patronicityConfig","$state",function(a,e,t,n,o){return{restrict:"E",scope:{id:"@?"},templateUrl:n.urlForTemplate("newadmin/challenges/referralsummary.html"),link:function(n){n.otherParams={isLoading:!1},n.head=a.clubs.clubLoad.get({id:t.id}),n.tableParams=new e({id:t.id,page:1,count:50,filter:{user:""},sorting:{referral_count:""}},{getData:function(e){console.log("getting data"),n.otherParams.isLoading=!0;var t=jQuery.param(e.url());return n.url=t,a.clubs.ClubReferralSummary.get(e.url()).$promise.then(function(e){return n.user=e.result.items,n.otherParams.isLoading=!1,n.user.forEach(function(e){e.userName&&(e.profileurl="/user"+o.href("user.editprofile",{username:e.userName}))}),n.user},function(e){})}})}}}]),e.directive("editUserSettings",["api","$uibModal","patronicityConfig","moment","$stateParams","CurrencyCodeProvider","Dialogs",function(s,c,n,e,l,t,u){return{restrict:"E",scope:{setting:"="},template:'<button ng-click="openEditModal()" class="btn btn-primary btn-sm">{{label}}</button>',link:function(e,t,r){e.label="Edit Settings",e.openEditModal=function(){c.open({templateUrl:n.urlForTemplate("newadmin/clubs/edit-user-settings.html"),controller:["$scope","$uibModalInstance","setting","moment","CurrencyCodeProvider",function(t,e,n,a,o){t.editUserSetting=angular.copy(n);l.name||r.slug;var i=l.type||r.type||"club";t.currencyCodes=["USD "],o.supportedCodes(i).then(function(e){t.currencyCodes=e.map(function(e){return e.code})}),t.loading=!0,t.getUserSetting=function(){s.giving.admin.settings.load(i,l.id,n.id).then(function(e){t.user=e,t.loading=!1},function(e){t.loading=!1}),s.user.cards.list(n.UserName).then(function(e){t.cards=e.cards})},t.getUserSetting(),t.presave=function(){s.giving.admin.settings.save(i,l.id,n.id,t.user.settings).then(function(){e.close(),t.$root.$broadcast("reload-data")},function(e){})},t.cancel=function(){e.close()},t.saveButtonText="Save",t.disqualify=function(){u.SingleTextAreaEntry("Reason","Disqualify Referral").then(function(e){s.giving.referral.forceDisqualify(n.id,l.id,e.textAreaEntry).then(function(e){console.log(e),t.getUserSetting()})})},t.qualify=function(){u.SingleTextAreaEntry("Reason","Force Qualify Referral").then(function(e){s.giving.referral.forceQualify(n.id,l.id,e.textAreaEntry).then(function(e){console.log(e),t.getUserSetting()})})},t.isValidReferral=function(e){var t=!1;return t=e?null==e.RemovedDate:t},t.hasCurrentTeam=function(){var e=!1;return e=t.user&&t.user.team&&t.user.team.current&&t.user.team.current.ChallengeTeamID?!0:e},t.hasHistoricalTeam=function(){var e=!1;return e=t.user&&t.user.team&&t.user.team.history&&t.user.team.history.length?!0:e},t.addTeam=function(){c.open({templateUrl:"addTeam.html",controller:["$scope","$uibModalInstance","api","userId","challengeId",function(t,n,e,a,o){t.teamData={searchResults:[],searchTerm:"",selectedTeam:{},showSearch:!1,showAddTeam:!1,searching:!1,newTeamDetails:{joinDate:null,reason:null}},t.search=function(){t.teamData.showSearch=!0,t.teamData.showAddTeam=!1,t.teamData.searching=!0,e.projectAdmin.challengeTeam.searchTeams(t.teamData.searchTerm,o).then(function(e){console.log(e),t.teamData.searchResults=e,t.teamData.searching=!1})},t.teamSelected=function(e){console.log(e),t.teamData.showSearch=!1,t.teamData.showAddTeam=!0,t.teamData.selectedTeam=e},t.confirmNewTeam=function(){e.giving.referral.add(o,a,t.teamData.selectedTeam.ID,t.teamData.newTeamDetails.reason,t.teamData.newTeamDetails.joinDate).then(function(e){n.close({reload:!0})})},t.cancel=function(){n.close({reload:!1})}}],size:"md",backdrop:!1,resolve:{userId:function(){return n.id},challengeId:function(){return l.id}}}).result.then(function(e){e&&e.reload&&t.getUserSetting()})}}],size:"md",backdrop:!1,resolve:{setting:function(){return e.setting}}})}}}}]),e.directive("teamMembershipDetail",["api","patronicityConfig",function(e,t){return{restrict:"E",scope:{detail:"=",historical:"@"},templateUrl:"referralDetail.html",link:function(n){n.isValidReferral=function(e){var t=!1;return t=e?null==e.RemovedDate:t},n.panelHeadingClass=function(){var e=n.isValidReferral(n.detail),t="panel-default";return t="1"!=n.historical?e?"panel-success":"panel-danger":t}}}}])}(),function(){var e=angular.module("patronicity.admin.forms",["patronicity.api","user","ngTable","ui.bootstrap"]);e.directive("adminForms",function(){return console.log("adminForms!"),{restrict:"E",scope:{},templateUrl:"adminForms.html"}}),e.directive("formsManager",["api","NgTableParams",function(e,t){return{restrict:"E",scope:{},templateUrl:"formsManager.html",link:function(n){n.tableParams=new t({page:1,count:25,filter:{},exact:{},sorting:{ID:"asc"}},{getData:function(t){return n.loading=!0,e.admin.forms.load({page:t.page(),count:t.count(),sorting:t.sorting(),filter:t.filter()}).then(function(e){return t.total(e.total),n.loading=!1,e.items})}}),n.$on("load-forms",function(){n.tableParams.reload()})}}}]),e.directive("formEdit",["$uibModal","patronicityConfig","api","$window","Dialogs",function(t,n,o,e,i){return{restrict:"E",template:'<button ng-click="openEditModal()" class="btn btn-primary">{{label}}</button>',scope:{form:"="},link:function(e){e.label="Edit",e.form||(e.label="Add Form"),e.openEditModal=function(){t.open({templateUrl:n.urlForTemplate("newadmin/forms/form-edit.html"),controller:["$scope","$uibModalInstance","form",function(t,n,a){t.isNewForm=!1,t.allowDelete=!1,t.listDetails={},a?(console.log("Editing form"),t.editForm=angular.copy(a)):(console.log("Creating new form"),t.editForm={ID:"new"},t.isNewForm=!0),t.delete=function(){i.Confirm("Deleting a form could make bad things happen. Are you sure you want to remove "+t.editForm.ShortName+" form definition?","Remove Form Definition").then(function(){console.log("Deleting form"),o.admin.forms.delete(t.editForm.ID).then(function(e){console.log("form deleted so requesting reload"+a),t.$root.$broadcast("load-forms","form"),n.close({})},function(e){console.log("Delete failed: "+e),t.messageText=e})})},t.cancel=function(){n.dismiss({})},t.preSave=function(){console.log("Validating Slug: "+t.editForm.ShortName),t.messageText="",t.dupSlug=!1,o.admin.forms.verifySlug(t.editForm.ShortName).then(function(e){t.forms=e.forms,t.forms&&angular.forEach(t.forms,function(e){e.ID!=t.editForm.ID&&(t.dupSlug=!0)}),t.dupSlug?(t.messageText="Slug validation failed: Slug must be unique.",console.log(t.messageText)):(Array.isArray(t.editForm.JSONFields)&&console.log("JSONFields is an array."),console.log("Saving form"),o.admin.forms.save(t.editForm).then(function(e){angular.copy(e,a),t.isNewForm&&(console.log("new form so requesting reload"+a),t.$root.$broadcast("load-forms","form")),n.close({})},function(e){console.log("Save failed: "+e),t.messageText=e}))})}}],size:"md",resolve:{form:function(){return e.form}}})}}}}]),e.directive("adminFormsFields",["api","$stateParams","patronicityConfig","$timeout","Dialogs",function(t,n,e,i,r){return{restrict:"E",templateUrl:e.urlForTemplate("newadmin/forms/fields.html"),link:function(a){a.formId=n.id,console.log("id: "+a.formId),a.isDirty=!1;var e;a.isSaving=!1;function o(){a.isSaving?void 0===e&&(e=i(function(){e=void 0,o()},5e3)):a.saveFormFields()}a.sortableOptions={update:function(e,t){},stop:function(e,t){o()}},a.moveToTop=function(e){for(var t=0;t<a.formDetail.JSONFields.length;t++)if(a.formDetail.JSONFields[t].name==e.name){var n=a.formDetail.JSONFields.splice(t,1);a.formDetail.JSONFields.unshift(n[0]),o();break}},a.saveFormFields=function(){a.isSaving=!0,t.admin.forms.save(a.formDetail).then(function(e){a.isDirty=!1,a.isSaving=!1,angular.copy(e,a.formDetail)})},a.removeField=function(t){r.Confirm("Deleting a field will remove the related field and stored data from all other forms. Are you sure you want to remove "+t.name+" from the form definition?","Remove From Form Definition").then(function(){var e=a.formDetail.JSONFields.filter(function(e){return e.name!=t.name});e.length!=a.formDetail.JSONFields.length&&(a.formDetail.JSONFields=e,o())})},a.$on("load-fields",function(){console.log("reload requested"),o()}),console.log("Load Form: "+n.id),t.admin.forms.loadForm(n.id).then(function(e){a.formDetail=e.form})}}}]),e.directive("fieldEdit",["$uibModal","patronicityConfig","api","Dialogs",function(t,n,r,s){return{restrict:"E",scope:{form:"=",field:"="},template:'<button ng-click="openEditModal()" class="btn btn-primary">{{label}}</button>',link:function(e){e.label="Edit",e.field||(e.label="Add Field"),e.openEditModal=function(){t.open({templateUrl:n.urlForTemplate("newadmin/forms/field-edit.html"),controller:["$scope","$uibModalInstance","form","field",function(n,t,a,e){function o(){console.log("Saving form and field"),r.admin.forms.save(n.formDetail).then(function(e){angular.copy(e,a),n.isNewField&&(console.log("new form so requesting reload"+a),n.$root.$broadcast("load-forms","form")),t.close({})},function(e){console.log("Save failed: "+e),n.messageText=e})}var i;n.formDetail=a,null===n.formDetail.JSONFields&&(n.formDetail.JSONFields=[]),console.log("formId: "+n.formDetail.ID),n.isNewField=!1,e?(console.log("Editing form field"),n.editField=angular.copy(e),n.originalName=n.editField.name):(console.log("Creating new form field"),n.editField={},n.isNewField=!0),n.delete=function(){s.Confirm("Deleting a field will remove the related field and stored data from all other forms. Are you sure you want to remove "+n.originalName+" from the form definition?","Remove From Form Definition").then(function(){console.log("Deleting field"),angular.forEach(n.formDetail.JSONFields,function(e){e.name==n.originalName&&(e=n.formDetail.JSONFields.indexOf(e),n.formDetail.JSONFields.splice(e,1))}),o()})},n.cancel=function(){t.dismiss({})},n.preSave=function(){var t=!0;n.editField.default||(n.editField.default=""),n.isNewField?n.formDetail.JSONFields.push(n.editField):(n.originalName!=n.editField.name&&angular.forEach(n.names,function(e){e==n.editField.name&&(t=!1,n.messageText="Duplicate field name: "+n.editField.name)}),t&&angular.forEach(n.formDetail.JSONFields,function(e){e.name==n.originalName&&(e=n.formDetail.JSONFields.indexOf(e),n.formDetail.JSONFields.splice(e,1,n.editField))})),t&&o()},i=0,n.names={},angular.forEach(n.formDetail.JSONFields,function(e){n.names[i]=e.name,i++}),console.log("Load Type List"),r.admin.forms.loadTypes().then(function(e){n.typeList=e.types})}],size:"md",resolve:{field:function(){return e.field},form:function(){return e.form}}})}}}}])}(),function(){var e=angular.module("patronicity.admin.giving",["patronicity.api","user","ngTable","ui.bootstrap","googlechart"]);e.directive("adminGivingEditProjects",["api","$stateParams","patronicityConfig",function(t,n,e){return{restrict:"E",scope:{id:"@?"},templateUrl:e.urlForTemplate("newadmin/giving/projects.html"),link:function(e){"club"==n.type?e.club=t.clubs.clubLoad.get({id:n.id}):"challenge"==n.type&&(e.challenge=t.challenges.challenge.get({id:n.id}))}}}]),e.directive("smallProgressBar",function(){return{restrict:"E",template:'<uib-progressbar style="width: 100%; height: 10px; margin: 0px;" type="{{ type }}" value="value"></uib-progressbar>',scope:{value:"="},link:function(n){n.type="info",n.$watch("value",function(e,t){n.type=100<e?"danger":80<e?"warning":"normal"})}}}),e.directive("adminGivingProjects",["api","$stateParams","Dialogs","$uibModal","patronicityConfig","$timeout",function(r,s,e,n,a,u){return{restrict:"E",scope:{},templateUrl:"adminGivingProjects.html",link:function(c){function o(e){e.EarnedBoost=parseFloat(e.EarnedBoost),e.RamadanBoost=parseFloat(e.RamadanBoost),e.ProjectGoal?e.FundedPercent=Math.round(100*e.ProjectPledgeAmount/e.ProjectGoal):e.FundedPercent=0,e.AutoLimit?e.AutoFundedPercent=Math.round(100*e.AutoDonatedAmount/e.AutoLimit):e.AutoFundedPercent=0,e.ManualLimit?e.ManualFundedPercent=Math.round(100*e.ManualDonatedAmount/e.ManualLimit):e.ManualFundedPercent=0}function l(e,t){t&&(e.Move=t);var a="new"==e.ID;r.giving.projects.save(s.type,s.id,e.ID,e).then(function(e){var n=e[0];o(n),a?(c.givingProjects.splice(0,0,n),c.currentProjectIds.splice(0,0,n.ProjectID),c.changeLimit(n)):angular.forEach(c.givingProjects,function(e,t){e.ID==n.ID&&(c.givingProjects[t]=n)}),i()},function(e){alert(e)})}function i(){r.giving.projects.allocated_total(s.type,s.id).then(function(e){c.allocatedAmount=e},function(e){alert(e)})}c.cards={cards:[]},c.currentProjectIds=[],c.clubOrChallengeType=s.type,"club"==s.type?c.club=r.clubs.clubLoad.get({id:s.id}):"challenge"==s.type&&(c.challenge=r.challenges.challenge.get({id:s.id})),c.isDirty=!1,c.isSaving=!1,c.loadingProjects=!0,c.allocatedAmount=!1,c.loadingProjects=!0,r.giving.projects.load(s.type,s.id).then(function(e){c.givingProjects=e;var t=[];angular.forEach(e,function(e){t.push(e.ProjectID),o(e)}),function t(){var e=[];var n;for(n=0;n<c.givingProjects.length;n++){var a=c.givingProjects[n];if(!a.StatsLoaded&&(e.push(a.ProjectID),20<e.length))break}e.length&&r.giving.projects.loadSlowStats(s.type,s.id,e).then(function(e){angular.forEach(e,function(e){for(n=0;n<c.givingProjects.length;n++)if(c.givingProjects[n].ProjectID==e.ProjectID){c.givingProjects[n].StatsLoaded=!0,c.givingProjects[n].EarnedBoost=e.EarnedBoost,c.givingProjects[n].EarnedBoostInUSD=e.EarnedBoostInUSD,c.givingProjects[n].RamadanBoost=e.RamadanBoost,c.givingProjects[n].RamadanBoostInUSD=e.RamadanBoostInUSD;break}}),u(function(){t()},0)})}(),c.currentProjectIds=t,c.loadingProjects=!1}),i(),c.sortableOptions={update:function(e,t){},stop:function(e,t){var n,a,o,i,r,s;t.item.sortable.index!=t.item.sortable.dropindex&&(n=t.item.data("$scope").givingProject.ID,s=!1,angular.forEach(c.givingProjects,function(e,t){e.ID==n?(a=e,o=r,s=!0):s&&!i&&(i=e.Lexorank),r=e.Lexorank}),l(a,void 0===o?"first":null==i?"last":o+"|"+i))}},c.moveToTop=function(e){for(var t=0;t<c.givingProjects.length;t++)if(c.givingProjects[t].ProjectID==e.ProjectID){var n=c.givingProjects.splice(t,1);c.givingProjects.unshift(n[0]),l(n[0],"first");break}},c.moveToBottom=function(e){for(var t=0;t<c.givingProjects.length;t++)if(c.givingProjects[t].ProjectID==e.ProjectID){var n=c.givingProjects.splice(t,1);c.givingProjects.push(n[0]),l(n[0],"last");break}},c.$on("project-selected",function(e,t){var n=.15*t.project.Goal,a=.15*t.project.Goal,t=(0==t.project.FundingOption&&(n=0),{ID:"new",ProjectID:t.project.ID,DonatedAmount:0,DonationLimit:1e3,AutoDonatedAmount:0,AutoLimit:n,ManualDonatedAmount:0,ManualLimit:a});"club"==s.type?t.ClubID=s.id:"challenge"==s.type&&(t.ChallengeID=s.id),l(t,"first")}),c.changeLimit=function(t){n.open({templateUrl:a.urlForTemplate("newadmin/giving/edit-limit.html"),controller:["$scope","$uibModalInstance","item",function(a,t,e){a.data={challengeType:!1,projectName:e.ProjectName,currencySymbol:e.ProjectCurrencySymbol,donatedAmount:e.DonatedAmount,autoLimitType:null==e.AutoLimit?"unlimited":"limited",autoLimit:e.AutoLimit,autoDonatedAmount:e.AutoDonatedAmount,manualLimit:e.ManualLimit,currency:e.ProjectCurrency,manualDonatedAmount:e.ManualDonatedAmount,showAddAutoUSD:!1,addAutoUsdAmount:0},a.invalidData=function(){var e=!1;return e="unlimited"==a.data.autoLimitType?!0:e},a.addUSDAmountToAutoLimit=function(){var t,n;a.data.addAutoUsdAmount&&(t=parseFloat(a.data.autoLimit),n=parseFloat(a.data.addAutoUsdAmount),"USD"==a.data.currency?(a.data.autoLimit=Math.round(t+n),a.cancelAddAutoAmount()):r.exchangeRate("USD",a.data.currency).then(function(e){n=Math.round(e.rate*n),a.data.autoLimit=Math.round(t+n),a.cancelAddAutoAmount()},function(e){alert(e)}))},a.showAddAutoAmount=function(){a.data.showAddAutoUSD=!0,a.data.addAutoUsdAmount=0},a.cancelAddAutoAmount=function(){a.data.showAddAutoUSD=!1,a.data.addAutoUsdAmount=0},a.save=function(){var e={AutoLimit:"unlimited"==a.data.autoLimitType?null:a.data.autoLimit,ManualLimit:"unlimited"==a.data.manualLimitType?null:a.data.manualLimit};t.close(e)},a.cancel=function(){t.dismiss()}}],size:"sm",resolve:{item:function(){return angular.copy(t)}}}).result.then(function(e){t.AutoLimit=e.AutoLimit,t.ManualLimit=e.ManualLimit,l(t)})},c.removeItem=function(t){e.Confirm("Are you sure you want to remove "+t.ProjectName+"?","Remove From Giving").then(function(){var e=c.givingProjects.filter(function(e){return e.ProjectID!=t.ProjectID});e.length!=c.givingProjects.length&&(c.givingProjects=e,c.currentProjectIds=c.currentProjectIds.filter(function(e){return e!=t.ProjectID}),r.giving.projects.delete(s.type,s.id,t.ID).then(function(e){},function(e){alert(e)}))})},c.rowClass=function(e){var t=[];return e.AutoLimit||t.push("danger"),0==t.length&&1!=parseInt(e.ProjectStatus)&&t.push("warning"),0==t.length&&e.EarnedBoost>e.RamadanBoost&&t.push("info"),t.join(" ")},c.calcEstimatedDonations=function(){c.calcEstimates=!0,r.giving.projects.donationEstimate(s.type,s.id).then(function(e){for(var t=0;t<c.givingProjects.length;t++)c.givingProjects[t].NextDonation=0;e.forEach(function(e){for(var t=0;t<c.givingProjects.length;t++)c.givingProjects[t].ProjectID==e.ProjectID&&(c.givingProjects[t].NextDonation=e.Donated)}),c.calcEstimates=!1})}}}}])}(),function(){var e=angular.module("patronicity.admin.internal",["patronicity.api","user","ngTable","ui.bootstrap","patronicity.admin.transfers"]);e.directive("adminInternalAccounts",["api","patronicityConfig","NgTableParams",function(e,t,n){return{restrict:"E",scope:{},templateUrl:t.urlForTemplate("newadmin/account/admin-internal-accounts.html"),link:function(o){function a(e,t){var n={};switch(e){case"status":switch(t){case"approved":n="label-success";break;case"incomplete":case"pending":case"closed":n="label-warning";break;default:n="label-danger"}break;case"processing":switch(t){case"approved":n="label-success";break;case"incomplete":case"pending":n="label-warning";break;default:n="label-danger"}break;case"payout":switch(t){case"approved":n="label-success";break;case"fraud":case"declined":n="label-danger";break;default:n="label-warning"}break;case"compliance":switch(t){case"approved":n="label-success";break;case"pending":case"in_review":n="label-warning";break;case"rejected":n="label-danger";break;case"incomplete":case"waiting_customer":n="label-default";break;default:n="label-danger"}}return n}function i(e,t){var n="Unknown",a=[];switch(e){case"status":a=o.listDetails.statusList;break;case"processing":a=o.listDetails.processingStatusList;break;case"payout":a=o.listDetails.payoutStatusList;break;case"compliance":a=o.listDetails.complianceStatusList;break;case"tax_registration":a=o.listDetails.taxRegistrationStatusList}return a.forEach(function(e){e.id==t&&(n=e.label)}),n}o.listDetails={},e.admin.account.getLists().then(function(e){o.listDetails.payoutStatusList=e.payoutStatus,o.listDetails.processingStatusList=e.processingStatus,o.listDetails.statusList=e.accountStatus,o.listDetails.complianceStatusList=e.complianceStatus,o.listDetails.taaxRegistrationStatusList=e.taxRegistrationStatus}),o.tableParams=new n({page:1,count:25,filter:{},exact:{},sorting:{CreatedAt:"desc"}},{getData:function(n){return o.loading=!0,e.admin.account.load({page:n.page(),count:n.count(),sorting:n.sorting(),filter:n.filter()}).then(function(e){n.total(e.total);for(var t=0;t<e.items.length;t++)e.items[t].PayoutStatusLabel=i("payout",e.items[t].PayoutStatus),e.items[t].PayoutStatusClass=a("payout",e.items[t].PayoutStatus),e.items[t].ProcessingStatusLabel=i("processing",e.items[t].ProcessingStatus),e.items[t].ProcessingStatusClass=a("processing",e.items[t].ProcessingStatus),e.items[t].StatusLabel=i("status",e.items[t].AccountStatus),e.items[t].StatusClass=a("status",e.items[t].AccountStatus),e.items[t].ComplianceLabel=i("compliance",e.items[t].ComplianceStatus),e.items[t].ComplianceClass=a("compliance",e.items[t].ComplianceStatus);return o.loading=!1,e.items})}}),o.$on("load-accounts",function(){o.tableParams.reload()})}}}]),e.filter("nl2br",["$sce",function(n){return function(e,t){e=(e+"").replace(/([^>\r\n]?)(\r\n|\n\r|\r|\n)/g,"$1"+(t||!0?"<br />":"<br>")+"$2");return n.trustAsHtml(e)}}]),e.directive("labelledLine",["patronicityConfig",function(e){return{restrict:"E",templateUrl:e.urlForTemplate("newadmin/account/labelled-line.html"),transclude:!0,replace:!0,scope:{label:"@"}}}]),e.directive("complianceProvider",["api","$stateParams","patronicityConfig","$window",function(i,r,e,n){return{restrict:"E",scope:{},templateUrl:e.urlForTemplate("newadmin/account/compliance-provider.html"),link:function(o){o.resetCompliance=function(e,t){e.preventDefault(),n.confirm("Are you sure you want to delete and reset the finclusive account?")&&i.admin.account.complianceReset(r.id,t).then(function(e){location.reload()},function(e){console.log(e)})},o.updateComplianceAccount=function(e,t){e.preventDefault(),i.admin.account.complianceUpdate(r.id,t).then(function(e){o.complianceCheck=e.complianceCheck},function(e){console.log(e)})},o.updateBasicComplianceStatus=function(e,t,n){e.preventDefault(),i.admin.account.complianceUpdateStatus(t,r.id,n,null).then(function(e){o.complianceCheck=e.complianceCheck},function(e){console.log(e)})},o.updateBasicComplianceStatusControlPerson=function(e,t,n,a){e.preventDefault(),i.admin.account.complianceUpdateStatus(t,r.id,n,a).then(function(e){o.complianceCheck=e.complianceCheck},function(e){console.log(e)})},i.admin.account.loadComplianceCheck(r.id).then(function(e){o.complianceCheck=e.complianceCheck,o.tabselector=o.complianceCheck[0].ui_label.provider_name},function(e){console.log(e)})}}}]),e.directive("adminInternalAccountDetail",["api","$stateParams","patronicityConfig","Dialogs","$sce","$uibModal",function(c,l,r,u,d,p){return{restrict:"E",scope:{},templateUrl:r.urlForTemplate("newadmin/account/detail.html"),link:function(s){function o(e){s.accountDetail=e.account,s.accountDetail.cannotCloseReason&&(s.accountDetail.cannotCloseReason=d.trustAsHtml(s.accountDetail.cannotCloseReason))}function t(){c.admin.account.loadAccount(l.id).then(function(e){o(e),s.accountCreatedDate=e.account.createdAt})}function i(){c.admin.account.loadProjects(l.id).then(function(e){s.projects=e.projects,s.filteredProjects=e.projects,s.closeable_project_subaccount_ids=[],s.allStatus=["All"],s.selectedStatus="All",s.allCommunities=["All"],s.selectedCommunity="All",s.filters={status:s.selectedStatus,communities:s.selectedCommunity},s.projects.forEach(function(e){if("Not Paid - Completed"==e.Status){for(var t=!0,n=0;n<e.Balance.length;n++)0!=e.Balance[n].Amount&&(t=!1);t&&s.closeable_project_subaccount_ids.push(e.SubAccountID)}s.allStatus.includes(e.Status)||s.allStatus.push(e.Status),e.Communities.forEach(function(e){s.allCommunities.includes(e)||s.allCommunities.push(e)})}),s.numberOfProjects=e.projects.length})}function n(i,e){p.open({templateUrl:r.urlForTemplate("newadmin/bluesnap/account-note-edit.html"),controller:["$scope","$uibModalInstance","outerScope",function(n,a,o){n.label="new"==i?"Add":"Edit",n.note_type="Account",n.editNote={ID:i,Note:e},n.save=function(){var e="new"==i?"create":"edit",t="new"==i?{note:n.editNote.Note}:{id:i,note:n.editNote.Note};o.data.noteErrorMessage=void 0,c.admin.account.note(l.id,e,t).then(function(e){o.notes=e.notes,a.close({})},function(e){o.data.noteErrorMessage=e})},n.cancel=function(){a.dismiss({})}}],size:"md",resolve:{outerScope:function(){return s}}})}function a(i,e){p.open({templateUrl:r.urlForTemplate("newadmin/bluesnap/account-note-edit.html"),controller:["$scope","$uibModalInstance","outerScope",function(n,a,o){n.label="new"==i?"Add":"Edit",n.note_type="Compliance",n.editNote={ID:i,Note:e},n.save=function(){var e="new"==i?"create":"edit",t="new"==i?{note:n.editNote.Note}:{id:i,note:n.editNote.Note};o.data.noteErrorMessage=void 0,c.admin.account.complianceNote(l.id,e,t).then(function(e){o.complianceNotes=e.notes,a.close({})},function(e){o.data.noteErrorMessage=e})},n.cancel=function(){a.dismiss({})}}],size:"md",resolve:{outerScope:function(){return s}}})}s.data={processing:!1,noteErrorMessage:void 0},t(),i(),c.admin.account.loadNotes(l.id).then(function(e){s.notes=e.notes,s.complianceNotes=e.complianceNotes}),c.admin.account.loadOptions(l.id).then(function(e){s.data.options=e}),s.$on("reload-project-balances",function(){i()}),s.$on("reload-account-info",function(){t()}),s.filterCampaign=function(e,t){s.filters[e]=t,s.filteredProjects=s.projects.filter(function(){return!0}),Object.entries(s.filters).forEach(function(e){for(var t=e[0].charAt(0).toUpperCase()+e[0].slice(1),n=e[1],a=0;a<s.filteredProjects.length;a++){var o=!1;if("All"!=n){if(Array.isArray(s.filteredProjects[a][t])){for(var i=!1,r=0;r<=s.filteredProjects[a][t].length;r++)s.filteredProjects[a][t][r]==n&&(i=!0);o=!i}else s.filteredProjects[a][t]!=n&&(o=!0);o&&(s.filteredProjects.splice(a,1),a--)}}})},s.closeProjectsComplete=function(){s.closing_projects_complete=!0,c.admin.account.closeProjectsBySubaccountIds(l.id,s.closeable_project_subaccount_ids).then(function(e){i()},function(e){alert(e)}).finally(function(){s.closing_projects_complete=!1})},s.statusClass=function(e,t){var n={};switch(e){case"status":switch(t){case"approved":n="label-success";break;case"incomplete":case"pending":case"closed":n="label-warning";break;default:n="label-danger"}break;case"processing":switch(t){case"approved":n="label-success";break;case"incomplete":case"pending":n="label-warning";break;default:n="label-danger"}break;case"payout":switch(t){case"approved":n="label-success";break;case"fraud":case"declined":n="label-danger";break;default:n="label-warning"}break;case"compliance":switch(t){case"approved":n="label-success";break;case"pending":case"in_review":n="label-warning";break;case"rejected":n="label-danger";break;case"incomplete":case"waiting_customer":n="label-default";break;default:n="label-danger"}break;case"tax_registration":switch(t){case"approved":n="label-success";break;case"not_verified":n="label-warning";break;default:n="label-danger"}}return n},s.statusLabel=function(e,t){var n="Unknown",a=[];switch(e){case"status":a=s.data.options.status;break;case"processing":a=s.data.options.processing;break;case"payout":a=s.data.options.payout;break;case"compliance":a=s.data.options.compliance;break;case"tax_registration":a=s.data.options.tax_registration}return a.forEach(function(e){e.id==t&&(n=e.label)}),n},s.closeAccount=function(){u.Confirm("Are you sure you want to close this account?","Close Account?",[{name:"Close",type:"ok"},{name:"Cancel",type:"cancel"}]).then(function(e){"ok"==e.type&&(s.data.processing=!0,c.admin.account.closeAccount(s.accountDetail.id).then(function(e){o(e)}).finally(function(){s.data.processing=!1}))},function(){})},s.convertToDefaultSettlement=function(t,n){u.Confirm("Are you sure you want to convert this campaign to settle in "+n+"?","Convert Settlement Currency",[{name:"Convert",type:"ok"},{name:"Cancel",type:"cancel"}]).then(function(e){s.data.processing=!0,c.admin.account.subaccounts.convertSettlement(l.id,t,n).then(function(e){i()}).finally(function(){s.data.processing=!1})})},s.clearSubaccountFlag=function(e,t,n){u.Confirm(e,"Clear Flag?",[{name:"Clear",type:"ok"},{name:"Cancel",type:"cancel"}]).then(function(e){s.data.processing=!0,c.admin.account.subaccounts.clearFlag(l.id,t,n).then(function(e){i()}).finally(function(){s.data.processing=!1})},function(){})},s.openAccount=function(){u.Confirm("Are you sure you want to re-open this account?","Re-Open Account?",[{name:"Open",type:"ok"},{name:"Cancel",type:"cancel"}]).then(function(e){"ok"==e.type&&(s.data.processing=!0,c.admin.account.openAccount(s.accountDetail.id).then(function(e){o(e)}).finally(function(){s.data.processing=!1}))},function(){})},s.changePayoutValues=function(){p.open({templateUrl:"edit-payout-fields-modal.html",controller:["$scope","$uibModalInstance","initial","CurrencyCodeProvider",function(e,t,n,a){e.data=n,e.data.symbol=a.symbolFromCode(n.payoutCurrency),e.save=function(){t.close(e.data)},e.cancel=function(){t.dismiss()}}],size:"md",resolve:{initial:function(){return{payoutDelayDays:parseInt(s.accountDetail.payoutDelayDays),payoutFrequency:s.accountDetail.payoutFrequency,payoutMinimum:parseInt(s.accountDetail.payoutMinimum),payoutCurrency:s.accountDetail.currencyCode,frequencyOptions:s.data.options.payoutFrequency}}}}).result.then(function(e){s.data.processing=!0;e={payoutDelayDays:e.payoutDelayDays,payoutFrequency:e.payoutFrequency,payoutMinimum:e.payoutMinimum};c.admin.account.setPayoutValues(l.id,e).then(function(e){o(e),s.notes=e.notes}).finally(function(){s.data.processing=!1})},function(){})},s.generateTransfer=function(e){p.open({templateUrl:"new-transfer-modal.html",controller:["$scope","$uibModalInstance","initial","CurrencyCodeProvider",function(n,e,t,a){n.data=t,n.data.symbol=a.symbolFromCode(t.payoutCurrency),n.data.selectedCampaignTotal=0,n.updateSelection=function(){n.data.calculated_payout.balance=n.data.calculated_payout.subaccounts.filter(function(e){return e.selected}).reduce(function(e,t){return e+t.amount},0)},n.$watch("data.transfer_type",function(e){e&&(n.data.calculated=!1,n.data.calculating=!0,c.admin.transfers.preflight(n.data.account_id,n.data.transfer_type,n.data.subaccount_id,n.data.payoutCurrency).then(function(e){n.data.calculated_payout=e;for(var t=0;t<e.subaccounts.length;t++)n.data.calculated_payout.subaccounts[t].selected=!0}).finally(function(){n.data.calculating=!1}))}),n.save=function(){e.close({account_id:n.data.account_id,subaccounts:n.data.calculated_payout.subaccounts,currency:n.data.payoutCurrency})},n.cancel=function(){e.dismiss()}}],size:"md",resolve:{initial:function(){return{transfer_type:"",calculating:!1,calculated:!1,confirm:!1,project_name:e.Name,account_id:s.accountDetail.id,subaccount_id:e.SubAccountID,account_description:s.accountDetail.description,payoutCurrency:e.SettlementCurrency}}}}).result.then(function(e){var t,n,a,o=e.subaccounts.filter(function(e){return e.selected}).map(function(e){return parseInt(e.id)});t=e.account_id,n=o,a=e.currency,p.open({templateUrl:"build-transfer-modal.html",controller:["$scope","$uibModalInstance","initial","CurrencyCodeProvider",function(t,e,n,a){t.data={log_stream:void 0,state:"pending"},t.cancel=function(){e.dismiss()},c.admin.transfers.generateSingle(n.account_id,n.subaccount_ids,n.currency).then(function(e){t.data.log_stream=e.log_stream,t.data.state="started"},function(e){t.data.state="error"}).finally(function(){}),t.generationComplete=function(){t.data.state="complete"}}],size:"md",resolve:{initial:function(){return{account_id:t,subaccount_ids:n,currency:a}}}}).result.then(function(e){i(),s.$broadcast("reload-transfers"),s.$broadcast("reload-adjustments"),s.$broadcast("reload-account-info")},function(){i(),s.$broadcast("reload-transfers"),s.$broadcast("reload-adjustments"),s.$broadcast("reload-account-info")})},function(){})},s.deleteDocument=function(e){u.Confirm("Are you sure you want to delete document "+e.description,"Delete Document").then(function(){c.admin.account.deleteDocument(s.accountDetail.id,e.id).then(function(e){t()})})},s.changeStatus=function(e){var t,n,a;switch(e){case"processing":t=s.data.options.processing,n=s.accountDetail.processingStatus,a="Change Processing Status";break;case"payout":t=s.data.options.payout,n=s.accountDetail.payoutStatus,a="Change Payout Status";break;case"status":t=s.data.options.status,n=s.accountDetail.accountStatus,a="Change Account Status";break;case"compliance":t=s.data.options.compliance,n=s.accountDetail.complianceStatus,a="Change Compliance Status";break;case"tax_registration":t=s.data.options.tax_registration,n=s.accountDetail.taxRegistrationStatus,a="Change Tax Registration Status"}p.open({templateUrl:"edit-status-modal.html",controller:["$scope","$uibModalInstance","initial",function(t,e,n){t.data=n,t.data.value=n.currentValue,t.data.options.forEach(function(e){e.id==n.currentValue&&(t.data.currentValueDisplay=e.label)}),t.save=function(){e.close(t.data)},t.cancel=function(){e.dismiss()}}],size:"md",resolve:{initial:function(){return{type:e,options:t,currentValue:n,title:a}}}}).result.then(function(e){s.data.processing=!0,c.admin.account.setStatus(l.id,e.type,e.value).then(function(e){o(e),e.complianceCheck&&location.reload(),s.notes=e.notes}).finally(function(){s.data.processing=!1})},function(){})},s.changeReserveAmount=function(a,o,i,r){p.open({templateUrl:"edit-reserve-modal.html",controller:["$scope","$uibModalInstance","CurrencyCodeProvider",function(e,t,n){e.data={amount:Math.round(o,0),currency:i,symbol:n.symbolFromCode(i),settlementCurrency:r,clearDoNotPay:!1,entireAccount:!1},e.save=function(){t.close({subaccount_id:a,amount:e.data.amount,currency:e.data.currency,clearDoNotPay:e.data.clearDoNotPay,entireAccount:e.data.entireAccount})},e.cancel=function(){t.dismiss({})}}],size:"md"}).result.then(function(e){s.data.processing=!0,c.admin.account.setReserve(l.id,e.subaccount_id,e.amount,e.currency,e.clearDoNotPay,e.entireAccount).then(function(e){s.projects=e.projects},function(e){alert(e)}).finally(function(){s.data.processing=!1})},function(){})},s.editNote=function(e,t){e.preventDefault(),n(t.ID,t.Note)},s.editComplianceNote=function(e,t){e.preventDefault(),a(t.ID,t.Note)},s.newNote=function(e){e.preventDefault(),n("new","")},s.newComplianceNote=function(e){e.preventDefault(),a("new","")},s.newInternalDocument=function(e){e.preventDefault(),s.showNewSection=!0},s.deleteNote=function(e,a){e.preventDefault(),u.Confirm("Are you sure want to delete this note?","Note Delete").then(function(e){if("OK"==e.name){for(var t,n=0;n<s.notes.length;n++)if(s.notes[n].ID==a.ID){t=n;break}void 0!==t&&s.notes.splice(t,1),s.data.noteErrorMessage=void 0,c.admin.account.note(l.id,"delete",{id:a.ID}).then(function(e){s.notes=e.notes},function(e){s.data.noteErrorMessage=e})}})},s.deleteComplianceNote=function(e,a){e.preventDefault(),u.Confirm("Are you sure want to delete this note?","Note Delete").then(function(e){if("OK"==e.name){for(var t,n=0;n<s.complianceNotes.length;n++)if(s.complianceNotes[n].ID==a.ID){t=n;break}void 0!==t&&s.complianceNotes.splice(t,1),s.data.noteErrorMessage=void 0,c.admin.account.complianceNote(l.id,"delete",{id:a.ID}).then(function(e){s.complianceNotes=e.notes},function(e){s.data.noteErrorMessage=e})}})}}}}]),e.directive("accountAdjustmentPanel",["$uibModal","api","$rootScope","Dialogs",function(t,a,o,i){return{restrict:"E",scope:{accountId:"@",settlementCurrency:"@"},templateUrl:"account-adjustment-panel.html",link:function(n){function e(){n.data.loading=!0,a.admin.account.adjustments.load(n.accountId,n.settlementCurrency).then(function(e){n.data.adjustments=e.adjustments}).finally(function(){n.data.loading=!1})}n.data={loading:!0,adjustments:[]},n.$on("reload-adjustments",function(){e()}),n.newAdjustment=function(){t.open({templateUrl:"new-adjustment-modal.html",controller:["$scope","$uibModalInstance","initial","CurrencyCodeProvider",function(e,t,n,a){e.data=n,e.data.symbol=a.symbolFromCode(n.payoutCurrency),e.save=function(){t.close(e.data)},e.cancel=function(){t.dismiss()}}],size:"md",resolve:{initial:function(){return{date:new Date,payoutCurrency:n.settlementCurrency,amount:0,type:"",reason:"",types:n.data.adjustment_types,subaccounts:n.data.subaccounts}}}}).result.then(function(e){n.data.loading=!0;e={date:e.date,amount:e.amount,currency:e.payoutCurrency,type:e.type,reason:e.reason,subaccount_id:e.subaccount_id};a.admin.account.adjustments.add(n.accountId,e).then(function(e){n.data.adjustments=e.adjustments,o.$broadcast("reload-project-balances")}).finally(function(){n.data.loading=!1})},function(){})},n.adjustmentAction=function(e,t){"delete"==t&&i.Confirm('Are you sure you want to delete:<br/>"'+e.description+'"?',"Delete Adjustment").then(function(){n.data.loading=!0,a.admin.account.adjustments.delete(n.accountId,e.id).then(function(e){n.data.adjustments=e.adjustments,o.$broadcast("reload-project-balances")}).finally(function(){n.data.loading=!1})},function(){})},e(),a.admin.account.adjustments.types(n.accountId,n.settlementCurrency).then(function(e){n.data.adjustment_types=e.types,n.data.subaccounts=e.subaccounts})}}}]),e.directive("accountTransferPanel",["$uibModal","api",function(n,a){return{restrict:"E",scope:{accountId:"@"},templateUrl:"account-transfer-panel.html",link:function(t){function e(){t.data.loading=!0,a.admin.account.loadTransfers(t.accountId).then(function(e){t.data.transfers=e}).finally(function(){t.data.loading=!1})}t.data={loading:!0,transfers:[]},t.$on("reload-transfers",function(){e()}),t.viewTransfer=function(e){n.open({templateUrl:"view-transfer-modal.html",controller:["$scope","$uibModalInstance","initial",function(n,a,e){n.data=e,n.save=function(){a.close(n.data)},n.cancel=function(){a.dismiss()},n.$on("transfer-aborted",function(e,t){t.id==n.data.id&&a.dismiss()})}],size:"md",resolve:{initial:function(){return{id:e}}}}).result.then(function(e){},function(){})},e()}}}])}(),function(){var e=angular.module("patronicity.admin.internal.settlements",["patronicity.api","user","ngTable","ui.bootstrap","patronicity.admin.transfers"]);e.directive("subaccountBalance",["api",function(a){return{restrict:"E",scope:{},template:'<span ng-if="data.loading">Loading...</span><span ng-if="!data.loading"><span ng-if="data.error">{{ data.error }}</span><span ng-if="!data.error" ng-repeat="balance in data.balances"><amount-info is-approximate="balance.is_approximate==1"></amount-info>{{ balance.amount | moneyWithDecimal : balance.currency}} {{ balance.currency }}<br/></span></span>',link:function(t,e,n){t.data={loading:!0,balances:[],error:null},a.admin.settlement_account.balance(n.subaccountId).then(function(e){t.data.balances=e,t.data.error=null},function(e){t.data.error=e}).finally(function(){t.data.loading=!1})}}}]),e.directive("adminInternalSettlementAccounts",["api","patronicityConfig","NgTableParams",function(n,e,t){return{restrict:"E",scope:{},templateUrl:e.urlForTemplate("newadmin/account/admin-internal-settlement-accounts.html"),link:function(e){e.tableParams=new t({page:1,count:25,filter:{},exact:{},sorting:{CreatedAt:"desc"}},{getData:function(t){return e.loading=!0,n.admin.settlement_account.list({page:t.page(),count:t.count(),sorting:t.sorting(),filter:t.filter()}).then(function(e){return t.total(e.total),e.items},function(e){alert(e)}).finally(function(){e.loading=!1})}}),e.$on("load-accounts",function(){e.tableParams.reload()})}}}]),e.directive("adminInternalAccountTransactions",["api","patronicityConfig","NgTableParams","$stateParams","$state","moment",function(i,e,r,s,c,l){return{restrict:"E",scope:{},templateUrl:e.urlForTemplate("newadmin/account/transactions.html"),link:function(a){var e=s.start||l().startOf("month").toDate(),t=s.end||l().endOf("month").toDate(),n=s.useSettlementDate||!1,o=s.subaccount_id;s.start==e&&s.end==t&&n===s.useSettlementDate||c.go("newadmin.internal.account.subaccount.transactions",{id:s.id,subaccount_id:o,start:e,end:t,useSettlementDate:n}),a.data={loading:!1,table_data_loading:!1,startDate:e,endDate:t,useSettlementDate:n,lists:{providerTypeList:[],transactionTypeList:[]}},a.update=function(){c.go("newadmin.internal.account.subaccount.transactions",{id:s.id,subaccount_id:o,start:a.data.startDate,end:a.data.endDate,useSettlementDate:a.data.useSettlementDate}),a.tableParams.reload()},a.data.loading=!0,i.admin.account.subaccounts.transactionInfo(s.id,o).then(function(e){a.data.lists=e.listDetails,a.data.subaccount=e.subaccount}).finally(function(){a.data.loading=!1}),a.prettyNameFromType=function(e){for(var t=a.data.lists.transactionTypeList,n=0;n<t.length;n++)if(t[n].id==e)return t[n].label;return e},a.prettyNameFromProvider=function(e){for(var t=a.data.lists.providerTypeList,n=0;n<t.length;n++)if(t[n].id==e)return t[n].label;return e},a.tableParams=new r({page:1,count:25,filter:{Type:"",PaymentProvider:""},exact:{},sorting:{CreatedDate:"asc"}},{getData:function(t){return a.data.table_data_loading=!0,i.admin.account.subaccounts.transactions(s.id,o,a.data.startDate,a.data.endDate,a.data.useSettlementDate,{page:t.page(),count:t.count(),sorting:t.sorting(),filter:t.filter()}).then(function(e){return t.total(e.total),e.items},function(e){alert(e)}).finally(function(){a.data.table_data_loading=!1})}})}}}])}(),function(){var e=angular.module("patronicity.admin.newadmin",["patronicity.api","user","ngTable","googlechart","patronicity.admin.challenges","patronicity.admin.sponsors","patronicity.admin.pages","patronicity.admin.clubs","patronicity.admin.forms","patronicity.admin.giving","patronicity.admin.pulsepage","patronicity.admin.bluesnap","patronicity.admin.internal","patronicity.admin.internal.settlements","patronicity.admin.transfers","patronicity.admin.batches","ngTagsInput","community"]);e.directive("adminNavigation",["$rootScope","patronicityConfig","api","$window","User",function(e,t,n,a,o){return{restrict:"E",scope:{},templateUrl:"adminNavigation.html",link:function(i){i.applicationName="launchgood"==t.applicationName?"LaunchGood":"Patronicity",i.isHidden=!1,i.permissions=[],i.canSeeFinancial=!1,i.mfaConfigured=o.isMFAConfigured(),n.admin.permissions().then(function(e){0==e.length?a.location="/":i.permissions=e}),i.setupMFA=function(){o.setupMFA().then(function(){i.mfaConfigured=o.isMFAConfigured()})},i.can=function(e){return-1!==i.permissions.indexOf(e)},e.$on("$stateChangeStart",function(e,t,n,a,o){t.data&&void 0!==t.data.hideNav?i.isHidden=t.data.hideNav:i.isHidden=!1})}}}]),e.directive("adminTeamDashboard",["api","moment",function(a,o){return{restrict:"E",scope:!0,templateUrl:"adminTeamDashboard.html",link:function(n,e,t){n.filterDateOption="Day",n.filter={Currency:"*",StartDate:null,EndDate:null,Countries:[],Regions:[]},n.selectedCurrency="USD",n.stats={target:0,fundsRaised:0,completedCampaigns:0,newSupporters:0},n.isStartDateVaild=!1,n.isEndDateVaild=!1,n.loading=!1,n.getStats=function(){var t;n.loading||(n.loading=!0,t=n.filter.Currency,a.admin.team_dashboard(n.filter).then(function(e){n.loading=!1,n.stats=e,n.selectedCurrency="*"==t?"USD":t},function(e){n.loading=!1}))},n.$watch("filter",function(){n.getStats()},!0),n.reLoadPage=function(){n.getStats()},n.$watch("filter.StartDate",function(e){o(e).utc().isValid()?n.isStartDateVaild=!1:n.isStartDateVaild=!0}),n.$watch("filter.EndDate",function(e){o(e).utc().isValid()?n.isEndDateVaild=!1:n.isEndDateVaild=!0}),n.$watch("filterDateOption",function(e){switch(n.customRange=!1,e){case"Day":n.filter.StartDate=o().utc().subtract(1,"day").startOf("day").toDate(),n.filter.EndDate=o().utc().subtract(1,"day").endOf("day").toDate();break;case"Week":n.filter.StartDate=o().utc().subtract(1,"week").startOf("day").toDate(),n.filter.EndDate=o().utc().subtract(1,"day").endOf("day").toDate();break;case"Month":n.filter.StartDate=o().utc().subtract(1,"month").startOf("day").toDate(),n.filter.EndDate=o().utc().subtract(1,"day").endOf("day").toDate();break;case"Year":n.filter.StartDate=o().utc().startOf("year").toDate(),n.filter.EndDate=o().utc().toDate();break;default:n.customRange=!0}n.filter.StartDate=o(n.filter.StartDate).utc().format("YYYY-MM-DD HH:mm:ss"),n.filter.EndDate=o(n.filter.EndDate).utc().format("YYYY-MM-DD HH:mm:ss")})}}}]),e.directive("adminCampaignDashboard",["api","moment",function(a,o){return{restrict:"E",scope:!0,templateUrl:"adminCampaignDashboard.html",link:function(n,e,t){n.filterDateOption="Day",n.filter={Currency:"*",StartDate:null,EndDate:null,Countries:[],Regions:[],CoachOption:""},n.stats={Total:0,ActiveCount:0,ApprovedCount:0,CompletedCount:0,FailedCount:0,NotSubmittedCount:0,SubmittedCount:0},n.selectedCurrency="USD",n.loading=!1,n.getStats=function(){var t;n.loading||(n.loading=!0,t=n.filter.Currency,a.admin.campaign_dashboard(n.filter).then(function(e){n.loading=!1,n.stats=e,n.selectedCurrency="*"==t?"USD":t,n.stats.Completed=parseInt(n.stats.FailedCount)+parseInt(n.stats.CompletedCount)},function(e){n.loading=!1}))},n.$watch("filter",function(){n.getStats()},!0),n.getPercentage=function(e){e=(e/n.stats.Total*100).toFixed(2);return isNaN(e)?0:e},n.$watch("filterDateOption",function(e){switch(n.customRange=!1,e){case"Day":n.filter.StartDate=o().utc().subtract(1,"day").startOf("day").toDate(),n.filter.EndDate=o().utc().subtract(1,"day").endOf("day").toDate();break;case"Week":n.filter.StartDate=o().utc().subtract(1,"week").startOf("day").toDate(),n.filter.EndDate=o().utc().subtract(1,"day").endOf("day").toDate();break;case"Month":n.filter.StartDate=o().utc().subtract(1,"month").startOf("day").toDate(),n.filter.EndDate=o().utc().subtract(1,"day").endOf("day").toDate();break;case"Year":n.filter.StartDate=o().utc().startOf("year").toDate(),n.filter.EndDate=o().utc().toDate();break;default:n.customRange=!0}})}}}]),e.directive("adminProjects",["api","$stateParams","NgTableParams","patronicityConfig",function(o,i,r,e){return{restrict:"E",scope:{},templateUrl:"adminProjects.html",link:function(a,e,t){a.listDetails={},a.currentResultCount=0,a.otherParams={isFeatureFiltered:!1,isLoading:!0},a.cols=[{field:"Title",title:"Title",show:!0},{field:"Creator",title:"Creator",show:!0},{field:"Creator Email",title:"Creator Email",show:!0},{field:"Status",title:"Status",show:!0},{field:"Manager",title:"Manager",show:!0},{field:"Coaching",title:"Coaching",show:!0},{field:"Contacted",title:"Contacted",show:!1},{field:"Goal",title:"Goal",show:!0},{field:"Raised",title:"Raised",show:!0},{field:"Donors",title:"Donors",show:!0},{field:"Applied Date",title:"Applied Date",show:!0},{field:"Launch Date",title:"Launch Date",show:!0},{field:"End Date",title:"End Date",show:!0},{field:"Sponsors",title:"Sponsors",show:!0},{field:"Friends of Communities",title:"Friends of Communities",show:!0},{field:"Old Communities",title:"Old Communities",show:!1},{field:"PaymentType",title:"PaymentType",show:!0},{field:"CounryCode",title:"Bank Country",show:!0},{field:"Grade",title:"Grade",show:!0},{field:"Potential",title:"Potential",show:!0},{field:"FundingOption",title:"FundingOption",show:!0}],o.admin.listParams().then(function(e){a.listDetails=e,a.tableParams=new r({page:1,count:50,filter:{},exact:n},{getData:function(t){return console.log("getting data"),console.log(t.url()),a.otherParams.isLoading=!0,o.admin.projects.get(t.url()).$promise.then(function(e){return t.total(e.total),a.currentResultCount=e.total,a.otherParams.isLoading=!1,a.data=e.result,e.result})}})}),a.getActiveCoaches=function(){return a.listDetails.managers.reduce(function(e,t){return 5==t.group&&e.push(t.ID),e},[])},a.managerFilter,a.managerChange=function(){console.log("manager change"),console.log(a.managerFilter)},a.selectAllActiveCoaches=function(){a.tableParams.filter().ManagerID=a.getActiveCoaches()},a.clearStatusFilter=function(){delete a.tableParams.filter().Status},a.clearManagerFilter=function(){delete a.tableParams.filter().ManagerID},a.clearPaymentTypeFilter=function(){delete a.tableParams.filter().PaymentType},a.toggleFilterByFeatured=function(){a.otherParams.isFeatureFiltered?(delete a.tableParams.filter().IsFeatured,a.otherParams.isFeatureFiltered=!1):(a.tableParams.filter().IsFeatured=1,a.otherParams.isFeatureFiltered=!0)},a.setStatusesOnPlate=function(){a.tableParams.filter().Status=[1,4,-1,5,8,-2]},a.SponsorNameFilterNone=function(){a.tableParams.filter().SponsorName="none"},a.FocFilterNone=function(){a.tableParams.filter().Foc="none"},a.SponsorNameFilterClear=function(){delete a.tableParams.filter().SponsorName},a.FocFilterClear=function(){delete a.tableParams.filter().Foc},a.clearPotentialFilter=function(){delete a.tableParams.filter().Potential},a.clearFundingFilter=function(){delete a.tableParams.filter().FundingOption},a.clearGradeFilter=function(){delete a.tableParams.filter().Grade},a.isValidDate=function(e){return"[object Date]"===Object.prototype.toString.call(e)&&!isNaN(e.getTime())},a.editFreshDesk=function(n){angular.forEach(a.data,function(e,t){n==t&&(e.FreshDeskView=!0)})},a.addFreshDesk=function(e,t){o.admin.addFreshDesk(e,t).then(function(e){a.tableParams.reload()})};var n={Active:1};i.coach&&i.status&&(n.ManagerID=parseInt(i.coach),n.Status=parseInt(i.status)),a.$on("reload-data",function(){console.log("reload requested"),a.tableParams.reload()}),a.campaignHide=function(){delete a.tableParams.filter().Potential},a.projectSearch=function(){n.ID=a.searchedProject,a.tableParams.reload()}}}}]),e.filter("fundingOptionnsText",function(){return function(e){var t;switch(e){case"-1":t="Unknown";break;case"0":t="All-or-Nothing";break;case"1":t="Partial";break;default:t="Unknown"}return t}}),e.directive("gradeSelector",["api",function(t){return{restrict:"E",scope:{grade:"=",project:"="},templateUrl:"gradeSelector.html",link:function(e){e.gradeSelected=function(){console.log("grade:: ",e.grade),t.admin.setGradeOrPotentialForProject("grade",e.grade,e.project).then(function(e){})}}}}]),e.directive("potentialSelector",["api",function(t){return{restrict:"E",scope:{potential:"=",project:"="},templateUrl:"potentialSelector.html",link:function(e){e.potentialSelected=function(){t.admin.setGradeOrPotentialForProject("potential",e.potential,e.project).then(function(e){})}}}}]),e.directive("justContacted",["api",function(e){return{restrict:"EA",scope:{projectId:"=",lastContactedDate:"="},replace:!0,template:'<button class="btn btn-primary" ng-click="justContacted()">Just Contacted</button>',link:function(t){t.justContacted=function(){e.admin.justContacted(t.projectId).then(function(e){t.lastContactedDate=e.LastContactedDate})}}}}]),e.directive("statusSelector",["api","$analytics","Dialogs","patronicityConfig",function(a,o,i,e){return{restrict:"E",scope:{projectId:"=?",sponsorId:"=?",status:"=",statusOptions:"="},templateUrl:"statusDropdown.html",link:function(n){n.menuOptions={isOpen:!1,isSaving:!1},n.applicationName=e.applicationName,n.textForStatus=function(){var t="";return n.menuOptions.isSaving?t="Saving...":angular.forEach(n.statusOptions,function(e){e.ID==n.status&&(t=e.label)}),t},n.changeStatus=function(t){n.menuOptions.isSaving=!0,void 0!==n.projectId&&null==n.sponsorId&&a.admin.forceStatus(n.projectId,t).then(function(e){-1==t?o.eventTrack("ReviewSubmitComplete",{category:"campaign",label:new Date}):1==t&&o.eventTrack("GoLiveSubmitComplete",{category:"campaign",label:new Date}),n.status=e.Status,n.menuOptions.isSaving=!1},function(e){i.Confirm(e,"Error",[{name:"OK",type:"ok"}]).then(function(){n.status=status,n.menuOptions.isSaving=!1})}),null==n.projectId&&void 0!==n.sponsorId&&(0==t?i.SingleTextAreaEntry("Please enter the reason you are Suspending this sponsor","Suspended Sponsor").then(function(e){a.communityPage.forceStatus(n.sponsorId,t,{reason:e.textAreaEntry}).then(function(e){n.status=e.Status,n.menuOptions.isSaving=!1},function(e){i.Confirm(e,"Error",[{name:"OK",type:"ok"}]).then(function(){n.status=status,n.menuOptions.isSaving=!1})})},function(){}):a.communityPage.forceStatus(n.sponsorId,t).then(function(e){n.status=e.Status,n.menuOptions.isSaving=!1},function(e){i.Confirm(e,"Error",[{name:"OK",type:"ok"}]).then(function(){n.status=status,n.menuOptions.isSaving=!1})}))}}}}]),e.directive("managerSelector",["api","patronicityConfig",function(t,e){return{restrict:"E",scope:{projectId:"=?",sponsorId:"=?",managerId:"=",managerOptions:"="},templateUrl:e.urlForTemplate("newadmin/managerDropdown.html"),link:function(n){n.menuOptions={isOpen:!1,isSaving:!1},n.textForManager=function(){var t="";return n.menuOptions.isSaving?t="Saving":angular.forEach(n.managerOptions,function(e){e.ID==n.managerId&&(t=e.fullName)}),t},n.getActiveCoaches=function(){n.managerList=[],void 0!==n.managerOptions&&0<n.managerOptions.length&&(n.managerList=n.managerOptions.reduce(function(e,t){return 5==t.group&&e.push(t),e},[]))},n.$watch("managerOptions",function(e,t){n.getActiveCoaches()}),n.changeManager=function(e){5==e.group&&(n.menuOptions.isSaving=!0,void 0!==n.projectId&&null==n.sponsorId&&t.admin.assignManager(n.projectId,e.ID).then(function(e){n.managerId=e.ManagerID,n.menuOptions.isSaving=!1}),null==n.projectId&&void 0!==n.sponsorId&&t.communityPage.assignManager(n.sponsorId,e.ID).then(function(e){n.managerId=e.ManagerID,n.menuOptions.isSaving=!1}))},n.clearManager=function(){console.log("Clear manager..."),n.menuOptions.isSaving=!0,void 0!==n.projectId&&null==n.sponsorId&&t.admin.assignManager(n.projectId).then(function(e){n.managerId=e.ManagerID,n.menuOptions.isSaving=!1}),null==n.projectId&&void 0!==n.sponsorId&&t.communityPage.assignManager(n.sponsorId).then(function(e){n.managerId=e.ManagerID,n.menuOptions.isSaving=!1})}}}}]),e.directive("coachingSelector",["api",function(t){return{restrict:"E",scope:{coaching:"=",coachingOptions:"=",flags:"=",projectId:"="},templateUrl:"coachingDropdown.html",link:function(n){n.menuOptions={isOpen:!1,isSaving:!1},n.textForCoaching=function(){var t="";return n.menuOptions.isSaving?t="Saving...":angular.forEach(n.coachingOptions,function(e){e.value==n.coaching&&(t=e.text)}),t},n.changeCoaching=function(e){n.menuOptions.isSaving=!0,"Yes"==e&&(n.flags&=-65),"No"==e&&(n.flags|=64),t.admin.setCoaching(n.projectId,n.flags).then(function(e){n.coaching=e.coaching,n.menuOptions.isSaving=!1})}}}}]),e.directive("sponsorItems",["api","patronicityConfig",function(t,e){return{restrict:"E",scope:{projectId:"=",sponsorIds:"=",sponsorOptions:"="},templateUrl:e.urlForTemplate("sponsor-dropdown.html"),link:function(a){a.menuOptions={isOpen:!1,isSaving:!1},a.textForSponsor=function(){var n="";return a.menuOptions.isSaving?n="Saving...":angular.forEach(a.sponsorIds,function(t){angular.forEach(a.sponsorOptions,function(e){t.ID==e.ID&&(n=e.Name)})}),n},a.changeSponsor=function(e){a.menuOptions.isSaving=!0,t.admin.projectSponsor(a.projectId,e).then(function(e){0<a.sponsorIds.length?a.sponsorIds[0].ID=e.sponsorId:a.sponsorIds=[{ID:e.sponsorId}],a.menuOptions.isSaving=!1})}}}}]),e.directive("featuredButton",["api",function(e){return{restrict:"EA",scope:{projectId:"=",isFeatured:"="},replace:!0,template:'<button class="btn" ng-class="buttonClass()" ng-click="toggleFeatured()">{{label()}}</button>',link:function(t){t.saving=!1,t.label=function(){var e="Feature";return t.saving?e="Saving...":1==t.isFeatured&&(e="Featured"),e},t.buttonClass=function(){var e="btn-default";return e=1==t.isFeatured?"btn-success":e},t.toggleFeatured=function(){t.saving=!0,e.admin.toggleFeatured(t.projectId).then(function(e){t.isFeatured=e.IsFeatured,t.saving=!1})}}}}]),e.directive("archiveButton",["api","Dialogs","$window",function(e,n,a){return{restrict:"EA",scope:{projectId:"=?",sponsorId:"=?",redirectAfterSuccess:"@"},replace:!0,template:'<button class="btn btn-danger" ng-click="archive()">{{label()}}</button>',link:function(t){t.saving=!1,t.label=function(){var e="Archive";return e=t.saving?"Archiving...":e},t.archive=function(){void 0!==t.projectId&&null==t.sponsorId&&n.Confirm("Are you sure you want to archive this project? It will be unavailable and may only be recovered by the developers.","Archive Project").then(function(){t.saving=!0,e.admin.archive(t.projectId).then(function(e){t.$emit("reload-data"),"true"==t.redirectAfterSuccess&&(a.location.href="/discover")},function(e){n.Confirm(e,"Archive Project",[{name:"OK",type:"ok"}]).then(function(){t.saving=!1})})}),null==t.projectId&&void 0!==t.sponsorId&&n.Confirm("Are you sure you want to archive this community? It will be unavailable and may only be recovered by the developers.","Archive Community").then(function(){t.saving=!0,e.communityPage.archiveSponsor(t.sponsorId).then(function(e){t.saving=!1,t.$root.$broadcast("load-sponsors","sponsor"),n.Confirm("This will not archive any campaigns in this community. You must archive them separately if necessary.","Note",[{name:"OK",type:"ok"}]).then(function(){"true"==t.redirectAfterSuccess&&(a.location.href="/discover")})},function(e){n.Confirm(e,"Archive Community",[{name:"OK",type:"ok"}]).then(function(){t.saving=!1})})})}}}}]),e.directive("adminCoaches",["api","NgTableParams",function(e,t){return{restrict:"E",scope:{},templateUrl:"coachAdmin.html",link:function(n){n.otherParams={isLoading:!1},n.tableParams=new t({page:1,count:50,filter:{GroupID:"5"}},{getData:function(t){return console.log("getting data"),console.log(t.url()),n.otherParams.isLoading=!0,e.admin.coaches.load(t.url()).$promise.then(function(e){return t.total(e.result.total),n.currentResultCount=e.result.total,n.otherParams.isLoading=!1,n.currentCurrency=n.currency(),console.log(e.result),e.result})}}),n.currency=function(){var e=n.tableParams.filter().Currency;return"*"==e?"USD":e},n.$on("reload-data",function(){console.log("reload requested"),n.tableParams.reload()})}}}]),e.directive("coachingOptionSelector",function(){return{restrict:"E",scope:{ngModel:"="},templateUrl:"coachingOptionSelector.html",link:function(e){e.call=[{code:"*",label:"All"},{code:"Calls",label:"Calls"},{code:"No calls",label:"No calls"}],e.ngModel="*"}}}),e.directive("currencySelector",["api",function(e){return{restrict:"E",scope:{ngModel:"="},templateUrl:"currencySelector.html",link:function(t){t.currencies=[{code:"*",label:"Total Converted to USD (Estimated)"}],e.dashboard.currencies().then(function(e){e.forEach(function(e){t.currencies.push({code:e,label:e})})},function(){}),t.ngModel="*"}}}]),e.directive("adminCoachesTips",["api","NgTableParams","$stateParams",function(e,t,a){return{restrict:"E",scope:{},templateUrl:"coachTipsAdmin.html",link:function(n){n.otherParams={isLoading:!1,coach:null},n.tableParams=new t({id:a.id,page:1,count:50,exact:{CoachID:a.id},sorting:{Date:"desc"}},{getData:function(t){return console.log("getting data"),console.log(t.url()),n.otherParams.isLoading=!0,e.admin.coaches.tips(t.url()).$promise.then(function(e){return t.total(e.result.tips.total),n.otherParams.coach=e.result.coach,n.currentResultCount=e.result.tips.total,n.otherParams.isLoading=!1,e.result.tips.result})}}),n.isPaid=function(e){return!0&e.TipFlags},n.togglePaid=function(t){t._changingFlag||(t._changingFlag=!0,e.admin.coaches.flag({transactionID:t.TransactionID,flagType:n.isPaid(t)?"unpaid":"paid"}).$promise.then(function(e){delete t._changingFlag,e.success?n.isPaid(t)?t.TipFlags=1^t.TipFlags:t.TipFlags=1|t.TipFlags:alert(e.message)}))},n.$on("reload-data",function(){console.log("reload requested"),n.tableParams.reload()})}}}]),e.directive("adminCoachesReviews",["api","NgTableParams","$stateParams",function(e,t,a){return{restrict:"E",scope:{},templateUrl:"coachReviewsAdmin.html",link:function(n){n.otherParams={isLoading:!1,coach:null},n.clearRatingsFilter=function(){delete n.tableParams.filter().Rating},n.tableParams=new t({id:a.id,page:1,count:50,exact:{CoachID:a.id},sorting:{AddedDate:"desc"}},{getData:function(t){return console.log("getting data"),console.log(t.url()),n.otherParams.isLoading=!0,e.admin.coaches.reviews(t.url()).$promise.then(function(e){return t.total(e.result.reviews.total),n.otherParams.coach=e.result.coach,n.currentResultCount=e.result.reviews.total,n.otherParams.isLoading=!1,e.result.reviews.result})}}),n.$on("reload-data",function(){console.log("reload requested"),n.tableParams.reload()})}}}]),e.directive("adminDashboard",["api",function(e){return{restrict:"E",scope:{},templateUrl:"adminDashboard.html",link:function(e){console.log("dashboard loading")}}}]),e.directive("dashboardUserChart",["api",function(e){return{restrict:"E",scope:{},template:'Start: <input ng-model="dateRange.start" /> End: <input ng-model="dateRange.end" /> <select ng-model="userChartObject.type"><option value="ColumnChart">Column Chart</option><option value="LineChart">Line Chart</option><option value="BarChart">Bar Chart</option><option value="AreaChart">Area Chart</option><option value="Table">Table</option></select> <button class="btn btn-primary" ng-click="reloadData()">Reload</button><div google-chart chart="userChartObject" style="height:600px; width:100%;"></div>',link:function(t){t.dateRange={start:"2014-01-01",end:"2017-12-31"},t.userChartObject={},t.userChartObject.type="ColumnChart",t.userChartObject.options={title:"New Users Per Month"},t.reloadData=function(){e.dashboard.userChart(t.dateRange.start,t.dateRange.end).then(function(e){t.userChartObject.data=e})},t.reloadData()}}}]),e.directive("dashboardNewCampaignsChart",["api",function(e){return{restrict:"E",scope:{},template:'Start: <input ng-model="dateRange.start" /> End: <input ng-model="dateRange.end" /> <select ng-model="newCampaignsChartObject.type"><option value="ColumnChart">Column Chart</option><option value="LineChart">Line Chart</option><option value="BarChart">Bar Chart</option><option value="AreaChart">Area Chart</option><option value="Table">Table</option></select> <button class="btn btn-primary" ng-click="reloadData()">Reload</button><div google-chart chart="newCampaignsChartObject" style="height:600px; width:100%;"></div>',link:function(t){t.dateRange={start:"2014-01-01",end:"2017-12-31"},t.newCampaignsChartObject={},t.newCampaignsChartObject.type="ColumnChart",t.newCampaignsChartObject.options={title:"Campaigns Created Per Month"},t.reloadData=function(){e.dashboard.newCampaignsChart(t.dateRange.start,t.dateRange.end).then(function(e){t.newCampaignsChartObject.data=e})},t.reloadData()}}}]),e.directive("dashboardDonationsChart",["api",function(e){return{restrict:"E",scope:{},template:'Start: <input ng-model="dateRange.start" /> End: <input ng-model="dateRange.end" /> <select ng-model="donationsChartObject.type"><option value="ColumnChart">Column Chart</option><option value="LineChart">Line Chart</option><option value="BarChart">Bar Chart</option><option value="AreaChart">Area Chart</option><option value="Table">Table</option></select> <button class="btn btn-primary" ng-click="reloadData()">Reload</button> <button ng-click="toggleOffline()" class="btn btn-primary"><span ng-if="showOffline">Hide Offline</span><span ng-if="!showOffline">Show Offline</span></button><div google-chart chart="donationsChartObject" style="height:600px; width:100%;"></div>',link:function(t){t.showOffline=!0,t.dateRange={start:"2014-01-01",end:"2017-12-31"},t.donationsChartObject={},t.donationsChartObject.type="ColumnChart",t.donationsChartObject.options={title:"Donations Per Month",isStacked:!0},t.reloadData=function(){e.dashboard.donationsChart(t.showOffline,t.dateRange.start,t.dateRange.end).then(function(e){t.donationsChartObject.data=e})},t.reloadData(),t.toggleOffline=function(){t.showOffline?t.showOffline=!1:t.showOffline=!0,t.reloadData()}}}}]),e.directive("adminBanners",["api",function(e){return{restrict:"E",scope:{},templateUrl:"adminBanners.html",link:function(e){}}}]),e.directive("bannerManager",["api",function(e){return{restrict:"E",scope:{},templateUrl:"bannerManager.html",link:function(t){t.banners=[],t.loadBanners=function(){e.admin.banners.load().then(function(e){console.log(e),t.banners=e})},t.loadBanners(),t.$on("load-banners",function(e){t.loadBanners(),console.log(e)})}}}]),e.directive("bannerListItem",["api",function(t){return{restrict:"E",templateUrl:"bannerListItem.html",scope:{banner:"=",index:"@",last:"@"},link:function(e){e.moveUp=function(){t.admin.banners.moveUp(e.banner.ID).then(function(){e.$root.$broadcast("load-banners","banner")})},e.moveDown=function(){t.admin.banners.moveDown(e.banner.ID).then(function(){e.$root.$broadcast("load-banners","banner")})}}}}]),e.directive("bannerEdit",["$uibModal","patronicityConfig","api","imageUpload","$q",function(t,n,r,s,c){return{restrict:"E",template:'<button ng-click="openEditModal()">{{label}}</button>',scope:{banner:"="},link:function(e){e.label="Edit",e.banner||(e.label="New Banner"),e.openEditModal=function(){t.open({templateUrl:n.urlForTemplate("newadmin/banner-edit.html"),controller:["$scope","$uibModalInstance","banner",function(n,t,a){var o=!1;function e(){var t=c.defer();return r.admin.banners.save(n.editBanner).then(function(e){angular.copy(e,a),t.resolve()},function(){t.reject()}),t.promise}function i(){s.selectImage("banner",n.editBanner.ID,!1,"banner").result.then(function(e){console.log(e),n.editBanner.ImageURL=e.url,n.editBanner.MediaID=e.guid})}a?(console.log("Editing banner"),n.editBanner=angular.copy(a)):(console.log("Creating new banner"),n.editBanner={ID:"new"},o=!0),n.save=function(){e().then(function(e){o&&(console.log("new banner so requesting reload"),n.$root.$broadcast("load-banners","banner")),t.close({})})},n.selectImage=function(){o?(console.log("is new banner so save before adding image"),e().then(function(){console.log("now can get image"),i()})):i()},n.cancel=function(){t.dismiss({})}}],size:"md",resolve:{banner:function(){return e.banner}}})}}}}]),e.directive("bannerStatusToggle",["api",function(e){return{restrict:"E",template:'<button ng-click="toggleStatus()">{{label()}}</button>',scope:{banner:"="},link:function(t){t.toggleStatus=function(){1==t.banner.Active?e.admin.banners.deactivate(t.banner.ID).then(function(e){t.$root.$broadcast("load-banners","banner")}):e.admin.banners.activate(t.banner.ID).then(function(e){t.$root.$broadcast("load-banners","banner")})},t.label=function(){return 1==t.banner.Active?"Deactivate":"Activate"}}}}]),e.directive("adminPress",function(){return console.log("adminPress!"),{restrict:"E",scope:{},templateUrl:"adminPress.html"}}),e.directive("pressManager",["api","NgTableParams",function(e,t){return console.log("pressManager!"),{restrict:"E",scope:{},templateUrl:"pressManager.html",link:function(n){n.isFeatured=function(e){return!!(2&e)},n.tableParams=new t({page:1,count:25,filter:{},exact:{},sorting:{}},{getData:function(t){return console.log("getting featured data"),console.log(t.url()),n.loading=!0,e.admin.press.loadPress({page:t.page(),count:t.count(),sorting:t.sorting(),filter:t.filter()}).then(function(e){return t.total(e.total),n.loading=!1,e.items})}}),n.$on("load-press",function(e){console.log("reload requested"),n.tableParams.reload()})}}}]),e.directive("pressEdit",["$uibModal","patronicityConfig","api","$window",function(t,r,s,c){return{restrict:"E",template:'<button ng-click="openEditModal()" class="btn btn-primary">{{label}}</button>',scope:{press:"="},link:function(e){e.label="Edit",e.press||(e.label="New Press"),e.openEditModal=function(){t.open({templateUrl:r.urlForTemplate("newadmin/press-edit.html"),controller:["$scope","$uibModalInstance","press",function(n,t,a){n.applicationName="launchgood"==r.applicationName?"Launchgood":"Patronicity","Patronicity"==n.applicationName?n.placeholders={url:"e.g. https://www.fastcompany.com/40404791/combining-crowdfunding-and-place-making-to-help-communities-improve-themselves",headline:"Combining Crowdfunding And Place-Making To Help Communities Improve Themselves",outlet_name:"Fast Company",description:"Our company was featured in Fast Company",image_url:"https://cdn.worldvectorlogo.com/logos/fast-company-1.svg"}:n.placeholders={url:"http://www.cnn.com/2015/07/08/us/muslims-help-southern-black-churches-irpt/index.html",headline:"Muslims raise funds to rebuild burned black churches",outlet_name:"CNN",description:"Our company was featured on CNN",image_url:"http://www.cnn.com/image.jpg"};var o=!1;function i(){n.editPress.ProjectId?(s.admin.project.getProjectImage(n.editPress.ProjectId).then(function(e){console.log("Get Project url"),n.projectDetails.projectImage=e.image}),s.admin.project.getProject(n.editPress.ProjectId).then(function(e){console.log("Get Project info"),n.projectDetails.project=e.project})):(console.log("ProjectId does not exist"),n.projectDetails.projectImage=null,n.projectDetails.project=null)}n.adminEdit=!0,n.projectDetails={},n.FlagDetails=[],a?(console.log("Editing press"),n.editPress=angular.copy(a),1&n.editPress.Flags?n.FlagDetails.Active="1":n.FlagDetails.Active="0",2&n.editPress.Flags?n.FlagDetails.Featured="1":n.FlagDetails.Featured="0",i()):(console.log("Creating new press"),n.currDate=new Date((new Date).toISOString().split("T")[0]),n.editPress={ID:"new",ContentDate:n.currDate},o=!0,n.FlagDetails.Active="1",n.FlagDetails.Featured="0"),n.preSave=function(){!function(){if(n.editPress.Url.startsWith("http://")||n.editPress.Url.startsWith("https://")){if(n.editPress.ImageUrl.startsWith("http://")||n.editPress.ImageUrl.startsWith("https://"))return console.log("Validation passed."),1;n.messageText="Image Url must start with - http:// or https://"}else n.messageText="URL must start with - http:// or https://";return console.log("Validation failed: "+n.messageText),0}()||(console.log("Saving..."),"1"==n.FlagDetails.Active?n.editPress.Flags|=1:n.editPress.Flags&=-2,"1"==n.FlagDetails.Featured?n.editPress.Flags|=2:n.editPress.Flags&=-3,"new"==n.editPress.ID&&(n.editPress.Type="press"),s.admin.press.save(n.editPress).then(function(e){console.log("Save complete."),angular.copy(e,a),o&&(console.log("new press so requesting reload"),n.$root.$broadcast("load-press","press")),t.close({})}))},n.displayProject=function(){c.open("/campaign/"+n.projectDetails.project.Slug,"_blank")},n.$on("project-selected",function(e,t){console.log("item selected!"),console.log(t),n.editPress.ProjectId=t.project.ID,console.log("projectId: "+n.editPress.ProjectId),i()}),n.cancel=function(){t.dismiss({})}}],size:"md",resolve:{press:function(){return e.press}}})}}}}]),e.directive("pressStatusToggle",["api",function(e){return{restrict:"E",template:'<button ng-click="toggleStatus()" class="btn btn-primary"><span ng-if="isActive(press)">Deactivate</span><span ng-if="!isActive(press)">Activate</span></button>',scope:{press:"="},link:function(t){t.isActive=function(e){return!!(1&e.Flags)},t.toggleStatus=function(){1&t.press.Flags?t.press.Flags&=-2:t.press.Flags|=1,e.admin.press.save(t.press).then(function(e){t.$root.$broadcast("load-press","press")})}}}}]),e.directive("adminRedirects",function(){return console.log("adminRedirects!"),{restrict:"E",scope:{},templateUrl:"adminRedirects.html"}}),e.directive("redirectsManager",["api","NgTableParams",function(e,t){return{restrict:"E",scope:{},templateUrl:"redirectsManager.html",link:function(n){n.tableParams=new t({page:1,count:25,filter:{},exact:{},sorting:{From:"asc"}},{getData:function(t){return console.log("getting data"),console.log(t.url()),n.loading=!0,e.admin.redirects.load({page:t.page(),count:t.count(),sorting:t.sorting(),filter:t.filter()}).then(function(e){return t.total(e.total),n.loading=!1,e.items})}}),n.$on("load-redirects",function(){console.log("reload requested"),n.tableParams.reload()})}}}]),e.directive("redirectEdit",["$uibModal","patronicityConfig","api","Dialogs",function(t,n,o,i){return{restrict:"E",template:'<button ng-click="openEditModal()" class="btn btn-primary">{{label}}</button>',scope:{redirect:"="},link:function(e){e.label="Edit",e.redirect||(e.label="Add Redirect"),e.openEditModal=function(){t.open({templateUrl:n.urlForTemplate("newadmin/redirect-edit.html"),controller:["$scope","$uibModalInstance","redirect",function(t,n,a){t.isNewRedirect=!1,t.isDisabled=!1,t.showEdit=!0,t.allowOffsite=!1,t.possibleTypes=[{label:"301 Moved Permanently",type:"301"},{label:"302 Moved Temporarily",type:"302"}],a?(console.log("Editing redirect"),t.editRedirect=angular.copy(a),o.admin.redirects.checkurl(t.editRedirect.From).then(function(e){t.metadata=e,t.metadata?o.admin.redirects.fetchproject(t.metadata.ProjectID).then(function(e){t.project=e,t.isDisabled=!0,t.showEdit=!1}):console.log("Metadata not found.")}),(t.editRedirect.To.startsWith("http://")||t.editRedirect.To.startsWith("https://"))&&(t.allowOffsite=!0)):(console.log("Creating new redirect"),t.editRedirect={ID:"new",Type:"301"},t.isNewRedirect=!0),t.save=function(){!function(){if(t.allowOffsite){if(!t.editRedirect.To.startsWith("http://")&&!t.editRedirect.To.startsWith("https://"))return t.messageText="Allow Offsite set to yes. To must start with - http:// or https://",void console.log("Validation failed: "+t.messageText);console.log("Syntax Validation passed.")}else if(t.editRedirect.To.startsWith("http://")||t.editRedirect.To.startsWith("https://"))return t.messageText="Allow Offsite set to no. To cannot start with - http:// or https://",void console.log("Validation failed: "+t.messageText);return 1}()||o.admin.redirects.save(t.editRedirect,t.allowOffsite).then(function(e){angular.copy(e,a),t.isNewRedirect&&(console.log("new redirect so requesting reload"),t.$root.$broadcast("load-redirects","redirect")),n.close({})},function(e){console.log("Save failed: "+e),t.messageText=e})},t.delete=function(){i.Confirm("Are you sure you want to delete this redirect?","Delete Redirect",[{name:"Delete",type:"ok"},{name:"Cancel",type:"cancel"}]).then(function(){o.admin.redirects.delete(t.editRedirect).then(function(){console.log("deleted redirect so requesting reload"),t.$root.$broadcast("load-redirects"),n.close({})},function(e){console.log("Delete failed: "+e),t.messageText=e})},function(){})},t.cancel=function(){n.dismiss({})}}],size:"md",resolve:{redirect:function(){return e.redirect}}})}}}}]),e.directive("adminTemplates",function(){return console.log("adminTemplates!"),{restrict:"E",scope:{},templateUrl:"adminTemplates.html"}}),e.directive("templatesManager",["api","NgTableParams",function(e,t){return{restrict:"E",scope:{},templateUrl:"templatesManager.html",link:function(n){n.listDetails={},e.admin.templates.groups().then(function(e){n.listDetails.groups=e}),n.tableParams=new t({page:1,count:25,filter:{},exact:{},sorting:{Name:"asc"}},{getData:function(t){return console.log("getting data"),console.log(t.url()),n.loading=!0,e.admin.templates.load({page:t.page(),count:t.count(),sorting:t.sorting(),filter:t.filter()}).then(function(e){return t.total(e.total),n.loading=!1,e.items})}}),n.$on("load-templates",function(){console.log("reload requested"),n.tableParams.reload()})}}}]),e.directive("templateEdit",["$uibModal","patronicityConfig","api","$window","Dialogs",function(t,n,l,u,e){return{restrict:"E",template:'<button ng-click="openEditModal()" class="btn btn-primary">{{label}}</button>',scope:{template:"="},link:function(e){e.label="Edit",e.template||(e.label="Add Email Template"),e.openEditModal=function(){t.open({templateUrl:n.urlForTemplate("newadmin/template-edit.html"),controller:["$scope","$uibModalInstance","template","$timeout","Dialogs",function(r,t,n,e,o){var a,i,s=!1,c=(n?(console.log("Editing email template"),r.editTemplate=angular.copy(n),r.checkbox={standaloneEmail:!!(1&r.editTemplate.Flags)}):(console.log("Creating new email template"),r.editTemplate={ID:"new",Body:"",Flags:"0"},s=!0),r.possibleLanguages=[{label:"English",language:"en"},{label:"",language:"fa"},{label:"Deutsch",language:"de"},{label:"",language:"ar"},{label:"esky",language:"cs"},{label:"",language:"el"},{label:"Espaol",language:"es"},{label:"Franais",language:"fr"},{label:"Italiano",language:"it"},{label:"Nederlands",language:"nl"},{label:"Svenska",language:"se"},{label:"Slovensko",language:"sl"},{label:"Polski",language:"pl"},{label:"Portugus de Portugal",language:"pt"},{label:"Portugus do Brasil",language:"br"},{label:"",language:"ru"},{label:"",language:"cn"},{label:"",language:"tw"},{label:"",language:"he"},{label:"Lietuvi",language:"lt"},{label:"Suomi",language:"fi"},{label:"Dansk",language:"da"},{label:"Bahasa Indonesia",language:"id"},{label:"Magyar",language:"hu"},{label:"",language:"th"},{label:"",language:"hi"}],l.admin.templates.groups().then(function(e){console.log(e),r.possibleGroupNames=e,r.groupChanged()}),r.groupDescription="Not loaded..",r.groupChanged=function(){r.possibleGroupNames.forEach(function(e){e.id==r.editTemplate.GroupName&&(r.groupDescription=e.description)})},r.changeStandaloneEmail=function(){r.checkbox.standaloneEmail?r.editTemplate.Flags|=1:r.editTemplate.Flags&=-2},r.save=function(){console.log("Saving email template"),l.admin.templates.save(r.editTemplate).then(function(e){angular.copy(e,n),s&&(console.log("new email template so requesting reload"),r.$root.$broadcast("load-templates","template")),t.close({})})},r.bodyCount=0,r.valueCount=0,/{{\s*([a-zA-Z\d]+(:?[_:\-]+[a-zA-Z\d]+)*)\s*}}/g);s||(r.editTemplate.TemplateVariables?r.editTemplate.TemplateVariables&&r.editTemplate.TemplateVariables&&"string"==typeof r.editTemplate.TemplateVariables&&(r.editTemplate.TemplateVariables=JSON.parse(r.editTemplate.TemplateVariables),i=r.editTemplate.Body.replace(c,""),r.bodyCount=i.length,angular.forEach(r.editTemplate.TemplateVariables,function(e,t){e.value?r.valueCount+=e.value.length:r.valueCount+=e.name.length})):(r.editTemplate.Body.match(c)&&(a=r.editTemplate.Body.match(c).map(function(e,t){return e.replace(c,"$1")})),i=_.uniqBy(a),r.phpvalues=i,r.editTemplate.TemplateVariables=i.map(function(e,t){return{id:t,name:e,value:""}}))),r.editTemplate.Dump=r.editTemplate.TemplateVariables;r.$watch("editTemplate.Body",function(e,t){var n;t&&e&&e.length!=t.length&&(r.editTemplate.Body.match(c)&&(n=r.editTemplate.Body.match(c).map(function(e,t){return e.replace(c,"$1")})),t=_.uniqBy(n),r.phpvalues=t,n=e.replace(c,""),r.bodyCount=n.length,r.editTemplate.TemplateVariablesNew=t.map(function(a,o){var i={},i={id:o,name:a,value:""};return r.editTemplate.TemplateVariablesNew=r.editTemplate.TemplateVariables.map(function(n,e){n.name==a&&(i={id:o,name:a,value:n.value}),angular.forEach(r.editTemplate.Dump,function(e,t){n.value==e.value&&a==e.name&&(i={id:o,name:a,value:e.value})})}),i}),r.editTemplate.TemplateVariables=r.editTemplate.TemplateVariablesNew)}),r.$watch(function(e){if(e.editTemplate.TemplateVariables)return e.editTemplate.TemplateVariables.map(function(e){return e})},function(e){r.valueCount=0,angular.forEach(e,function(e){e.value?r.valueCount+=e.value.length:r.valueCount+=e.name.length})},!0),r.preview=function(){var t=u.open("/blank.html","_blank"),a=angular.copy(r.editTemplate.Body);angular.forEach(r.editTemplate.TemplateVariables,function(e,t){var n;e.value&&(n=new RegExp("{{\\s*"+e.name+"\\s*}}","g"),a=a.replace(n,e.value))}),l.admin.templates.preview(a,r.editTemplate.Flags).then(function(e){t.document.write(e),t.document.title="Email Template: "+r.editTemplate.Name})},r.sendTestEmail=function(){var a=angular.copy(r.editTemplate.Body);angular.forEach(r.editTemplate.TemplateVariables,function(e,t){var n;e.value&&(n=new RegExp("{{\\s*"+e.name+"\\s*}}","g"),a=a.replace(n,e.value))}),l.admin.templates.testEmail(r.editTemplate).then(function(e){o.Confirm("Test email has be sent to "+r.editTemplate.testEmail+" successfully","Test Email Sent",[{name:"OK",type:"ok"}])},function(e){o.Confirm("Something went wrong "+e,"Error ",[{name:"OK",type:"ok"}])})},r.$watch("phpvalues",function(e,t){var a="";angular.forEach(e,function(e,t,n){t===n.length-1?a+='"'+e+'" => $'+e:a+='"'+e+'" => $'+e+", "}),r.PHPvariables="array( "+a+" );"}),r.cancel=function(){t.dismiss({})}}],size:"md",resolve:{template:function(){return e.template}}})}}}}]),e.directive("templatePreview",["api","$window",function(e,a){return{restrict:"E",template:'<button ng-click="showPreview()" class="btn btn-primary">Preview</button>',scope:{template:"="},link:function(n){n.showPreview=function(){var t=a.open("/blank.html","_blank");e.admin.templates.preview(n.template.Body,n.template.Flags).then(function(e){t.document.write(e),t.document.title="Email Template: "+n.template.Name})}}}}]),e.directive("adminSmsReminder",["api","patronicityConfig","$http",function(a,e,t){return{restrict:"E",templateUrl:"adminSmsReminder.html",link:function(t,e,n){t.phonenumber=!0,t.verifyWaiting=!1,t.backPhone=!1,t.saveButtonText="Verify Me",t.regEx="(+|00)d+((-d+)+)?",t.editSms=function(){t.editsms.phone.$valid&&t.editsms.verifyCode.$untouched?a.smsReminder.sendVerification(t.phone).then(function(e){t.verifyWaiting=!0,t.backPhone=!0,t.phonenumber=!1,t.msg="Please check your phone for verification code.",console.log(t.msg)},function(e){t.msg=e}):t.editsms.verifyCode.$valid&&t.editsms.phone.$valid&&a.smsReminder.verifyCode(t.verifyCode).then(function(e){t.msg=e.response},function(e){})},t.backToPhone=function(){t.verifyWaiting=!1,t.backPhone=!1,t.phonenumber=!0,t.verifyCode="",t.msg="",t.editsms.verifyCode.$setUntouched()}}}}]),e.directive("adminSmsTemplete",["api","NgTableParams",function(e,t){return{restrict:"E",scope:{},templateUrl:"adminSmsTemplete.html",link:function(n){n.listDetails={},e.smsReminder.load().then(function(e){n.data=e}),n.tableParams=new t({page:1,count:25,filter:{},exact:{},sorting:{Name:"asc"}},{getData:function(t){return console.log("getting data"),console.log(t.url()),n.loading=!0,e.smsReminder.load({page:t.page(),count:t.count(),sorting:t.sorting(),filter:t.filter()}).then(function(e){return t.total(e.total),n.loading=!1,e.items})}}),n.$on("load-templates-sms",function(){n.tableParams.reload()})}}}]),e.directive("templateSmsDelete",["api","$window","$uibModal","patronicityConfig",function(o,e,t,n){return{restrict:"E",template:'<button ng-click="openDeleteModal()" class="btn btn-primary">Delete</button>',scope:{template:"="},link:function(e){e.openDeleteModal=function(){t.open({templateUrl:n.urlForTemplate("newadmin/confirm.html"),controller:["$scope","$uibModalInstance","$timeout","template",function(t,n,e,a){t.delete=function(){console.log("Deleting sms template"),o.smsReminder.delete(a).then(function(e){t.$root.$broadcast("load-templates-sms","template"),n.dismiss({})})},t.cancel=function(){n.dismiss({})}}],size:"md",resolve:{template:function(){return e.template}}})}}}}]),e.directive("smsMessageQueue",["api","$window","$uibModal","patronicityConfig","Dialogs",function(o,e,t,n,i){return{restrict:"E",template:'<button ng-click="openDeleteModal()" class="btn btn-primary">Send Now</button>',scope:{template:"="},link:function(e){e.openDeleteModal=function(){t.open({templateUrl:n.urlForTemplate("newadmin/sms-message-queue.html"),controller:["$scope","$uibModalInstance","$timeout","template",function(t,n,e,a){t.template=a,t.regEx="(+|00)d+((-d+)+)?",t.regExs=new RegExp("(\\+|00)\\d+((\\-\\d+)+)?"),t.changed=function(){t.template.testphone&&null!=t.template.testphone&&(t.template.testphone=t.template.testphone.replace(/[a-zA-Z-]+$/,""),t.template.testphone=t.template.testphone.replace(" ","\n"),t.template.testphone=t.template.testphone.replace(/^(?=\n)$|^\s*|\s*$|\n\n+/gm,""),t.template.testphone.match(t.regExs)?t.testPhoneVaild=!1:t.testPhoneVaild=!0)},t.preview=function(){o.smsReminder.testMultiSMS(t.template).then(function(e){t.message=e,console.log(t.message)},function(e){i.Confirm(e,"Error",[{name:"OK",type:"ok"}])})},t.processing=!1,t.sendToChallenges=function(e){t.template.method=e,t.processing=!0,o.smsReminder.sendSmsToChallenge(t.template).then(function(e){t.processing=!1,n.dismiss({}),i.Confirm("SMS sent to "+t.template.method+" members. NOTE: It could take 15+ minutes for all messages to be delivered.","Sending SMS",[{name:"OK",type:"ok"}]).then(function(){t.processing=!1})},function(e){t.processing=!1,i.Confirm(e,"Error",[{name:"OK",type:"ok"}])})},t.cancel=function(){n.dismiss({})}}],size:"md",resolve:{template:function(){return e.template}}})}}}}]),e.directive("templateSmsEdit",["$uibModal","patronicityConfig","api","$window",function(t,n,s,e){return{restrict:"E",template:'<button ng-click="openEditModal()" class="btn btn-primary">{{label}}</button>',scope:{template:"="},link:function(e){e.label="Edit",e.template||(e.label="Add SMS Template"),e.openEditModal=function(){t.open({templateUrl:n.urlForTemplate("newadmin/template-sms-edit.html"),controller:["$scope","$uibModalInstance","template","$timeout",function(r,t,n,e){var a,o=!(r.regEx="(+|00)d+((-d+)+)?"),i=(n?(console.log("Editing SMS template"),r.editTemplate=angular.copy(n),r.checkbox={standaloneEmail:!!(1&r.editTemplate.Flags)}):(console.log("Creating new SMS template"),r.editTemplate={ID:"new",Body:"",Flags:"0",TemplateVariables:[]},o=!0),s.smsReminder.groups().then(function(e){r.possibleGroupNames=e,r.groupChanged()}),r.groupDescription="Not loaded..",r.groupChanged=function(){r.possibleGroupNames.forEach(function(e){e.id==r.editTemplate.GroupName&&(r.groupDescription=e.description)})},r.changeStandaloneEmail=function(){r.checkbox.standaloneEmail?r.editTemplate.Flags|=1:r.editTemplate.Flags&=-2},r.save=function(){console.log("Saving email template"),s.smsReminder.save(r.editTemplate).then(function(e){angular.copy(e,n),o&&(console.log("new Sms template so requesting reload"),r.$root.$broadcast("load-templates-sms","template")),t.close({})})},r.bodyCount=0,r.valueCount=0,/{{\s*([a-zA-Z\d]+(:?[_:\-]+[a-zA-Z\d]+)*)\s*}}/g);o||(r.editTemplate.TemplateVariables?r.editTemplate.TemplateVariables&&r.editTemplate.TemplateVariables&&"string"==typeof r.editTemplate.TemplateVariables&&(r.editTemplate.TemplateVariables=JSON.parse(r.editTemplate.TemplateVariables),a=r.editTemplate.Body.replace(i,""),r.bodyCount=a.length,angular.forEach(r.editTemplate.TemplateVariables,function(e,t){e.value?r.valueCount+=e.value.length:r.valueCount+=e.name.length})):(a=r.editTemplate.Body.match(i).map(function(e,t){return e.replace(i,"$1")}),a=_.uniqBy(a),r.editTemplate.TemplateVariables=a.map(function(e,t){return{id:t,name:e,description:"",value:""}}))),r.editTemplate.Dump=r.editTemplate.TemplateVariables;r.$watch("editTemplate.Body",function(e,t){var n;t&&e&&e.length!=t.length&&(r.editTemplate.Body.match(i)&&(n=r.editTemplate.Body.match(i).map(function(e,t){return e.replace(i,"$1")})),t=_.uniqBy(n),n=e.replace(i,""),r.bodyCount=n.length,r.editTemplate.TemplateVariablesNew=t.map(function(a,o){var i={},i={id:o,name:a,description:"",value:""};return r.editTemplate.TemplateVariablesNew=r.editTemplate.TemplateVariables.map(function(n,e){n.name==a&&(i={id:o,name:a,description:"",value:n.value}),angular.forEach(r.editTemplate.Dump,function(e,t){n.value==e.value&&a==e.name&&(i={id:o,name:a,description:e.description,value:e.value})})}),i}),r.editTemplate.TemplateVariables=r.editTemplate.TemplateVariablesNew)}),r.$watch(function(e){if(e.editTemplate.TemplateVariables)return e.editTemplate.TemplateVariables.map(function(e){return e})},function(e){r.valueCount=0,angular.forEach(e,function(e){e.value?r.valueCount+=e.value.length:r.valueCount+=e.name.length})},!0),r.cancel=function(){t.dismiss({})},r.preview=function(){s.smsReminder.testSMS(r.editTemplate).then(function(e){r.message=e,console.log(r.message)},function(e){}),console.log(r.message)}}],size:"md",resolve:{template:function(){return e.template}}})}}}}]),e.directive("wrapperEdit",["$uibModal","patronicityConfig","api","$window",function(t,n,a,o){return{restrict:"E",template:'<button ng-click="openWrapperEditModal()" class="btn btn-primary">{{wrapperlabel}}</button>',link:function(e){e.wrapperlabel="Edit Email Wrapper",e.openWrapperEditModal=function(){t.open({templateUrl:n.urlForTemplate("newadmin/wrapper-edit.html"),controller:["$scope","$uibModalInstance",function(t,n){console.log("Editing email wrapper"),t.loading=!0,a.admin.wrapper.load().then(function(e){console.log("Loading email wrapper"),t.wrapper=e,t.loading=!1,t.editWrapper=angular.copy(t.wrapper)}),t.save=function(){console.log("Saving email wrapper"),a.admin.wrapper.save(t.editWrapper).then(function(e){angular.copy(e,t.wrapper),n.close({})})},t.preview=function(){var e=o.open("/blank.html","_blank");e.document.write(t.wrapper.Body),e.title="Email Wrapper"},t.cancel=function(){n.dismiss({})}}],size:"md"})}}}}]),e.directive("groupEdit",["$uibModal","patronicityConfig","api",function(t,n,a){return{restrict:"E",template:'<button ng-click="openGroupEditModal()" class="btn btn-primary">{{grouplabel}}</button>',link:function(e){e.grouplabel="Edit Template Groups",e.openGroupEditModal=function(){t.open({templateUrl:n.urlForTemplate("newadmin/group-edit.html"),controller:["$scope","$uibModalInstance",function(t,n){console.log("Editing template groups"),t.loading=!0,a.admin.group.load().then(function(e){console.log("Loading template groups"),t.groupSelect={ID:""},t.editGroup={ID:"",Name:"",Description:""},t.loading=!1,t.isDisabled=!0,console.log(e),t.possibleGroups=e,t.groupChanged()}),t.add=function(){console.log("Add template group"),t.editGroup={ID:"new",Name:"",Description:""},t.isDisabled=!1},t.groupChanged=function(){console.log("Group selected..."),t.possibleGroups.forEach(function(e){e.ID==t.groupSelect.ID&&(console.log("Selected group found..."),t.editGroup={ID:e.ID,Name:e.Name,Description:e.Description},t.isDisabled=!1,console.log("Edit template group"))})},t.save=function(){console.log("Saving template group"),a.admin.group.save(t.editGroup).then(function(e){angular.copy(e,t.editGroup),n.close({})})},t.cancel=function(){n.dismiss({})}}],size:"md"})}}}}]),e.directive("groupName",["api",function(){return{restrict:"E",scope:{group:"=",groupList:"="},template:"<span>{{textForGroup()}}</span>",link:function(n){n.textForGroup=function(){var t="";return angular.forEach(n.groupList,function(e){e.id==n.group&&(t=e.label)}),t}}}}]),e.directive("adminUsers",function(){return console.log("adminUsers!"),{restrict:"E",scope:{},templateUrl:"adminUsers.html"}}),e.directive("usersManager",["api","NgTableParams","moment",function(e,t,a){return{restrict:"E",scope:{},templateUrl:"usersManager.html",link:function(n){n.listDetails={},e.user.userGroup().then(function(e){n.listDetails.groups=e.items}),n.tableParams=new t({page:1,count:25,filter:{},exact:{},sorting:{UserID:"asc"}},{getData:function(t){return console.log("getting data"),console.log(t.url()),n.userListURL=jQuery.param(t.url()),n.loading=!0,e.admin.userstats.get(t.url()).$promise.then(function(e){return t.total(e.total),n.currentResultCount=e.total,n.isLoading=!1,angular.forEach(e.result,function(e,t){e.CreatedOn=a.unix(e.CreatedOn).toDate(),e.LastLogin=a.unix(e.LastLogin).toDate()}),e.result})}}),n.$on("load-users",function(){console.log("reload requested"),n.tableParams.reload()})}}}]),e.directive("userEdit",["$uibModal","patronicityConfig","api","Dialogs","User","moment",function(t,n,s,c,e,l){return{restrict:"E",template:'<button ng-click="openEditModal()" class="btn btn-primary">{{label}}</button>',scope:{user:"="},link:function(e){e.label="Edit",e.openEditModal=function(){t.open({templateUrl:n.urlForTemplate("newadmin/user-edit.html"),controller:["$scope","$uibModalInstance","user","User",function(n,t,a,o){function i(){c.Confirm("User has been deleted.","User Deleted",[{name:"ok",type:"ok"}]),n.cancel()}function r(){s.admin.users.save(n.editUser).then(function(e){angular.merge(a,a,e),s.admin.users.saveProfile(n.editProfile).then(function(e){t.close({})},function(e){n.messageText=e,console.log("Profile Save failed: "+n.messageText)})},function(e){n.messageText=e,console.log("User Save failed: "+n.messageText)}),0!=n.displayDonations.length&&s.admin.users.saveDonation(n.displayDonations).then(function(e){},function(e){c.Confirm("Donation update failed : "+e,"Donation Update",[{name:"OK",type:"ok"}]).then(function(){})}),s.admin.users.savePermissions(n.editUser.ID,n.editPermissions).then(function(e){},function(e){c.Confirm("Permissions update failed : "+e,"Permissions Update",[{name:"OK",type:"ok"}]).then(function(){})}),s.admin.users.savePreEnrollment(n.editUser.ID,n.editPreEnrollment).then(function(e){},function(e){c.Confirm("PreEnrollment update failed : "+e,"PreEnrollment Update",[{name:"OK",type:"ok"}]).then(function(){})})}n.subscribeStatusses={},n.newNotes={},n.editPermissions={accounts:0,finance:0},n.editPreEnrollment={friday_givers:0,ramadan:0,dhul_hijjah:0},n.forceDelete=!1,n.newNote=function(){n.addingNote=!0},n.cancelNote=function(){n.addingNote=!1},n.deletedDisabled=!1,n.subscribeStatusChanged=function(t,e){s.project.toggleSubscribe(t).then(function(e){n.subscribeStatusses[t]=e.receivedUpdates})},console.log("Editing user"),n.editUser=angular.copy(a),console.log(n.editUser.ID),n.originalEmail=n.editUser.Email,n.loadingProfile=!0,s.admin.users.loadProfile(n.editUser.ID).then(function(e){console.log("Loading profile data"),n.editProfile=e}).finally(function(){n.loadingProfile=!1}),n.loadingStats=!0,s.admin.users.loadStats(n.editUser.ID).then(function(e){console.log("Loading stat data"),n.displayStats=e,console.log("Stat data: "+n.displayStats)}).finally(function(){n.loadingStats=!1}),n.loadUserNotes=function(){n.loadingNotes=!0,s.admin.users.loadUserNotes(n.editUser.ID).then(function(e){angular.forEach(e,function(e,t){e.CreatedDate=l.unix(e.CreatedDate).toDate()}),n.notes=e}).finally(function(){n.loadingNotes=!1})},n.loadUserNotes(),n.loadUserPermissions=function(){n.loadingPermissions=!0,s.admin.users.getPermissions(n.editUser.ID).then(function(e){n.editPermissions.accounts=e&&1==e.accounts?1:0,n.editPermissions.finance=e&&1==e.finance?1:0}).finally(function(){n.loadingPermissions=!1})},n.loadUserPermissions(),n.loadUserPreEnrollment=function(){n.loadingPreEnrollment=!0,s.admin.users.getPreEnrollment(n.editUser.ID).then(function(e){n.editPreEnrollment.friday_givers=e&&1==e.friday_givers?1:0,n.editPreEnrollment.ramadan=e&&1==e.ramadan?1:0,n.editPreEnrollment.dhul_hijjah=e&&1==e.dhul_hijjah?1:0}).finally(function(){n.loadingPreEnrollment=!1})},n.loadUserPreEnrollment(),n.loadingDonations=!0,s.admin.users.loadDonations(n.editUser.ID).then(function(e){console.log("Loading donation data"),n.displayDonations=e,angular.forEach(n.displayDonations,function(e,t){e.zakat&&(e.zakat.zakat=1==e.zakat.zakat),e.giftaid&&(e.giftaid.giftaid_donation=1==e.giftaid.giftaid_donation)});for(var t=0;t<e.length;t++)n.subscribeStatusses[e[t].id]=e[t].receive_update}).finally(function(){n.loadingDonations=!1}),n.loadingGroups=!0,s.user.userGroup().then(function(e){n.possibleGroupIDs=e.items}).finally(function(){n.loadingGroups=!1}),n.resetPassword=function(){console.log("Send password reset email..."),s.admin.users.resetPassword(n.editUser.Email).then(function(e){console.log("Email sent"),c.Confirm("Password reset email sent","Password Reset",[{name:"OK",type:"ok"}]).then(function(){n.saving=!1})},function(e){console.log(e)})},n.onBehalfOfUser=function(e){o.onBehalfOfUser(e)},n.deleteUser=function(t){n.deletedDisabled=!0,c.Confirm("Are you sure you wish to delete this user? THIS CANNOT BE UNDONE.","Delete User",[{name:"Yes",type:"ok"},{name:"No",type:"cancel"}]).then(function(){n.saving=!1,s.admin.users.deleteUser(t).then(function(e){console.log(e),i()},function(e){console.log(e),c.Confirm("User could not be deleted. "+e+".<br><br> If youre sure that this user is safe to delete, you can click 'FORCE DELETE' below. <br><br> <strong> Note: </strong> make sure they have no unreported Gift Aid donations. ","Error Deleting User",[{name:"FORCE DELETE",type:"ok"},{name:"Cancel",type:"cancel"}]).then(function(){n.forceDelete=!0,s.admin.users.deleteUser(t,n.forceDelete).then(function(e){i()})},function(){n.deletedDisabled=!1})})},function(){n.deletedDisabled=!1})},n.presave=function(){n.originalEmail!=n.editUser.Email?s.admin.users.validateEmail(n.editUser).then(function(e){r()},function(e){n.messageText=e,console.log("Validation failed: "+n.messageText)}):r()},n.cancel=function(){t.dismiss({})},n.saveNote=function(){var e={userId:o.current().ID,Message:n.newNotes.Message};s.admin.users.addNote(n.editUser.ID,"manual_notes",e).then(function(e){n.addingNote=!1,n.newNotes.Message="",n.loadUserNotes()},function(e){alert(e)})}}],size:"lg",resolve:{user:function(){return e.user}}})}}}}]),e.directive("groupId",["api",function(){return{restrict:"E",scope:{group:"=",groupList:"="},template:"<span>{{textForGroup()}}</span>",link:function(n){n.textForGroup=function(){var t="";return angular.forEach(n.groupList,function(e){e.ID==n.group&&(t=e.Name)}),t}}}}]),e.directive("adminTestimonials",function(){return console.log("adminTestimonials!"),{restrict:"E",scope:{},templateUrl:"adminTestimonials.html"}}),e.directive("testimonialsManager",["api","NgTableParams",function(e,t){return{restrict:"E",scope:{},templateUrl:"testimonialsManager.html",link:function(n){n.tableParams=new t({page:1,count:25,filter:{Type:"testimonial"},exact:{},sorting:{CreatedDate:"desc"}},{getData:function(t){return console.log("getting data"),console.log(t.url()),n.loading=!0,e.admin.testimonials.load({page:t.page(),count:t.count(),sorting:t.sorting(),filter:t.filter()}).then(function(e){return t.total(e.total),n.loading=!1,e.items})}}),n.$on("load-testimonials",function(){console.log("reload requested"),n.tableParams.reload()})}}}]),e.directive("testimonialEdit",["$uibModal","patronicityConfig","api","$window",function(t,n,r,s){return{restrict:"E",template:'<button ng-click="openEditModal()" class="btn btn-primary">{{label}}</button>',scope:{testimonial:"="},link:function(e){e.label="Edit",e.testimonial||(e.label="New Testimonial"),e.openEditModal=function(){t.open({templateUrl:n.urlForTemplate("newadmin/testimonial-edit.html"),controller:["$scope","$uibModalInstance","testimonial",function(n,t,a){var o=!1;function i(){n.editTestimonial.ProjectId?(r.admin.project.getProjectImage(n.editTestimonial.ProjectId).then(function(e){console.log("Get Project url"),n.projectDetails.projectImage=e.image}),r.admin.project.getProject(n.editTestimonial.ProjectId).then(function(e){console.log("Get Project info"),n.projectDetails.project=e.project})):(console.log("Parent ProjectId does not exist"),n.projectDetails.projectImage=null,n.projectDetails.project=null)}n.projectDetails={},a?(console.log("Editing testimonial"),n.editTestimonial=angular.copy(a),i()):(console.log("Creating new testimonial"),n.editTestimonial={ID:"new"},o=!0),n.preSave=function(){console.log("PreSave..."),"new"==n.editTestimonial.ID&&(n.editTestimonial.Type="testimonial"),console.log("Save..."),console.log("ProjectId: "+n.editTestimonial.ProjectId),r.admin.testimonials.save(n.editTestimonial).then(function(e){angular.copy(e,a),o&&(console.log("new press so requesting reload"),n.$root.$broadcast("load-testimonials","testimonial")),t.close({})})},n.displayProject=function(){s.open("/campaign/"+n.projectDetails.project.Slug,"_blank")},n.$on("project-selected",function(e,t){console.log("item selected!"),console.log(t),n.editTestimonial.ProjectId=t.project.ID,console.log("projectId: "+n.editTestimonial.ProjectId),i()}),n.cancel=function(){console.log("Cancel..."),t.dismiss({})}}],size:"md",resolve:{testimonial:function(){return e.testimonial}}})}}}}]),e.directive("testimonialStatusToggle",["api","$timeout",function(e,n){return{restrict:"E",template:'<button ng-click="toggleStatus()" class="btn btn-primary"><span ng-if="!isPublished(testimonial)">Publish</span><span ng-if="isPublished(testimonial)">Unpublish</span></button>',scope:{testimonial:"="},link:function(t){t.isPublished=function(e){return!!(3&e.Flags)},t.toggleStatus=function(){3&t.testimonial.Flags?(console.log("Change Flag to Unpublished"),t.testimonial.Flags&=-4):(console.log("Change Flag to Published"),t.testimonial.Flags|=3,null===t.testimonial.ContentDate&&(console.log("Get Date..."),e.admin.testimonials.getDate().then(function(e){t.testimonial.ContentDate=e}))),n(function(){e.admin.testimonials.save(t.testimonial).then(function(e){console.log("Saving..."),t.$root.$broadcast("load-testimonial","testimonial")})},200)}}}}]),e.directive("projectSearch",["api","$stateParams","patronicityConfig","$rootScope",function(o,e,t,i){return{restrict:"E",scope:{ignoreIds:"=?",searchVerb:"@?",currentUser:"=?",title:"@?",selectedProjectId:"=?",selectedProjectIdByID:"=?",sponsorId:"=",searchById:"@?"},templateUrl:t.urlForTemplate("newadmin/project-search.html"),link:function(a,e,t){t.title?a.title=t.title:"search_active"==a.searchVerb?a.title="Add Existing Campaign By Name":a.title="Add Existing Active Campaign By Name",a.searchProjects=function(e,t,n){a.loading=!0,a.errorMsg="",a.searchVerb||(a.searchVerb="search_active");t={param1:t?null:e,id:t?e:null,returnSingleInArray:!!n,type:a.searchVerb,limit:200,offset:0,currentUser:a.currentUser,category:void 0,sponsorID:a.sponsorId};return o.Cards.query(t).$promise.then(function(e){0==e.length&&(a.errorMsg="No campaign is found");var t=e;return void 0!==a.ignoreIds&&(t=e.filter(function(e){for(var t=!1,n=0;n<a.ignoreIds.length;n++)if(a.ignoreIds[n]==e.ID){t=!0;break}return!t})),a.loading=!1,t})},a.itemSelected=function(e,t,n,a){i.$broadcast("project-selected",{project:e})},a.$on("added-campaign-to-list",function(e,t){a.ignoreIds.push(t)}),a.$on("removed-campaign-from-list",function(e,t){t=a.ignoreIds.indexOf(t);a.ignoreIds.splice(t,1)})}}}]),e.directive("userSearch",["api","$stateParams","patronicityConfig",function(t,e,n){return{restrict:"E",scope:{sponsorId:"=?"},templateUrl:"userSearch.html",link:function(o){o.searchUsers=function(e){return console.log("SponsorId: "+o.sponsorId),t.admin.sponsorUsers.userList(o.sponsorId).then(function(e){o.ignoreIds=e.users}),o.errorMsg="",t.admin.users.search(e).then(function(e){console.log(e),0==e.total&&(o.errorMsg="User not found");var t=e.items;return t=void 0!==o.ignoreIds?e.items.filter(function(e){for(var t=!1,n=0;n<o.ignoreIds.length;n++)if(o.ignoreIds[n]==e.ID){t=!0,console.log("Exclude UserID: "+e.ID);break}return!t}):t})},o.itemSelected=function(e,t,n,a){o.$emit("user-selected",{user:e})}}}}]),e.directive("adminMessages",function(){return console.log("adminMessages!"),{restrict:"E",scope:{},templateUrl:"adminMessages.html"}}),e.directive("messagesManager",["api","NgTableParams",function(e,t){return{restrict:"E",scope:{},templateUrl:"messagesManager.html",link:function(n){n.tableParams=new t({page:1,count:25,filter:{},exact:{},sorting:{StartDate:"asc"}},{getData:function(t){return console.log("getting data"),console.log(t.url()),n.loading=!0,e.admin.messages.load({page:t.page(),count:t.count(),sorting:t.sorting(),filter:t.filter()}).then(function(e){return t.total(e.total),n.loading=!1,e.items})}}),n.$on("load-messages",function(){console.log("reload requested"),n.tableParams.reload()})}}}]),e.directive("messageEdit",["$uibModal","patronicityConfig","api",function(t,n,r){return{restrict:"E",template:'<button ng-click="openEditModal()" class="btn btn-primary">{{label}}</button>',scope:{message:"="},link:function(e){e.label="Edit",e.message||(e.label="New Message"),e.openEditModal=function(){t.open({templateUrl:n.urlForTemplate("newadmin/message-edit.html"),controller:["$scope","$uibModalInstance","message",function(n,a,o){var i=!1;n.FlagDetails=[],o?(console.log("Editing message"),n.editMessage=angular.copy(o),1&n.editMessage.Flags?n.FlagDetails.AlwaysShow="1":n.FlagDetails.AlwaysShow="0",2&n.editMessage.Flags?n.FlagDetails.Inactive="1":n.FlagDetails.Inactive="0"):(console.log("Creating new message"),n.editMessage={ID:"new"},i=!0,n.FlagDetails.Active="1",n.FlagDetails.Featured="0"),n.preSave=function(){console.log("Validating Slug: "+n.editMessage.Slug);var t=!(n.messageText="");r.admin.messages.verifySlug(n.editMessage.Slug).then(function(e){e.messages&&(angular.forEach(e.messages,function(e){("new"==n.editMessage.ID||e.ID!=n.editMessage.ID)&&(t=!1)}),t||(n.messageText="Slug validation failed: Slug must be unique.")),t&&(!function(){console.log("Validating dates.");var e=!0;n.editMessage.StartDate>n.editMessage.EndDate&&(e=!1,n.messageText="Start Date must be earlier than the End Date.");return e}()?console.log("Validation failed."):(console.log("Save..."),"1"==n.FlagDetails.AlwaysShow?n.editMessage.Flags|=1:n.editMessage.Flags&=-2,"1"==n.FlagDetails.Inactive?n.editMessage.Flags|=2:n.editMessage.Flags&=-3,r.admin.messages.save(n.editMessage).then(function(e){angular.copy(e,o),i&&(console.log("new message so requesting reload"),n.$root.$broadcast("load-messages","message")),a.close({})})))})},n.cancel=function(){console.log("Cancel..."),a.dismiss({})}}],size:"md",resolve:{message:function(){return e.message}}})}}}}]),e.directive("adminSponsorCauses",["api","NgTableParams","$timeout",function(e,t,s){return{restrict:"E",scope:{},templateUrl:"adminSponsorCauses.html",link:function(i){i.tableParams=new t({page:1,count:25,filter:{},exact:{},sorting:{Group:"asc",SortOrder:"asc"}},{getData:function(t){return console.log("getting data"),console.log(t.url()),i.loading=!0,e.projectAdmin.sponsorCauses.load({page:t.page(),count:t.count(),sorting:t.sorting(),filter:t.filter()}).then(function(e){return t.total(e.total),i.loading=!1,i.sponsorcauses=e.items,i.sponsorcauses})}}),i.isDirty=!1;var r;i.isSaving=!1;i.sortableOptions={update:function(e,t){},stop:function(e,t){var n,a=_.groupBy(i.sponsorcauses,function(e){return e.Group});for(n in a)for(var o=0;o<a[n].length;o+=1)a[n][o].SortOrder=o;!function e(){i.isSaving?void 0===r&&(r=s(function(){r=void 0,e()},5e3)):i.saveSponsorCauses()}()}},i.$on("load-sponsorcauses",function(){console.log("reload requested"),i.tableParams.reload()}),i.saveSponsorCauses=function(){i.isSaving=!0,e.projectAdmin.sponsorCauses.sort(i.sponsorcauses,"irusa2").then(function(e){var o;i.isDirty=!1,i.isSaving=!1,o=e,angular.forEach(i.sponsorcauses,function(e,t){for(var n=0;n<=o.length;n++)if(e.ID==o[n].ID){var a=e.ID;i.sponsorcauses[t]=o[n],i.sponsorcauses[t].causes=a;break}})})}}}}]),e.directive("sponsorCausesEdit",["$uibModal","patronicityConfig","api",function(t,n,o){return{restrict:"E",template:'<button ng-click="openCausesEditModal()" class="btn btn-primary">{{label}}</button>',scope:{causes:"=?"},link:function(e){e.label="Edit",e.causes||(e.label="New Sponsor Causes"),e.openCausesEditModal=function(){t.open({templateUrl:n.urlForTemplate("newadmin/sponsors/causes-edit.html"),controller:["$scope","$uibModalInstance","causes",function(t,n,a){a?(console.log("Editing causes"),t.editCauses=angular.copy(a)):(console.log("Creating new causes"),t.editCauses={ID:"new"}),t.loadSponsorData=function(){o.admin.sponsors.load({count:500}).then(function(e){t.sponsors=e.items})},t.loadSponsorData(),t.save=function(){console.log("Save..."),o.projectAdmin.sponsorCauses.save(t.editCauses).then(function(e){angular.copy(e,a),t.$root.$broadcast("load-sponsorcauses","causes"),n.close({})})},t.cancel=function(){console.log("Cancel..."),n.dismiss({})}}],size:"md",resolve:{causes:function(){return e.causes}}})}}}}]),e.directive("sponsorCausesDelete",["$uibModal","patronicityConfig","api","Dialogs",function(e,t,a,o){return{restrict:"E",template:'<button ng-click="causesDel()" class="btn btn-primary">{{label}}</button>',scope:{causes:"=?"},link:function(n){n.label="Delete",n.causesDel=function(){o.Confirm("Are you sure want to delete "+n.causes.Name,"Causes Delete").then(function(t){"OK"==t.name&&a.projectAdmin.sponsorCauses.delete(n.causes).then(function(e){console.log(t),n.$root.$broadcast("load-sponsorcauses","causes")})})}}}}]),e.directive("adminAccountingReports",["$rootScope","patronicityConfig","api",function(e,t,n){return{restrict:"E",scope:{},templateUrl:"adminAccountingReports.html",link:function(e){e.transactionReport=function(){n.admin.accountingReports(e.startDate,e.endDate,"transaction").then(function(e){})}}}}]),e.directive("adminReportingQueries",["api","NgTableParams","$window","Dialogs","$uibModal",function(a,e,t,o,n){return{restrict:"E",scope:!0,templateUrl:"adminReportingQueries.html",link:function(n){n.tableParams=new e({page:1,count:25,filter:{},exact:{},sorting:{Order:"asc"}},{getData:function(t){return n.loading=!0,a.admin.reportingQueries.load({page:t.page(),count:t.count(),sorting:t.sorting(),filter:t.filter()}).then(function(e){return t.total(e.total),n.loading=!1,n.editPage=e.items,e.items})}}),n.$on("load-ReportingQueries",function(){n.tableParams.reload()}),n.run=function(e){n.dataQuery={report:e.ID},t.open("/api/fulladmin/CSVQueryReport?"+jQuery.param(n.dataQuery),"_blank")},n.delete=function(e){o.Confirm("Are you sure you want to delete this report?","Delete Report",[{name:"Delete",type:"ok"},{name:"Cancel",type:"cancel"}]).then(function(){a.admin.reportingQueries.delete(e).then(function(){n.$root.$broadcast("load-ReportingQueries")},function(e){})},function(){})}}}}]),e.directive("reportingQueryEdit",["$uibModal","patronicityConfig","api","$window","Dialogs",function(t,n,r,e,a){return{restrict:"E",template:'<button ng-click="openEditModal()" class="btn btn-primary">{{label}}</button>',scope:{page:"="},link:function(e){e.label="Edit Query",e.page||(e.label="Add Query"),e.openEditModal=function(){t.open({templateUrl:n.urlForTemplate("newadmin/reporting-query-edit.html"),controller:["$scope","$uibModalInstance","page","Dialogs",function(i,t,n,e){i.isNewPage=!1,i.messageText="",i.listDetails={},i.notAllowQuery=["CREATE","INSERT","UPDATE","DELETE","TRUNCATE","ALTER","GRANT"],n?(console.log("Editing page"),i.editPage=angular.copy(n)):(console.log("Creating new page"),i.isNewPage=!0,i.editPage={ID:"new",Query:"",Description:"",Params:[]}),i.preSave=function(){i.allowQuery=!0,i.queryMatched="",i.msg="",angular.forEach(i.notAllowQuery,function(e){i.allowQuerymatchUpper=i.editPage.Query.toLowerCase().match(e.toLowerCase()),null!==i.allowQuerymatchUpper&&(i.allowQuery=!1,""==i.queryMatched?(i.queryMatched+=i.allowQuerymatchUpper,i.msg="The command "):(i.queryMatched+=", "+i.allowQuerymatchUpper,i.msg="The commands"))}),i.allowQuery?r.admin.reportingQueries.save(i.editPage).then(function(e){angular.copy(e,n),i.$root.$broadcast("load-ReportingQueries"),t.close({})},function(e){}):e.Confirm(i.msg+" ( <strong>"+i.queryMatched+" </strong>) are not allowed in this query. Please remove before saving.","Not allowed ",[{name:"Ok",type:"ok"},{name:"Cancel",type:"cancel"}]).then(function(){})},i.bodyCount=0,i.valueCount=0;var a,o=/{{\s*([a-zA-Z\d]+(:?[_:\-]+[a-zA-Z\d]+)*)\s*}}/g;i.isNewPage||(i.editPage.Params?i.editPage.Params&&i.editPage.Params&&"string"==typeof i.editPage.Params&&(i.editPage.Params=JSON.parse(i.editPage.Params)):(a=i.editPage.Query.match(o).map(function(e,t){return e.replace(o,"$1")}),a=_.uniqBy(a),i.editPage.Params=a.map(function(e,t){return{id:t,name:e,description:"",value:""}}))),i.editPage.Dump=i.editPage.Params;i.$watch("editPage.Query",function(e,t){var n;t&&e&&e.length!=t.length&&(i.editPage.Query.match(o)&&(n=i.editPage.Query.match(o).map(function(e,t){return e.replace(o,"$1")})),t=_.uniqBy(n),n=e.replace(o,""),i.bodyCount=n.length,i.editPage.Params=t.map(function(n,a){var o={},o={id:a,name:n,description:"",value:""};return angular.forEach(i.editPage.Params,function(e,t){n==e.name&&(o={id:a,name:n,description:e.description,value:e.value})}),o}))}),i.cancel=function(){t.dismiss({})}}],size:"md",resolve:{page:function(){return e.page}}})}}}}]),e.directive("reportingQueryRun",["$uibModal","patronicityConfig","api","$window","Dialogs",function(t,e,n,o,a){return{restrict:"E",template:'<button ng-click="openEditModal()" class="btn btn-primary"> Run </button>',scope:{page:"="},link:function(e){e.openEditModal=function(){t.open({templateUrl:"adminReportingQueriesRun.html",controller:["$scope","$uibModalInstance","page","Dialogs",function(t,e,n,a){t.editPage=angular.copy(n),t.editPage.Params=JSON.parse(t.editPage.Params),t.run=function(){t.url="",angular.forEach(t.editPage.Params,function(e){""==t.url?t.url=e.name+"="+e.value:t.url+="&"+e.name+"="+e.value}),t.data={report:t.editPage.ID,params:t.url},o.open("/api/fulladmin/CSVQueryReport?"+jQuery.param(t.data),"_blank")},t.cancel=function(){e.dismiss({})}}],size:"md",resolve:{page:function(){return e.page}}})}}}}]),e.directive("freshdeskTicketActivity",["$uibModal","patronicityConfig","api","$window",function(t,n,e,a){return{restrict:"E",template:'<button ng-click="openEditModal()" class="btn btn-sm btn-primary">{{label}}</button>',scope:{},link:function(e){e.label="Freshdesk Ticket Activity",e.openEditModal=function(){t.open({templateUrl:n.urlForTemplate("newadmin/freshdesk-ticket-activity.html"),controller:["$scope","$uibModalInstance",function(e,t){e.cancel=function(){t.dismiss({})}}],size:"md"})}}}}]),e.directive("adminFeaturedOrderProjects",["api","$stateParams","Dialogs","$uibModal","patronicityConfig","$timeout",function(n,e,r,t,a,s){return{restrict:"E",scope:{},templateUrl:"adminFeaturedOrderProjects.html",link:function(i){i.cards={cards:[]},i.currentProjectIds=[],i.isDirty=!1,i.isSaving=!1;var e;i.loadingProjects=!0;function t(){i.loadingProjects=!0,n.admin.loadFeaturedOrderProjects().then(function(e){i.loadingProjects=!1,i.projects=e.items,i.projects.sort(function(e,t){return e.SortOrder-t.SortOrder});var t=[];angular.forEach(e,function(e){t.push(e.ID)}),i.currentProjectIds=t})}function a(){i.isSaving?void 0===e&&(e=s(function(){e=void 0,a()},5e3)):i.saveProjects()}function o(){for(var e in i.projects)i.projects[e].SortOrder=e}t(),i.sortableOptions={update:function(e,t){},stop:function(e,t){o(),a()}},i.moveToTop=function(e){for(var t=0;t<i.projects.length;t++)if(i.projects[t].ID==e.ID){var n=i.projects.splice(t,1);i.projects.unshift(n[0]),o(),a();break}},i.moveToBottom=function(e){for(var t=0;t<i.projects.length;t++)if(i.projects[t].ID==e.ID){var n=i.projects.splice(t,1);i.projects.push(n[0]),o(),a();break}},i.$on("project-selected",function(e,t){i.projects.splice(0,0,t.project),i.currentProjectIds.splice(0,0,t.project.ID),n.admin.addAndRemoveFeaturedOrderProjects(t.project.ID,1,i.projects).then(function(e){i.moveToTop(t.project)})}),i.removeItem=function(t){r.Confirm("Are you sure you want to remove "+t.Name+"?","Remove From Featured List").then(function(){var e=i.projects.filter(function(e){return e.ID!=t.ID});e.length!=i.projects.length&&(i.projects=e,i.currentProjectIds=i.currentProjectIds.filter(function(e){return e!=t.ID}),n.admin.addAndRemoveFeaturedOrderProjects(t.ID,0,i.projects).then(function(e){}),o())})},i.saveProjects=function(){i.loadingProjects=!0,i.isSaving=!0,n.admin.saveFeaturedOrderProjects(i.projects).then(function(e){var o;i.isDirty=!1,i.isSaving=!1,o=e,angular.forEach(i.projects,function(e,t){for(var n=0;n<=o.length;n++)if(e.ID==o[n].ID){var a=e.project;i.projects[t]=o[n],i.projects[t].project=a;break}i.loadingProjects=!1})},function(e){alert(e),t()})}}}}]),e.directive("adminRasulJoin",["patronicityConfig","api",function(e,n){return{restrict:"E",scope:{},templateUrl:"adminRasulJoin.html",link:function(t){t.create=function(){t.userFields.rasul_src="",n.giving.rasul.join(t.userFields).then(function(e){t.resetFields()},function(e){t.error=e})},t.resetFields=function(){delete t.userFields}}}}]),e.directive("adminBannedCountries",["api","$uibModal",function(o,t){return{restrict:"E",scope:{},templateUrl:"adminBannedCountries.html",link:function(n){n.getBannedCountries=function(e){var t;n.bannedCountries=[],n.showOfac=!0,n.isLoading=!0,n.hasError=!1,"ofac"==e?n.showOfac=!(t="ofacCountryAllInfo"):(t="bannedCountryAllInfo",n.showOfac=!0),o.project[t]().then(function(e){n.bannedCountries=e}).catch(function(e){n.hasError=!0,n.errorMessage=e.message}).finally(function(){n.isLoading=!1})},n.getBannedCountries(),n.deleteBannedCountry=function(e,t){confirm("Are you sure you want to delete "+t+"?")&&o.project.deleteBannedCountry(e).then(function(){n.getBannedCountries()})},n.addOrEditBannedCountry=function(e,a){t.open({templateUrl:"bannedCountryModal.html",controller:["$scope","$uibModalInstance","country",function(t,n,e){t.bannedCountryData=angular.copy(e),"edit"==a&&(parseInt(t.bannedCountryData.Flags)?t.bannedCountryData.isOfac=!0:t.bannedCountryData.isOfac=!1),t.save=function(){var e;"edit"==a?e="editBannedCountry":"add"==a&&(e="addNewBannedCountry"),o.project[e](t.bannedCountryData).then(function(){n.close()})},t.cancel=function(){n.dismiss()}}],size:"md",resolve:{country:function(){return e}}}).result.then(function(){n.getBannedCountries()})}}}}]),e.directive("adminChallengeTeam",["api","NgTableParams",function(a,e){return{restrict:"E",scope:{},templateUrl:"adminChallengeTeam.html",link:function(n){n.tableParams=new e({page:1,count:25,filter:{},exact:{},sorting:{AddedDate:"desc"}},{getData:function(t){n.isLoading=!0;var e=jQuery.param(t.url());return n.sponsorCSV=e,a.admin.challengeteam.load.get(t.url()).$promise.then(function(e){return t.total(e.total),n.list=e.list,n.currentResultCount=e.total,n.isLoading=!1,e.result})}}),n.$on("load-challenge-team",function(){n.tableParams.reload()})}}}]),e.directive("challengeTeamEdit",["$uibModal","patronicityConfig","api","$window",function(t,n,o,e){return{restrict:"E",template:'<button ng-click="openEditModal()" class="btn btn-xs btn-primary">{{label}}</button>',scope:{challengeTeam:"="},link:function(e){e.label="Edit",e.challengeTeam||(e.label="Add challenge team"),e.openEditModal=function(){t.open({templateUrl:n.urlForTemplate("newadmin/challenge-team-edit.html"),controller:["$scope","$uibModalInstance","challengeTeam",function(t,n,a){t.isNewchallengeTeam=!1,a?t.editchallengeTeam=angular.copy(a):(t.editchallengeTeam={ID:"new"},t.isNewchallengeTeam=!0),t.save=function(){o.projectAdmin.saveChallengeTeam(t.editchallengeTeam).then(function(e){angular.copy(e,a),t.$root.$broadcast("load-challenge-team","challengeTeam"),n.close({})},function(e){console.log("Save failed: "+e),t.messageText=e})},t.cancel=function(){n.dismiss({})}}],size:"md",resolve:{challengeTeam:function(){return e.challengeTeam}}})}}}}]),e.directive("customTeamUrl",["api","$q",function(o,i){return{restrict:"A",require:"ngModel",link:function(e,t,n,a){if(!a)throw"Missing ngModel!";a.$parsers.push(function(e){var t=e?e.replace(/[^A-Za-z0-9_\-]/g,""):null;return t!=e&&(a.$setViewValue(t),a.$render()),t}),a.$asyncValidators.uniqueUrl=function(e,t){e=e||t;return e&&0<e.length?o.projectAdmin.slugValidation(e):i.resolve()}}}}]),e.directive("hideCampaign",["api","Dialogs","$window",function(e,n,t){return{restrict:"EA",scope:{projectId:"=",isHide:"="},replace:!0,template:'<button class="btn btn-xs btn-danger" ng-click="campaignHide()">{{labels()}}</button>',link:function(t){t.saving=!1,t.labels=function(){return t.label="Private Campaign",t.text="private",t.saving&&(t.label="Campaign Hiding..."),t.isHide&&(t.label="Unprivate Campaign",t.text="unprivate"),t.label},t.campaignHide=function(){void 0!==t.projectId&&n.Confirm("Are you sure you want to "+t.text+" this Campaign?",t.label).then(function(){t.saving=!0,e.admin.hideCampaign(t.projectId).then(function(e){t.saving=!1,t.$emit("reload-data"),t.$emit("reload-data-admintab")},function(e){n.Confirm(e,t.label,[{name:"OK",type:"ok"}]).then(function(){t.saving=!1})})})}}}}]),e.directive("hideCampaignForNonAdmins",["api","Dialogs","$window",function(e,n,t){return{restrict:"EA",scope:{projectId:"=",isHide:"="},replace:!0,template:'<button class="btn btn-xs btn-danger" ng-click="campaignHide()">{{labels()}}</button>',link:function(t){t.saving=!1,t.labels=function(){return t.label="Hide Campaign",t.text="hide",t.saving&&(t.label="Campaign Hiding..."),t.isHide&&(t.label="Unhide Campaign",t.text="unhide"),t.label},t.campaignHide=function(){void 0!==t.projectId&&n.Confirm("Are you sure you want to "+t.text+" this Campaign?",t.label).then(function(){t.saving=!0,e.admin.hideCampaignForNonAdmin(t.projectId).then(function(e){t.saving=!1,t.$emit("reload-data"),t.$emit("reload-data-admintab")},function(e){n.Confirm(e,t.label,[{name:"OK",type:"ok"}]).then(function(){t.saving=!1})})})}}}}]),e.directive("getProjectUrl",["api","Dialogs","$window",function(e,t,n){return{restrict:"EA",scope:{projectId:"="},replace:!0,templateUrl:"getProjectUrl.html",link:function(t){t.getProjectLink=function(){e.Cards.get({id:t.projectId},function(e){t.project=e})},t.getProjectLink()}}}])}(),function(){var e=angular.module("patronicity.admin.pages",["patronicity.api","user","ngTable","ui.bootstrap","googlechart"]);e.directive("adminPages",function(){return console.log("adminPages!"),{restrict:"E",scope:{},templateUrl:"adminPages.html"}}),e.directive("pageManager",["api","NgTableParams",function(e,t){return{restrict:"E",scope:{},templateUrl:"pageManager.html",link:function(n){n.listDetails={},e.admin.pages.getStatusList().then(function(e){console.log("Build Page Status list"),n.listDetails.statusList=e}),n.tableParams=new t({page:1,count:25,filter:{},exact:{},sorting:{Title:"asc"}},{getData:function(t){return console.log("getting data"),console.log(t.url()),n.loading=!0,e.admin.pages.load({page:t.page(),count:t.count(),sorting:t.sorting(),filter:t.filter()}).then(function(e){return t.total(e.total),n.loading=!1,e.items})}}),n.$on("load-pages",function(){console.log("reload requested"),n.tableParams.reload()})}}}]),e.directive("pageStatusList",["api",function(){return{restrict:"E",scope:{status:"=",statusList:"="},template:"<span>{{textForStatusList()}}</span>",link:function(n){n.textForStatusList=function(){var t="";return angular.forEach(n.statusList,function(e){e.id==n.status&&(t=e.label)}),t}}}}]),e.directive("pageEdit",["$uibModal","patronicityConfig","api","$window",function(t,n,o,e){return{restrict:"E",template:'<button ng-click="openEditModal()" class="btn btn-primary">{{label}}</button>',scope:{page:"="},link:function(e){e.label="Edit",e.page||(e.label="Add Page"),e.openEditModal=function(){t.open({templateUrl:n.urlForTemplate("newadmin/pages/page-edit.html"),controller:["$scope","$uibModalInstance","page",function(t,n,a){t.isNewPage=!1,t.showWrapper=!0,t.pattern=/^[a-zA-Z0-9._-]+$/,t.messageText="",t.listDetails={},t.newTags={},t.tags=[{id:1,label:"name",value:"name"},{id:2,label:"property",value:"property"}],a?(console.log("Editing page"),t.editPage=angular.copy(a),t.checkbox={standalone:!!(1&t.editPage.Flags),includeHeader:!!(2&t.editPage.Flags),includeFooter:!!(4&t.editPage.Flags),robotsNoIndex:!!(8&t.editPage.Flags),robotsNoFollow:!!(16&t.editPage.Flags),isActive:!!(32&t.editPage.Flags)},t.checkbox.standalone&&(t.showWrapper=!1),t.editPage.WrapperId?o.admin.pageWrappers.loadPageWrapper(t.editPage.WrapperId).then(function(e){console.log("Get Page Wrapper"),t.listDetails.pageWrapper=e.wrapper}):(console.log("WrapperId does not exist"),t.listDetails.pageWrapper=null),t.editPage.MetaTags&&"string"==typeof t.editPage.MetaTags?(t.editPage.MetaTags=JSON.parse(t.editPage.MetaTags),0==t.editPage.MetaTags.Meta.length&&(t.editPage.MetaTags.Meta={})):t.editPage.MetaTags={Meta:{},Style:"",Script:"",Html:""}):(console.log("Creating new page"),t.editPage={ID:"new"},t.isNewPage=!0,t.editPage.MetaTags={Meta:{},Style:"",Script:"",Html:""}),o.admin.pages.getContainerList().then(function(e){t.editPage.templates=e}),o.admin.pageWrappers.getWrapperList().then(function(e){console.log("Build Page Wrapper list"),t.listDetails.wrapperList=e}),o.admin.pages.getStatusList().then(function(e){console.log("Build Page Status list"),t.listDetails.statusList=e}),t.changeStandalone=function(){t.checkbox.standalone?(t.editPage.Flags|=1,t.showWrapper=!1):(t.editPage.Flags&=-2,t.showWrapper=!0)},t.changeIncludeHeader=function(){t.checkbox.includeHeader?t.editPage.Flags|=2:t.editPage.Flags&=-3},t.changeIncludeFooter=function(){t.checkbox.includeFooter?t.editPage.Flags|=4:t.editPage.Flags&=-5},t.changeRobotsNoIndex=function(){t.checkbox.robotsNoIndex?t.editPage.Flags|=8:t.editPage.Flags&=-9},t.changeRobotsNoFollow=function(){t.checkbox.robotsNoFollow?t.editPage.Flags|=16:t.editPage.Flags&=-17},t.changeActive=function(){t.checkbox.isActive?t.editPage.Flags|=32:t.editPage.Flags&=-33},t.newMeta=function(){t.addingMeta=!0},t.removeMeta=function(e){delete t.editPage.MetaTags.Meta[e.tag+"|"+e.value]},t.addTag=function(){t.editPage.MetaTags.Meta[t.newTags.tag+"|"+t.newTags.value]=t.newTags,t.newTags={}},t.preSave=function(){console.log("Validate slug: "+t.editPage.Slug),t.messageText="",t.dupSlug=!1,o.admin.pages.verifySlug(t.editPage.Slug).then(function(e){t.pages=e.pages,t.pages&&angular.forEach(t.pages,function(e){e.ID!=t.editPage.ID&&(t.dupSlug=!0)}),t.dupSlug?t.messageText="Slug must be unique.":(t.editPage.ContainerSlug=t.editPage.ContainerSlug&&t.editPage.ContainerSlug.trim(),o.admin.pages.save(t.editPage).then(function(e){angular.copy(e,a),t.isNewPage&&(console.log("new page so requesting reload"+a),t.$root.$broadcast("load-pages","page")),n.close({})},function(e){t.messageText="Save of page has failed.",console.log(t.messageText),console.log(e)}))})},t.cancel=function(){n.dismiss({})}}],size:"lg",resolve:{page:function(){return e.page}}})}}}}]),e.directive("pageWrapperList",["api","$stateParams","NgTableParams","patronicityConfig",function(e,t,a,n){return console.log("pageWrapperList!"),{restrict:"E",scope:{},templateUrl:n.urlForTemplate("newadmin/pages/page-wrapper-list.html"),link:function(n){n.tableParams=new a({page:1,count:25,filter:{},sorting:{Name:"asc"}},{getData:function(t){return console.log("getting data"),console.log(t.url()),n.loading=!0,e.admin.pageWrappers.load({page:t.page(),count:t.count(),sorting:t.sorting(),filter:t.filter()}).then(function(e){return t.total(e.total),n.loading=!1,e.items})}}),n.$on("load-wrappers",function(){console.log("reload requested"),n.tableParams.reload()})}}}]),e.directive("pageWrapperEdit",["$uibModal","patronicityConfig","api",function(t,n,o){return{restrict:"E",scope:{wrapper:"="},template:'<button ng-click="openEditModal()" class="btn btn-primary">{{label}}</button>',link:function(e){e.label="Edit",e.wrapper||(e.label="Add Wrapper"),e.openEditModal=function(){t.open({templateUrl:n.urlForTemplate("newadmin/pages/page-wrapper-edit.html"),controller:["$scope","$uibModalInstance","wrapper",function(t,n,a){t.isNewWrapper=!1,a?(console.log("Editing page wrapper"),t.editWrapper=angular.copy(a),t.checkbox={isActive:!!(1&t.editWrapper.Flags)}):(console.log("Creating new page wrapper"),t.editWrapper={ID:"new"},t.isNewWrapper=!0),t.changeActive=function(){t.checkbox.isActive?t.editWrapper.Flags|=1:t.editWrapper.Flags&=-2},t.save=function(){console.log("Saving page wrapper"),console.log("ID: "+t.editWrapper.ID),o.admin.pageWrappers.save(t.editWrapper).then(function(e){angular.copy(e,a),t.isNewWrapper&&(console.log("new wrapper so requesting reload"+a),t.$root.$broadcast("load-wrappers","wrapper")),n.close({})},function(e){console.log("Save failed: "+e),t.messageText=e})},t.cancel=function(){n.dismiss({})}}],size:"md",resolve:{wrapper:function(){return e.wrapper}}})}}}}])}(),function(){var e=angular.module("patronicity.admin.pulsepage",["patronicity.api","user","ngTable","ui.bootstrap","googlechart"]);e.directive("adminPulsePage",function(){return console.log("adminPulsePage!"),{restrict:"E",scope:{},templateUrl:"adminPulsePage.html"}}),e.directive("pulsePageManager",["api","NgTableParams",function(e,t){return{restrict:"E",scope:{},templateUrl:"pulsePageManager.html",link:function(n){n.listDetails={},e.admin.pulsePages.getLists().then(function(e){console.log("Build Page Status, Type and Section lists"),n.listDetails.statusList=e.status,n.listDetails.typeList=e.type,n.listDetails.sectionList=e.section}),n.tableParams=new t({page:1,count:25,filter:{},exact:{},sorting:{Order:"asc"}},{getData:function(t){return console.log("getting data"),console.log(t.url()),n.loading=!0,e.admin.pulsePages.load({page:t.page(),count:t.count(),sorting:t.sorting(),filter:t.filter()}).then(function(e){return t.total(e.total),n.loading=!1,e.items})}}),n.$on("load-page",function(){console.log("reload requested"),n.tableParams.reload()})}}}]),e.directive("pulsePageStatusList",["api",function(){return{restrict:"E",scope:{status:"=",statusList:"="},template:"<span>{{textForStatusList()}}</span>",link:function(n){n.textForStatusList=function(){var t="";return angular.forEach(n.statusList,function(e){e.id==n.status&&(t=e.label)}),t}}}}]),e.directive("pulsePageTypeList",["api",function(){return{restrict:"E",scope:{type:"=",typeList:"="},template:"<span>{{textForTypeList()}}</span>",link:function(n){n.textForTypeList=function(){var t="";return angular.forEach(n.typeList,function(e){e.id==n.type&&(t=e.label)}),t}}}}]),e.directive("pulsePageSectionList",["api",function(){return{restrict:"E",scope:{section:"=",sectionList:"="},template:"<span>{{textForSectionList()}}</span>",link:function(n){n.textForSectionList=function(){var t="";return angular.forEach(n.sectionList,function(e){e.id==n.section&&(t=e.label)}),t}}}}]),e.directive("pulseEdit",["$uibModal","patronicityConfig","api","$window",function(t,n,o,e){return{restrict:"E",template:'<button ng-click="openEditModal()" class="btn btn-primary">{{label}}</button>',scope:{page:"="},link:function(e){e.label="Edit",e.page||(e.label="Add Page"),e.openEditModal=function(){t.open({templateUrl:n.urlForTemplate("newadmin/pulse/pulse-edit.html"),controller:["$scope","$uibModalInstance","page",function(t,n,a){t.isNewPage=!1,t.messageText="",t.listDetails={},a?(console.log("Editing page"),t.editPage=angular.copy(a),t.editPage.Order=parseInt(t.editPage.Order)):(console.log("Creating new page"),t.editPage={ID:"new"},t.isNewPage=!0,t.editPage.Order=0),o.admin.pulsePages.getLists().then(function(e){console.log("Build Page Status, Type and Section lists"),t.listDetails.statusList=e.status,t.listDetails.typeList=e.type,t.listDetails.sectionList=e.section}),t.preSave=function(){o.admin.pulsePages.save(t.editPage).then(function(e){angular.copy(e,a),t.isNewPage&&(console.log("new pulse page so requesting reload"+a),t.$root.$broadcast("load-page","page")),n.close({})},function(e){t.messageText="Save of pulse page has failed.",console.log(t.messageText),console.log(e)})},t.cancel=function(){n.dismiss({})}}],size:"md",resolve:{page:function(){return e.page}}})}}}}])}(),function(){var e=angular.module("patronicity.admin.sponsors",["patronicity.api","user","ngTable","ui.bootstrap","googlechart"]);e.directive("adminSponsors",function(){return console.log("adminSponsors!"),{restrict:"E",scope:{},templateUrl:"adminSponsors.html"}}),e.directive("sponsorManager",["api","NgTableParams",function(a,e){return{restrict:"E",scope:{},templateUrl:"sponsorManager.html",link:function(n){n.cols=[{field:"Name",title:"Name",show:!0},{field:"Creator",title:"Creator",show:!0},{field:"Creator Email",title:"Creator Email",show:!0},{field:"Status",title:"Status",show:!0},{field:"Manager",title:"Manager",show:!0},{field:"Description",title:"Description",show:!1},{field:"Slug",title:"Slug",show:!1},{field:"Created",title:"Created",show:!0},{field:"Launch Date",title:"Launch Date",show:!0},{field:"Curated",title:"Curated",show:!0},{field:"Allow Campaign Friends",title:"Allow Campaign Friends",show:!0},{field:"Direct Campaigns",title:"Direct Campaigns",show:!0},{field:"FOC Campaigns",title:"FOC Campaigns",show:!0},{field:"Payment Type",title:"Payment Type",show:!0},{field:"Bank Country",title:"Bank Country",show:!0},{field:"Offline Donation",title:"Offline Donation",show:!0},{field:"FOC Total Raised",title:"FOC Total Raised",show:!0},{field:"Online Donation",title:"Online Donation",show:!0},{field:"Currency",title:"Currency",show:!0},{field:"Total Raised",title:"Total Raised",show:!0}],n.display={Data:0},n.tableParams=new e({page:1,count:25,filter:{},exact:{},sorting:{Created:"desc"},display:n.display.Data},{getData:function(t){n.isLoading=!0;var e=jQuery.param(t.url());return n.sponsorCSV=e,a.admin.projectsstats.get(t.url()).$promise.then(function(e){return t.total(e.total),n.list=e.list,n.currentResultCount=e.total,n.display.Data=e.display,n.isLoading=!1,e.result})}}),n.$on("load-sponsors",function(){console.log("reload requested"),n.tableParams.reload()}),n.clearStatusFilter=function(){delete n.tableParams.filter().Status},n.clearManagerFilter=function(){delete n.tableParams.filter().ManagerID},n.clearPaymentTypeFilter=function(){delete n.tableParams.filter().PaymentType},n.clearAllowFOCFilter=function(){delete n.tableParams.filter().CampaignFriends},n.displayList=function(){n.tableParams._params.display=n.display.Data,n.tableParams.reload()}}}}]),e.directive("sponsorStatusToggle",["api",function(e){return{restrict:"E",template:'<button ng-click="toggleStatus()" class="btn btn-xs btn-primary"><span ng-if="isActive(sponsor)">Deactivate</span><span ng-if="!isActive(sponsor)">Activate</span></button>',scope:{sponsor:"="},link:function(t){t.isActive=function(e){return!!(1&e.Flags)},t.toggleStatus=function(){1&t.sponsor.Flags?t.sponsor.Flags&=-2:t.sponsor.Flags|=1,e.admin.sponsors.save(t.sponsor).then(function(e){t.$root.$broadcast("load-sponsors","sponsor")})}}}}]),e.directive("sponsorEdit",["$uibModal","patronicityConfig","api","$window",function(t,n,i,r){return{restrict:"E",template:'<button ng-click="openEditModal()" class="btn btn-xs btn-primary">{{label}}</button>',scope:{sponsor:"="},link:function(e){e.label="Edit",e.sponsor||(e.label="Add Sponsor"),e.openEditModal=function(){t.open({templateUrl:n.urlForTemplate("newadmin/sponsors/sponsor-edit.html"),controller:["$scope","$uibModalInstance","sponsor",function(n,t,a){function o(){n.editSponsor.ParentProjectID?(i.admin.project.getProjectImage(n.editSponsor.ParentProjectID).then(function(e){console.log("Get Parent Project url"),n.listDetails.projectImage=e.image}),i.admin.project.getProject(n.editSponsor.ParentProjectID).then(function(e){console.log("Get Parent Project info"),n.listDetails.project=e.project})):(console.log("Parent ProjectId does not exist"),n.listDetails.projectImage=null,n.listDetails.project=null)}n.isNewSponsor=!1,n.listDetails={},n.FlagDetails=[],a?(console.log("Editing sponsor"),n.editSponsor=angular.copy(a),1&n.editSponsor.Flags?n.FlagDetails.Active="1":n.FlagDetails.Active="0",console.log("ProjectID: "+n.editSponsor.ParentProjectID),o()):(console.log("Creating new sponsor"),n.editSponsor={ID:"new",Color:"#7ECB91"},n.isNewSponsor=!0,n.FlagDetails.Active="1"),i.admin.sponsors.getAdminList().then(function(e){console.log("Build Admin user list"),n.listDetails.managers=e}),n.displayProject=function(){r.open("/project/"+n.listDetails.project.Slug,"_blank")},n.$on("project-selected",function(e,t){console.log("item selected!"),console.log(t),n.editSponsor.ParentProjectID=t.project.ID,console.log("projectId: "+n.editSponsor.ParentProjectID),o()}),n.save=function(){console.log("Saving sponsor"),"1"==n.FlagDetails.Active?n.editSponsor.Flags|=1:n.editSponsor.Flags&=-2,i.admin.sponsors.save(n.editSponsor).then(function(e){angular.copy(e,a),n.isNewSponsor&&console.log("new sponsor so requesting reload"+a),n.$root.$broadcast("load-sponsors","sponsor"),t.close({})},function(e){console.log("Save failed: "+e),n.messageText=e})},n.cancel=function(){t.dismiss({})}}],size:"md",resolve:{sponsor:function(){return e.sponsor}}})}}}}]),e.directive("adminSponsorsMetadata",["api","$stateParams","NgTableParams","patronicityConfig",function(e,a,t,n){return console.log("adminSponsorsMetadata!"),{restrict:"E",templateUrl:n.urlForTemplate("newadmin/sponsors/metadata.html"),link:function(n){n.sponsorId=a.id,console.log("id: "+n.sponsorId),console.log("Load Sponsor: "+a.id),e.admin.sponsors.loadSponsor(a.id).then(function(e){n.sponsorDetail=e.sponsor}),n.tableParams=new t({page:1,count:25,filter:{},sorting:{GroupName:"asc"}},{getData:function(t){return console.log("getting data"),console.log(t.url()),n.loading=!0,e.admin.metadata.load({page:t.page(),count:t.count(),sorting:t.sorting(),exact:{SponsorID:a.id},filter:t.filter()}).then(function(e){return t.total(e.total),n.loading=!1,e.items})}}),n.$on("load-metadata",function(){console.log("reload requested"),n.tableParams.reload()})}}}]),e.directive("metadataEdit",["$uibModal","patronicityConfig","api",function(t,n,o){return{restrict:"E",scope:{sponsorId:"=",metadata:"="},template:'<button ng-click="openEditModal()" class="btn btn-primary">{{label}}</button>',link:function(e){e.label="Edit",e.metadata||(e.label="Add Metadata"),e.openEditModal=function(){t.open({templateUrl:n.urlForTemplate("newadmin/sponsors/metadata-edit.html"),controller:["$scope","$uibModalInstance","sponsorId","metadata",function(t,n,e,a){console.log("sponsorId: "+e),t.isNewMetadata=!1,t.possibleGroups=[{id:"project_field_default",label:"Default value"},{id:"email_template_slug_override",label:"Email template override"},{id:"project_field_from_master",label:"Copy from master campaign"},{id:"approval_level",label:"Approval level for the dashboard"},{id:"approval_setting",label:"Approval setting for new campaigns"}],a?(console.log("Editing sponsor metadata"),t.editMetadata=angular.copy(a)):(console.log("Creating new sponsor metadata"),t.editMetadata={ID:"new",SponsorID:e},t.isNewMetadata=!0),t.save=function(){console.log("Saving sponsor metadata"),console.log("ID: "+t.editMetadata.ID+" SponsorID: "+t.editMetadata.SponsorID),console.log("Saving sponsor metadata"),o.admin.metadata.save(t.editMetadata).then(function(e){angular.copy(e,a),t.isNewMetadata&&(console.log("new metadata so requesting reload"+a),t.$root.$broadcast("load-metadata","metadata")),n.close({})},function(e){console.log("Save failed: "+e),t.messageText=e})},t.cancel=function(){n.dismiss({})}}],size:"md",resolve:{metadata:function(){return e.metadata},sponsorId:function(){return e.sponsorId}}})}}}}]),e.directive("adminSponsorsUsers",["api","$stateParams","NgTableParams","patronicityConfig","Dialogs",function(a,e,t,n,o){return console.log("adminSponsorsUsers!"),{restrict:"E",templateUrl:"adminSponsorsUsers.html",link:function(n){n.listDetails={sponsorId:e.id},n.tableParams=new t({page:1,count:25,filter:{},sorting:{UserID:"asc"}},{getData:function(t){return console.log("getting data"),console.log(t.url()),n.loading=!0,a.admin.sponsorUsers.load({page:t.page(),count:t.count(),sorting:t.sorting(),exact:{SponsorID:e.id},filter:t.filter()}).then(function(e){return t.total(e.total),n.loading=!1,e.items})}}),n.delete=function(e){console.log("Deleting ID: "+e),o.Confirm("Are you sure you want to delete this user for this sponsor?","Delete Sponsor User",[{name:"Delete",type:"ok"},{name:"Cancel",type:"cancel"}]).then(function(){a.admin.sponsorUsers.delete(e).then(function(){console.log("deleted sponsor user so requesting reload"),n.$root.$broadcast("load-user")},function(e){console.log("Delete failed: "+e),n.messageText=e})},function(){})},n.$on("user-selected",function(e,t){console.log("item selected!"),n.newSponsorUser={ID:"new",UserID:t.user.ID,SponsorID:n.listDetails.sponsorId},a.admin.sponsorUsers.save(n.newSponsorUser).then(function(e){console.log("new sponsor user so requesting reload "+e),n.$root.$broadcast("load-user","data")},function(e){console.log("Save failed: "+e)})}),n.$on("load-user",function(){console.log("reload requested"),n.tableParams.reload()})}}}]),e.directive("adminSponsorsResources",["api","$stateParams","Dialogs","$uibModal","patronicityConfig","$timeout",function(t,n,r,e,a,s){return{restrict:"E",scope:{},templateUrl:a.urlForTemplate("newadmin/sponsors/resource.html"),link:function(i){i.sponsorId=n.id,console.log("id: "+i.sponsorId),console.log("Load Sponsor: "+n.id),t.admin.sponsors.loadSponsor(n.id).then(function(e){i.sponsorDetail=e.sponsor}),t.admin.resources.loadAllForSponsor(n.id).then(function(e){i.sponsorResources=e.resources,i.sponsorResources.sort(function(e,t){return e.Order-t.Order});var t=[];angular.forEach(e.resources,function(e){t.push(e.ID)}),i.currentResourceIds=t}),i.currentResourceIds=[],i.isDirty=!1;var e;i.isSaving=!1;function a(){i.isSaving?void 0===e&&(e=s(function(){e=void 0,a()},5e3)):i.saveSponsorResources()}function o(){for(var e in i.sponsorResources)i.sponsorResources[e].Order=e}i.sortableOptions={update:function(e,t){},stop:function(e,t){o(),a()}},i.moveToTop=function(e){for(var t=0;t<i.sponsorResources.length;t++)if(i.sponsorResources[t].ID==e.ID){var n=i.sponsorResources.splice(t,1);i.sponsorResources.unshift(n[0]),o(),a();break}},i.$on("resource-added",function(e,t){console.log("Data.ID: "+t.resource.ID);t={ID:t.resource.ID,SponsorID:t.resource.SponsorID,Title:t.resource.Title,Order:i.sponsorResources.length,resource:t.resource};i.sponsorResources.push(t),i.currentResourceIds.push(t.ID),a()}),i.removeItem=function(t){r.Confirm("Are you sure you want to remove "+t.Title+" from the Sponsor?.","Remove From Sponsor").then(function(){var e=i.sponsorResources.filter(function(e){return e.ID!=t.ID});e.length!=i.sponsorResources.length&&(i.sponsorResources=e,i.currentResourceIds=i.currentResourceIds.filter(function(e){return e!=t.ID}),o(),a())})},i.saveSponsorResources=function(){i.isSaving=!0,t.admin.resources.saveAll(i.sponsorId,i.sponsorResources).then(function(e){var o;i.isDirty=!1,i.isSaving=!1,o=e,angular.forEach(i.sponsorResources,function(e,t){for(var n=0;n<=o.length;n++)if(e.ID==o[n].ID){var a=e.resource;i.sponsorResources[t]=o[n],i.sponsorResources[t].resource=a;break}})})}}}}]),e.directive("resourceEdit",["$uibModal","patronicityConfig","api",function(t,n,o){return{restrict:"E",scope:{sponsorId:"=",resource:"="},template:'<button ng-click="openEditModal()" class="btn btn-primary">{{label}}</button>',link:function(e){e.label="Edit",e.resource||(e.label="Add Section"),e.openEditModal=function(){t.open({templateUrl:n.urlForTemplate("newadmin/sponsors/resource-edit.html"),controller:["$scope","$uibModalInstance","sponsorId","resource",function(t,n,e,a){console.log("sponsorId: "+e),t.isNewResource=!1,a?(console.log("Editing sponsor resource"),t.editResource=angular.copy(a)):(console.log("Creating new sponsor resource"),t.editResource={ID:"new",SponsorID:e},t.isNewResource=!0),t.save=function(){console.log("ID: "+t.editResource.ID+" SponsorID: "+t.editResource.SponsorID),console.log("Saving sponsor resource"),o.admin.resources.save(t.editResource).then(function(e){angular.copy(e,a),t.isNewResource&&(console.log("new resource so requesting reload for ID: "+e.ID),t.$root.$broadcast("resource-added",{resource:e})),n.close({})},function(e){console.log("Save failed: "+e),t.messageText=e})},t.cancel=function(){n.dismiss({})}}],size:"md",resolve:{resource:function(){return e.resource},sponsorId:function(){return e.sponsorId}}})}}}}]),e.directive("adminSponsorsResourceItems",["api","$stateParams","Dialogs","$uibModal","patronicityConfig","$timeout",function(t,n,r,e,a,s){return{restrict:"E",scope:{},templateUrl:a.urlForTemplate("newadmin/sponsors/resource-item.html"),link:function(i){i.sectionId=n.id,console.log("id: "+i.sectionId),console.log("Load Resource: "+n.id),t.admin.resources.loadResource(n.id).then(function(e){i.resourceDetail=e.resource}),t.admin.resourceItems.loadAllForResource(n.id).then(function(e){i.resourceItems=e.items,i.resourceItems.sort(function(e,t){return e.Order-t.Order});var t=[];angular.forEach(e.items,function(e){t.push(e.ID)}),i.currentItemIds=t}),i.currentItemIds=[],i.isDirty=!1;var e;i.isSaving=!1;function a(){i.isSaving?void 0===e&&(e=s(function(){e=void 0,a()},5e3)):i.saveResourceItems()}function o(){for(var e in i.resourceItems)i.resourceItems[e].Order=e}i.sortableOptions={update:function(e,t){},stop:function(e,t){o(),a()}},i.moveToTop=function(e){for(var t=0;t<i.resourceItems.length;t++)if(i.resourceItems[t].ID==e.ID){var n=i.resourceItems.splice(t,1);i.resourceItems.unshift(n[0]),o(),a();break}},i.$on("item-added",function(e,t){console.log("Data.ID: "+t.item.ID);t={ID:t.item.ID,SectionID:t.item.SectionID,Title:t.item.Title,Link:t.item.Link,Order:i.resourceItems.length,MediaID:t.item.MediaID,Description:t.item.Description,item:t.item};i.resourceItems.push(t),i.currentItemIds.push(t.ID),a()}),i.removeItem=function(t){r.Confirm("Are you sure you want to remove "+t.Title+" from the Resource Section?.","Remove From Resource").then(function(){var e=i.resourceItems.filter(function(e){return e.ID!=t.ID});e.length!=i.resourceItems.length&&(i.resourceItems=e,i.currentItemIds=i.currentItemIds.filter(function(e){return e!=t.ID}),o(),a())})},i.saveResourceItems=function(){i.isSaving=!0,t.admin.resourceItems.saveAll(i.sectionId,i.resourceItems).then(function(e){var o;i.isDirty=!1,i.isSaving=!1,o=e,angular.forEach(i.resourceItems,function(e,t){for(var n=0;n<=o.length;n++)if(e.ID==o[n].ID){var a=e.item;i.resourceItems[t]=o[n],i.resourceItems[t].item=a;break}})})}}}}]),e.directive("resourceItemEdit",["$uibModal","patronicityConfig","api",function(t,n,o){return{restrict:"E",scope:{sectionId:"=",item:"="},template:'<button ng-click="openEditModal()" class="btn btn-primary">{{label}}</button>',link:function(e){e.label="Edit",e.item||(e.label="Add Section Item"),e.openEditModal=function(){t.open({templateUrl:n.urlForTemplate("newadmin/sponsors/resource-item-edit.html"),controller:["$scope","$uibModalInstance","sectionId","item",function(t,n,e,a){console.log("sectionId: "+e),t.isNewItem=!1,a?(console.log("Editing resource section item"),t.editItem=angular.copy(a)):(console.log("Creating new resource section item"),t.editItem={ID:"new",SectionID:e},t.isNewItem=!0),t.save=function(){console.log("ID: "+t.editItem.ID+" SectionID: "+t.editItem.SectionID),console.log("Saving section item"),o.admin.resourceItems.save(t.editItem).then(function(e){angular.copy(e,a),t.isNewItem&&(console.log("new section item so requesting reload for ID: "+e.ID),t.$root.$broadcast("item-added",{item:e})),n.close({})},function(e){console.log("Save failed: "+e),t.messageText=e})},t.cancel=function(){n.dismiss({})}}],size:"md",resolve:{item:function(){return e.item},sectionId:function(){return e.sectionId}}})}}}}]),e.directive("adminSponsorsCampaigns",["api","NgTableParams","$stateParams",function(e,t,a){return{restrict:"E",scope:{},templateUrl:"adminSponsorsCampaigns.html",link:function(n){n.sponsorid=a.id,n.tableParams=new t({page:1,count:25,filter:{},exact:{SponsorID:a.id,Active:1},sorting:{EndDate:"desc"}},{getData:function(t){return n.url=jQuery.param(t.url()),e.admin.projects.get(t.url()).$promise.then(function(e){return t.total(e.total),n.total=e.total,n.data=e.result,e.result})}}),n.$on("load-sponsors-campaign",function(){n.tableParams.reload()})}}}]),e.directive("sponsorFeaturedButton",["api",function(e){return{restrict:"EA",scope:{sponsorId:"=",isFeatured:"="},replace:!0,template:'<button class="btn" ng-class="buttonClass()" ng-click="toggleFeatured()">{{label()}}</button>',link:function(t){t.saving=!1,t.label=function(){var e="Feature";return t.saving?e="Saving...":1==t.isFeatured&&(e="Featured"),e},t.buttonClass=function(){var e="btn-default";return e=1==t.isFeatured?"btn-success":e},t.toggleFeatured=function(){t.saving=!0,e.communityPage.sponsorToggleFeatured(t.sponsorId).then(function(e){t.isFeatured=e.IsFeatured,t.$root.$broadcast("load-sponsors","sponsor"),t.saving=!1})}}}}]),e.directive("adminCommunityList",["api","NgTableParams",function(a,e){return{restrict:"E",scope:{},templateUrl:"adminCommunityList.html",link:function(n){n.tableParams=new e({page:1,count:25,noPager:!0,filter:{},exact:{},sorting:{Created:"desc"}},{counts:[],getData:function(t){n.isLoading=!0;var e=jQuery.param(t.url());return n.sponsorCSV=e,a.admin.communitylist.get(t.url()).$promise.then(function(e){return t.total(e.total),n.list=e.list,n.currentResultCount=e.total,n.isLoading=!1,e.result})}}),n.$on("load-community-list",function(){n.tableParams.reload()})}}}]),e.directive("communityListEdit",["$uibModal","patronicityConfig","api","$window",function(t,n,o,e){return{restrict:"E",template:'<button ng-click="openEditModal()" class="btn btn-xs btn-primary">{{label}}</button>',scope:{list:"="},link:function(e){e.label="Edit",e.list||(e.label="Add Community List"),e.openEditModal=function(){t.open({templateUrl:n.urlForTemplate("newadmin/sponsors/community-list-edit.html"),controller:["$scope","$uibModalInstance","list",function(t,n,a){t.isNewSponsor=!1,a?(console.log("Editing sponsor"),t.editList=angular.copy(a)):(console.log("Creating new sponsor"),t.editList={ID:"new",Color:"#7ECB91"},t.isNewSponsor=!0),t.save=function(){o.admin.communityList.save(t.editList).then(function(e){angular.copy(e,a),t.isNewSponsor&&console.log("new sponsor so requesting reload"+a),t.$root.$broadcast("load-community-list","community list"),n.close({})},function(e){console.log("Save failed: "+e),t.messageText=e})},t.cancel=function(){n.dismiss({})}}],size:"md",resolve:{list:function(){return e.list}}})}}}}]),e.directive("adminCommunityListItems",["api","$stateParams","Dialogs","$uibModal","patronicityConfig","$timeout",function(n,r,s,e,t,c){return{restrict:"E",scope:{},templateUrl:"adminCommunityListItems.html",link:function(o){o.cards={cards:[]},o.currentItemIds=[],o.isDirty=!1,o.isSaving=!1;var e;o.loadingItems=!0;function t(){o.loadingItems=!0,n.admin.communityListItems.load(o.listID).then(function(e){o.Items=e.items,o.Items.sort(function(e,t){return e.SortOrder-t.SortOrder});var t=[];angular.forEach(o.Items,function(e){t.push(e.SponsorID)}),o.currentItemIds=t,o.loadingItems=!1})}function a(){o.isSaving?void 0===e&&(e=c(function(){e=void 0,a()},5e3)):o.saveItems()}function i(){for(var e in o.Items)o.Items[e].SortOrder=e}o.listID=r.id,t(),o.sortableOptions={update:function(e,t){},stop:function(e,t){i(),a()}},o.moveToTop=function(e){for(var t=0;t<o.Items.length;t++)if(o.Items[t].ID==e.ID){var n=o.Items.splice(t,1);o.Items.unshift(n[0]),i(),a();break}},o.moveToBottom=function(e){for(var t=0;t<o.Items.length;t++)if(o.Items[t].ID==e.ID){var n=o.Items.splice(t,1);o.Items.push(n[0]),i(),a();break}},o.$on("community-item-selected",function(e,t){t={type:"add",id:t.community.ID,listID:o.listID};n.admin.communityListItems.addAndRemove(t).then(function(e){o.Items.splice(0,0,e.item),o.currentItemIds.splice(0,0,e.item.ID),o.moveToTop(e.item)})}),o.removeItem=function(t){s.Confirm("Are you sure you want to remove "+t.Name+"?","Remove From Community List Items").then(function(){var e=o.Items.filter(function(e){return e.SponsorID!=t.SponsorID});e.length!=o.Items.length&&(o.Items=e,o.currentItemIds=o.currentItemIds.filter(function(e){return e!=t.SponsorID}),e={type:"remove",id:t.ID,listID:o.listID},n.admin.communityListItems.addAndRemove(e).then(function(e){}),i())})},o.saveItems=function(){o.loadingItems=!0,o.isSaving=!0,n.admin.communityListItems.save(o.Items,o.listID).then(function(e){var a;o.isDirty=!1,o.isSaving=!1,a=e,angular.forEach(o.Items,function(e,t){for(var n=0;n<=a.length;n++)if(e.SponsorID==a[n].SponsorID){o.Items[t]=a[n];break}o.loadingItems=!1})},function(e){alert(e),t()})}}}}]),e.directive("searchCommunityForList",["$timeout","Dialogs","api","patronicityConfig","$uibModal","$rootScope",function(e,t,n,a,o,i){return{restrict:"E",scope:{ignoreIds:"=?",searchVerb:"@?",currentUser:"=?",selectedCommunityId:"=?",sponsorId:"="},templateUrl:a.urlForTemplate("newadmin/community-search-for-list.html"),link:function(o,e,t){o.searchCommunities=function(e){o.loading=!0,o.errorMsg="",o.searchVerb||(o.searchVerb="search_active");e={param1:e,type:o.searchVerb,limit:200,offset:0,currentUser:o.currentUser,category:void 0,sponsorID:o.sponsorId};return n.Communities.query(e).$promise.then(function(e){0==e.length&&(o.errorMsg="No campaign is found");var t=e;return void 0!==o.ignoreIds&&(t=e.filter(function(e){for(var t=!1,n=0;n<o.ignoreIds.length;n++)if(o.ignoreIds[n]==e.ID){t=!0;break}return!t})),o.loading=!1,t})},o.itemSelected=function(e,t,n,a){i.$broadcast("community-item-selected",{community:e}),o.selectedCommunityId=""}}}}]),e.directive("adminSponsorLeaderboards",["$uibModal","patronicityConfig","api","$window","moment",function(t,n,a,e,o){return{restrict:"E",template:'<button ng-click="openEditModal()" class="btn btn-xs btn-primary">{{label}}</button>',scope:{sponsor:"="},link:function(e){e.label="leaderboards",e.openEditModal=function(){t.open({templateUrl:n.urlForTemplate("newadmin/sponsors/admin-sponsor-leaderboards.html"),controller:["$scope","$uibModalInstance","sponsor",function(n,t,e){n.leaderboardFundraisersPrize=!1,n.leaderboardFundraisersDonorsPrize=!1,n.copyFromData=!0,n.copyFromDataDonor=!0,n.leaderBoard={fundraisers:{name:"Standard",type:"top-fundraisers",display:0,startDate:"",endDate:"",sponsorIds:e.ID,templateType:"commpage",currencyCode:"USD",perPage:5,prizes:[{amount:""},{amount:""},{amount:""}]},fundraisersDonors:{name:"Standard",type:"top-fundraisers-donors",display:0,startDate:"",endDate:"",sponsorIds:e.ID,templateType:"commpage",currencyCode:"USD",perPage:5,prizes:[{amount:""},{amount:""},{amount:""}]},sponsorID:e.ID},n.donationTypes=[{name:"Standard",value:"top-fundraisers"},{name:"Unfiltered",value:"sponsor-unfiltered-donations"}],n.donorTypes=[{name:"Standard",value:"top-fundraisers-donors"},{name:"Unfiltered",value:"sponsor-unfiltered-donors"}],n.load=function(){a.admin.sponsors.loadLeaderBoard(e.ID).then(function(e){e.fundraisers&&(n.leaderBoard.fundraisers=e.fundraisers,o(n.leaderBoard.fundraisers.startDate).isValid()&&o(n.leaderBoard.fundraisers.endDate).isValid()&&(n.copyFromData=!1),o(n.leaderBoard.fundraisers.startDate).isValid()&&(n.leaderBoard.fundraisers.startDate=Date.parse(n.leaderBoard.fundraisers.startDate)),o(n.leaderBoard.fundraisers.endDate).isValid()&&(n.leaderBoard.fundraisers.endDate=Date.parse(n.leaderBoard.fundraisers.endDate))),e.fundraisersDonors&&(n.leaderBoard.fundraisersDonors=e.fundraisersDonors,o(n.leaderBoard.fundraisersDonors.startDate).isValid()&&(n.leaderBoard.fundraisersDonors.startDate=Date.parse(n.leaderBoard.fundraisersDonors.startDate)),o(n.leaderBoard.fundraisersDonors.endDate).isValid()&&(n.leaderBoard.fundraisersDonors.endDate=Date.parse(n.leaderBoard.fundraisersDonors.endDate)),o(n.leaderBoard.fundraisersDonors.startDate).isValid()&&o(n.leaderBoard.fundraisersDonors.endDate).isValid()&&(n.copyFromDataDonor=!1)),1<n.leaderBoard.fundraisers.prizes.length&&angular.forEach(n.leaderBoard.fundraisers.prizes,function(e,t){e.amount&&(n.leaderboardFundraisersPrize=!0)}),1<n.leaderBoard.fundraisersDonors.prizes.length&&angular.forEach(n.leaderBoard.fundraisersDonors.prizes,function(e,t){e.amount&&(n.leaderboardFundraisersDonorsPrize=!0)})},function(e){n.messageText=e})},n.reBuildDate=function(){n.leaderBoard.fundraisers.startDate&&n.leaderBoard.fundraisers.endDate&&(n.leaderBoard.fundraisers.startDate=o(n.leaderBoard.fundraisers.startDate).utc().format("YYYY-MM-DDTHH:mm:ss.SSS[Z]"),n.leaderBoard.fundraisers.endDate=o(n.leaderBoard.fundraisers.endDate).utc().format("YYYY-MM-DDTHH:mm:ss.SSS[Z]")),n.leaderBoard.fundraisersDonors.startDate&&n.leaderBoard.fundraisersDonors.endDate&&(n.leaderBoard.fundraisersDonors.startDate=o(n.leaderBoard.fundraisersDonors.startDate).utc().format("YYYY-MM-DDTHH:mm:ss.SSS[Z]"),n.leaderBoard.fundraisersDonors.endDate=o(n.leaderBoard.fundraisersDonors.endDate).utc().format("YYYY-MM-DDTHH:mm:ss.SSS[Z]"))},n.save=function(){n.reBuildDate(),a.admin.sponsors.saveLeaderBoard(n.leaderBoard).then(function(e){n.$root.$broadcast("load-sponsors","sponsor"),t.close({})},function(e){n.messageText=e})},n.addPrize=function(){n.leaderboardFundraisersPrize=!0},n.addMorePrize=function(){n.leaderBoard.fundraisers.prizes.push({amount:""})},n.addDonorPrize=function(){n.leaderboardFundraisersDonorsPrize=!0},n.addDonorsMorePrize=function(){n.leaderBoard.fundraisersDonors.prizes.push({amount:""})},n.copyPrizeFrom=function(){n.leaderBoard.fundraisersDonors.prizes=n.leaderBoard.fundraisers.prizes},n.copyPrizeFromDonors=function(){n.leaderBoard.fundraisers.prizes=n.leaderBoard.fundraisersDonors.prizes},n.copyLeaderboardDataFrom=function(){n.leaderBoard.fundraisersDonors.display=n.leaderBoard.fundraisers.display,n.leaderBoard.fundraisersDonors.startDate=n.leaderBoard.fundraisers.startDate,n.leaderBoard.fundraisersDonors.endDate=n.leaderBoard.fundraisers.endDate,n.leaderBoard.fundraisersDonors.sponsorIds=n.leaderBoard.fundraisers.sponsorIds,n.leaderBoard.fundraisersDonors.templateType=n.leaderBoard.fundraisers.templateType,n.leaderBoard.fundraisersDonors.currencyCode=n.leaderBoard.fundraisers.currencyCode,n.leaderBoard.fundraisersDonors.perPage=n.leaderBoard.fundraisers.perPage},n.copyLeaderboardDataFromDonors=function(){n.leaderBoard.fundraisers.display=n.leaderBoard.fundraisersDonors.display,n.leaderBoard.fundraisers.endDate=n.leaderBoard.fundraisersDonors.endDate,n.leaderBoard.fundraisers.startDate=n.leaderBoard.fundraisersDonors.startDate,n.leaderBoard.fundraisers.sponsorIds=n.leaderBoard.fundraisersDonors.sponsorIds,n.leaderBoard.fundraisers.templateType=n.leaderBoard.fundraisersDonors.templateType,n.leaderBoard.fundraisers.currencyCode=n.leaderBoard.fundraisersDonors.currencyCode,n.leaderBoard.fundraisers.perPage=n.leaderBoard.fundraisersDonors.perPage},n.cancel=function(){t.dismiss({})},n.getTypeHelp=function(e){var t="";return"top-fundraisers"==e?t="This leaderboard only counts donations through direct campaign page links or donor referral links.":"sponsor-unfiltered-donations"==e?t="This leaderboard counts all donations from all sources.":"top-fundraisers-donors"==e?t="This leaderboard only counts donors through direct campaign page links or donor referral links.":"sponsor-unfiltered-donors"==e&&(t="This leaderboard counts all donors from all sources."),t},n.load()}],size:"md",resolve:{sponsor:function(){return e.sponsor}}})}}}}]),e.directive("sponsorLeaderboards",["$uibModal","patronicityConfig","api","$window","moment",function(e,t,a,n,o){return{restrict:"E",templateUrl:t.urlForTemplate("sponsor-leaderboards.html"),scope:{sponsorId:"="},link:function(n,e,t){n.leaderboard={fundraisers:{},fundraisersDonors:{}},n.$watch("sponsorId",function(e,t){e&&e!==t&&a.projectAdmin.loadLeaderBoard(n.sponsorId).then(function(e){n.leaderboard.fundraisers=e.fundraisers,n.leaderboard.fundraisersDonors=e.fundraisersDonors},function(e){n.messageText=e})})}}}])}(),function(){var e=angular.module("patronicity.admin.transfers",["patronicity.api","user","ngTable","ui.bootstrap","patronicity.report.generator"]);e.directive("adminTransferHome",["api","patronicityConfig",function(t,e){return{restrict:"E",scope:{},templateUrl:e.urlForTemplate("newadmin/transfers/home.html"),link:function(n){function e(){n.data.loading=!0,t.admin.transfers.stats().then(function(e){for(var t in n.data.loading=!1,e)n.data[t]=e[t]},function(e){n.data.error_message=e})}n.data={loading:!0,error_message:"",last_generated:Date.now(),transfers_pending:0,transfers_needing_approval:0,next_generation:Date.now(),accounts_needing_transfers:0,generating_transfers:!1,generating_batches:!1,log_stream:null},n.generationComplete=function(){n.data.generating_transfers=!1,n.data.generating_batches=!1,e()},n.generateTransfers=function(){n.data.generating_transfers=!0,t.admin.transfers.generate("transfers").then(function(e){n.data.log_stream=e.log_stream},function(e){n.data.error_message=e})},n.generateBatches=function(){n.data.generating_batches=!0,t.admin.transfers.generate("batches").then(function(e){n.data.log_stream=e.log_stream},function(e){n.data.error_message=e})},e()}}}]),e.directive("adminTransfersList",["api","patronicityConfig","NgTableParams","$stateParams",function(a,e,o,i){return{restrict:"E",scope:{},templateUrl:e.urlForTemplate("newadmin/transfers/list.html"),link:function(n){n.error_message="";var e=i.state||"",t={};e.length&&(t={State:e}),n.listDetails={stateList:[]},a.admin.transfers.typesAndLabels().then(function(e){n.listDetails.stateList=e.states}),n.tableParams=new o({page:1,count:25,filter:t,exact:{},sorting:{CreatedAt:"desc"}},{getData:function(t){return n.loading=!0,a.admin.transfers.list({page:t.page(),count:t.count(),sorting:t.sorting(),filter:t.filter()}).then(function(e){return t.total(e.total),n.loading=!1,e.items})}}),n.setApproved=function(e,t){a.admin.transfers.setApproved(e,t).then(function(e){n.tableParams.reload(),n.error_message=""},function(e){n.error_message=e})},n.$on("load-accounts",function(){n.tableParams.reload()})}}}]),e.directive("adminTransfer",["api","patronicityConfig","NgTableParams","$stateParams",function(e,t,n,a){return{restrict:"E",scope:{},templateUrl:t.urlForTemplate("newadmin/transfers/admin_detail.html"),link:function(e){e.data={id:a.id}}}}]),e.directive("transferDetails",["api","patronicityConfig","$rootScope","Dialogs","$uibModal","User",function(a,e,o,i,r,s){return{restrict:"E",scope:{transferId:"@"},templateUrl:e.urlForTemplate("newadmin/transfers/detail.html"),link:function(n){n.data={loading:!0,error_message:"",automatic:{available:!1,remitter:null,message:"",in_progress:!1,log_stream:void 0,remitter_not_available_message:""}},n.setTransferApproved=function(e){a.admin.transfers.setApproved(n.data.ID,e).then(function(e){t(),o.$broadcast("reload-transfers")},function(e){n.data.error_message=e})},n.canAbort=function(e){var t=!1;switch(e.State){case"pending_approval":case"approved":t=!0}return t};var e=!(n.automaticTransfer=function(){n.data.automatic.message="",s.enforceMFA().then(function(){a.admin.transfers.automaticTransfer(n.data.ID).then(function(e){n.data.automatic.in_progress=!0,n.data.automatic.log_stream=e.log_stream},function(e){n.data.automatic.in_progress=!1,n.data.automatic.message="Can't perform an Automatic Transfer: "+e})},function(){})});function t(){n.data.loading=!0,a.admin.transfers.get(n.transferId).then(function(e){for(var t in n.data.error_message="",e)n.data[t]=e[t];n.data.CanAbort=0<=["pending_approval","approved"].indexOf(n.data.State),"approved"==n.data.State&&a.admin.transfers.automaticMethod(n.data.ID).then(function(e){n.data.automatic.available=e.automatic_available,n.data.automatic.remitter=e.remitter},function(e){alert(e)})},function(e){n.data.error_message=e}).finally(function(){n.data.loading=!1})}n.generationComplete=function(){e||(e=!0,t(),o.$broadcast("reload-transfers"),o.$broadcast("reload-project-balances"),o.$broadcast("reload-account-info"))},n.manualTransfer=function(){r.open({templateUrl:"manual-transfer-modal.html",controller:["$scope","$uibModalInstance","initial","api","mvCountryLoader","$rootScope",function(i,e,t,n,a,o){i.data={loaded:!1,transfer:t,form:{id:t.ID,method:"",date:void 0,reference:"",notes:"",confirm:!1},methods:[],type_help:"Loading..."},n.admin.transfers.manualMethods().then(function(e){i.data.methods=e,i.data.loaded=!0}),a.then(function(e){var o=e;n.admin.account.loadAccount(t.AccountID).then(function(t){var e=[],n=t.account.country,a=(angular.forEach(o,function(e){e.Code==t.account.country&&(n=e.Name)}),"This account's bank is located in "+n+" ("+t.account.country+")");e.push(a),a="You will most likely be paying them with "+("US"==t.account.country?"Finclusive ACH":"Western Union Global Pay"),e.push(a),i.data.type_help=e.join(" ")})}),i.save=function(){e.close(i.data.form)},i.cancel=function(){e.dismiss()}}],size:"md",resolve:{initial:function(){return n.data}}}).result.then(function(e){a.admin.transfers.sendManually(e.id,e.method,e.date,e.reference,e.notes).then(function(e){t(),o.$broadcast("reload-transfers"),o.$broadcast("reload-project-balances"),o.$broadcast("reload-account-info")},function(e){alert(e)})})},n.abortTransfer=function(){i.Confirm("Are you sure you want to delete/abort this transfer?  It will not be recoverable and will have to be regenerated.","Abort Transfer").then(function(){a.admin.transfers.abort(n.data.ID).then(function(e){n.$emit("transfer-aborted",{id:n.data.ID}),o.$broadcast("reload-transfers"),o.$broadcast("reload-project-balances"),o.$broadcast("reload-account-info")},function(e){n.data.error_message=e})})},t()}}}]),e.directive("logStream",["$parse","LogStream",function(a,i){return{restrict:"E",template:'<div id="log-stream-{{ log.identifier }}" style="max-width: 100%; max-height: 600px; overflow-y: auto; border: 1px solid #777;" ng-bind-html="log.content"></div>',link:function(o,e,t){o.content="";var n=null;t.identifier?(o.log={content:"",identifier:t.identifier},t.onCompletion&&(n=a(t.onCompletion)),o.$on("complete",function(e,t){n(o)}),o.$on("message",function(e,t){o.data.message=t.message;var n="normal",n=t.level<300?"":t.level<400?"text-warning":"text-danger",a="[]"==t.context?"":t.context,n=(o.log.content+='<span class="'+n+'">'+t.message+" "+a+"</span><br/>",document.getElementById("log-stream-"+o.log.identifier));n.scrollTop=n.scrollHeight}),i.open(t.identifier,o)):console.error("No Identifier specified")}}}])}(),angular.module("patronicity.all-time-stats",["patronicity.configuration"]).directive("allTimeStats",["patronicityConfig","api","$location",function(e,n,t){return{restrict:"E",scope:{icons:"=",header:"=",light:"=",blurb:"="},templateUrl:e.urlForTemplate("all-time-stats.html"),link:function(t){t.light&&(t.statsStyle={fill:"white",color:"white"}),n.home.footerStats().then(function(e){t.stats=e})}}}]),function(){var e=angular.module("patronicity.api",["ui.bootstrap","ngResource","ngSanitize"]),A="/project/data/",$="/dashboard/data",T="/dashboard";var E=new function(e){this.store={},this.timeout=e,this.get=function(e){var t,n,a=this.store[e];return a?(n=(new Date).getTime(),a.expires<n?(console.log("%cCache Hit, but expired, so miss: ","color: red",e),this.remove(e)):(console.log("%cCache Hit: ","color: green",e),t=a.value)):console.log("%cCache Miss: ","color: orange",e),t},this.put=function(e,t){var n=(new Date).getTime()+1e3*this.timeout;this.store[e]={value:t,expires:n},console.log("Added "+e+"that expires at: "+n)},this.remove=function(e){delete this.store[e]},this.removeAll=function(){this.store={}}}(86400);e.factory("api",["$resource","$sce","$uibModal","$http","$q","patronicityConfig",function(e,t,n,o,a,i){var r=e(A+"timezones/:id",{id:"@ID"}),s=e("/projects/rest/userimage/:id",{id:"@id"}),g="/api/",c=e(g+"projectapi/campaignGeoChart"),l=e(g+"cards/card/:id",{id:"@ID"}),u=e(g+"projectadmin/accountSearch/:id",{id:"@ID"}),d=e(g+"cards/community/:id",{id:"@ID"}),p=e(g+"projectadmin/payment/bank/:id",{id:"@ID"}),m=e(g+"projectadmin/payment/connect/:id",{id:"@ID"}),f=e(g+"projectadmin/payment/managed/:id",{id:"@ID"}),h=e(g+"projectadmin/payment/paypal/:id",{id:"@ID"}),y=e(g+"challenges/challenge/:id",{id:"@ID"}),v=e(g+"clubs/clubLoad/:id",{id:"@ID"}),b=e(g+"clubs/usersForClub/:id",{id:"@ID"},{save:{method:"POST",isArray:!0}}),w=e(g+"clubs/adminClubSourceSummary/:id",{id:"@ID"},{save:{method:"POST",isArray:!0}}),C=e(g+"clubs/adminClubReferralSummary/:id",{id:"@ID"},{save:{method:"POST",isArray:!0}}),D=e(g+"challenges/adminChallengeSourceSummary/:id",{id:"@ID"},{save:{method:"POST",isArray:!0}}),I=e(g+"challenges/adminChallengeReferralSummary/:id",{id:"@ID"},{save:{method:"POST",isArray:!0}}),S=e(g+"challenges/adminChallengeStats/:id",{id:"@ID"},{save:{method:"POST",isArray:!0}});function k(s,e){return a(function(i,r){o.post(s,e,{}).then(function(e,t,n,a){var o;null===e?r("Server returned null: "+s,t,n,a):"string"==typeof e?r("Server response invalid: "+e,t,n,a):(o=e.data).success?i(o.result):r(o.message,t,n,a,e)},function(e,t,n,a,o){r(e,t,n,a,e)})})}function j(s,e){return a(function(i,r){o.get(s,{cache:e}).then(function(e,t,n,a){var o;null===e?r("Server returned null: "+s,t,n,a):"string"==typeof e?r("Server response invalid: "+e,t,n,a):(o=e.data).success?i(o.result):r(o.message,t,n,a,e)},function(e,t,n,a,o){r(e,t,n,a,e)})})}var P=[];return{Cards:l,AccountSearch:u,CampaignGeoChart:c,Communities:d,Timezones:r,projectByID:function(e){return k(g+"projectapi/basics",{id:e})},UserImage:s,userForDonation:function(){return k(g+"user/currentUser")},campaignTest:function(e){return k(g+"projectapi/campaignTest/"+e)},countMeIn:function(e,t){return k(g+"user/countMeIn",{email:e,type:t})},setReturnToProject:function(e){return o.get(A+"returnToProject/"+e)},notifications:{all:function(){return j(A+"notification")},markRead:function(e,t){return k(A+"notification/"+e+"/markRead",t)}},getAddresses:function(){return j(A+"addresses")},donate:{minimumProjectInfo:function(e){return j(g+"donate/minimumProjectForDonation/"+e)},minimumForCurrencies:function(){return j(g+"donate/minimumForCurrencies")},donate:function(e,t){return k(g+"donate/donate/"+e,t)},tipParameters:function(e){return void 0===P[e]&&(P[e]=k(g+"donate/tipParameters",{currency:e})),P[e]},thankYou:function(e){return k(g+"donate/thank_you/"+e)},applePaySession:function(e){return k(g+"donate/applePaySession",{url:e})}},getShareInformationForProject:function(e,t){return k(g+"projectapi/shareInfo",{id:e,params:t})},updateShareCounter:function(e,t){return k(g+"projectapi/sharecounter/"+e,{type:t})},toggleProjectLike:function(e){return k(g+"projectapi/like/"+e)},login:function(e,t){return k(g+"user/login",{email:e,password:t})},onBehalfOfUser:function(e){return k(g+"user/onBehalfOfUser",{email:e})},register:function(e){return k(g+"user/register",{userFields:e})},logout:function(){return k(g+"user/logout")},facebookLoginOrRegister:function(e,t,n,a,o,i,r){return k(g+"user/social",{verb:"facebook-login",email:e,firstName:t,lastName:n,name:a,id:o,profile_image_url:i,friends:r})},googleLoginOrRegister:function(e,t,n,a,o,i,r){return k(g+"user/social",{verb:"google-login",email:e,firstName:t,lastName:n,name:a,id:o,profile_image_url:i,token:r})},exchangeRate:function(e,t,n){return j(A+"exchange-rate/"+e+"/"+t,n?E:void 0)},banners:function(){return a(function(n,a){o.get(A+"banners").then(function(e){if(e.data.success){for(var t in e.data.result)e.data.result[t].ActiveDate=new Date(e.data.result[t].ActiveDate),e.data.result[t].CreatedDate=new Date(e.data.result[t].CreatedDate);n(e.data.result)}else alert(e.message),a()},a)})},bannerSave:function(e){return k(A+"banners/save",e)},bannerArchive:function(e){return j(A+"banners/archive/"+e)},bannerDeactivate:function(e){return j(A+"banners/deactivate/"+e)},bannerActivate:function(e){return j(A+"banners/activate/"+e)},bannerNew:function(){return j(A+"banners/new")},facebookFriendsSave:function(e){return a(function(t,n){o.post(A+"facebook-friends/save",e).then(function(e){e.data.success?t(e.data.result):n()},n)})},accountTypes:function(){return k(A+"accountTypes")},dashboardSponsorInformation:function(e){return k($,{cmd:"sponsor-information",id:e})},dashboardSponsorTotals:function(e){return k($,{cmd:"sponsor-totals",id:e})},projectStates:function(){return k(A+"project-states")},categories:function(){return k(A+"categories")},viewNotes:function(e,t){return k(A+"project-notes/view/"+e,{group:t})},addNote:function(e,t,n){return k(A+"project-notes/add/"+e,{type:t,note:n})},noteCount:function(e,t){return k(A+"project-notes/count/"+e,{group:t})},toggleSponsorPaid:function(e,t,n){return k($,{cmd:"paid-project",sponsorId:t,projectId:e,paymentLevel:n})},pressList:function(){return k(A+"press/list",{})},home:{banners:function(){return k(g+"home/banners")},footerStats:function(){return k(g+"home/footerStats")}},smsReminder:{sendVerification:function(e){return k(g+"sms/sendSMSVerification",{number:e})},verifyCode:function(e){return k(g+"sms/verifySMSCode",{code:e})},userPhoneVerified:function(e){return k(g+"sms/userPhoneVerified",{user:e})},getUserChallengePhoneNumber:function(e){return k(g+"sms/getUserChallengePhoneNumber",{userid:e})},sendSmsToChallenge:function(e){return k(g+"sms/sendSmsToChallenge",{templates:e})},testSMS:function(e){return k(g+"sms/sendTestSMS",{templates:e})},testMultiSMS:function(e){return k(g+"sms/sendMultiTestSMS",{templates:e})},load:function(e){return k(g+"fulladmin/SmsTemplates",{method:"load",params:e})},save:function(e){return k(g+"fulladmin/SmsTemplates",{method:"save",templates:e})},delete:function(e){return k(g+"fulladmin/SmsTemplates",{method:"delete",templates:e})},groups:function(){return k(g+"fulladmin/SmsTemplates",{method:"groups"})},projectSendVerification:function(e,t,n){return k(g+"sms/projectSendSMSVerification",{number:e,projectID:t,smsData:n})},projectVerifyCode:function(e,t,n){return k(g+"sms/projectVerifySMSCode",{code:e,projectID:t,smsData:n})},projectClearSMSData:function(e,t){return k(g+"sms/projectClearSMSData",{projectID:e,smsData:t})},projectSendSMSText:function(e,t,n){return k(g+"sms/sendManualDirectSMS",{id:e,phone:t,body:n})}},press:{list:function(){return k(g+"newPress/press",{method:"list"})}},sponsor:{list:function(){return k(g+"sponsors/all")},byId:function(e){return k(g+"sponsors/byId",{id:e})},summaryStats:function(e){return k($,{cmd:"sponsor-summary",id:e})},togglePipelinePriority:function(e,t){return k($,{cmd:"pipeline-priority",sponsorId:t,projectId:e})},approvalStatus:function(e,t,n){return k(T+"/approvalStatus",{projectid:t,sponsorid:e,level:n})},approvalCheck:function(e,t,n){return k(T+"/approvalCheck",{projectid:t,sponsorid:e,level:n})},rejectCheck:function(e,t,n){return k(T+"/rejectCheck",{projectid:t,sponsorid:e,level:n})},resetApproval:function(e,t){return k(T+"/resetApproval",{projectid:t,sponsorid:e})},approveForLevel:function(e,t,n){return k(T+"/approve",{projectid:t,sponsorid:e,level:n})},rejectForLevel:function(e,t,n){return k(T+"/reject",{projectid:t,sponsorid:e,level:n})},createProjectFields:function(e){return k(g+"sponsors/create_project_fields",{id:e})}},sponsorBudget:function(e,t){return k($,{cmd:"sponsor-budget",id:e,budget:t})},sponsors:function(){return k(A+"sponsors")},sponsorProjects:function(e,t){return k(A+"sponsor-projects",{sponsorid:e,type:t})},sponsorStatus:function(e,t,n){return k(A+"sponsor-status",{sponsorid:e,projectid:t,status:n})},sponsorForm:function(e,t){return k(A+"sponsor-form/"+e,{isAdmin:t})},sponsorFormSave:function(e,t){return k(A+"sponsor-form/"+e+"/save",t)},cards:{supportInfo:function(e){return k(g+"cards/supportInfo",{ids:e})},countQueryItems:function(e){return k(g+"cards/countQueryItems",{id:e})}},challenges:{challenge:y,signup:function(e,t){return k(g+"challenges/signup",{id:e,source:t})},userStatsForChallenge:function(e){return k(g+"challenges/userStats",{id:e})},adjustForDay:function(e,t,n,a){return k(g+"challenges/adjustForDay",{id:e,projectId:t,challengeId:n,day:a})},save:function(e){return k(g+"challenges/save",{method:"save",challenge:e})},adminChallengeStats:S,adminChallengeUserStats:function(e,t){return k(g+"challenges/adminChallengeUserStats/"+e,t)},ChallengeSourceSummary:D,ChallengeReferralSummary:I,adminChallengeUsers:function(e){return k(g+"challenges/adminChallengeUsers",{id:e})},hideLastDaysBanner:function(e){return k(g+"challenges/hideLastDaysBanner",{id:e})},updateMailerlite:function(e){return k(g+"challenges/updateMailerlite",{email:e})}},giving:{load:function(e,t){return j(g+"giving/load/"+e+(t?"/"+t:""))},setStatus:function(e){return k(g+"giving/setUsersGivingStatus",{params:e})},members:{stats:function(e,t){return k(g+"giving/member/stats",{type:e,slug:t})},leaderboard:function(e,t,n,a){return k(g+"giving/leaderboard/list",{type:e,slug:t,limit:n,skip:a})},list:function(e,t,n,a){return k(g+"giving/member/list",{type:e,slug:t,limit:n,skip:a})},userRank:function(e,t){return k(g+"giving/leaderboard/me",{type:e,slug:t})},pointRank:function(e,t,n,a){return k(g+"giving/leaderboard/points",{type:e,slug:t,limit:n,skip:a})}},user:{join:function(e,t,n){return k(g+"giving/user/"+e+"/"+t+"/join",n)},quit:function(e,t){return k(g+"giving/user/"+e+"/"+t+"/quit")},settings:{load:function(e,t){return j(g+"giving/user/"+e+"/"+t+"/settings")},save:function(e,t,n){return k(g+"giving/user/"+e+"/"+t+"/settings",n)},clear:function(e,t){return k(g+"giving/user/"+e+"/"+t+"/clear")}},friends:function(e,t,n,a){return k(g+"giving/leaderboard/friends",{type:e,slug:t,limit:n,skip:a})}},admin:{reports:function(e,t){return k(g+"giving/reports",{type:e,id:t})},settings:{save:function(e,t,n,a){return k(g+"giving/user/"+e+"/"+t+"/settings/"+n,a)},load:function(e,t,n,a){return j(g+"giving/user/"+e+"/"+t+"/settings/"+n,a)}},quit:function(e,t,n){return k(g+"giving/user/"+e+"/"+t+"/quit/"+n)}},projects:{load:function(e,t){return k(g+"giving/projects",{verb:"load",type:e,id:t})},donationEstimate:function(e,t){return k(g+"giving/projects",{verb:"estimate",type:e,id:t})},save:function(e,t,n,a){return k(g+"giving/projects",{verb:"save_one",type:e,id:t,entry_id:n,project:a})},allocated_total:function(e,t){return k(g+"giving/projects",{verb:"allocated_total",type:e,id:t})},delete:function(e,t,n,a){return k(g+"giving/projects",{verb:"delete",type:e,id:t,entry_id:n})},loadSlowStats:function(e,t,n){return k(g+"giving/projects",{verb:"load_slow_stats",type:e,id:t,project_ids:n})}},messages:{saveViewed:function(e,t,n){return k(g+"giving/messages",{verb:"saveViewed",slug:e,userID:t,message:n})}},gamePointSource:function(){return k(g+"giving/gamePointSource",{verb:"all"})},rasul:{join:function(e){return k(g+"giving/rasulJoin",{verb:"join",userFields:e})},salawatCounter:function(){return k(g+"giving/salawatCounters")}},referral:{forceDisqualify:function(e,t,n){return k(g+"giving/teamReferral/"+t+"/"+e+"/disqualify",{reason:n})},forceQualify:function(e,t,n){return k(g+"giving/teamReferral/"+t+"/"+e+"/qualify",{reason:n})},add:function(e,t,n,a,o){return k(g+"giving/teamReferral/"+e+"/"+t+"/add",{teamId:n,joinDate:o,reason:a})}}},clubs:{timeline:function(e){return j(g+"clubs/timeline/"+e)},save:function(e){return k(g+"clubs/save",{method:"save",club:e})},clubLoad:v,userStats:b,ClubSourceSummary:w,ClubReferralSummary:C},community:{statsForCommunity:function(e,t){return k(g+"communities/communityStats",{id:e,currencyCode:t})},communityDetails:function(e){return k(A+"community/info",{id:e})},searchCommunity:function(e,t,n){return k(g+"projectadmin/communities",{method:"find",s:e,type:t,id:n})},searchCommunityByID:function(e,t){return k(g+"projectadmin/communities",{method:"findCommunityByID",communityID:e,id:t})},saveMapCommunity:function(e,t){return k(g+"projectadmin/communities",{method:"saveMapping",item:e,id:t})},deleteMapCommunity:function(e,t){return k(g+"projectadmin/communities",{method:"deleteMapping",community_id:e,id:t})},addCommunity:function(e){return k(g+"projectadmin/communities",{method:"add",item:e})},editCommunity:function(e){return k(g+"projectadmin/communities",{method:"edit",id:e})},saveCommunity:function(e){return k(g+"projectadmin/communities",{method:"save",item:e})},deleteImageCommunity:function(e){return k(g+"projectadmin/communities",{method:"delete-image",item:e})}},communityPage:{createCommunity:function(e){return k(g+"communitypage/createCommunity",{title:e.title,currencyCode:e.currencyCode})},communityDetailBySlug:function(e){return k(g+"communitypage/DetailBySlug",{slug:e})},communityIDBySlug:function(e){return k(g+"communitypage/idBySlug",{slug:e})},communityPermission:function(e){return k(g+"communitypage/communityPermission",{slug:e})},communityEditSave:function(e){return k(g+"communitypage/communitySave",{params:e})},loadCommunityTeam:function(e){return k(g+"communitypage/team",{method:"load",slug:e})},saveCommunityTeam:function(e,t){return k(g+"communitypage/team",{method:"save",slug:e,data:t})},adminSection:function(e){return k(g+"communitypage/adminSection",{method:"load",slug:e})},assignManager:function(e,t){return k(g+"communitypage/assignManager",{id:e,ManagerID:t})},forceStatus:function(e,t,n){return k(g+"communitypage/forceStatus",{id:e,status:t,params:n})},archiveSponsor:function(e){return k(g+"communitypage/archive",{id:e})},getCampaigns:function(e){return k(g+"communitypage/getCampaigns",{method:"load",slug:e})},saveCampaigns:function(e,t,n,a){return k(g+"communitypage/getCampaigns",{method:"save",slug:e,id:t,status:n,reason:a})},setCommunityCampaignsStatus:function(e,t,n){return k(g+"communitypage/getCampaigns",{method:"setStatus",slug:e,id:t,status:n})},viewNotes:function(e,t){return k(g+"communitypage/sponsorNotes",{id:e,group:t,method:"view"})},addNote:function(e,t,n){return k(g+"communitypage/sponsorNotes",{id:e,type:t,note:n,method:"add"})},noteCount:function(e,t){return k(g+"communitypage/sponsorNotes",{id:e,group:t,method:"count"})},communityListByUser:function(e){return k(g+"communitypage/communityListByUser",{method:"load",id:e})},saveMetaData:function(e){return k(g+"communitypage/saveMetaData",{method:"save",param:e})},requirementsCheck:function(e){return k(g+"communitypage/sponsorRequirementsCheck",{slug:e})},changeSponsorState:function(e,t,n){return k(g+"communitypage/sponsorState",{slug:e,verb:t,params:n})},sponsorBarInfo:function(e){return k(g+"communitypage/sponsorBarInfo",{slug:e})},setDefaultCampaign:function(e,t){return k(g+"communitypage/SetResetDefaultCampaign",{method:"set",id:e,projectId:t})},resetDefaultCampaign:function(e,t){return k(g+"communitypage/SetResetDefaultCampaign",{method:"reset",id:e,projectId:t})},sponsorToggleFeatured:function(e){return k(g+"communitypage/toggleFeatured",{id:e})},deleteDefaultImage:function(e){return k(g+"communitypage/deleteDefaultImage",{id:e})},projects:e(g+"communitypage/getCampaigns",{method:"load"}),validCustomUrl:function(e,t){return k(g+"communitypage/urlCheck",{method:"test-url",id:e,url:t})},statsBySlug:function(e,t){return k(g+"communitypage/sponsorStats",{slug:e,currency:t})}},donationStream:{load:function(e){return k(g+"donationStream/load",e)},filterLoad:function(e,t){return k(g+"donationStream/loadFilterDonation",{start:e,end:t})},donationsDuringInterval:function(e,t){return k(g+"donationStream/donationsDuringInterval",{start:e,end:t})}},reports:{generate:function(e,t){return k(g+"reports/action",{verb:"generate",identifier:e,format:t})},status:function(e,t){return k(g+"reports/action",{verb:"status",identifier:e,format:t})}},projectAdmin:{create:{step:function(e,t,n){var a,o={verb:t};for(a in n)o[a]=n[a];return k(g+"createproject/step_"+e,o)},account:function(e){return k(g+"createproject/new_account",{id:e})},suggestedCommunities:function(){return k(g+"createproject/suggested_communities")}},saveFeeAdjustment:function(e,t,n,a,o,i,r){return k(g+"projectadmin/feeAdjustment/save",{ProjectId:e,Name:t,Amount:n,Type:a,ID:o,ProcessedDate:i,PaymentMethod:r})},deleteFeeAdjustment:function(e,t,n){return k(g+"projectadmin/feeAdjustment/delete",{ID:e,ProjectId:t,Type:n})},saveInsightsCustomMessage:function(e,t){return k(g+"projectadmin/insightsCustomMessage/save",{ProjectId:e,CustomMessage:t})},getInsightsCustomMessage:function(e){return k(g+"projectadmin/insightsCustomMessage/get",{ProjectId:e})},lockedField:function(e,t,n){return k(g+"projectadmin/lockedField",{id:e,field:t,locked:n})},accountTypes:function(){return k(g+"projectadmin/bankAccountTypes")},supportedAccountCountries:function(){return k(g+"stripe/supportedCountries")},accountOptions:function(e,t){return k(g+"projectadmin/accountOptions",{country_code:e,id:t})},accountFieldsForCountry:function(e){return k(g+"stripe/fieldsForCountry/"+e)},needsAdditionalInformationForAccountWithProject:function(e){return k(g+"projectadmin/additionalAccountInfoRequired/"+e)},paymentInfoValid:function(e){return k(g+"projectadmin/paymentInfoValid/"+e)},infoVerified:function(e){return k(g+"projectadmin/infoVerified/"+e)},createProject:function(e){return k(g+"projectadmin/createproject",{goal:e.goal,title:e.title,sponsors:e.sponsors,currencycode:e.currencycode,communities:e.communities,location:e.location})},createProjectV2:function(e){return k(g+"projectadmin/createprojectv2",{params:e})},basicInfo:function(e){return k(g+"projectadmin/basicInfo",{id:e})},sendPaymentRequest:function(e){return k(g+"projectadmin/sendPaymentRequest",{params:e})},loadLeaderBoard:function(e){return k(g+"projectadmin/sponsorLeaderBoard",{method:"load",sponsorID:e})},zakatStatus:function(e,t,n){return k(g+"projectadmin/zakatStatus",{id:e,status:t,reason:n})},sponsorZakatStatusApproval:function(e,t){return k(g+"projectadmin/sponsorZakatStatusApproval",{id:e,tableName:t})},bankInfo:p,connectInfo:m,managedInfo:f,account:{byUserId:function(e){return k(g+"account/ForProjectByUserId")},forProjectId:function(e,t){return k(g+"account/forProjectOrCommunity",{method:"load",id:e,type:t})},setupCustomer:function(e,t,n,a,o,i,r,s){e={method:"customer",id:e,type:t,email:n,country:a};return o&&("corporate"==(e.accountType=o)?e.business=r:"personal"==o&&(e.personal=i)),s&&(e.bank=s),k(g+"account/setupCustomer",e)},setupAccount:function(e,t,n){return k(g+"account/setupAccount",{id:e,type:t,params:n})},saveAdditionalForm:function(e,t){return k(g+"account/additionalForm",{method:"save",data:e,accountId:t})},resetAccount:function(e,t){return k(g+"account/reset",{id:e,type:t})},resetAccountOnInitial:function(e,t){return k(g+"account/resetOnInitial",{id:e,type:t})},linkProjectToAccount:function(e,t,n){return k(g+"account/link",{id:e,type:t,account_id:n})},convertToNewInternalAccount:function(e,t,n,a){return k(g+"account/convert",{id:e,type:t,account_id:a,account_type:n})},updatePreapproval:function(e){return k(g+"account/UpdatePreapproval",{account_id:e})},loadSection:function(e,t){return k(g+"account/section",{method:"load",section:t,account_id:e})},getSensitiveData:function(e,t){return k(g+"account/sensitiveData",{method:"load",account_id:e,field_type:t})},saveSection:function(e,t,n){return k(g+"account/section",{method:"save",section:t,account_id:e,data:n})},listDocuments:function(e){return k(g+"account/document",{method:"list",account_id:e})},deleteDocument:function(e,t){return k(g+"account/document",{method:"delete",account_id:e,document_id:t})},saveDocument:function(e,t){return k(g+"account/document",{method:"save",account_id:e,data:t})},transfers:function(e,t){return k(g+"account/transfers",{account_id:e,project_id:t})},donationSummary:function(e,t){return k(g+"account/donationSummary",{account_id:e,project_id:t})}},bluesnap:{forProjectId:function(e,t){return k(g+"projectadmin/bluesnap",{method:"load",id:e,type:t})},linkProjectToAccount:function(e,t,n,a){return k(g+"projectadmin/bluesnap",{method:"link",id:e,type:t,account_id:n,suppress_clone:a||!1})},resetAccount:function(e,t){return k(g+"projectadmin/bluesnap",{method:"reset",id:e,type:t})},loadPayout:function(e,t){return k(g+"projectadmin/bluesnap",{method:"loadpayout",id:e,type:t})},getPayoutFee:function(e,t){return k(g+"projectadmin/bluesnap",{method:"getpayoutfee",id:e,type:t})},savePayout:function(e,t,n,a){return k(g+"projectadmin/bluesnap",{method:"savepayout",id:e,type:t,frequency:n,reserveRefund:a})},requestPayout:function(e,t){return k(g+"projectadmin/bluesnap",{method:"requestpayout",id:e,type:t})},getPendingUpdates:function(e,t){return k(g+"projectadmin/bluesnap",{method:"getpendingupdates",id:e,type:t})},setupCustomer:function(e,t,n,a,o,i,r,s){e={method:"customer",id:e,type:t,email:n,country:a};return o&&("corporate"==(e.accountType=o)?e.business=r:"personal"==o&&(e.personal=i)),s&&(e.bank=s),k(g+"projectadmin/bluesnap",e)},account:{loadSection:function(e,t,n,a){return k(g+"projectadmin/bluesnapAccount",{method:"load",section:t,id:e,projectCommunityId:n,projectCommunityType:a})},saveSection:function(e,t,n,a,o){return k(g+"projectadmin/bluesnapAccount",{method:"save",section:t,id:e,data:n,projectCommunityId:a,projectCommunityType:o})}}},wepay:{fees:function(e,t,n){return k(g+"projectadmin/wepay",{method:"fees",id:e,type:t,country:n})},forProjectId:function(e,t){return k(g+"projectadmin/wepay",{method:"load",id:e,type:t})},linkProjectToAccount:function(e,t,n,a){return k(g+"projectadmin/wepay",{method:"link",id:e,type:t,account_id:n,suppress_clone:a||!1})},resetAccount:function(e,t){return k(g+"projectadmin/wepay",{method:"reset",id:e,type:t})},setupCustomer:function(e,t,n,a,o,i,r,s,c,l,u,d,p,m){e={method:"customer",id:e,type:t,email:n,firstName:a,lastName:o,country:i,currencyCode:r,accountType:s,mccCode:c,additional:m};return"business"!=s&&"nonprofit"!=s||(e.businessName=l,e.businessDescription=u,e.businessAddress=d),"business"==s&&p&&(e.businessUrl=p),k(g+"projectadmin/wepay",e)},resendConfirmation:function(e,t,n){return k(g+"projectadmin/wepay",{method:"resend_confirmation",id:e,type:t,email:n})}},loadGettingStarted:function(e,t){return k(g+"projectadmin/gettingStarted",{method:"load",id:e,country:t})},saveGettingStarted:function(e,t){return k(g+"projectadmin/gettingStarted",{method:"save",id:e,data:t})},getSMSData:function(e){return k(g+"projectadmin/getSMSData",{id:e})},loadYourStory:function(e){return k(g+"projectadmin/yourStory",{method:"load",id:e})},saveYourStory:function(e,t){return k(g+"projectadmin/yourStory",{method:"save",id:e,data:t})},saveConfirmCreation:function(e,t){return k(g+"projectadmin/confirmCreation",{method:"save",id:e,data:t})},loadRewards:function(e){return k(g+"projectadmin/rewards",{method:"load",id:e})},saveRewards:function(e,t){return k(g+"projectadmin/rewards",{method:"save",id:e,data:t})},loadSocial:function(e){return k(g+"projectadmin/social",{method:"load",id:e})},saveSocial:function(e,t){return k(g+"projectadmin/social",{method:"save",id:e,data:t})},donationById:function(e){return k(g+"projectadmin/donation",{id:e,method:"load"})},saveDonation:function(e,t,n){return k(g+"projectadmin/donation",{projectId:e,id:t,method:"save",donation:n})},donationTipCheck:function(e,t,n){return k(g+"projectadmin/donation",{projectId:e,amount:t,id:n,method:"will-tip"})},donationProjectInfo:function(e){return k(g+"projectadmin/donation",{projectId:e,method:"project-info"})},projectBarInfo:function(e){return k(g+"projectadmin/projectBarInfo",{id:e})},sendProjectUpdate:function(e,t){return k(g+"projectadmin/updates",{id:e,method:"send",details:t})},types:function(e){return k(g+"projectadmin/updates",{id:e,method:"types"})},loadUpdate:function(e,t){return k(g+"projectadmin/projectUpdates",{method:"load",projectId:e,id:t})},saveUpdate:function(e,t){return k(g+"projectadmin/projectUpdates",{method:"save",projectId:e,update:t})},getPress:function(e,t){return k(g+"projectadmin/loadPress",{method:"load",id:e,projectId:t})},savePress:function(e){return k(g+"projectadmin/press",{method:"save",press:e})},getProjectImage:function(e){return k(g+"projectadmin/project",{method:"projectImage",id:e})},getProject:function(e){return k(g+"projectadmin/project",{method:"project",id:e})},getProjectUser:function(){},changeProjectState:function(e,t,n){return k(g+"projectadmin/changeProjectState",{id:e,state:t,params:n})},validCustomUrl:function(e,t){return k(g+"projectadmin/social",{method:"test-url",id:e,url:t})},tipCoach:function(e,t,n){return k(g+"projectadmin/tipCoach",{id:e,token:t,amount:n})},rateCoach:function(e,t,n){return k(g+"projectadmin/rateCoach",{id:e,rating:t,comments:n})},paypalInfo:h,projectInfoForPaymentPage:function(e,t){return k(g+"projectadmin/projectInfoForPaymentPage",{id:e,type:t})},decideTypeOfAccountPanelToShow:function(e,t,n){return k(g+"projectadmin/decideTypeOfAccountPanelToShow",{id:e,type:t,country:n})},requirementsCheck:function(e){return k(g+"projectadmin/requirementsCheck",{id:e})},adminTabInfo:function(e){return k(g+"projectadmin/adminTabInfo",{id:e})},skipPaymentOptions:function(e){return k(g+"projectadmin/skipPaymentOptions",{id:e})},overridePaymentOptions:function(e,t,n){return k(g+"projectadmin/overridePaymentOptions",{id:e,type:t,paymentType:n})},donationChart:function(e,t){return k(g+"projectadmin/donationChart",{id:e,showOffline:t})},donationSourceStats:function(e){return k(g+"projectadmin/donationSourceStats",{id:e})},sponsorResources:function(e){return k(g+"projectadmin/sponsorResources",{id:e})},paymentOptions:function(e,t){return k(g+"projectadmin/paymentOptions",{id:e,type:t})},volunteers:function(e){return k(g+"projectadmin/volunteers",{id:e})},givingBoosts:function(e){return k(g+"projectadmin/givingBoosts",{id:e})},reports:{donations:function(e){return k(g+"projectreports/donations",{id:e})},summary:function(e){return k(g+"projectreports/summary",{id:e})},givingBoost:function(e){return k(g+"projectreports/givingBoost",{id:e})},campaignDonorReports:function(e){return k(g+"projectreports/campaignDonorReports",{id:e})},sponsorDonorReport:function(e,t,n){return k(g+"projectreports/donorsForSponsor",{id:e,startDate:t,endDate:n})}},sponsorCauses:{load:function(e){return k(g+"projectadmin/sponsorCauses",{method:"load",params:e})},save:function(e){return k(g+"projectadmin/sponsorCauses",{method:"save",causes:e})},delete:function(e){return k(g+"projectadmin/sponsorCauses",{method:"delete",causes:e})},sort:function(e){return k(g+"projectadmin/sponsorCauses",{method:"sort",causes:e})}},loadAdjustmentList:function(){return k(g+"projectadmin/loadAdjustmentList",{})},phoneCountries:function(){return k(g+"projectadmin/loadPhoneCountries",{})},slugValidation:function(e){return k(g+"projectadmin/challengeTeam",{method:"validation",team:e})},loadChallengeTeam:function(e){return k(g+"projectadmin/challengeTeam",{method:"load",id:e})},teamInvited:function(e,t,n,a){return k(g+"projectadmin/challengeTeam",{method:"teamInvited",id:e,limit:t,start:n,end:a})},saveChallengeTeam:function(e){return k(g+"projectadmin/challengeTeam",{method:"save",team:e})},teamSignupLeaderboard:function(e,t,n){return k(g+"projectadmin/teamSignupLeaderboard",{limit:n,startDate:e,endDate:t})},challengeTeam:{searchTeams:function(e,t){return k(g+"projectadmin/challengeTeam",{method:"search",term:e,challengeId:t})}}},project:{bannedCountryAllInfo:function(){return j(g+"projectapi/bannedCountryAllInfo")},ofacCountryAllInfo:function(){return j(g+"projectapi/OfacCountryAllInfo")},deleteBannedCountry:function(e){return k(g+"projectapi/deleteBannedCountry",{id:e})},editBannedCountry:function(e){return k(g+"projectapi/editBannedCountry",{bannedCountryData:e})},addNewBannedCountry:function(e){return k(g+"projectapi/addNewBannedCountry",{bannedCountryData:e})},bannedCountryNames:function(){return j(g+"projectapi/bannedCountryNames")},bannedCountryCodes:function(){return j(g+"projectapi/bannedCountryCodes")},countryLevels:function(){return j(g+"projectapi/countryLevels")},permittedCountryCodes:function(){return j(g+"projectapi/permittedCountryCodes")},ofacCountryNames:function(){return j(g+"projectapi/ofacCountryNames")},ofacCountryCodes:function(){return j(g+"projectapi/ofacCountryCodes")},currencyCodes:function(e){return k(g+"projectapi/currencyCodes",{type:e})},shareInfoBySlug:function(e){return k(g+"projectapi/share",{slug:e})},view:function(e){return k(g+"projectapi/view",{slug:e})},timeline:function(e){return k(g+"projectapi/timeline",{slug:e})},donors:function(e,t){return k(g+"projectapi/donors",{id:e,lastId:t})},rewards:function(e){return k(g+"projectapi/rewards",{id:e})},statsPanel:function(e){return k(g+"projectapi/statsPanel",{id:e})},getProject:function(e){return k(g+"projectapi/getProject",{id:e})},toggleSubscribe:function(e){return k(g+"projectapi/toggleSubscribe",{id:e})},toggleShareAddress:function(e){return k(g+"projectapi/toggleShareAddress",{id:e})},leaderboard:function(e,t,n,a,o,i,r,s,c){return k(g+"projectapi/projectLeaderboard",{startDate:t,type:e,endDate:n,currencyCode:a,limit:o,offset:i,fresh:r,sponsorIds:s,countryCode:c})},leaderboardCounter:function(e,t,n,a,o,i){return k(g+"projectapi/leaderboardCounter",{startDate:t,type:e,endDate:n,currencyCode:a,sponsorIds:o,countryCode:i})},donationCategoryChart:function(e,t,n){return k(g+"projectapi/donationCategoryChart",{type:e,startDate:t,endDate:n})},campaignAndDonorGeoChart:function(e,t){return k(g+"projectapi/campaignAndDonorGeoChart",{startDate:e,endDate:t})},toggleZakat:function(e){return k(g+"projectapi/toggleZakat",{id:e})},volunteerOptIn:function(e,t,n){return k(g+"projectapi/volunteerOptIn",{id:e,name:t,email:n})}},user:{login:function(e,t,n){return k(g+"user/login",{email:e,password:t,reCaptcha:n})},register:function(e,t){return k(g+"user/register",{userFields:e,reCaptcha:t})},mfa:{valid:function(e){return k(g+"mfa/valid",{reset:e})},authenticate:function(e){return k(g+"mfa/authenticate",{code:e})},setup:function(e,t){return k(g+"mfa/setup",{state:e,code:t})}},serverTime:function(){return k(g+"user/serverTime")},getAccounts:function(e){return k(g+"user/getAccounts",{userId:e})},contact:function(e,t,n,a){return k(g+"user/contact/"+e,{details:t,template:n,reCaptcha:a})},deleteRequest:function(e){return k(g+"user/deleteRequest/"+e)},toggleSubscribeToNewsletter:function(e){return k(g+"user/toggleSubscribeToNewsletter/"+e)},sendEmailConfirmation:function(e){return k(g+"user/sendEmailConfirmation/"+e)},toggleDisplayNameOnRecentDonations:function(e){return k(g+"user/toggleDisplayNameOnRecentDonations/"+e)},toggleDisplayLocationOnRecentDonations:function(e){return k(g+"user/toggleDisplayLocationOnRecentDonations/"+e)},toggleDisplaySupportedCampaigns:function(e){return k(g+"user/toggleDisplaySupportedCampaigns/"+e)},toggleDisplayCreatedCampaigns:function(e){return k(g+"user/toggleDisplayCreatedCampaigns/"+e)},toggleDisplayCommunities:function(e){return k(g+"user/toggleDisplayCommunities/"+e)},loadUser:function(e){return k(g+"user/loadUser",{name:e})},loadCommunityData:function(e,t,n){return k(g+"user/loadCommunityData",{id:e,offset:t,limit:n})},loadDonations:function(e,t,n,a){return k(g+"user/loadDonations",{id:e,offset:t,limit:n,filter:a})},loadZakatDonations:function(e,t,n,a){return k(g+"user/loadZakatEligibleDonations",{id:e,offset:t,limit:n,filter:a})},updateDonationDisplay:function(e,t,n,a,o){return k(g+"user/updateDonationDisplay",{id:e,name:t,location:n,isAnonymous:a,isAmountPrivate:o})},changePassword:function(e,t,n){return k(g+"user/changePassword",{oldPassword:e,newPassword:t,id:n})},facebookDisconnect:function(e,t,n){return k(g+"user/facebookDisconnect",{sureDisconnected:e,newPassword:t,id:n})},resetPassword:function(e,t){return k(g+"user/resetPassword",{email:e,id:t})},resendReceipt:function(e){return k(g+"user/resendReceipt",{id:e})},subscribeAll:function(e){return k(g+"user/subscribeAll",{userID:e})},unsubscribeAll:function(e){return k(g+"user/unsubscribeAll",{userID:e})},validateEmail:function(e){return k(g+"user/validateEmail",{userData:e})},saveUser:function(e){return k(g+"user/saveUser",{userData:e})},saveProfile:function(e,t){return k(g+"user/saveProfile",{profile:e,userData:t})},clearSmsReminder:function(e){return k(g+"user/clearSmsReminder",{userData:e})},loadShippingAddress:function(e,t){return k(g+"user/userShippingAddress",{method:"load",user:e,address:t})},saveShippingAddress:function(e,t){return k(g+"user/userShippingAddress",{method:"save",user:e,address:t})},clearShippingAddress:function(e,t){return k(g+"user/userShippingAddress",{method:"clear",user:e,address:t})},clearProfilePicture:function(e){return k(g+"user/clearProfilePicture",{userID:e})},saveDefaultSetting:function(e,t){return k(g+"user/SaveDefaultSetting",{user:e,data:t})},smsVerifyCode:function(e,t,n){return k(g+"sms/userVerifySMSCode",{code:e,user:t,smsData:n})},sendVerification:function(e,t,n){return k(g+"sms/userSendSMSVerification",{number:e,user:t,smsData:n})},clearSMSData:function(e,t){return k(g+"sms/userClearSMSData",{user:e,smsData:t})},updateEnrollments:function(e,t,n,a){return k(g+"user/updateEnrollments",{subscriptions:e,cardID:t,userID:n,verb:a})},setPreferredCurrency:function(e){return k(g+"user/setPreferredCurrency",{currencyCode:e})},guest:{create:function(e,t){return k(g+"user/guest",{verb:"create",email:e,name:t})}},cards:{forProjectId:function(e,t){return k(g+"user/cards",{verb:"for-project",projectId:e,currency:t})},list:function(e){return k(g+"user/cards",{verb:"list",username:e})},setDefault:function(e,t){return k(g+"user/cards",{verb:"setDefault",cardID:e,userID:t})},remove:function(e,t){return k(g+"user/cards",{verb:"remove",cardID:e,userID:t})},add:function(e,t,n,a,o,i,r){return k(g+"user/cards",{verb:"add",tokens:t,userID:e,billingAddress:n,saveCard:a,giftAid:o,guest:i,reCaptcha:r})},pendingUsage:function(e,t){return k(g+"user/cards",{verb:"pendingUsage",cardID:e,userID:t})},forGivingType:function(e,t,n){return k(g+"user/cards",{verb:"for-challenge",username:n,slug:e,givingType:t})}},favorites:{add:function(e,t){return k(g+"user/favorite",{verb:"add",project_id:e,source:t})},remove:function(e){return k(g+"user/favorite",{verb:"remove",project_id:e})},list:function(){return k(g+"user/favorite",{verb:"list"})},projectIds:function(e){return k(g+"user/favorite",{verb:"project_ids",suggestedListId:e})},setOrder:function(e){return k(g+"user/favorite",{verb:"set_order",ids:e})}},donationInfo:function(e){return k(g+"user/donationInfo",{projectID:e})},sendPasswordReset:function(e){return k(g+"user/sendPasswordReset",{email:e})},getSubjectList:function(e){return k(g+"user/getSubjectList",{userId:e})},getByCode:function(e){return k(g+"user/getByCode",{code:e})},setPassword:function(e,t){return k(g+"user/setPassword",{code:e,password:t})},userGroup:function(){return k(g+"user/getUserGroup",{method:"load"})},getGivingEnrollment:function(e){return k(g+"user/givingEnrollment",{verb:"load",userId:e})},saveGivingEnrollment:function(e,t,n,a,o){return k(g+"user/givingEnrollment",{verb:"save",userId:e,ramadan:t,dhc:n,friday_givers:a,only_for:o})},points:{total:function(e,t){return k(g+"user/points",{verb:"total",userId:e,source:t})},recent:function(e,t){return k(g+"user/points",{verb:"recent",userId:e,limit:t})},recentWithFilter:function(e){return k(g+"user/points",{verb:"recentWithFilter",query:e})},userFriendJoined:function(e,t){return k(g+"user/points",{verb:"userFriendJoined",userId:e,source:t})}}},zakat:{saveCalculatorData:function(e,t,n){return k(g+"zakat/saveCalculatorData",{username:e,entries:t,period:n})},saveOfflineDonation:function(e,t){return k(g+"zakat/saveOfflineDonation",{username:e,entries:t})},editCalculatorData:function(e,t,n){return k(g+"zakat/editCalculatorData",{username:e,period:t,entries:n})},fetchMetalPrices:function(){return k(g+"zakat/fetchMetalPrices")},getAllProfiles:function(e){return k(g+"zakat/getAllProfiles",{username:e})},getOffLineDonations:function(e,t){return k(g+"zakat/getOffLineDonations",{id:e,filter:t})},deleteZakatCalculatorProfile:function(e,t){return k(g+"zakat/deleteZakatCalculatorProfile",{username:e,period:t})},getProfile:function(e,t){return k(g+"zakat/getProfile",{username:e,profile:t})}},media:{delete:function(e,t,n){return k(g+"media/delete",{guid:t,src:n,type:e})}},pulse:{view:function(){return k(g+"pulse/view")}},admin:{permissions:function(){return k(g+"fulladmin/permissions")},transfers:{stats:function(){return k(g+"payout/stats")},typesAndLabels:function(){return k(g+"payout/typesAndLabels")},list:function(e){return k(g+"payout/list",{params:e})},setApproved:function(e,t){return k(g+"payout/approved",{id:e,approved:t})},get:function(e){return k(g+"payout/load",{id:e})},generate:function(e){return k(g+"payout/generate",{type:e})},abort:function(e){return k(g+"payout/abort",{id:e})},sendManually:function(e,t,n,a,o){return k(g+"payout/manual",{id:e,method:t,date:n,reference:a,notes:o})},manualMethods:function(){return k(g+"payout/manual_methods")},automaticMethod:function(e){return k(g+"payout/automatic_method",{transfer_id:e})},automaticTransfer:function(e){return k(g+"payout/automatic_transfer",{transfer_id:e})},preflight:function(e,t,n,a){return k(g+"payout/preflight",{id:e,type:t,subaccount_id:n,currency:a})},generateSingle:function(e,t,n){return k(g+"payout/generate_single",{id:e,subaccount_ids:t,currency:n})}},batches:{list:function(e){return k(g+"payoutbatch/list",{params:e})},get:function(e){return k(g+"payoutbatch/load",{id:e})},prefund:function(e,t,n){return k(g+"payoutbatch/prefund",{id:e,date:t,transferIdentifier:n})},complete:function(e,t,n){return k(g+"payoutbatch/complete",{id:e,date:t,remitterIdentifier:n})}},team_dashboard:function(e){return k(g+"fulladmin/team_dashboard",{filters:e})},campaign_dashboard:function(e){return k(g+"fulladmin/campaign_dashboard",{filters:e})},manualAutomaticSourceChart:function(e,t,n,a){return k(g+"Challenges/adminManualAutomaticSourceChart",{id:e,givingtype:t,type:n,currency:a})},projects:e(g+"fulladmin/projects/:id",{id:"@ID"}),listParams:function(){return k(g+"fulladmin/projectListParams")},justContacted:function(e){return k(g+"fulladmin/justContacted",{id:e})},forceStatus:function(e,t){return k(g+"fulladmin/forceStatus",{id:e,status:t})},assignManager:function(e,t){return k(g+"fulladmin/assignManager",{id:e,ManagerID:t})},setCoaching:function(e,t){return k(g+"fulladmin/setCoaching",{id:e,flags:t})},toggleFeatured:function(e){return k(g+"fulladmin/toggleFeatured",{id:e})},archive:function(e){return k(g+"fulladmin/archive",{id:e})},accountingReports:function(e,t,n){return k(g+"fulladmin/accountingReport",{start:e,end:t,type:n})},addFreshDesk:function(e,t){return k(g+"fulladmin/addFreshDesk",{id:e,freshdeskid:t})},justHelpingOption:function(e,t){return k(g+"fulladmin/helpingOption",{id:e,helpingOption:t})},loadFeaturedOrderProjects:function(){return k(g+"fulladmin/featuredOrderProjects",{verb:"load"})},saveFeaturedOrderProjects:function(e){return k(g+"fulladmin/featuredOrderProjects",{verb:"save",projects:e})},addAndRemoveFeaturedOrderProjects:function(e,t){return k(g+"fulladmin/featuredOrderProjects",{verb:"addAndRemove",id:e,featured:t})},setGradeOrPotentialForProject:function(e,t,n){return k(g+"fulladmin/evaluationSetGradeOrPotential",{verb:e,value:t,id:n})},campaignSlugChange:function(e,t,n){return k(g+"fulladmin/forceSlugChange",{method:e,id:t,newSlug:n})},validCampaignSlug:function(e,t,n){return k(g+"fulladmin/forceSlugChange",{method:e,id:t,newSlug:n})},hideCampaign:function(e){return k(g+"fulladmin/hideCampaign",{id:e})},hideCampaignForNonAdmin:function(e){return k(g+"fulladmin/hideCampaignForNonAdmin",{id:e})},communityListItems:{load:function(e){return k(g+"fulladmin/communityListItems",{verb:"load",listId:e})},save:function(e,t){return k(g+"fulladmin/communityListItems",{verb:"save",community:e,listId:t})},addAndRemove:function(e){return k(g+"fulladmin/communityListItems",{verb:"addAndRemove",params:e})}},coaches:e(g+"fulladmin/coaches/:id",{id:"@ID"},{load:{method:"GET",isArray:!1},tips:{method:"GET",isArray:!1,params:{method:"tips"}},flag:{method:"POST",params:{method:"flagTip"}},reviews:{method:"GET",url:g+"fulladmin/coach_reviews/:id"}}),projectSponsor:function(e,t){return k(g+"fulladmin/projectSponsor",{projectId:e,sponsorId:t})},projectsstats:e(g+"fulladmin/sponsorStats/:id",{id:"@ID"}),communitylist:e(g+"fulladmin/communitylist/:id",{id:"@ID"}),userstats:e(g+"fulladmin/userStats/:id",{id:"@ID"}),challengeteam:{load:e(g+"fulladmin/loadChallengeTeam/:id",{id:"@ID"})},banners:{load:function(){return k(g+"fulladmin/banners",{method:"load"})},save:function(e){return k(g+"fulladmin/banners",{method:"save",banner:e})},deactivate:function(e){return k(g+"fulladmin/banners",{method:"deactivate",id:e})},activate:function(e){return k(g+"fulladmin/banners",{method:"activate",id:e})},moveUp:function(e){return k(g+"fulladmin/banners",{method:"moveup",id:e})},moveDown:function(e){return k(g+"fulladmin/banners",{method:"movedown",id:e})}},press:{loadPress:function(e){return k(g+"fulladmin/press",{method:"loadPress",params:e})},load:function(){return k(g+"fulladmin/press",{method:"load"})},save:function(e){return k(g+"fulladmin/press",{method:"save",press:e})}},redirects:{load:function(e){return k(g+"fulladmin/redirects",{method:"load",params:e})},save:function(e,t){return k(g+"fulladmin/redirects",{method:"save",redirects:e,allowOffsite:t})},checkurl:function(e){return k(g+"fulladmin/redirects",{method:"checkurl",from:e})},fetchproject:function(e){return k(g+"fulladmin/redirects",{method:"fetchproject",projectId:e})},delete:function(e){return k(g+"fulladmin/redirects",{method:"delete",redirects:e})}},templates:{load:function(e){return k(g+"fulladmin/templates",{method:"load",params:e})},save:function(e){return k(g+"fulladmin/templates",{method:"save",templates:e})},delete:function(e){return k(g+"fulladmin/templates",{method:"delete",templates:e})},preview:function(e,t){return k(g+"fulladmin/templates",{method:"preview",body:e,flags:t})},groups:function(){return k(g+"fulladmin/templates",{method:"groups"})},testEmail:function(e){return k(g+"fulladmin/templates",{method:"testEmail",editTemplate:e})}},wrapper:{load:function(){return k(g+"fulladmin/wrapper",{method:"load"})},save:function(e){return k(g+"fulladmin/wrapper",{method:"save",wrapper:e})}},group:{load:function(){return k(g+"fulladmin/group",{method:"load"})},save:function(e){return k(g+"fulladmin/group",{method:"save",group:e})}},users:{load:function(e){return k(g+"fulladmin/users",{method:"load",params:e})},resetPassword:function(e){return k(g+"fulladmin/users",{method:"reset",email:e})},loadProfile:function(e){return k(g+"fulladmin/users",{method:"profile",userID:e})},loadStats:function(e){return k(g+"fulladmin/users",{method:"stats",userID:e})},loadDonations:function(e){return k(g+"fulladmin/users",{method:"donations",userID:e})},loadUserNotes:function(e){return k(g+"fulladmin/users",{method:"notes",userID:e})},validateEmail:function(e){return k(g+"fulladmin/users",{method:"validateEmail",user:e})},save:function(e){return k(g+"fulladmin/users",{method:"save",user:e})},saveProfile:function(e){return k(g+"fulladmin/users",{method:"saveProfile",profile:e})},saveDonation:function(e){return k(g+"fulladmin/users",{method:"saveDonation",donation:e})},addNote:function(e,t,n){return k(g+"fulladmin/users",{method:"saveNote",id:e,group:t,message:n})},search:function(e,t,n){return k(g+"fulladmin/users",{method:"load",includeThumb:!0,params:{filter:{Email:e},page:void 0===t?1:t,count:void 0===n?10:n}})},getPermissions:function(e){return k(g+"fulladmin/users",{method:"userPermissions",userID:e})},savePermissions:function(e,t){return k(g+"fulladmin/users",{method:"savePermissions",permissions:t,userID:e})},getPreEnrollment:function(e){return k(g+"fulladmin/users",{method:"userPreEnrollment",userID:e})},savePreEnrollment:function(e,t){return k(g+"fulladmin/users",{method:"savePreEnrollment",preEnrollment:t,userID:e})},deleteUser:function(e,t){return k(g+"user/delete",{email:e,force:t})}},sponsors:{load:function(e){return k(g+"fulladmin/sponsors",{method:"load",params:e})},getAdminList:function(){return k(g+"fulladmin/sponsors",{method:"adminList"})},loadSponsor:function(e){return k(g+"fulladmin/sponsors",{method:"loadSponsor",id:e})},save:function(e){return k(g+"fulladmin/sponsors",{method:"save",sponsor:e})},saveLeaderBoard:function(e){return k(g+"fulladmin/sponsorLeaderBoard",{method:"save",leaderBoard:e})},loadLeaderBoard:function(e){return k(g+"fulladmin/sponsorLeaderBoard",{method:"load",sponsorID:e})}},metadata:{load:function(e){return k(g+"fulladmin/metadata",{method:"load",params:e})},save:function(e){return k(g+"fulladmin/metadata",{method:"save",metadata:e})}},communityList:{save:function(e){return k(g+"fulladmin/communityListSave",{method:"save",list:e})}},sponsorUsers:{load:function(e){return k(g+"fulladmin/sponsorUsers",{method:"load",params:e})},save:function(e){return k(g+"fulladmin/sponsorUsers",{method:"save",user:e})},delete:function(e){return k(g+"fulladmin/sponsorUsers",{method:"delete",id:e})},userList:function(e){return k(g+"fulladmin/sponsorUsers",{method:"userList",id:e})}},resources:{loadAllForSponsor:function(e){return k(g+"fulladmin/resources",{method:"loadAllForSponsor",id:e})},saveAll:function(e,t){return k(g+"fulladmin/resources",{method:"saveAll",sponsorID:e,resources:t})},save:function(e){return k(g+"fulladmin/resources",{method:"save",resource:e})},loadResource:function(e){return k(g+"fulladmin/resources",{method:"loadResource",id:e})}},resourceItems:{loadAllForResource:function(e){return k(g+"fulladmin/resourceItems",{method:"loadAllForResource",id:e})},saveAll:function(e,t){return k(g+"fulladmin/resourceItems",{method:"saveAll",sectionID:e,items:t})},save:function(e){return k(g+"fulladmin/resourceItems",{method:"save",item:e})}},testimonials:{load:function(e){return k(g+"fulladmin/testimonials",{method:"load",params:e})},getDate:function(){return k(g+"fulladmin/testimonials",{method:"getDate"})},save:function(e){return k(g+"fulladmin/testimonials",{method:"save",testimonial:e})}},project:{getProjectImage:function(e){return k(g+"fulladmin/project",{method:"projectImage",id:e})},getProject:function(e){return k(g+"fulladmin/project",{method:"project",id:e})}},pages:{load:function(e){return k(g+"fulladmin/pages",{method:"load",params:e})},getStatusList:function(){return k(g+"fulladmin/pages",{method:"statusList"})},verifySlug:function(e){return k(g+"fulladmin/pages",{method:"verifySlug",slug:e})},save:function(e){return k(g+"fulladmin/pages",{method:"save",page:e})},getContainerList:function(){return k(g+"fulladmin/getContainerData")}},pageWrappers:{load:function(e){return k(g+"fulladmin/pageWrappers",{method:"load",params:e})},save:function(e){return k(g+"fulladmin/pageWrappers",{method:"save",wrapper:e})},getWrapperList:function(){return k(g+"fulladmin/pageWrappers",{method:"wrapperList"})},loadPageWrapper:function(e){return k(g+"fulladmin/pageWrappers",{method:"loadWrapper",id:e})}},forms:{load:function(e){return k(g+"fulladmin/forms",{method:"load",params:e})},save:function(e){return k(g+"fulladmin/forms",{method:"save",form:e})},delete:function(e){return k(g+"fulladmin/forms",{method:"delete",formId:e})},loadForm:function(e){return k(g+"fulladmin/forms",{method:"loadForm",formId:e})},loadTypes:function(){return k(g+"fulladmin/forms",{method:"loadTypes"})},verifySlug:function(e){return k(g+"fulladmin/forms",{method:"verifySlug",shortName:e})}},messages:{load:function(e){return k(g+"fulladmin/messages",{method:"load",params:e})},save:function(e){return k(g+"fulladmin/messages",{method:"save",message:e})},verifySlug:function(e){return k(g+"fulladmin/messages",{method:"verifySlug",slug:e})}},pulsePages:{load:function(e){return k(g+"fulladmin/pulse",{method:"load",params:e})},getLists:function(){return k(g+"fulladmin/pulse",{method:"lists"})},save:function(e){return k(g+"fulladmin/pulse",{method:"save",page:e})}},settlement_account:{list:function(e){return k(g+"settlementAccounts/list",{params:e})},balance:function(e){return k(g+"settlementAccounts/balance",{id:e})}},account:{getLists:function(){return k(g+"account/admin",{method:"lists"})},load:function(e){return k(g+"account/admin",{method:"load",params:e})},loadAccount:function(e){return k(g+"account/admin",{method:"loadAccount",id:e})},loadComplianceCheck:function(e){return k(g+"account/admin",{method:"loadComplianceCheck",id:e})},loadProjects:function(e){return k(g+"account/admin",{method:"loadProjects",id:e})},closeProjectsBySubaccountIds:function(e,t){return k(g+"account/admin",{method:"closeSubaccounts",id:e,subaccount_ids:t})},loadNotes:function(e){return k(g+"account/admin",{method:"loadNotes",id:e})},openAccount:function(e){return k(g+"account/admin",{method:"state",state:"open",id:e})},closeAccount:function(e){return k(g+"account/admin",{method:"state",state:"close",id:e})},loadTransfers:function(e){return k(g+"account/admin",{method:"transfers",id:e})},deleteDocument:function(e,t){return k(g+"account/admin",{method:"deleteDocument",id:e,document_id:t})},note:function(e,t,n){return k(g+"account/admin",{method:"note",id:e,verb:t,data:n})},complianceNote:function(e,t,n){return k(g+"account/admin",{method:"compliance-note",id:e,verb:t,data:n})},complianceUpdateStatus:function(e,t,n,a){return k(g+"account/admin",{provider:e,method:"compliance-update-status",id:t,verb:n,id2:a})},complianceReset:function(e,t){return k(g+"account/admin",{method:"compliance-reset",id:e,provider:t})},complianceUpdate:function(e,t){return k(g+"account/admin",{method:"compliance-update",id:e,provider:t})},loadOptions:function(e){return k(g+"account/admin",{method:"options",id:e})},setReserve:function(e,t,n,a,o,i){return k(g+"account/admin",{method:"setReserve",id:e,subaccount_id:t,amount:n,currency:a,clear_do_not_pay:o,entire_account:i})},setStatus:function(e,t,n){return k(g+"account/admin",{method:"setStatus",id:e,which:t,value:n})},setPayoutValues:function(e,t){return k(g+"account/admin",{method:"setPayoutValues",id:e,data:t})},adjustments:{load:function(e,t){return k(g+"adjustment/load",{id:e,settlementCurrency:t})},add:function(e,t){return k(g+"adjustment/create",{id:e,data:t})},types:function(e,t){return k(g+"adjustment/types",{id:e,settlementCurrency:t})},delete:function(e,t){return k(g+"adjustment/delete",{id:e,adjustment_id:t})}},subaccounts:{clearFlag:function(e,t,n){return k(g+"account/admin",{method:"clear_subaccount_flag",id:e,subaccount_id:t,flag:n})},transactions:function(e,t,n,a,o,i){return k(g+"account/transactions",{id:e,subaccount_id:t,start:n,end:a,use_settlement_date:o,params:i})},transactionInfo:function(e,t){return k(g+"account/transaction_info",{id:e,subaccount_id:t})},convertSettlement:function(e,t,n){return k(g+"account/admin",{method:"convert_settlement",id:e,subaccount_id:t,currency:n})}}},blueSnap:{load:function(e){return k(g+"fulladmin/blueSnap",{method:"load",params:e})},getLists:function(){return k(g+"fulladmin/blueSnap",{method:"lists"})},loadProjects:function(e){return k(g+"fulladmin/blueSnap",{method:"loadProjects",id:e})},loadPayouts:function(e){return k(g+"fulladmin/blueSnap",{method:"loadPayouts",id:e})},loadAccount:function(e){return k(g+"fulladmin/blueSnap",{method:"loadAccount",id:e})},syncAccount:function(e){return k(g+"fulladmin/blueSnap",{method:"syncAccount",id:e})},closeAccount:function(e){return k(g+"fulladmin/blueSnap",{method:"close",id:e})},openAccount:function(e){return k(g+"fulladmin/blueSnap",{method:"open",id:e})},setReserve:function(e,t){return k(g+"fulladmin/blueSnap",{method:"setReserve",id:e,amount:t})},loadNotes:function(e){return k(g+"fulladmin/blueSnap",{method:"loadNotes",id:e})},saveNote:function(e){return k(g+"fulladmin/blueSnap",{method:"saveNote",note:e})},deleteNote:function(e){return k(g+"fulladmin/blueSnap",{method:"deleteNote",note:e})},deleteDoc:function(e){return k(g+"fulladmin/blueSnap",{method:"deleteDoc",doc:e})},loadPayout:function(e){return k(g+"fulladmin/blueSnap",{method:"loadpayout",id:e})},getPayoutFee:function(e){return k(g+"fulladmin/blueSnap",{method:"getpayoutfee",id:e})},savePayout:function(e,t,n){return k(g+"fulladmin/blueSnap",{method:"savepayout",id:e,frequency:t,reserveRefund:n})},releasePayout:function(e,t){return k(g+"fulladmin/bluesnap",{method:"releasepayout",id:e,executeDateTime:t})},getPendingUpdates:function(e){return k(g+"fulladmin/bluesnap",{method:"getpendingupdates",id:e})},accountApproveUnapprove:function(e){return k(g+"fulladmin/blueSnap",{method:"accountApproveUnapprove",id:e})},updateReserveRefundAmount:function(e,t){return k(g+"fulladmin/blueSnap",{method:"updateReserveRefundAmount",id:e,reserveRefund:t})}},reportingQueries:{load:function(e){return k(g+"fulladmin/reportingQueries",{method:"load",params:e})},delete:function(e){return k(g+"fulladmin/reportingQueries",{method:"delete",page:e})},save:function(e){return k(g+"fulladmin/reportingQueries",{method:"save",page:e})}},projectList:{load:e(g+"fulladmin/projectList/:id",{id:"@ID"}),save:function(e){return k(g+"fulladmin/projectListSave",{method:"save",list:e})}},projectListItems:{load:function(e){return k(g+"fulladmin/projectListItems",{verb:"load",listId:e})},save:function(e,t){return k(g+"fulladmin/projectListItems",{verb:"save",project:e,listid:t})},addAndRemove:function(e){return k(g+"fulladmin/projectListItems",{verb:"addAndRemove",params:e})}}},refund:{info:function(e){return k(g+"projectadmin/donation",{id:e,method:"info"})},refund:function(e,t){return k(g+"projectadmin/donation",{params:t,method:"refund",id:e})}},dashboard:{userChart:function(e,t){return k(g+"fulladmin/userChart",{start:e,end:t})},newCampaignsChart:function(e,t){return k(g+"fulladmin/newCampaignsChart",{start:e,end:t})},donationsChart:function(e,t,n){return k(g+"fulladmin/donationsChart",{showOffline:e,start:t,end:n})},currencies:function(){return k(g+"fulladmin/currencies")},countries:function(e){return k(g+"fulladmin/countries",{query:e})},regions:function(e,t){return k(g+"fulladmin/regions",{query:t,countries:e})}},aws:{newRecommendationEngine:function(e){return a(function(t,n){o.get("https://search.launchgood.com/v1/recommendation/v1?user_id="+e+"&limit=10").then(function(e){e.data?t(e.data):n("Recommendation engine did not return any data")}).catch(function(e){n(e)})})}}}}])}(),function(){var e=angular.module("patronicity",["patronicity.sentry","ngSanitize","ngAnimate","ngResource","ngTable","ngMessages","ui.router","ui.bootstrap","ui.sortable","textAngular","mv.utils","patronicity-upload","community","teammember","admin","user","patronicity.buttons","patronicity.notifications","patronicity.buttons.refund","patronicity.api","patronicity.projectcards","patronicity.countdown","angularMoment","mv.configuration","patronicity.sharing","patronicity.navigation","patronicity.projects","patronicity.project.dashboard","patronicity.utility","patronicity.giving.challenge","patronicity.admin.newadmin","patronicity.thankyou","patronicity.startproject","patronicity.configuration","angulartics","angulartics.google.tagmanager","angulartics.google.tagmanager.transaction","angulartics.facebook.pixel","angulartics.adroll","timer","ngclipboard","patronicity.user.profiles","patronicity.user.userutils","patronicity.common.currency","patronicity.campaign.map","patronicity.campaign.geo-chart","patronicity.common.rating","patronicity.common.sponsors","patronicity.home","patronicity.clubs","patronicity.common.directives","patronicity.clubs.timeline","patronicity.communitypage","patronicity.giving.dialogs","patronicity.payment_providers","patronicity.credit_card","patronicity.campaign.factory","patronicity.campaign.view","patronicity.lgx.navigation","patronicity.pulse.factory","patronicity.pulse.main","patronicity.projectcards.factory","patronicity.programs.page","patronicity.all-time-stats","ngJuxtapose","patronicity.streams","patronicity.careers","vcRecaptcha","patronicity.discover","patronicity.rasul","patronicity.user.newprofile","patronicity.challengecards","patronicity.zakat","patronicity.skeleton","patronicity.contentful"]);e.config(["$analyticsProvider",function(e){e.settings.ga.disablePageTracking=!0,e.firstPageview(!0),e.withAutoBase(!0)}]),e.config(["$compileProvider",function(e){e.aHrefSanitizationWhitelist(/^\s*(https?|ftp|mailto|whatsapp):/)}]),e.run(["$rootScope","$transitions","$window","api","$state","$timeout",function(n,e,t,a,o,i){e.onSuccess({},function(e){var t=e.from().name.split(".");console.log("Successful transition from "+e.from().name+" to "+e.to().name),"challenge"==t[0]&&(console.log("Successful Challenge Transition from "+e.from().name+" to "+e.to().name),n.previousType=n.type,n.previousSlug=n.slug,n.previousSetting=n.setting,n.type="",n.slug="",n.setting="",t=e.params("to"),n.type=t.type,n.slug=t.name,n.setting=function(e){var t,n;0<(t=e.lastIndexOf("."))&&(n=e.substring(t+1));return n}(e.to().name),n.previousType!=n.type&&($("body").removeClass(n.typeClass),n.typeClass=""),n.previousSlug==n.slug&&n.previousType==n.type||($("body").removeClass(n.typeSlugClass),n.typeSlugClass=""),n.previousSetting!=n.setting&&($("body").removeClass(n.settingClass),n.settingClass=""),n.type&&(n.typeClass="body_"+n.type),n.type&&n.slug&&(n.typeSlugClass="body_"+n.type+"_"+n.slug),n.setting&&(n.settingClass="modal_"+n.setting)),n.$broadcast("ui-state-changed",e.to().name,e.params("to"),e.from().name,e.params("from"))}),n.$watch(function(){t.dataLayer&&i(function(){t.dataLayer.push({event:"optimize.activate"})},0,!1)})}])}(),function(){var e=angular.module("patronicity.campaign.geo-chart",["patronicity.api","patronicity.configuration","googlechart"]);e.directive("campaignGeoChart",["api","loadGoogleMapAPI",function(e,t){return{restrict:"E",scope:{},template:'<div google-chart chart="campaignGeoChart" style="height:380px; width:100%;"></div>',link:function(t){t.campaignGeoChart={},t.campaignGeoChart.type="GeoChart",e.CampaignGeoChart.query(function(e){t.campaignGeoChart.data=[["Country","Campaigns"]],angular.forEach(e,function(e){t.campaignGeoChart.data.push([e.name,parseInt(e.cnt)])})})}}}]),e.directive("campaignDonationGeoChart",["api","loadGoogleMapAPI",function(a,e){return{restrict:"E",scope:{},template:'<div google-chart chart="campaignGeoChart" style="height:380px; width:100%;"></div>',link:function(t,e,n){t.campaignGeoChart={},t.campaignGeoChart.type="GeoChart",t.campaignGeoChart.options={displayMode:"markers",colorAxis:{colors:["green","blue"]},sizeAxis:{minValue:0,maxValue:100}},a.project.campaignAndDonorGeoChart(n.start,n.end).then(function(e){t.campaignGeoChart.data=[["Country","Campaigns","Donations"]],angular.forEach(e,function(e){t.campaignGeoChart.data.push([e.country,parseInt(e.projects),parseInt(e.donations)])})})}}}])}(),angular.module("patronicity.campaign.map",["patronicity.api","patronicity.configuration"]).directive("campaignMap",["patronicityConfig",function(e){return{restrict:"E",scope:{sponsorId:"@",zoom:"@"},templateUrl:e.urlForTemplate("campaign-map-template.html"),controller:["$scope","$element","searchApi",function(o,n,a){var i,r,e;void 0!==window.GoogleMapsLoader&&(i=this,o.campaigns=[],o.markers=[],(r=angular.element("<div></div>")).css({position:"absolute",top:0,left:0,right:0,bottom:0,backgroundColor:"rgba(0,0,0,0.5)",zIndex:99999,color:"#FFFFFF"}),(e=angular.element('<i class="fa fa-fw fa-spinner fa-spin fa-2x"></i>')).css({position:"absolute",top:0,left:0,right:0,bottom:0,margin:"auto",width:"36px",height:"36px",lineHeight:"36px"}),r.append(e),window.GoogleMapsLoader.KEY="AIzaSyA2M3mNLZhe6K2FQMV4404qw2-4yD5xZno",window.GoogleMapsLoader.load(function(e){var t={center:{lat:40.7127837,lng:-74.00594130000002},zoom:parseInt(o.zoom)||2,disableDefaultUI:!0};o.map=new e.maps.Map(n.get(0).firstChild,t),angular.element(n.get(0).firstChild).append(r),o.$apply()}),this.loadCampaigns=function(t){(!t||t<0)&&(o.campaigns=[],t=0),angular.element(n.get(0).firstChild).append(r);var e={type:"sponsored_by",limit:200,offset:t,category:void 0,param1:o.sponsorId};a.searchLegacy(e).then(function(e){e&&e.length?(angular.forEach(e,function(e){e.Latitude&&e.Longitude&&o.campaigns.push({name:e.Name,slug:e.Slug,location:e.Location,latitude:e.Latitude,longitude:e.Longitude})}),i.loadCampaigns(t+e.length)):(i.addMarkers(),r.remove())})},this.resetZoom=function(){o.map&&o.map.setZoom(parseInt(o.zoom)||2)},this.addMarkers=function(){var a;o.map&&(o.campaignInfoWindow||(o.campaignInfoWindow=new window.google.maps.InfoWindow),a=new window.google.maps.LatLngBounds,angular.forEach(o.campaigns,function(e){var t={lat:parseFloat(e.latitude),lng:parseFloat(e.longitude)},n=new window.google.maps.Marker({position:t,title:e.name,map:o.map});n.addListener("click",function(e){o.campaignInfoWindow.setContent('<h3><a href="/project/'+e.slug+'" target="_blank">'+e.name+"</a></h3>"),o.campaignInfoWindow.open(o.map,this)}.bind(n,e)),o.markers.push(n),a.extend(t)}),o.map.fitBounds(a))},this.removeMarkers=function(){o.map&&(angular.forEach(o.markers,function(e){e.setMap(null)}),o.markers=[])},o.$watch("sponsorId",function(e){e&&i.loadCampaigns()}),o.$watch("zoom",function(){o.map&&i.resetZoom()}),o.$watch("map",function(e){e&&o.campaigns.length&&i.addMarkers()}),o.$watch("campaigns",function(e){e&&e.length||i.removeMarkers()}))}]}}]),angular.module("patronicity.campaign.factory",["patronicity.api","user","patronicity.configuration","ui.router","patronicity.common.currency"]).factory("CampaignManager",["api","$q","$rootScope",function(o,e,t){var i={},r={};console.log("campaign manager loading");var s=e.defer();return i={view:{},stats:{},share:{},timeline:{},rewards:{},supporters:{}},{load:function(e,t,n,a){if(void 0===i[e][t]||n)switch(e){case"view":t&&null!=t&&(i[e][t]=o.project.view(t),i[e][t].then(function(e){r[t]=e.ID,s.resolve(e.ID)}));break;case"stats":i[e][t]=s.promise.then(function(e){return o.project.statsPanel(e)});break;case"share":i[e][t]=s.promise.then(function(e){return o.getShareInformationForProject(e,a)});break;case"timeline":i[e][t]=o.project.timeline(t);break;case"rewards":i[e][t]=s.promise.then(function(e){return o.project.rewards(e)})}return i[e][t]},loadSupporters:function(n){var a=e.defer();return s.promise.then(function(e){var t;i.supporters[n]&&i.supporters[n].donors.length?(t=i.supporters[n].donors[i.supporters[n].donors.length-1].ID,o.project.donors(e,t).then(function(e){for(var t=0;t<e.donors.length;t++)i.supporters[n].donors.push(e.donors[t]);a.resolve(i.supporters[n])})):o.project.donors(e,0).then(function(e){i.supporters[n]=e,a.resolve(i.supporters[n])})}),a.promise}}}]),function(){var e=angular.module("patronicity.campaign.view",["patronicity.api","user","patronicity.configuration"]);e.directive("campaignView",["patronicityConfig","api","$sce","CampaignManager","User","$stateParams",function(i,e,t,r,s,n){return{restrict:"E",require:"^editManager",scope:{},templateUrl:i.urlForTemplate("campaign/view.html"),link:function(n,e,t,a){function o(e){r.load("view",n.slug,e=e||!1).then(function(e){n.project=e,n.loaded=!0})}n.slug=a.projectSlug(),n.isLoggedIn=s.isLoggedIn(),n.loaded=!1,n.isLaunchgood=function(){return"launchgood"==i.applicationName},n.isPatronicity=function(){return"patronicity"==i.applicationName},n.login=function(){s.isLoggedIn()||s.loginModal(!1).then(function(e){o(!0)})},n.$on("user:login-change",function(e,t){n.isLoggedIn=s.isLoggedIn()}),o(!0)}}}]),e.directive("campaignStatsPanel",["api","patronicityConfig","CampaignManager","User","CurrencyCodeProvider","$timeout",function(e,t,o,i,n,a){return{restrict:"E",templateUrl:t.urlForTemplate("campaign/stats-panel.html"),scope:{projectId:"@",slug:"@"},link:function(n,e,t){var a;n.loading=!0,n.data={},a=n.slug,o.load("stats",a).then(function(e){n.data.stats=e,n.loading=!1},function(e){alert("Unable to load project information: "+e+"!")}),o.load("view",a).then(function(e){n.data.tags=e.Tags,n.data.FundingOption=e.FundingOption,n.data.EndDate=e.EndDate,n.data.TaxDeductible=e.TaxDeductible,n.data.GiftAid=e.GiftAid,n.data.Company=e.Company,n.data.NonprofitTypeText=e.NonprofitTypeText,n.data.TaxID=e.TaxID}),i.get().then(function(){n.userPreferredCurrencyCode=i.getPreferredCurrency()}),n.$on("currency-selected",function(e,t){n.userPreferredCurrencyCode=t.currencyCode})}}}]),e.directive("campaignMainImage",["$sce","patronicityConfig","CampaignManager",function(a,e,o){return{restrict:"E",templateUrl:e.urlForTemplate("campaign/main-image.html"),scope:{slug:"@"},link:function(t,e,n){t.loading=!0,t.playButton=!1,t.imageDisplay=!1,t.videoDisplay=!1,o.load("view",t.slug).then(function(e){t.carousel=e.Carousel,t.loading=!1,angular.forEach(e.Carousel,function(e){0==e.IsImage?(t.playButton=!0,t.imageDisplay=!0,String(e.URL).match(/\?/gi)?t.videoURL=e.URL+"&autoplay=1":t.videoURL=e.URL+"?autoplay=1"):1==e.IsImage&&0!=e.IsImage&&(t.imageDisplay=!0,t.imageURL=e.URL)}),1==e.Carousel.length&&(0==e.Carousel[0].IsImage?(t.videoURL=t.videoURL.replace("autoplay=1",""),t.imageDisplay=!1,t.videoDisplay=!0):(t.imageDisplay=!0,t.playButton=!1))}),t.trustSrc=function(e){return a.trustAsResourceUrl(e)},t.overlayClicked=function(){t.playButton&&(t.playButton=!1,t.imageDisplay=!1,t.videoDisplay=!0)}}}}]),e.directive("campaignTags",["patronicityConfig","CampaignManager",function(e,a){return{restrict:"E",templateUrl:e.urlForTemplate("campaign/tags.html"),scope:{slug:"@"},link:function(t,e,n){t.loading=!0,t.details={},a.load("view",t.slug).then(function(e){t.details.Tags=e.Groups,t.details.TaxDeductible=e.TaxDeductible,t.details.ZakatVerified=e.ZakatVerified,t.details.NonprofitTypeText=e.NonprofitTypeText,t.loading=!1})}}}]),e.directive("campaignShareButtons",["patronicityConfig","CampaignManager","User","api","$rootScope","GivingManager","$analytics",function(o,l,u,t,e,d,p){return{restrict:"E",templateUrl:function(e,t){var n,a=void 0===t.type?"campaign":t.type;return void 0===t.templateType?"campaign"==a?n="campaign":"challenge"==a?n="challenge":"thankyou"==a?n="thankyou":"default"==a?n="default":"user-profile"==a?n="user-profile":"custom"==a&&(n="team-link"):n=t.templateType,"campaign"==n?o.urlForTemplate("campaign/share-buttons.html"):"challenge"==n?o.urlForTemplate("challenge/ramadan_challenge_2023/components/share-buttons.html"):"thankyou"==n?o.urlForTemplate("campaign/thank-you-share-buttons.html"):"default"==n?o.urlForTemplate("default-share-buttons.html"):"user-profile"==n?o.urlForTemplate("user-profile/components/share-buttons.html"):"team-link"==n?o.urlForTemplate("campaign/team-link-share-buttons.html"):void 0},scope:{type:"@",slug:"@",donationId:"@",givingType:"@",shareMessage:"=?",specificUrl:"=?"},link:function(i,r){i.loading=!0,i.share={},i.projectId,i.linkCopied=!1,i.linkDisabled=!0;var s=void 0!==i.givingType?i.givingType:void 0===i.type?"campaign":i.type,c=void 0!==i.givingType?i.givingType:void 0===r.givingType?"challenge":r.givingType;function n(t){var e,n,a,o;t=t||!1,"campaign"==s||"user-profile"==s?l.load("view",i.slug,t).then(function(e){l.load("share",i.slug,t,{donationId:i.donationId}).then(function(e){var t;e=e,i.projectId=e.ID,i.share.CurrentUserLikes=e.CurrentUserLikes,i.share.ShareCounter=e.ShareCounter,i.share.ShareImageUrl=e.ShareImageUrl,i.share.ShareEmailUrl=e.ShareEmailUrl,i.share.EmailShareFullUrl=e.ShareEmailUrl,i.share.ShareDescription=e.ShareDescription,i.share.ShareTitle=e.ShareTitle,i.share.ShareUrl=e.ShareUrl,i.share.TwitterShareUrl=e.TwitterShareUrl,i.share.WhatsappShareUrl="https://wa.me/?text="+window.encodeURIComponent(e.ShareUrl),i.loading=!1,(t=document.querySelector(".share-url .lgx-input p"))&&(t.classList.add("animate-input"),t.addEventListener("animationend",function(){t.style.overflow="unset"}))})}):"default"==s?(e=(a=window.location.href).indexOf("?"),n=a,-1!==e&&(n=a.substring(0,e)),o={url:n}.url,u.get().then(function(){u.isLoggedIn()?o=o+"?src="+u.current().ID:r.defaultSrc&&(o=o+"?src="+r.defaultSrc),i.share.ShareUrl=o,i.share.WhatsappShareUrl="https://wa.me/?text="+window.encodeURIComponent(o),i.share.TwitterShareUrl="https://twitter.com/intent/tweet?text="+o})):"custom"==s?((a=i.specificUrl)&&(i.share.ShareEmailUrl=a.teamLink,i.share.ShareDescription=a.message,i.share.ShareImageUrl="",i.share.teamName=a.teamName,i.share.campaignName=a.title,i.share.ShareTitle=a.subject,i.share.ShareUrl=a.teamLink,i.share.WhatsappShareUrl="https://wa.me/?text="+window.encodeURIComponent(a.message),i.share.EmailShareFullUrl="mailto:?subject="+a.subject+" &body= "+a.message),a&&a.teamLink&&null!=a.teamLink&&(i.linkDisabled=!1)):d.load(c,i.slug).then(function(e){e=e,i.share.ShareEmailUrl=e.stats.share.url,i.share.ShareDescription=e.name,i.share.ShareImageUrl="",i.share.ShareTitle=e.name,i.share.ShareUrl=e.stats.share.url,i.share.TwitterShareUrl=e.stats.share.twitter,i.share.WhatsappShareUrl=e.stats.share.whatsapp,i.share.EmailShareFullUrl=e.stats.share.email,i.loading=!1})}function o(e){"campaign"==s&&t.updateShareCounter(i.projectId,e).then(function(e){i.share.ShareCounter=e.shareCounter},function(e){alert(e)})}i.$watch("slug",function(e,t){e&&e!==t&&n()}),i.$watch("specificUrl",function(e,t){e&&e!==t&&n()}),!i.slug&&"default"!=s||n(),e.$on("user:login-change",function(e){n(!0)}),i.facebookPostResult=function(e,t){"success"==e&&o("fbshare"),p.eventTrack("share",{category:"share",label:"facebook"})},i.sendEmail=function(){return o("emailshare"),!0},i.likeProject=function(){t.toggleProjectLike(i.projectId).then(function(e){e.liked?(i.project.CurrentUserLikes=!0,o("like")):(i.project.CurrentUserLikes=!1,o("unlike"))},function(e){alert(e)})},i.tweet=function(e){var t=($(window).width()-575)/2,n=($(window).height()-400)/2,a=i.share.TwitterShareUrl;return window.open(a,"twitter","status=1,width=575,height=400,top="+n+",left="+t),o("twittershare"),e.preventDefault(),p.eventTrack("share",{category:"share",label:"twitter"}),!1},i.facebookLogin=function(e,t){"success"==e&&t.email.trim().length&&u.facebookLoginOrRegister(t.email,t.first_name,t.last_name,t.name,t.id).then(function(){},function(e){alert(e)})},i.copySuccess=function(e){i.linkCopied=!0,p.eventTrack("share",{category:"share",label:"copyLink"})},i.whatsApp=function(){"user-profile"==s&&window.open(i.share.WhatsappShareUrl,"_blank"),p.eventTrack("share",{category:"share",label:"whatsapp"})},i.sampleMessage=!1,i.toggleMessage=function(){i.sampleMessage=!i.sampleMessage}}}}]),e.directive("campaignContent",["patronicityConfig","CampaignManager","$sce",function(e,n,i){return{restrict:"E",templateUrl:e.urlForTemplate("campaign/content.html"),scope:{slug:"@"},link:function(o,e,t){o.loading=!0,o.readMore=!1,o.data={story:[],updates:[],activeTab:"story",updateCount:0},o.setActiveTab=function(e){o.data.activeTab=e},o.readMore=function(){o.readMore=!0},n.load("timeline",o.slug,!0).then(function(e){var t=[],n=[],a=e.editable;angular.forEach(e.items,function(e){("pitch"==e.type?(e.editable=a,e.body=i.trustAsHtml(e.body),t):(e.editable=a,e.subtype&&"update"==e.subtype&&o.data.updateCount++,n)).push(e)}),o.projectId=e.projectId,o.data.story=t,o.data.updates=n,o.loading=!1})}}}]),e.directive("campaignObjective",["patronicityConfig","CampaignManager",function(e,a){return{restrict:"E",templateUrl:e.urlForTemplate("campaign/objective.html"),scope:{slug:"@"},link:function(t,e,n){t.loading=!0,t.Objective={},t.ProjectID,a.load("view",t.slug).then(function(e){t.Objective=e.Tags,t.ProjectID=e.ID,t.loading=!1})}}}]),e.directive("campaignTeam",["patronicityConfig","CampaignManager","$sce","User",function(e,a,o,i){return{restrict:"E",templateUrl:e.urlForTemplate("campaign/team.html"),scope:{slug:"@"},link:function(n,e,t){n.loading=!0,n.data={Team:{},ProjectID:void 0,GoogleMapEmbedSrc:void 0,ShortLocation:void 0},n.$on("user:login-change",function(e,t){n.isBlacklisted=i.isBlacklisted()}),a.load("view",n.slug).then(function(e){n.data.Team=e.Team,n.data.ProjectID=e.ID,n.data.GoogleMapEmbedSrc=o.trustAsResourceUrl(e.GoogleMapEmbedSrc),n.data.ShortLocation=e.ShortLocation,n.loading=!1})}}}]),e.directive("campaignGivingLevels",["patronicityConfig","CampaignManager","$rootScope",function(e,a,o){return{restrict:"E",templateUrl:e.urlForTemplate("campaign/giving-levels.html"),scope:{slug:"@"},link:function(t,e,n){t.loading=!0,t.data={Rewards:[],ShowLimit:7},a.load("view",t.slug).then(function(e){t.data.CurrencyCode=e.CurrencyCode,t.data.ProjectID=e.ID,a.load("rewards",t.slug).then(function(e){angular.forEach(e,function(e){e.Limit=parseInt(e.Limit),e.PrizeAwarded=parseInt(e.PrizeAwarded),e.ChallengeAmount=parseFloat(e.ChallengeAmount),t.data.Rewards.push(e)}),t.loading=!1})}),t.showAllRewards=function(){t.data.ShowLimit=t.data.Rewards.length},t.selected=function(e){o.$broadcast("project:reward-selected",{ProjectID:t.data.ProjectID,RewardID:e})}}}}]),e.directive("campaignSupporters",["patronicityConfig","CampaignManager",function(e,o){return{restrict:"E",templateUrl:e.urlForTemplate("campaign/supporters.html"),scope:{slug:"@"},link:function(n,e,t){function a(t){n.loading=!0,o.loadSupporters(n.slug).then(function(e){n.data.Supporters=e.donors,t||(n.data.Total=e.count),n.loading=!1})}n.loading=!0,n.data={Supporters:[],Total:0,ShowLimit:5,PerPage:10},a(),n.showMoreSupporters=function(){n.data.ShowLimit+=n.data.PerPage,n.data.ShowLimit>=n.data.Supporters.length&&n.data.ShowLimit<=n.data.Total&&a(!0)}}}}]),e.directive("campaignCommunities",["patronicityConfig","CampaignManager",function(e,a){return{restrict:"E",templateUrl:e.urlForTemplate("campaign/communities.html"),scope:{slug:"@"},link:function(t,e,n){t.loading=!0,t.data={Communities:{}},a.load("view",t.slug).then(function(e){t.data.Communities=e.Communities,t.loading=!1})}}}]),e.directive("campaignSocials",["patronicityConfig","CampaignManager",function(e,a){return{restrict:"E",templateUrl:e.urlForTemplate("campaign/social-media.html"),scope:{slug:"@"},link:function(t,e,n){t.loading=!0,t.data={SocialLinks:{}},a.load("view",t.slug).then(function(e){t.data.SocialLinks=e.SocialLinks,t.loading=!1})}}}]),e.directive("campaignStickyBar",["patronicityConfig","CampaignManager",function(e,a){return{restrict:"E",templateUrl:e.urlForTemplate("campaign/sticky-bar.html"),scope:{slug:"@"},link:function(t,e,n){t.loading=!0,t.data={Stats:{}},a.load("stats",t.slug).then(function(e){t.data.Stats=e,t.loading=!1})}}}])}(),angular.module("patronicity.careers",["patronicity.api","user","patronicity.configuration"]).directive("jobsList",["patronicityConfig","$http",function(e,a){return{restrict:"E",scope:{},templateUrl:e.urlForTemplate("careers/jobs.html"),link:function(t,e,n){t.loading=!0,a.get("https://api.collage.co/v1/positions/launchgood").then(function(e){t.data={positions:e.data.positions},t.loading=!1})}}}]),angular.module("patronicity.challengecards",["patronicity.configuration"]).directive("challengeCard",["patronicityConfig","$window","GivingManager",function(e,i,r){return{restrict:"E",templateUrl:e.urlForTemplate("challenge-cards.html"),scope:{template:"@",slug:"@"},link:function(t,e,n){if(t.slug){var a,o;switch(t.slug){case"ramadan-challenge-2021":a="challenge",o="ramadan_challenge_2021";break;case"ramadan-challenge-2022":a="challenge",o="ramadan_challenge_2022";break;case"ramadan-challenge-2023":a="challenge",o="ramadan_challenge_2023";break;case"friday-givers":a="club",o="friday-givers";break;case"dhul_hijjah-2021":a="challenge",o="dhul_hijjah_2021";break;case"dhul-hijjah-2022":a="challenge",o="dhul_hijjah_2022"}r.load(a,o,!0).then(function(e){t.totalMembersSignedUp=e.signedUp})}t.joinChallengeOrClub=function(){switch(t.slug){case"ramadan-challenge-2021":case"ramadan-challenge-2022":case"ramadan-challenge-2023":i.location.href="/ramadan?src=home_block";break;case"friday-givers":i.location.href="/club#!/giving_club";break;case"dhul_hijjah-2021":case"dhul_hijjah-2022":i.location.href="/dhc?src=home_block"}}}}}]),function(){var e=angular.module("patronicity.common.currency",["patronicity.configuration"]);e.config(["$provide",function(e){e.decorator("$locale",["$delegate",function(e){return e.NUMBER_FORMATS.PATTERNS[1].negPre="-",e.NUMBER_FORMATS.PATTERNS[1].negSuf="",e}])}]),e.filter("noDecimalCurrency",["$filter","$locale",function(e,t){var n=e("currency"),a=t.NUMBER_FORMATS;return function(e,t){e=n(e,t),t=null;return t=e?e.replace(new RegExp("\\"+a.DECIMAL_SEP+"\\d{2}"),""):t}}]),e.factory("CurrencyCodeProvider",["patronicityConfig","api","$q",function(e,t,o){var n=[],a={USD:"$",AUD:"$",CAD:"$",SGD:"$",NZD:"$",GBP:"",EUR:"",MYR:"RM",JPY:""},i={USD:"",AUD:"",CAD:"",SGD:"",NZD:"",GBP:"",EUR:"",MYR:"",JPY:""};function r(e){return void 0===n[e]&&(n[e]=t.project.currencyCodes(e)),n[e]}return{TYPE_PROJECT:"project",TYPE_COMMUNITY:"community",TYPE_CLUB:"club",TYPE_CHALLENGE:"challenge",supportedCodes:function(n){return o(function(t,e){r(n).then(function(e){e.forEach(function(e){a[e.code]=e.symbol}),t(e)},e)})},showCurrencyCode:function(){return"launchgood"==e.applicationName},defaultCurrencyCode:function(){return"USD"},symbolFromCode:function(e){var t="?";return t=a[(e=void 0===e?"USD":e).toUpperCase()]?a[e.toUpperCase()]:t},emojiFromCode:function(e){return i[e]},minimumDonationForCode:function(a,t){return o(function(n,e){r(t).then(function(e){var t=1;e.forEach(function(e){e.code==a&&(t=e.minimumAmount)}),n(t)},e)})},suggestedGivingAmountsForCode:function(a,t){return o(function(n,e){r(t).then(function(e){var t=[3,5,10,15,20,40];e.forEach(function(e){e.code==a&&(t=e.suggestedAmounts)}),n(t)},e)})}}}]),e.filter("money",["$filter","$locale","CurrencyCodeProvider",function(e,t,n){var a=e("currency"),o=t.NUMBER_FORMATS;return function(e,t){t=n.symbolFromCode(t),e=a(e,t),t=null;return t=e?e.replace(new RegExp("\\"+o.DECIMAL_SEP+"\\d{2}"),""):t}}]),e.directive("currencyCodeConverterDropdown",["CurrencyCodeProvider","patronicityConfig","User","api","$rootScope","$timeout",function(e,t,a,o,i,n){return{restrict:"E",scope:{withCurrencySymbolLabel:"@?"},templateUrl:t.urlForTemplate("currency-code-converter-dropdown.html"),link:function(n){function t(){a.get().then(function(){for(var e=0;e<n.currencyCodes.length;e++)if(n.currencyCodes[e].code==a.getPreferredCurrency()){n.selectedCurrency=n.currencyCodes[e];break}i.$broadcast("currency-selected",{currencyCode:n.selectedCurrency.code})})}t(),n.currencyCodes=[{label:"$ USD",code:"USD"},{label:"$ AUD",code:"AUD"},{label:"$ CAD",code:"CAD"},{label:"$ SGD",code:"SGD"},{label:"$ NZD",code:"NZD"},{label:" GBP",code:"GBP"},{label:" EUR",code:"EUR"},{label:"RM MYR",code:"MYR"}],n.currencyChanged=function(){if(a.isLoggedIn())o.user.setPreferredCurrency(n.selectedCurrency.code).then(function(){a.setPreferredCurrency(n.selectedCurrency.code)}).catch(function(){});else{try{localStorage.userPreferredCurrency=n.selectedCurrency.code}catch(e){console.log("error setting local storage: ",e)}a.setPreferredCurrency(n.selectedCurrency.code)}i.$broadcast("currency-selected",{currencyCode:n.selectedCurrency.code,selectedCurrency:n.selectedCurrency})},n.$on("user:login-change",function(e){t()}),n.$on("currency-selected",function(e,t){t&&t.selectedCurrency&&(n.selectedCurrency=t.selectedCurrency)})}}}]),e.directive("userMoney",["$filter","api","CurrencyCodeProvider","User",function(r,e,s,c){return{restrict:"E",scope:{amount:"=",originalCurrencyCode:"=",filter:"@?"},template:"{{convertedAmount}}",link:function(n){function t(){c.get().then(function(){n.userPreferredCurrency=c.getPreferredCurrency(),a()}).catch(function(e){o()})}function a(){n.userPreferredCurrency!=n.originalCurrencyCode?e.exchangeRate(n.originalCurrencyCode,n.userPreferredCurrency,!0).then(function(e){i(Math.ceil(parseFloat(n.amount)*e.rate),n.userPreferredCurrency)}).catch(function(e){o()}):o()}function o(){i(n.amount,n.originalCurrencyCode)}function i(e,t){"money"==n.filter?n.convertedAmount=r("money")(e,t):"numberSuffix"==n.filter?n.convertedAmount=r("numberSuffix")(e):"currency"==n.filter?n.convertedAmount=r("currency")(e,s.symbolFromCode(t)):"noDecimalCurrency"==n.filter?n.convertedAmount=r("noDecimalCurrency")(e,s.symbolFromCode(t)):n.convertedAmount=e}t(),n.$watch(function(){return n.amount+"-"+n.originalCurrencyCode+"-"+n.filter},function(){a()}),n.$on("currency-selected",function(e,t){n.userPreferredCurrency!=t.currencyCode&&(n.userPreferredCurrency=t.currencyCode,a())}),n.$on("user:login-change",function(e){t()})}}}]),e.filter("moneyWithDecimal",["$filter","$locale","CurrencyCodeProvider",function(e,t,n){var a=e("currency");t.NUMBER_FORMATS;return function(e,t){t=n.symbolFromCode(t);return a(e,t)}}]),e.directive("currencyCode",["CurrencyCodeProvider",function(a){return{restrict:"E",scope:{code:"="},template:'<span ng-show="showing">{{ code }}</span>',link:function(e,t,n){e.showing=a.showCurrencyCode()}}}]),e.filter("flipSignCurrency",["$filter",function(e){var n=e("currency");return function(e,t){return n(e*=-1,t)}}]),e.directive("currencyCodeDropDown",["CurrencyCodeProvider",function(o){return{restrict:"E",scope:{code:"=?",profileview:"=?"},template:'<select class="lgx-input giving-goal--currency lgx-u-mb-3" name="country" id="country" ng-options="currencyOption.label for currencyOption in settings.currencyCodes track by currencyOption.code" ng-model="settings.currencyCode" ng-change="settingChanged()" style="background-position-x: 88% !important; height: 56px;"></select>',link:function(n){var t=o.defaultCurrencyCode(),e={code:t,symbol:o.symbolFromCode(t),emoji:o.emojiFromCode(t),label:"Loading.."};function a(e){var t;n.settings.processing=!0,t=e,(e=o.supportedCodes("challenge")).then(function(e){n.settings.currencyCodes=e.map(function(e){return e.emoji=o.emojiFromCode(e.code),e.label=e.emoji+" "+e.code,e.code==t&&(n.settings.currencyCode=e),e})}),e.then(function(){}).finally(function(){n.settings.processing=!1})}n.settings={currencyCode:e,currencyCodes:[e]},null==n.code&&(n.code=n.settings.currencyCode),n.settingChanged=function(){n.code=n.settings.currencyCode},n.$watch("code",function(e){null!=e&&(a(e),n.settings.currencyCode=e)}),n.$watch("profileview",function(e){null==e||n.profileview||a(t)})}}}])}(),function(){var e=angular.module("patronicity.common.directives",["patronicity.configuration"]);e.directive("datePicker",["patronicityConfig",function(e){return{restrict:"E",scope:{date:"=ngModel",disabled:"&ngDisabled",config:"=?",placeholder:"@?",format:"@?"},templateUrl:e.urlForTemplate("date-picker.html"),link:function(e,t,n){e.reset=function(){e.disabled()||(e.date=null)}}}}]),e.directive("currencyPicker",["api",function(a){return{restrict:"E",scope:{selectedCurrency:"=ngModel",disabled:"&ngDisabled",showEstimateOption:"=?"},template:'<select class="form-control" ng-options="currency.code as currency.label for currency in currencies" ng-model="selectedCurrency" ng-disabled="disabled()"></select>',link:function(t,e,n){t.currencies=[],t.showEstimateOption&&(t.currencies.push({code:"*",label:"USD (Estimate)"}),t.selectedCurrency="*"),a.dashboard.currencies().then(function(e){e.forEach(function(e){t.currencies.push({code:e,label:e})})},function(){t.currencies.push({code:"USD",label:"USD"}),t.currencies.push({code:"GBP",label:"GBP"}),t.currencies.push({code:"CAD",label:"CAD"}),t.currencies.push({code:"SGD",label:"SGD"})})}}}]),e.directive("multiCountryPicker",["api","$q",function(a,o){return{restrict:"E",scope:{selectedCountries:"=ngModel",disabled:"&ngDisabled",beforeSearch:"&",afterSearch:"&"},template:'<link href="//media.launchgood.com/06bc2411f7284f2a6f474e36ab2b263173b8c480/css/ng-tags-input.min.css" rel="stylesheet"/><tags-input ng-model="selectedCountries" key-property="id" display-property="name" placeholder="Select Countries" add-from-autocomplete-only="true" ng-disabled="disabled()"><auto-complete source="findCountries($query)"></auto-complete></tags-input>',link:function(n,e,t){n.countries=[],n.findCountries=function(e){n.beforeSearch();var t=o.defer();return a.dashboard.countries(e).then(function(e){t.resolve(e),n.afterSearch()},function(){n.afterSearch(),t.reject()}),t.promise}}}}]),e.directive("multiRegionPicker",["api","$q",function(o,i){return{restrict:"E",scope:{selectedRegions:"=ngModel",countries:"=",disabled:"&ngDisabled",beforeSearch:"&",afterSearch:"&"},template:'<link href="//media.launchgood.com/06bc2411f7284f2a6f474e36ab2b263173b8c480/css/ng-tags-input.min.css" rel="stylesheet"/><tags-input ng-model="selectedRegions" key-property="id" display-property="name" placeholder="Select Regions" add-from-autocomplete-only="true" ng-disabled="disabled()"><auto-complete source="findRegions($query)"></auto-complete></tags-input>',link:function(a,e,t){a.regions=[],a.findRegions=function(e){a.beforeSearch();var t=a.countries.map(function(e){return e.id}),n=i.defer();return o.dashboard.regions(t,e).then(function(e){n.resolve(e),a.afterSearch()},function(){a.afterSearch(),n.reject()}),n.promise},a.$watch("countries",function(){a.regions=[]})}}}])}(),function(){var e=angular.module("patronicity.common.editor",["patronicity.configuration","ui.bootstrap","textAngular","patronicity.api"]);e.directive("textEditor",["patronicityConfig","imageUpload","$uibModal","taTranslations","$window","api",function(e,i,t,s,c,l){function u(a){a.reflowPopover=function(e){a.getScrollTop(a.displayElements.scrollWindow[0],!1);var t=e.position(),n=t.top+a.displayElements.scrollWindow[0].scrollTop,t=(t.top<51?(a.displayElements.popover.css("top",n+e[0].offsetHeight+"px"),a.displayElements.popover.removeClass("top").addClass("bottom")):(a.displayElements.popover.css("top",n-54+"px"),a.displayElements.popover.removeClass("bottom").addClass("top")),a.displayElements.text[0].offsetWidth-a.displayElements.popover[0].offsetWidth),n=e[0].offsetLeft+e[0].offsetWidth/2-a.displayElements.popover[0].offsetWidth/2,e=Math.max(0,Math.min(t,n)),n=Math.min(n,Math.max(0,n-t))-11;e+=window.scrollX,n-=window.scrollX,a.displayElements.popover.css("left",e+"px"),a.displayElements.popoverArrow.css("margin-left",n+"px")}}return{restrict:"E",scope:{html:"=",imageType:"@",imageTypeData:"@"},template:function(e,t){var n="<div text-angular ng-change=\"change()\" ta-toolbar=\"[['bold','italics','h2','ul'],['customInsertLink','customImageUpload'], ['html','clear']]\" ";return void 0!==t.textEditorClass&&(n+='ta-text-editor-class="'+t.textEditorClass+'" '),void 0!==t.htmlEditorClass&&(n+='ta-html-editor-class="'+t.htmlEditorClass+'" '),n+='ng-model="html"></div>'},link:function(r,e,t){r.change=function(){r.$emit("editor-value-changed")},$(".ta-resizer-handle-overlay",e).remove(),r.$on("choose-editor-image",function(e,n,a,o){r.choosingImage=!0,i.selectImage(r.imageType,r.imageTypeData,!0).result.then(function(e){var t="",t=e.link&&e.link.length?'<a href="'+e.link+'" target="_blank"><img class="img-responsive" guid="'+e.guid+'" data-guid="'+e.guid+'" src="'+e.url+'" title="'+e.caption+'"/></a>':'<img class="img-responsive" data-guid="'+e.guid+'" src="'+e.url+'" title="'+e.caption+'"/>';o(),n.wrapSelection("insertHTML",t,!0),a.resolve(),r.choosingImage=!1},function(e){r.choosingImage=!1,a.reject(e)})}),r.$on("select-editor-image",function(e,t,n,a){t.preventDefault(),a.displayElements.popover.css("width","100px");var t=a.displayElements.popoverContainer,o=(t.empty(),angular.element('<div class="btn-group" style="padding-right: 6px;">')),o=angular.element('<div class="btn-group">'),i=(void 0!==n.attr("data-guid")?((i=angular.element('<button type="button" class="btn btn-default btn-sm btn-small" unselectable="on" tabindex="-1"><i class="fa fa-link"></i></button>')).on("click",function(e){a.$emit("edit-project-image-link",a,n),a.hidePopover(),e.preventDefault()}),o.append(i),a.displayElements.popover.css("width","100px")):a.displayElements.popover.css("width","60px"),angular.element('<button type="button" class="btn btn-default btn-sm btn-small" unselectable="on" tabindex="-1"><i class="fa fa-trash-o"></i></button>'));i.on("click",function(e){void 0!==n.attr("data-guid")&&l.media.delete(r.imageType,n.attr("data-guid"),n.attr("src")).then(function(){},function(e){alert(e)}),e.preventDefault(),n.remove(),a.updateTaBindtaTextElement(),a.hidePopover()}),o.append(i),t.append(o),u(a),a.showPopover(n)}),r.$on("edit-project-image-link",function(e,n,t){r.choosingImage=!0;var a="";"A"==t.parent()[0].nodeName&&(a=t.parent().attr("href")),i.updateImageCaptionAndLink(t.attr("src"),t.attr("data-guid"),t.attr("title"),a).result.then(function(e){var t=$('img.img-responsive[data-guid="'+e.guid+'"]');a.length&&e.link.length?t.parent().attr("href",e.link):a.length&&!e.link.length?t.unwrap():!a.length&&e.link.length&&t.wrap('<a href="'+e.link+'" target="_blank">'),t.attr("title",e.caption),n.updateTaBindtaTextElement(),r.choosingImage=!1},function(e){r.choosingImage=!1})}),r.$on("select-editor-link",function(e,t,n,a){t.preventDefault(),a.displayElements.popover.css("width","436px");var t=a.displayElements.popoverContainer,o=(t.empty(),t.css("line-height","28px"),angular.element('<a href="'+n.attr("href")+'" target="_blank">'+n.attr("href")+"</a>")),o=(o.css({display:"inline-block","max-width":"200px",overflow:"hidden","text-overflow":"ellipsis","white-space":"nowrap","vertical-align":"middle"}),t.append(o),angular.element('<div class="btn-group pull-right">')),i=angular.element('<button type="button" class="btn btn-default btn-sm btn-small" tabindex="-1" unselectable="on" title="'+s.editLink.reLinkButton.tooltip+'"><i class="fa fa-edit icon-edit"></i></button>'),i=(i.on("click",function(e){e.preventDefault();e=c.prompt(s.insertLink.dialogPrompt,n.attr("href"));e&&""!==e&&"http://"!==e&&(n.attr("href",e),a.updateTaBindtaTextElement()),a.hidePopover()}),o.append(i),angular.element('<button type="button" class="btn btn-default btn-sm btn-small" tabindex="-1" unselectable="on" title="'+s.editLink.unLinkButton.tooltip+'"><i class="fa fa-unlink icon-unlink"></i></button>')),r=(i.on("click",function(e){e.preventDefault(),n.replaceWith(n.contents()),a.updateTaBindtaTextElement(),a.hidePopover()}),o.append(i),angular.element('<button type="button" class="btn btn-default btn-sm btn-small" tabindex="-1" unselectable="on">'+s.editLink.targetToggle.buttontext+"</button>"));"_blank"===n.attr("target")&&r.addClass("active"),r.on("click",function(e){e.preventDefault(),n.attr("target","_blank"===n.attr("target")?"":"_blank"),r.toggleClass("active"),a.updateTaBindtaTextElement()}),o.append(r),t.append(o),u(a),a.showPopover(n)})}}}]),e.config(["$provide",function(e){e.decorator("taOptions",["taRegisterTool","$delegate","$timeout","taTranslations","$window",function(e,t,n,a,o){return e("customImageUpload",{iconclass:"fa fa-picture-o",action:function(e,t){return this.$editor().$emit("choose-editor-image",this.$editor(),e,t),!1},onElementSelect:{element:"img",action:function(e,t,n){return this.$editor().$emit("select-editor-image",e,t,n),!1}}}),e("customInsertLink",{tooltiptext:a.insertLink.tooltip,iconclass:"fa fa-link",action:function(){var e=o.prompt(a.insertLink.dialogPrompt,"http://");if(e&&""!==e&&"http://"!==e)return this.$editor().wrapSelection("createLink",e,!0)},activeState:function(e){return!!e&&"A"===e[0].tagName},onElementSelect:{element:"a",action:function(e,t,n){return this.$editor().$emit("select-editor-link",e,t,n),!1}}}),t.setup.textEditorSetup=function(e){n(function(){e.trigger("focus")},50)},t.defaultTagAttributes.a.target="_blank",t.toolbar[1].push("customImageUpload"),t.toolbar[1].push("customInsertLink"),t}])}])}(),angular.module("patronicity.common.rating",["patronicity.configuration"]).directive("starRating",["patronicityConfig",function(e){return{restrict:"E",scope:{rating:"=ngModel",readonly:"&"},templateUrl:e.urlForTemplate("star-rating.html"),link:function(t,e,n){t.setRating=function(e){t.readonly()||(t.rating=parseInt(e)||0)}}}}]),function(){var e=angular.module("patronicity.common.sponsors",["patronicity.configuration"]);e.factory("sponsors",["api","$q",function(e,t){var n=null;return{sponsors:function(){return n=n||e.sponsor.list()},sponsorColorWithOpacity:function(o,i){return t(function(a,t){n.then(function(e){var n=!1;angular.forEach(e,function(e){var t;e.id==o&&7==e.color.length&&(t=(e=(e=/^#?([a-f\d]{2})([a-f\d]{2})([a-f\d]{2})$/i.exec(e.color))?{r:parseInt(e[1],16),g:parseInt(e[2],16),b:parseInt(e[3],16)}:null).r+e.g+e.b<380,e&&(a({color:"rgba("+e.r+", "+e.g+", "+e.b+", "+i+")",light:t}),n=!0))}),n||t()},t)})}}}]),e.directive("sponsoredTopNavigation",["patronicityConfig","sponsors","User",function(e,n,a){return{restrict:"E",scope:{sponsor:"@",dashboard:"@"},templateUrl:e.urlForTemplate("navigation/sponsored-navigation.html"),link:function(t){t.data={loading:!0,color:"transparent",sponsors:[],isDashboard:"true"===t.dashboard},a.get().then(function(){a.loggedIn()&&(t.userIsAdmin=a.current().IsAdmin)}),t.sponsor&&(t.data.loading=!0,n.sponsors().then(function(e){t.data.sponsors=e,n.sponsorColorWithOpacity(t.sponsor,1).then(function(e){t.userIsAdmin&&!t.data.isDashboard?t.data.color="#7ECB91":t.data.color=e.color,e.light&&(t.data.whiteText={color:"#fff"})},function(){t.data.color="#7ECB91"}).finally(function(){t.data.loading=!1})}))}}}]),e.directive("sponsorHeroBanner",["patronicityConfig","sponsors","User",function(t,i,n){return{restrict:"E",scope:{sponsor:"="},templateUrl:t.urlForTemplate("navigation/sponsored-project-banner.html"),link:function(a,o,e){a.data={visible:!1,userIsAdmin:!1,hasSponsors:"patronicity"==t.applicationName,displayColor:"#7ECB91",fixedBanner:!1,sponsor:{color:"#7ECB91",imageUrl:"",name:""}},n.get().then(function(){n.loggedIn()&&(a.data.userIsAdmin=n.current().IsAdmin)}),a.$on("user:login-change",function(e,t){t.loggedIn?a.data.userIsAdmin=t.user.IsAdmin:a.data.userIsAdmin=!1}),a.$watch("sponsor",function(n){n&&i.sponsors().then(function(e){angular.forEach(e,function(e){var t;e.id==n.id&&(a.data.sponsor=e,a.data.sponsor.imageUrl&&(a.data.sponsor.imageUrl=-1!==(t=a.data.sponsor.imageUrl).indexOf("https")?t:"//media.launchgood.com/06bc2411f7284f2a6f474e36ab2b263173b8c480/"+t),a.data.displayColor=i.sponsorColorWithOpacity(e.id,"0.6").then(function(e){a.data.displayColor=e.color}),a.data.visible=!0)})})}),window.addEventListener("scroll",function(e){var t=o.children().children()[0],n=window.scrollY;a.$apply(function(){t&&(n>t.offsetTop?i.sponsorColorWithOpacity(a.data.sponsor.id,"0.95").then(function(e){a.data.displayColor=e.color,a.data.fixedBanner=!0}):i.sponsorColorWithOpacity(a.data.sponsor.id,"0.6").then(function(e){a.data.displayColor=e.color,a.data.fixedBanner=!1}))})})}}}]),e.directive("sponsorDashboardButton",["patronicityConfig","api","User",function(e,a,t){return{restrict:"E",scope:{sponsor:"="},templateUrl:e.urlForTemplate("navigation/sponsor-dashboard-button.html"),link:function(n){n.data={userIsAdmin:!1},t.get().then(function(){t.loggedIn()&&(n.data.userIsAdmin=t.current().IsAdmin)}),a.sponsor.byId(n.sponsor).then(function(e){n.data.sponsor=e}),n.$watch("sponsor",function(e,t){e!==t&&a.sponsor.byId(n.sponsor).then(function(e){n.data.sponsor=e})})}}}])}(),function(){var e=angular.module("patronicity.community.admin",["patronicity.configuration","ui.router","ui.bootstrap","patronicity.api","user"]);e.directive("startCommunity",["api","$window","User","$location","$analytics","$state",function(o,i,r,e,s,c){return{restrict:"E",templateUrl:"startCommunity.html",scope:{},link:function(n,e,t){n.newCommunity={goal:"",title:"",currencyCode:"USD",currencylabel:"$ USD"};var a=!(n.currencies=[{label:"$ USD",value:"USD"},{label:"$ CAD",value:"CAD"},{label:" GBP",value:"GBP"},{label:"$ AUD",value:"AUD"},{label:"$ SGD",value:"SGD"},{label:"$ NZD",value:"NZD"},{label:" EUR",value:"EUR"},{label:"RM MYR",value:"MYR"}]);n.canSubmit=function(){var e=!1;return e=""===n.newCommunity.title||a?e:!0},n.buttonLabel=function(){return a?"Creating...":"Next Step"},n.createProject=function(){a=!0,r.isLoggedIn()?(s.eventTrack("Create",{category:"communityPage",label:n.newCommunity.title}),o.communityPage.createCommunity(n.newCommunity).then(function(e){i.location.href="/communitypage/"+e.editUrl+c.href("community.edit",{slug:e.editUrl})},function(e){alert(e),a=!1})):r.loginModal(!1).then(function(e){s.eventTrack("Create",{category:"communityPage",label:n.newCommunity.title}),o.communityPage.createCommunity(n.newCommunity).then(function(e){i.location.href="/communitypage/"+e.editUrl+c.href("community.edit",{slug:e.editUrl})},function(e){alert("There was an error creating your community.  Please try again."),a=!1})})},n.setCurrencyCode=function(t){angular.forEach(n.currencies,function(e){e.value==t&&(n.newCommunity.currencylabel=e.label)}),n.newCommunity.currencyCode=t}}}}]),e.directive("communityAdmin",["api","patronicityConfig","$stateParams","User","$timeout","$state","$sce","$window","$location",function(n,e,r,s,c,l,u,d,t){return{restrict:"E",templateUrl:e.urlForTemplate("community/admin/index.html"),link:function(o,e,t){function i(n){var e,a;o.data.sections&&(o.tabs=(e=o.data.sections,a=[],angular.forEach(e,function(e){var t={id:e.id,status:e.status};switch(e.id){case"edit":t.sref="community.edit.detail({ slug: slug })",t.gosref="community.edit.detail",t.iconClass="glyphicon-star",t.title="Community Detail";break;case"account":t.sref="community.edit.account({ slug: slug })",t.gosref="community.edit.account",t.iconClass="glyphicon-sunglasses",t.title="Payment Information";break;case"enhance":t.sref="community.edit.enhance({ slug: slug })",t.gosref="community.edit.enhance",t.iconClass="glyphicon-gift",t.title="Enhance";break;case"communityoptions":t.sref="community.edit.communityoptions({ slug: slug })",t.gosref="community.edit.communityoptions",t.iconClass="glyphicon-equalizer",t.title="Community Options";break;case"branding":t.sref="community.edit.branding({ slug: slug })",t.gosref="community.edit.branding",t.iconClass="glyphicon-equalizer",t.title="Branding";break;case"admin":t.sref="community.edit.admin({ slug: slug })",t.gosref="community.edit.admin",t.iconClass="glyphicon-equalizer",t.title="Admin"}a.push(t)}),a),angular.forEach(o.tabs,function(e,t){e.sref==n&&(o.currentTab={index:t,title:e.title,subtitle:u.trustAsHtml(e.subtitle),hasSaveAndNext:t!=o.tabs.length-1&&"account"!==e.id&&"admin"!==e.id})})),o.pageside="community.view"==l.current.name}o.slug=r.slug||t.slug,o.viewDetails={mobileView:"overview"},o.getPermission=function(){return n.communityPage.communityPermission(o.slug).then(function(e){o.data=e,o.WePayAccountID=e.WePayAccountID,o.SponsorID=e.ID,o.sections=o.data.sections,i(l.current.name+"({ slug: slug })"),o.$broadcast("Sponsor-loaded",o.SponsorID)},function(e){}),o.data},s.get().then(function(){o.isAdmin=s.isAdmin()}),o.getPermission(),o.$on("payment-info-saved",function(){o.getPermission()});var a=!1;o.saveAndNext=function(){a=!0,o.$broadcast("sponsor-save-panel")},o.$on("saved-sponsor-data",function(e,t){var n;o.getPermission(),c(function(){i(l.current.name+"({ slug: slug })")},2500),a?((n=o.currentTab.index+1)<o.tabs.length&&(l.go(o.tabs[n].gosref,{slug:o.slug}),d.scrollTo(0,0)),a=!1):(o.showSaved=!0,c(function(){o.showSaved=!1},2500))}),o.$on("$stateChangeSuccess",function(e,t){i(t.name)}),o.$on("ui-state-changed",function(e,t,n,a,o){i(t)}),o.$on("edit-sponsor-id-changed",function(e,t){i(l.current.name+"({ slug: slug })")}),o.setMobileView=function(e,t){o.viewDetails.mobileView=e,o.$broadcast("$stateChangeSuccess",{name:"community.edit."+t+"({ slug: slug })"})}}}}]),e.directive("communityAdminEditSection",["api","$stateParams","$timeout","$log","$uibModal","$state","CurrencyCodeProvider",function(o,i,r,s,c,l,u){return{restrict:"E",templateUrl:"communityAdminEditSection.html",link:function(n,e,t){var a;n.data={metadata:[]},n.slug=i.slug||t.slug,n.urlCopied=!1,n.firstLoad=!0,n.urlSaved=!0,n.messgeDisplay=!1,n.currencies=[],u.supportedCodes("community").then(function(e){n.currencies=e.map(function(e){return{label:e.symbol+" "+e.code,value:e.code}})}),n.getCommunity=function(){return o.communityPage.communityDetailBySlug(n.slug).then(function(e){n.data=e,n.data.metadata.Accent=n.data.metadata.Accent||"#57c282",n.data.metadata.custom_url=n.data.metadata.custom_url||"",n.urlSaved=!0},function(e){}),n.data},n.getCommunity(),n.preSave=function(e){a&&(r.cancel(a),a=void 0),a=r(function(){var t=n.data.slug;return o.communityPage.communityEditSave(n.data).then(function(e){n.messgeDisplay=!0,n.message="Community page has been saved!",r(function(){n.message="",n.messgeDisplay=!1,n.$emit("saved-sponsor-data")},2e3),e.slug!=t&&c.open({templateUrl:"communityURLChangedModal.html",controller:["$scope","$uibModalInstance",function(e,t){e.ok=function(){t.close()}}]}).result.then(function(){window.location="/communitypage/"+e.slug+l.href("community.edit",{slug:e.slug})})},function(e){})},e?0:5e3)},n.$on("sponsor-save-panel",function(e,t){n.messgeDisplay=!0,n.message="Data saving ...",n.preSave(),console.log("edit detail save ")}),n.$on("sponsor-getCommunity",function(e,t){r(function(){n.getCommunity()},2e3)}),n.changed=function(e){s.info("Sponsor detail: "+e+" changed!"),n.preSave(!1)},n.copyUrl=function(){n.urlCopied=!0},n.$watch("data.metadata.custom_url",function(){n.urlCopied=!1,n.firstLoad&&n.data.metadata.custom_url?n.firstLoad=!1:n.urlSaved=!1}),n.delayedSave=function(){n.preSave(!1)}}}}]),e.directive("customCommunityUrl",["api","$q",function(i,r){return{restrict:"A",require:"ngModel",scope:{sponsorId:"="},link:function(o,e,t,n){if(!n)throw"Missing ngModel!";n.$parsers.push(function(e){var t=e?e.replace(/[^A-Za-z0-9_\-]/g,""):null;return t!=e&&(n.$setViewValue(t),n.$render()),t}),n.$asyncValidators.uniqueUrl=function(e,t){var a=e||t;return r(function(t,n){a&&0<a.length?i.communityPage.validCustomUrl(o.sponsorId,a).then(function(e){t(e)},function(e){n("Invalid URL"),o.$emit("sponsor-getCommunity")}):t()})}}}}]),e.directive("communityDescription",["$uibModal","patronicityConfig",function(a,s){return{restrict:"E",templateUrl:"communityDescription.html",scope:{html:"=",projectId:"=",showCkeditor:"=",disabled:"=?"},link:function(t,e,n){t.editing=!0,void 0===t.disabled&&(t.disabled=!1),t.editPitch=function(e){!t.disabled&&t.editing&&(a.open({templateUrl:"editCommunityPitch.html",backdrop:"static",windowClass:"pitch-editor-modal",controller:["$scope","$uibModalInstance","html","projectID","showCkeditor",function(e,t,n,a,o){e.html=n,e.valid=r(n),e.projectId=a,e.showCkeditor=o,e.application=s.applicationName;var i=!1;function r(e){return!!angular.element(e).text().length}e.$on("editor-value-changed",function(){i=!0,e.valid=r(e.html)}),e.cancel=function(){t.dismiss()},e.save=function(){t.close({pitch:e.html,pitchChanged:i})}}],resolve:{html:function(){return t.html},projectID:function(){return t.projectId},showCkeditor:function(){return t.showCkeditor}}}).result.then(function(e){t.html=e.pitch,t.$emit("pitch-edited",{pitch:e.pitch,changed:e.pitchChanged})},function(){}),e.preventDefault())}}}}]),e.directive("communityPagePreview",["api","patronicityConfig","$stateParams","$rootScope","$sce","$window","User",function(a,e,o,i,r,s,c){return{restrict:"E",templateUrl:e.urlForTemplate("community/view-detail.html"),link:function(n,e,t){n.slug=o.slug||t.slug,n.playButton=!1,n.imageDisplay=!1,n.videoDisplay=!1,n.statsLoaded=!1,c.get().then(function(){n.isAdmin=c.isAdmin()}),a.communityPage.communityDetailBySlug(n.slug).then(function(e){var t;n.data=e,n.safeVideoUrl=r.trustAsResourceUrl(n.data.metadata.VideoUrl),n.data.metadata.Accent=n.data.metadata.Accent||"#57c282",n.data.metadata.brandColor=n.data.metadata.brandColor||"#57c282",n.data.metadata.buttonTextColor=n.data.metadata.buttonTextColor||"white",t=n.data.metadata.CurrencyCode,n.statsLoaded=!1,a.communityPage.statsBySlug(n.slug,t).then(function(e){n.stats=e.stats,n.stats||(n.stats={projectCount:0,patronCount:0,fundedAmount:0,currency:t}),n.statsLoaded=!0},function(e){}),e.metadata.VideoUrl&&!n.data.main_link?(n.videoURL=n.data.metadata.VideoUrl.replace("autoplay=1",""),n.imageDisplay=!1,n.videoDisplay=!0):n.data.main_link&&e.metadata.VideoUrl?(n.playButton=!0,n.imageDisplay=!0):(n.imageDisplay=!0,n.playButton=!1),e.metadata.nonProfitFields&&"501c3"==e.metadata.nonProfitFields.nonprofit_type&&(n.display501c3=!0),n.StartACampaignButtonLabel=n.data.metadata.start_campaign_button_label||"Start a campaign",n.GiveDirectlyButtonLabel=n.data.metadata.give_directly_button_label||"Give directly"},function(e){}),n.selectedFilterItem="Sort",n.filterItems=["Sort","Amount raised","Most Donors","Newest","Trending"],n.selectedStatusFilterItem="Filter",n.filterStatusItems=["Filter","Open","Closed"],n.$watch("selectedFilterItem",function(e,t){e!==t&&i.$broadcast("sposnsor-filter-change",{a:e})}),n.$watch("selectedStatusFilterItem",function(e,t){e!==t&&i.$broadcast("sposnsor-status-filter-change",{a:e})}),n.overlayClicked=function(){n.playButton&&(n.playButton=!1,n.imageDisplay=!1,n.videoDisplay=!0)},n.startACampaign=function(){s.open("/projects/start/?sponsorId="+n.data.sponsor_id,"_blank")},n.readingLimit=function(e){"more"==e?(n.numLimit=1e3,n.less=!0,n.more=!1):(n.numLimit=100,n.more=!0,n.less=!1)},n.readingLimit("less"),n.safeUrl=function(e){var t=e.match(/^(?:http(?:s)?:)?\/\/(?:www\.)?youtube.com\/watch\?v=([0-9a-z\-A-Z]*)/);return(t=t||e.match(/^(?:http(?:s)?:)?\/\/(?:www\.)?youtu.be\/([0-9a-z\-A-Z_]*)/))&&(e="//www.youtube.com/embed/"+t[1]),r.trustAsResourceUrl(e)},n.$watch("data.metadata.brandColor",function(e,t){null!=e&&(n.rgbaColorBg="rgba("+parseInt(e.slice(-6,-4),16)+","+parseInt(e.slice(-4,-2),16)+","+parseInt(e.slice(-2),16)+",0.1)")},!0)}}}]),e.directive("canEdit",["api","patronicityConfig","$stateParams","$location","Dialogs","$state",function(l,e,t,n,u,o){return{restrict:"E",templateUrl:e.urlForTemplate("community/canedit.html"),scope:{data:"="},link:function(i,e,t){var n=i.data.Slug;function r(t){angular.forEach(i.navigation,function(e){e.active=0===t.indexOf(e.state)})}function s(e){var t,n,a;i.sponsorStatus=e.sponsor.status,i.dropdownOptions=e.sponsor.dropdown,i.changingStatus=!1,i.navigation=(t=e.navigation,n=e.sponsor.slug,a=[],angular.forEach(t,function(e){var t={id:e};switch(t.id){case"view":t.icon="glyphicon-sunglasses",t.label="View",t.tooltip="View your community",t.state="community.view";break;case"edit":t.icon="glyphicon-pencil",t.label="Edit",t.tooltip="Edit your community",t.state="community.edit";break;case"campaigns":t.icon="glyphicon-cog",t.label="Campaigns",t.tooltip="View your campaigns",t.state="community.campaigns";break;case"reports":t.icon="glyphicon-zoom-in",t.label="Reports",t.tooltip="Reports Details",t.state="community.reports";break;case"resources":t.icon="glyphicon-credit-card",t.label="Resources",t.tooltip="Additional Resources",t.state="community.resources";break;case"insights":t.icon="glyphicon-signal",t.label="Insights",t.tooltip="community Insights",t.state="community.insights"}t.url="/communitypage/"+n+o.href(t.state,n),t.active=!1,a.push(t)}),a),r(o.current.name)}function c(){l.communityPage.sponsorBarInfo(n).then(function(e){s(e)},function(e){alert(e)})}i.slug=n,i.topnav=[],i.changingStatus=!1,i.sponsorStatusLabel=function(){return i.changingStatus?"Saving...":i.sponsorStatus},i.handleDropdownOption=function(t){var a,o;"submit-sponsor"==t.verb?(a=i.slug,o=t.verb,i.changingStatus=!0,l.communityPage.requirementsCheck(a).then(function(e){var t,n;e.canSubmit?(t="",t="help@launchgood.com",u.Confirm('<p>Your Community will now be submitted. Please give us 24-48 hours to review, will help you set up your community for success!</p><p>If this is an emergency and needs immediate approval, please contact <a href="mailto:help@launchgood.com">help@launchgood.com</a> for immediate assistance.</p>',"Submit Community",[{name:"Submit",type:"ok"},{name:"Cancel",type:"cancel"}]).then(function(){l.communityPage.changeSponsorState(a,o).then(function(e){s(e)},function(e){e.includes("help@launchgood.com")&&(alert(e),c())})},function(){i.changingStatus=!1})):(i.changingStatus=!1,n="<ul>",angular.forEach(e.missingRequired,function(e){n+="<li>"+e+"</li>"}),n+="</ul>",u.Confirm("Your community page is incomplete. Please visit the edit page and complete these items:<br><br>"+n,"Community Incomplete",[{name:"OK",type:"ok"}]))},function(){i.changingStatus=!1})):void 0!==t.confirm_message?u.Confirm(t.confirm_message,t.confirm_title,[{name:t.confirm_ok,type:"ok"},{name:t.confirm_cancel,type:"cancel"}]).then(function(e){u.SingleTextAreaEntry(t.dialog_message,t.dialog_title).then(function(e){i.changingStatus=!0,l.communityPage.changeSponsorState(i.slug,t.verb,{reason:e.textAreaEntry}).then(function(e){s(e)})},function(e){e.includes("help@launchgood.com")&&(alert(e),c()),i.changingStatus=!1})},function(){i.changingStatus=!1}):void 0!==t.dialog_message?u.SingleTextAreaEntry(t.dialog_message,t.dialog_title).then(function(e){i.changingStatus=!0,l.communityPage.changeSponsorState(i.slug,t.verb,{reason:e.textAreaEntry}).then(function(e){s(e)},function(e){e.includes("help@launchgood.com")&&(alert(e),c()),i.changingStatus=!1})}):(i.changingStatus=!0,l.communityPage.changeSponsorState(i.slug,t.verb).then(function(e){s(e)},function(e){e.includes("help@launchgood.com")&&(alert(e),c()),i.changingStatus=!1}))},i.handleSingleOption=function(e){e&&(1==i.dropdownOptions.length?(i.statusMenuDropdown=!1,i.handleDropdownOption(i.dropdownOptions[0])):i.dropdownOptions.length<1?i.statusMenuDropdown=!1:i.statusMenuDropdown=!0)},i.statusLabelClass=function(e){var t="btn-primary";switch(e){case"In Review":t="btn-primary";break;case"Go Live!":case"Submit for Review":case"Suspended":t="btn-warning";break;default:t="btn-primary"}return t},i.$on("ui-state-changed",function(e,t,n,a,o){r(t)}),c()}}}]),e.directive("sponsorNotes",["api","$uibModal","patronicityConfig",function(a,o,i){return{restrict:"EA",template:'<button class="btn btn-primary" ng-click="showNotesModal()">Notes{{noteCountLabel()}}</button>',scope:{sponsorId:"=",noteCount:"="},replace:!0,link:function(t,e,n){t.noteCountLabel=function(){var e="";return e=0<t.noteCount?"("+t.noteCount+")":e},t.showNotesModal=function(){o.open({templateUrl:i.urlForTemplate("project-notes-modal.html"),controller:["$scope","$uibModalInstance","sponsorId",function(t,e,n){t.addingNote=!1,t.note="",t.loadSponsorNotes=function(){a.communityPage.viewNotes(n,"sponsor").then(function(e){t.notes=e},function(e){console.log("couldn't load notes!")})},t.loadSponsorNotes(),t.cancel=function(){e.close()},t.ok=function(){e.close()},t.newNote=function(){t.addingNote=!0},t.cancelNote=function(){t.addingNote=!1},t.saveNote=function(){a.communityPage.addNote(n,"sponsor-note",t.note).then(function(e){t.addingNote=!1,t.note="",t.loadSponsorNotes()},function(e){alert(e)})}}],resolve:{sponsorId:function(){return t.sponsorId}}})}}}}]),e.directive("userCommunityPages",["api","patronicityConfig","$stateParams",function(a,e,t){return{restrict:"E",templateUrl:e.urlForTemplate("user/profile-communities.html"),scope:{userId:"="},link:function(n,e,t){n.getCommunities=function(){return a.communityPage.communityListByUser(n.userId).then(function(e){n.data=e},function(e){}),n.data},void 0!==n.userId&&n.getCommunities(),n.$watch("userId",function(e,t){e!==t&&n.getCommunities()})}}}]),e.directive("communityCardGrid",["patronicityConfig","User","api",function(e,t,r){return{restrict:"E",scope:{listId:"=",medium:"@?",source:"@?",templateType:"@?"},templateUrl:e.urlForTemplate("community-card-grid.html"),link:function(n,e,t){var a={offset:0,limit:6,type:"customList",listID:n.listId},o=!1;function i(t){(t=void 0===t?!1:t)?n.loadingMore=!0:n.loading=!0,r.Communities.query(a,function(e){t&&n.cards.length?angular.forEach(e,function(e){n.cards.push(e)}):n.cards=e,n.showLoadMore=o&&e.length==a.limit,n.loading=!1,n.loadingMore=!1})}n.nextPage=function(e){a.offset+=parseInt(a.limit),i(e)},o=void 0!==t.showLoadMore&&"0"!==t.showLoadMore&&"false"!==t.showLoadMore,i()}}}]),e.directive("communityCard",["api","patronicityConfig","$rootScope","UTMCardManager",function(e,a,t,o){return{restrict:"EA",scope:{card:"=",loadComplete:"&?",utmMedium:"=?",utmSource:"=?",type:"=?"},template:'<div ng-include="getTemplateUrl()"></div>',link:function(t,e,n){t.getTemplateUrl=function(){return"onlyImage"==t.type?a.urlForTemplate("community-card-image.html"):a.urlForTemplate("community-card.html")},t.onImageLoad=function(e){t.loadComplete&&t.loadComplete()({type:t.type})},void 0!==n.afterComplete&&(t.afterComplete=n.afterComplete),t.srcForUrl=function(){var e="";return t.utmMedium&&t.utmSource&&o.setSource(t.utmSource,t.utmMedium,t.card.Slug),e=o.getSource()&&""!=o.getSource()?o.getSource():e}}}}])}(),angular.module("patronicity.community.factory",["patronicity.configuration","ui.router"]).factory("UTMCardManager",["api","$rootScope",function(e,t){var a={};return a={src:""},{setSource:function(e,t,n){return a.src="?utm_source="+e+"&utm_medium="+t+"&utm_campaign="+n,a.src},getSource:function(){return a.src}}}]),function(){var e=angular.module("community",["mv.forms","ui.bootstrap","patronicity.configuration","ui.router"]);e.service("CommunityService",["$uibModal","patronicityConfig","api",function(n,a,r){this.Add=function(e,t){return n.open({templateUrl:a.urlForTemplate("add-community-modal.html"),controller:["$scope","$uibModalInstance","$http","excludeCommunityIDs","projectID",function(a,t,e,n,o){var i=this;a.error=null,a.communityName=null,a.selectedCommunity=null,a.canAdd=!1,this.excludeIDs=n,this.projectID=o,a.cancel=function(){t.dismiss("cancel")},a.selectCommunity=function(e,t,n){a.selectedCommunity=e,0<=i.excludeIDs.indexOf(e.ID)?a.canAdd=!1:a.canAdd=!0},a.$watch("communityName",function(e,t){e!==t&&a.selectedCommunity&&e!=a.selectedCommunity.Name&&(a.selectedCommunity=null)}),a.getCommunities=function(e){return r.community.searchCommunity(e).then(function(e){return e},function(e){})},a.create=function(){r.community.addCommunity(a.communityName).then(function(e){a.progress=100,t.close({verb:"edit",community:e})})},a.selectedExisting=function(){t.close({verb:"select",community:a.selectedCommunity})}}],resolve:{excludeCommunityIDs:function(){return e},projectID:function(){return t}}}).result},this.Edit=function(e,t){return n.open({templateUrl:a.urlForTemplate("edit-community-modal.html"),controller:["$scope","$uibModalInstance","$http","imageUpload","community","mode","api",function(t,n,e,a,o,i,r){t.mode=i,"object"==typeof o?t.community=o:r.community.editCommunity(o).then(function(e){t.community=e,t.community.SortOrder=parseInt(e.SortOrder)}),t.cancel=function(){n.close({verb:"cancel"})},t.selectImage=function(){a.selectImage("community",t.community.ID,!1,"community").result.then(function(e){t.community.ImageSrc=e.url,t.community.ImageIsValid=!0,t.community.ThumbnailImageSrc=e.url,t.community.ThumbnailImageIsValid=!0})},t.selectVideo=function(){a.selectVideo("community",t.community.ID,!1).result.then(function(e){})},t.removeImage=function(){confirm("Are you sure you want to remove this image?")&&r.community.deleteImageCommunity(t.community).then(function(e){t.community=e})},t.save=function(){"user"==t.mode&&(t.community.Status=1),r.community.saveCommunity(t.community).then(function(e){n.close({verb:"save",community:e.result})})}}],resolve:{community:function(){return e},mode:function(){return t||"user"}}}).result}}]),e.directive("communityPage",["api","patronicityConfig",function(o,e){return{restrict:"E",templateUrl:e.urlForTemplate("community-page.html"),scope:{communityId:"@"},link:function(t,e,n){function a(e){o.community.communityDetails(e).then(function(e){t.community=e,t.loading=!1})}t.loading=!0,t.community={},a(t.communityId),t.$watch("communityId",function(e,t){void 0!==e&&""!==e&&e!==t&&a(e)})}}}]),e.directive("newCommunityPage",["api","patronicityConfig","$stateParams",function(e,t,a){return{restrict:"E",templateUrl:t.urlForTemplate("community/new-community.html"),scope:{},link:function(e,t,n){a.slug||n.slug}}}]),e.directive("friendCommunityList",["Dialogs","api","patronicityConfig","$uibModal","$window",function(n,r,e,a,o){return{restrict:"E",scope:{communities:"=",disabled:"=?",projectId:"=",area:"@"},templateUrl:e.urlForTemplate("friend-community-list.html"),link:function(t){t.error=null,t.communityName=null,t.selectedCommunity=null,t.canAdd=!1,t.removeCommunity=function(e,a){e.stopPropagation(),n.Confirm("Are you sure you want to remove "+a.name+" from this project?","Confirm Community Removal").then(function(e){var n=-1;angular.forEach(t.communities,function(e,t){e.id==a.id&&(n=t)}),0<=n&&t.communities.splice(n,1),r.community.deleteMapCommunity(a.id,t.projectId).then(function(e){},function(e){alert(e)}),t.$emit("edit-project-id-changed")}).catch(function(){})},t.addCommunity=function(){a.open({templateUrl:e.urlForTemplate("add-friend-community-modal.html"),controller:["$scope","$uibModalInstance","communities","project","$rootScope",function(a,e,t,n,o){var i=[];a.apiCall="getCommunities",a.communityname="Community",a.communities=t,a.project=n,angular.forEach(a.communities,function(e,t){i.push(e.id)}),a.cancel=function(){e.dismiss("cancel")},a.selectCommunity=function(e,t,n){a.selectedCommunity=e,0<=i.indexOf(e.ID)?a.canAdd=!1:a.canAdd=!0},a.$watch("communityName",function(e,t){e!==t&&a.selectedCommunity&&e!=a.selectedCommunity.Name&&(a.selectedCommunity=null)}),a.getCommunities=function(e){return new RegExp("^\\d+$").test(e)?a.getCommunitiesByID(e):r.community.searchCommunity(e,"friendsCommunity",a.project).then(function(e){return e},function(e){})},a.getCommunitiesByID=function(e){return r.community.searchCommunityByID(e,a.project).then(function(e){return e},function(e){})},a.selectedExisting=function(){a.communities.push({id:a.selectedCommunity.ID,imageSrc:a.selectedCommunity.ImageSrc,name:a.selectedCommunity.Name}),r.community.saveMapCommunity(a.communities,a.project).then(function(e){o.$broadcast("edit-project-id-changed")},function(e){}),e.close()}}],size:"md",resolve:{communities:function(){return t.communities},project:function(){return t.projectId}}})},t.redirectToCommunityPage=function(e){e&&e.relativeUrl&&(e="/"+e.relativeUrl,o.open(e,"_blank"))}}}}]),e.directive("defaultCommunity",["Dialogs","api","patronicityConfig","$uibModal","$window",function(t,r,e,n,a){return{restrict:"E",scope:{communities:"=",project:"=",area:"@"},templateUrl:e.urlForTemplate("default-community.html"),link:function(o){o.error=null,o.communityName=null,o.selectedCommunity=null,o.canAdd=!1,o.removeCommunity=function(e,a){e.stopPropagation(),t.Confirm("Are you sure you want to remove "+a.name+" from this project?","Confirm Community Removal").then(function(e){var n=-1;angular.forEach(o.communities,function(e,t){e.id==a.id&&(n=t)}),0<=n&&o.communities.splice(n,1),o.sponsorId=null,r.admin.projectSponsor(o.project,o.sponsorId).then(function(e){o.disabled=!1}),o.$emit("edit-project-id-changed")}).catch(function(){})},o.addCommunity=function(){n.open({templateUrl:e.urlForTemplate("add-friend-community-modal.html"),controller:["$scope","$uibModalInstance","communities","project","$rootScope",function(a,e,t,n,o){var i=[];a.communityname="Sponsor",a.communities=t,a.project=n,angular.forEach(a.communities,function(e,t){i.push(e.id)}),a.cancel=function(){e.dismiss("cancel")},a.selectCommunity=function(e,t,n){a.selectedCommunity=e,0<=i.indexOf(e.ID)?a.canAdd=!1:a.canAdd=!0},a.$watch("communityName",function(e,t){e!==t&&a.selectedCommunity&&e!=a.selectedCommunity.Name&&(a.selectedCommunity=null)}),a.getCommunities=function(e){return r.community.searchCommunity(e,"defaultCommunity",a.project).then(function(e){return e},function(e){})},a.selectedExisting=function(){a.sponsorId=a.selectedCommunity.ID,a.communities.push({id:a.selectedCommunity.ID,imageSrc:a.selectedCommunity.ImageSrc,name:a.selectedCommunity.Name}),r.admin.projectSponsor(a.project,a.sponsorId).then(function(e){o.$broadcast("sponsor-id-updated",!0)}),e.close()}}],size:"md",resolve:{communities:function(){return o.communities},project:function(){return o.project}}})},o.redirectToCommunityPage=function(e){e&&e.relativeUrl&&(e="/"+e.relativeUrl,a.open(e,"_blank"))},o.$on("sponsor-id-updated",function(e,t){o.disabled=t}),o.$watch("communities",function(){angular.forEach(o.communities,function(e,t){void 0!==e.id?o.disabled=!0:o.disabled=!1})})}}}])}(),angular.module("patronicity.communitypage",["patronicity.community.sections.enhance","patronicity.community.sections.community-options","patronicity.community.sections.branding","patronicity.community.sections.admin","patronicity.community.tabs.campaigns","patronicity.community.tabs.reports","patronicity.community.tabs.insights","patronicity.community.tabs.resources","patronicity.community.admin","patronicity.community.factory"]),angular.module("patronicity.community.sections.admin",["patronicity.configuration","ui.router","ui.bootstrap","patronicity.api","user"]).directive("communityAdminAdminSection",["api","patronicityConfig","$stateParams","$timeout",function(a,e,o,i){return{restrict:"E",templateUrl:"communityAdminAdminSection.html",link:function(t,e,n){t.slug=o.slug||n.slug,t.data={},t.messgeDisplay=!1,console.log("this is admin page"),t.getAdminSection=function(){return a.communityPage.adminSection(t.slug).then(function(e){t.data=e,t.setAdminSectionSetting(t.data)},function(e){}),t.data},t.getAdminSection(),t.setAdminSectionSetting=function(e){t.isCuratedPage=1==e.curated_page.status,null!=e.metadata.campaignFriends&&0!=e.metadata.campaignFriends||(t.data.metadata.campaignFriends="disallow"),t.isCuratedPage&&null==e.curated_page.campaignApprove&&(t.data.curated_page.campaignApprove="manual"),null==e.page_detail.zakatStatusApproval&&(t.data.page_detail.zakatStatusApproval="manual"),null==e.page_detail.zakatCategory&&(t.data.page_detail.zakatCategory="Other")},t.campaignSave=function(){a.communityPage.communityEditSave(t.data).then(function(e){console.log("Save campaign."),t.messgeDisplay=!0,t.message="Community Page : Admin section has been saved!",i(function(){t.message="",t.messgeDisplay=!1},2e3)},function(e){})},t.saveMetaData=function(){t.isSaving=!0,a.communityPage.saveMetaData(t.data).then(function(e){t.data=e,t.setAdminSectionSetting(t.data)},function(e){}).finally(function(){t.isSaving=!1})},t.selectCampaignApprove=function(e){return t.data.curated_page.campaignApprove=e,t.changed(e),t.data.curated_page.campaignApprove},t.selectZakatStatusApproval=function(e){return t.data.page_detail.zakatStatusApproval=e,t.changed(e),t.data.page_detail.zakatStatusApproval},t.setAdminCuratedSetting=function(){1==t.data.curated_page.status&&null==t.data.curated_page.campaignApprove&&(t.data.curated_page.campaignApprove="manual"),1==t.data.curated_page.status&&null==t.data.curated_page.raisefunds&&(t.data.curated_page.raisefunds=!1)},t.changed=function(e){t.setAdminCuratedSetting(),t.saveMetaData(!1)},t.selectCampaignFriends=function(e){return t.data.metadata.campaignFriends=e,t.saveMetaData(),t.data.metadata.campaignFriends}}}}]),angular.module("patronicity.community.sections.branding",["patronicity.configuration","ui.router","ui.bootstrap","patronicity.api","user"]).directive("communityAdminBrandingSection",["api","patronicityConfig","$stateParams","$rootScope","$sce","$timeout",function(o,e,i,t,r,s){return{restrict:"E",templateUrl:"communityAdminBrandingSection.html",link:function(n,e,t){var a;n.slug=i.slug||t.slug,n.data={},n.getCommunity=function(){return o.communityPage.communityDetailBySlug(n.slug).then(function(e){n.data=e,n.data.metadata.brandColor=n.data.metadata.brandColor||"#57c282",n.data.metadata.buttonTextColor=n.data.metadata.buttonTextColor||"white"},function(e){}),n.data},n.getCommunity(),n.brandingSave=function(e){a&&(s.cancel(a),a=void 0),a=s(function(){return o.communityPage.communityEditSave(n.data).then(function(e){n.messgeDisplay=!0,n.message="Branding has been saved!",n.$emit("saved-sponsor-data"),s(function(){n.message="",n.messgeDisplay=!1},2e3)},function(e){})},e?0:5e3)},n.$on("sponsor-save-panel",function(e,t){n.messgeDisplay=!0,n.message="Data saving ...",n.brandingSave()}),n.selectButtonTextColor=function(e){return n.data.metadata.buttonTextColor=e,n.brandingSave(),n.data.metadata.buttonTextColor},n.getTrustUrl=function(e){r.trustAsResourceUrl(e)},n.$watch("data.metadata.brandColor",function(e,t){null!=e&&(n.rgbaColorBg="rgba("+parseInt(e.slice(-6,-4),16)+","+parseInt(e.slice(-4,-2),16)+","+parseInt(e.slice(-2),16)+",0.1)")},!0),n.getCommunityStats=function(){o.communityPage.statsBySlug(n.slug).then(function(e){n.stats=e.stats,n.stats||(n.stats={projectCount:0,patronCount:0,fundedAmount:0})},function(e){})},n.getCommunityStats()}}}]),function(){var e=angular.module("patronicity.community.sections.community-options",["patronicity.configuration","ui.router","ui.bootstrap","patronicity.api","user"]);e.directive("communityAdminCommunityOptionsSection",["api","Dialogs","mvCountryLoader","User","$rootScope","$stateParams","$timeout","$window","patronicityConfig",function(u,d,p,m,g,f,h,y,v){return{restrict:"E",templateUrl:"communityAdminCommunityOptionsSection.html",link:function(r,e,t){var s,n;r.isApplicationLaunchgood="launchgood"==v.applicationName,r.slug=f.slug||t.slug,r.data={metadata:{locks:{}}},r.messgeDisplay=!1,r.searchBoxDisplay=!0;function a(){u.communityPage.communityDetailBySlug(r.slug).then(function(e){if(r.data=e,r.data.metadata.campaignApprove=r.data.metadata.campaignApprove||"",r.data.metadata.campaignFriends=r.data.metadata.campaignFriends||"allow",r.data.metadata.campaignTemplate=r.data.metadata.campaignTemplate||0,r.parent_project_id=angular.copy(r.data.parent_project_id),r.data.parent_project_id&&void 0!==r.data.parent_project_id&&0!==r.data.parent_project_id&&(i(r.data.parent_project_id,!0),r.searchBoxDisplay=!1),r.isCuratedPage=1==e.curated_page.status,r.isApplicationLaunchgood){r.hasInactiveCategories=!1;for(var t=0;t<r.data.categories.length;t++){var n=r.data.categories[t];if(n&&n.inactive){r.hasInactiveCategories=!0;break}}}else l();p.then(function(e){s=e,c()})},function(e){console.error(e)}).then(function(){0}),r.data}function o(e){0==r.data.metadata.raisefunds&&delete r.data.metadata.campaignApprove,0!=r.data.metadata.directDonation&&""!=r.data.parent_project_id||(r.data.parent_project_id=null,r.resetDefaultCampaignStatus()),r.isEditingReward(),n&&(h.cancel(n),n=void 0),n=h(function(){u.communityPage.communityEditSave(r.data).then(function(e){r.messgeDisplay=!0,r.message="Community Option has been saved!",h(function(){r.message="",r.messgeDisplay=!1,r.$emit("saved-sponsor-data")},2e3)},function(e){console.error(e)})},e?0:5e3)}function i(t,n){r.IsImageDisplay=!1,!isNaN(Number(t))&&angular.isNumber(Number(t))&&u.projectByID(t).then(function(e){r.project=e,angular.forEach(r.project.Carousel,function(e){e.IsImage&&(r.IsImageDisplay=!0,r.imageUrl=e.ThumbnailURL)}),n||r.project.ID!=t||r.changed(t)})}function c(){if(void 0!==r.data){var e,n,a=[],t=["street","city","zipCode"];for(e in t){var o=t[e];r.data.campaignLocation&&void 0!==r.data.campaignLocation[o]&&0<r.data.campaignLocation[o].length&&a.push(r.data.campaignLocation[o])}r.data.campaignLocation&&""!==r.data.campaignLocation.state&&void 0!==r.data.campaignLocation.state&&0<r.data.campaignLocation.state.length&&(n=!1,s&&void 0!==r.data.campaignLocation.country&&angular.forEach(s,function(e){var t;e.Code==r.data.campaignLocation.country&&void 0!==e.States&&(t=r.data.campaignLocation.state.trim().toLowerCase(),angular.forEach(e.States,function(e){t!=e.Abbreviation.toLowerCase()&&t!=e.Name.toLowerCase()||(a.push(e.Name),n=!0)}))}),n||a.push(r.data.campaignLocation.state)),r.data.campaignLocation&&void 0!==r.data.campaignLocation.country&&0<r.data.campaignLocation.country.length&&(s?angular.forEach(s,function(e){e.Code==r.data.campaignLocation.country&&a.push(e.Name)}):a.push(r.data.campaignLocation.country));var i=a.join(", ");0<i.length?r.data.currentAddress=i:r.data.currentAddress=void 0}}function l(){var t=0;angular.forEach(r.data.categories,function(e){e.selected&&t++}),r.selectedCategoryCount=t}r.toggleLockAll=function(){var e=r.allLocked();r.$broadcast("set-field-locks",{locked:!e})},r.allLocked=function(){var e,t=!0;for(e in r.data.metadata.locks)t&=r.data.metadata.locks[e];return t},r.setEndDays=function(e){r.data.metadata.campaign.EndDays=e,-1!=r.data.metadata.campaign.EndDays||void 0!==r.data.metadata.campaign.EndDate&&r.data.metadata.campaign.EndDate||((e=new Date).setDate(e.getDate()+30),r.data.metadata.campaign.EndDate=e),r.changed("EndDate")},r.isAdmin=!1,m.get().then(function(){m.loggedIn()&&(r.currentUser=m.current().ID,r.isAdmin=m.isAdmin())}),r.$watch("data.metadata.campaign.EndDate",function(e,t){void 0!==t&&void 0!==e&&r.changed("EndDate")}),r.$on("new-mv-image-uploaded",function(e,t){r.data.default_campaign_image_link=t.url}),r.$on("new-mv-image-uploading",function(e,t){t.uploading&&(r.data.default_campaign_image_link="")}),r.$on("field-lock-changed",function(){r.changed("lock")}),r.isEditingReward=function(){angular.forEach(r.data.metadata.givingLevel,function(e,t,n){1==e.editingThisReward&&"new"==e.id&&n.splice(t,1)})},r.selectCampaignApprove=function(e){return r.data.metadata.campaignApprove=e,r.changed(e),r.data.metadata.campaignApprove},r.selectCampaignFriends=function(e){return r.data.metadata.campaignFriends=e,r.changed(e),r.data.metadata.campaignFriends},r.$on("sponsor-save-panel",function(e,t){r.messgeDisplay=!0,r.message="Data saving ...",g.editingRewardDisable||o(!0)}),r.$on("givingLevel-save-panel",function(e,t){g.editingRewardDisable||o(!1)}),r.$on("campaign-default-image-removing",function(e,t){r.removeImage()}),r.removeImage=function(){d.Confirm("Are you sure you want to delete this image?","Delete Image",[{name:"Delete",type:"ok"},{name:"Cancel",type:"cancel"}]).then(function(){u.communityPage.deleteDefaultImage(r.data.sponsor_id).then(function(){r.$broadcast("campaign-default-image-removed",{}),a()},function(e){})},function(){})},r.changed=function(e){g.editingRewardDisable||o(!1)},r.$watch("data.metadata.raisefunds",function(e){1==e&&""==r.data.metadata.campaignApprove?r.selectCampaignApprove("manual"):0==e&&delete r.data.metadata.campaignApprove}),r.$watch("data.metadata.directDonation",function(e){0==e&&r.resetDefaultCampaignStatus()}),r.$on("project-selected",function(e,t){r.data.parent_project_id=t.project.ID,i(r.data.parent_project_id,!1),r.setDefaultCampaignStatus(),r.searchBoxDisplay=!1}),r.setDefaultCampaignStatus=function(){u.communityPage.setDefaultCampaign(r.data.sponsor_id,r.data.parent_project_id).then(function(e){},function(e){})},r.redirectToProjectCampaignPage=function(){var e;r&&r.project&&r.project.Slug&&(e="/campaign/"+r.project.Slug,y.open(e,"_blank"))},r.resetDefaultCampaignStatus=function(e){e&&e.stopPropagation(),u.communityPage.resetDefaultCampaign(r.data.sponsor_id,r.data.parent_project_id).then(function(e){delete r.data.parent_project_id,r.searchBoxDisplay=!0,o(!1)},function(e){})},r.locationChanged=function(){c(),r.changed("address")},r.changeAddress=function(){var e,t=["street","city","state","country","zipCode"];for(e in t)r.data.campaignLocation[t[e]]="";c(),r.data.location=""},r.toggleCategory=function(e){if(r.isApplicationLaunchgood){if(!e.selected){if(r.hasInactiveCategories){var t=[];r.hasInactiveCategories=!1;for(var n=0;n<r.data.categories.length;n++){var a=r.data.categories[n];a&&!a.inactive&&t.push(a)}r.data.categories=t}angular.forEach(r.data.categories,function(e){e.selected=!1}),e.selected=!0,r.changed("category")}}else e.selected=!e.selected,l()},a()}}}]),e.directive("communityRewards",["Dialogs","$rootScope",function(s,e){return{restrict:"E",scope:{rewards:"=",currencyCode:"=",currencySymbol:"=",locked:"="},templateUrl:"communityRewards.html",controller:["$scope","$element","$timeout","$window","$rootScope",function(a,e,t,n,o){function i(e){a.editableItem=e}function r(e){var t,n={};for(t in e)0<=t.indexOf("$")||(n[t]=e[t]);return n}this.editReward=function(e){e.editingThisReward=!0,i(r(e)),a.editingRewardDisable=!0,o.editingRewardDisable=!0},this.duplicateReward=function(e){e=r(e);e.id="new",e.prize_awarded=0,e.editingThisReward=!0,a.rewards.push(e),i(e),a.editingRewardDisable=!0,o.editingRewardDisable=!0},this.deleteReward=function(t){s.Confirm('Are you sure you want to remove "'+t.title+'"?',"Confirm Deletion").then(function(){var e=a.rewards.indexOf(t);0<=e&&a.rewards.splice(e,1),"new"!=t.id&&a.$emit("givingLevel-save-panel")})},this.saveRewardEdit=function(e){var n;void 0!==a.editableItem&&"new"!==a.editableItem.id&&(angular.forEach(a.rewards,function(e,t){e.id==a.editableItem.id&&(n=t)}),void 0!==n?(a.editableItem.changed=!0,a.rewards.splice(n,1,a.editableItem)):a.rewards.push(a.editableItem)),e.editingThisReward=!1,a.editableItem=void 0,a.editingRewardDisable=!1,o.editingRewardDisable=!1,a.$emit("givingLevel-save-panel")},this.cancelRewardEdit=function(e){for(var t=0;t<a.rewards.length;t++)if(a.rewards[t].id==e.id){a.rewards[t].editingThisReward=!1,"new"==e.id&&a.rewards.splice(t,1);break}a.editableItem=void 0,a.editingRewardDisable=!1,o.editingRewardDisable=!1},a.addReward=function(e){var t={id:"new",title:"",description:"",amount:10,limit:0,prize_awarded:0,require_shipping:!1,require_note:!1,include_note:!1,note_description:"",unlimited:1,allow_change_amount:!0,editingThisReward:!0,note_email:"",hide_reward:!1,require_email:!1,include_email_note:!1};a.editingRewardDisable=!0,o.editingRewardDisable=!0,e?a.rewards.unshift(t):a.rewards.push(t),i(t)}}]}}]).directive("communityReward",function(){return{require:"^communityRewards",restrict:"E",templateUrl:"communityReward.html",scope:{item:"=item",editable:"=",currencyCode:"@",currencySymbol:"@"},link:function(e,t,n,a){e.unlimitedAvailable=0===parseInt(e.item.Limit),e.delete=function(){a.deleteReward(e.item)},e.edit=function(){a.editReward(e.item)},e.duplicate=function(){a.duplicateReward(e.item)}}}}).directive("communityRewardEditable",function(){return{require:"^communityRewards",restrict:"E",templateUrl:"communityRewardEditable.html",scope:{item:"=item",currencyCode:"@",currencySymbol:"@"},link:function(e,t,n,a){e.save=function(){a.saveRewardEdit(e.item)},e.cancel=function(){a.cancelRewardEdit(e.item)}}}})}(),function(){var e=angular.module("patronicity.community.sections.enhance",["patronicity.configuration","ui.router","ui.bootstrap","patronicity.api","user"]);e.directive("communityAdminEnhanceSection",["api","patronicityConfig","$stateParams","$timeout","$rootScope",function(i,e,r,s,t){return{restrict:"E",templateUrl:"communityAdminEnhanceSection.html",link:function(n,e,t){var a;function o(e){a&&(s.cancel(a),a=void 0),a=s(function(){return i.communityPage.communityEditSave(n.data).then(function(e){n.messgeDisplay=!0,n.message="Enhance has been saved!",n.$emit("saved-sponsor-data"),s(function(){n.message="",n.messgeDisplay=!1},2e3)},function(e){})},e?0:5e3)}n.slug=r.slug||t.slug,n.data={},n.saveMembers=function(){return i.communityPage.saveCommunityTeam(n.slug,n.data.communityTeam).then(function(e){n.data.communityTeam=e.members,n.data.communityTeam.messages=e.messages},function(e){}),n.data.communityTeam},n.$on("save-panel",function(e,t){s(function(){n.saveMembers()},2e3)}),n.$on("sponsor-save-panel",function(e,t){n.messgeDisplay=!0,n.message="Data saving ...",o()}),n.selectNonprofitType=function(t){angular.forEach(n.data.non_profit,function(e){e.selected=e.id==t.id})},n.selectedNonprofitType=function(){var t="none";return n.data&&angular.forEach(n.data.non_profit,function(e){e.selected&&(t=e.id)}),"501c3"!=t&&"municipality"!=t||n.data.hasOwnProperty("company_address")||(n.data.company_address={Name:"",Address:"",Address2:"",City:"",State:"",Zip:"",Country:"US",ID:"new"}),t},i.communityPage.communityDetailBySlug(n.slug).then(function(e){n.data=e},function(e){}),n.data,n.delayedSave=function(){o(!1)}}}}]),e.directive("communityTeamList",["api",function(e){return{restrict:"E",templateUrl:"communityTeamList.html",scope:{team:"=",invites:"=",messages:"="},link:function(t,e,n){t.addMember=function(){t.newMember={name:"",email:""}},t.cancel=function(){t.newMember=void 0},t.moveUp=function(e){e=t.team.indexOf(e);return-1!=e&&(t.team[e-1]?(t.team.splice(e-1,2,t.team[e],t.team[e-1]),void t.$emit("save-panel")):0)},t.moveDown=function(e){e=t.team.indexOf(e);return-1!=e&&(t.team[e+1]?(t.team.splice(e,2,t.team[e+1],t.team[e]),void t.$emit("save-panel")):0)},t.delete=function(e){"owner"==e.permission?alert("You cannot delete "+e.name+" because they are the community owner."):(e=t.team.indexOf(e),t.team.splice(e,1),t.$emit("save-panel"))},t.deleteInvite=function(e){e=t.invites.indexOf(e);t.invites.splice(e,1),t.$emit("save-panel")},t.save=function(){var e;t.editCommunityTeamForm.$valid&&(e={id:"new",name:"[Pending Invite]",email:t.newMember.email,permission:"full",status:"pending"},t.invites.push(e),t.newMember=null,t.$emit("save-panel"))}}}}])}(),angular.module("patronicity.community.tabs.campaigns",["patronicity.configuration","ngTable","ngTagsInput","ui.router","ui.bootstrap","patronicity.api","user","patronicity.utility"]).directive("communityAdminTabsCampaigns",["api","patronicityConfig","$stateParams","User","$timeout","Dialogs","NgTableParams","$filter","$q",function(l,e,n,a,o,u,i,t,r){return{restrict:"E",templateUrl:e.urlForTemplate("community/admin/tab/campaigns.html"),link:function(r,e,t){var s=n.slug||t.slug;function c(){r.otherParams.isLoading=!0,r.url=jQuery.param(r.paramsURL),l.communityPage.projects.get(r.paramsURL).$promise.then(function(e){return r.sponsorId=e.sponsorID,r.data=e.result,r.total=e.total,r.csvurl=r.url.replace("slug="+s,"exact[SponsorID]="+e.sponsorID+"&exact[Active]=1"),r.toReviewCount=0,r.reviewedCount=0,r.pendingToReviewCount=0,r.friendToReviewCount=0,r.friendReviewedCount=0,r.pendingFriendToReviewCount=0,angular.forEach(r.data,function(e,t){"communityCampaign"==e.displayType&&("applied"==e.SPStatus&&r.toReviewCount++,"pending"==e.SPStatus&&r.pendingToReviewCount++,"approved"!=e.SPStatus&&"rejected"!=e.SPStatus||r.reviewedCount++),"friendsCommunityCampaign"==e.displayType&&("applied"==e.SPStatus&&r.friendToReviewCount++,"pending"==e.SPStatus&&r.pendingFriendToReviewCount++,"approved"!=e.SPStatus&&"rejected"!=e.SPStatus||r.friendReviewedCount++)}),r.otherParams.isLoading=!1,r.tableParams.reload(),r.data})}r.filterused=!1,r.otherParams={isLoading:!1},r.$on("user:login-change",function(e,t){r.isAdmin=a.isAdmin()}),r.reviewStatus=function(t,n,e,a,o){var i,r;"reject"==n?(i="Please enter the reason you are denying this project",r="Deny Project - "+e,"1"==a&&"applied"==o?u.Confirm("<p>Rejecting this campaign will close the campaign and it will no longer be able to receive funds.","Rejection Warning",[{name:"Ok",type:"ok"},{name:"Cancel",type:"cancel"}]).then(function(){u.SingleTextAreaEntry(i,r).then(function(e){l.communityPage.saveCampaigns(s,t,n,e.textAreaEntry).then(function(e){c()},function(e){})})}):u.SingleTextAreaEntry(i,r).then(function(e){l.communityPage.saveCampaigns(s,t,n,e.textAreaEntry).then(function(e){c()},function(e){})})):l.communityPage.saveCampaigns(s,t,n).then(function(e){c()},function(e){})},r.penddingStatus=function(e,t){l.communityPage.setCommunityCampaignsStatus(s,e,t).then(function(e){c()},function(e){})},r.initialCountForloadCampaigns=0,r.tableParams=new i({page:1,count:200,slug:s,filter:{},sorting:{AddedDate:"desc"}},{getData:function(e){var t=r.data;return t&&(e.total(r.total),r.data=t),r.paramsURL=e.url(),0==r.initialCountForloadCampaigns&&(r.initialCountForloadCampaigns++,c()),r.data}}),r.$on("load-sponsors-campaign",function(){c()}),r.noAction=function(e){return"2"!=e&&"3"!=e&&"8"!=e?!0:!1},r.$watch("tableParams.filter()",function(e,t){e&&(r.filterused=!0),e!=t&&r.delayLoad()},!0),r.$watch("tableParams.page()",function(e,t){e!=t&&r.delayLoad()},!0),r.delayLoad=function(e){o(function(){c()},3e3)},r.sponsorZakatStatusApproval=function(e){var t=0,n=0,a=0,o=0,i=0;l.projectAdmin.sponsorZakatStatusApproval(r.sponsorId,e).then(function(e){angular.forEach(e,function(e){""==e[1]||"none"==e[1]?t++:"rejected"==e[1]?n++:"approved"==e[1]?a++:1==e[1].success?o++:0==e[1].success&&i++}),u.Confirm("Campaigns changed: "+o.toString()+", Campaigns failed to change: "+i.toString()+", Campaigns that are approved: "+a.toString()+", Campaigns that are rejected: "+n.toString()+", Campaigns that are not zakat eligible: "+t.toString())},function(e){alert(e)})}}}}]),angular.module("patronicity.community.tabs.insights",["patronicity.configuration","ui.router","ui.bootstrap","patronicity.api","user"]).directive("communityAdminTabsInsights",["api","patronicityConfig","$stateParams",function(e,t,a){return{restrict:"E",templateUrl:t.urlForTemplate("community/admin/tab/insights.html"),link:function(e,t,n){a.slug||n.slug;console.log("insights tabs ")}}}]),function(){var e=angular.module("patronicity.community.tabs.reports",["patronicity.configuration","ui.router","ui.bootstrap","patronicity.api","user"]);e.directive("communityAdminTabsReports",["api","patronicityConfig","$stateParams",function(a,e,o){return{restrict:"E",templateUrl:e.urlForTemplate("community/admin/tab/reports.html"),link:function(t,e,n){o.slug||n.slug;t.getCommunity=function(){t.loading=!0,a.communityPage.communityIDBySlug(t.slug).then(function(e){t.data=e,e=e.sponsor_id,t.loading=!0,t.reports=[],a.projectAdmin.reports.sponsorDonorReport(e,null,null).then(function(e){t.reports=e},function(e){console.error(e)}).finally(function(){t.loading=!1})},function(e){t.loading=!1})},t.getCommunity()}}}]),e.directive("newDonorsReport",["$uibModal","patronicityConfig","api","$window",function(t,e,n,i){return{restrict:"E",template:'<button ng-click="openEditModal()" class="btn btn-sm btn-primary" ng-disabled="buttonDisabled">{{label}}</button>',scope:{sponsorId:"="},link:function(e){e.buttonDisabled=!0,e.label="New Donors",e.openEditModal=function(){var o="/api/projectreports/donorsForSponsor/";t.open({templateUrl:"newDonorsReport.html",controller:["$scope","$uibModalInstance","sponsorId","moment",function(e,t,n,a){e.sponsorId=n,e.ok=function(){e.StartDate?e.StartDate=a(e.StartDate).format("YYYY-MM-DD"):e.StartDate=null,e.EndDate?e.EndDate=a(e.EndDate).format("YYYY-MM-DD"):e.EndDate=null,null==e.StartDate&&null==e.EndDate?i.open(o+e.sponsorId,"_blank"):i.open(o+e.sponsorId+"/"+e.StartDate+"/"+e.EndDate,"_blank"),t.dismiss({})},e.cancel=function(){t.dismiss({})}}],size:"md",resolve:{sponsorId:function(){return e.sponsorId}}})}}}}])}(),angular.module("patronicity.community.tabs.resources",["patronicity.configuration","ui.router","ui.bootstrap","patronicity.api","user"]).directive("communityAdminTabsResources",["api","patronicityConfig","$stateParams",function(e,t,a){return{restrict:"E",templateUrl:t.urlForTemplate("community/admin/tab/resources.html"),link:function(e,t,n){a.slug||n.slug;console.log("resources tabs ")}}}]),function(){var e=angular.module("patronicity.configuration",["mv.configuration","mv.facebook","patronicity.utility","vcRecaptcha"]);e.provider("patronicityConfig",function(){return{options:{templateOverrides:{},templateBasePath:"//media.launchgood.com/06bc2411f7284f2a6f474e36ab2b263173b8c480/templates/"},setApplication:function(e){"patronicity"==(this.options.application=e)&&(this.options.templateOverrides={"start-project/start-project.html":"//media.launchgood.com/06bc2411f7284f2a6f474e36ab2b263173b8c480/templates/start-project-pt.html","home.html":"home.html"})},$get:["$log",function(e){return this.setApplication("launchgood"),{templateOverrides:this.options.templateOverrides,templateBasePath:this.options.templateBasePath,applicationName:"launchgood",urlForTemplate:function(e){var t=this.templateBasePath+e;return t=this.templateOverrides[e]?this.templateOverrides[e]:t},databaseEndpointUrl:function(e){return"/project/data/"+e},apiEndpointURL:function(e){return"/api/"+e}}}]}}),e.config(["$mvConfigurationProvider","patronicityConfigProvider",function(e,t){e.setTemplateBasePath(t.options.templateBasePath+"mv/")}]),e.config(["$mvFacebookConfigurationProvider",function(e){e.setApplicationID("575274599245723"),e.setRedirectURL("http://launchgood.com"),e.setLoginRequiredScope("email")}]),e.config(["$sceDelegateProvider",function(e){e.resourceUrlWhitelist(["self","http://*.launchgood.com/**","https://*.launchgood.com/**","//*.launchgood.com/**","http://*.patronicity.com/**","https://*.patronicity.com/**","//*.patronicity.com/**"])}]),e.config(["vcRecaptchaServiceProvider",function(e){e.setSiteKey("6LcPeL4ZAAAAALW8Fppbnh41cQUrw742AvnyZx4u"),e.setTheme("light"),e.setSize("invisible"),e.setType("image"),e.setLang("en"),e.setBadge("inline")}])}(),function(){var e=angular.module("patronicity.contentful",["patronicity.api","user","patronicity.configuration","ui.router","patronicity.clubs","patronicity.lgx.dialogs","patronicity.giving.factory"]);e.factory("contentful",function(){if(window.contentful)return window.contentful.createClient({space:"svltlb1ky1ti",accessToken:"VKaKj9cGGuJ5lgCxTVych8ny-vGF3HGP_cow0828Yuk"});throw new Error("Contentful API not loaded! (did you include it from CDN?")}),e.directive("contentfulPromoBannerPosition",["contentful","$timeout",function(a,o){return{restrict:"A",scope:!0,link:function(t,e,n){n=n.contentfulPromoBannerPosition;a.getEntries({"fields.position":n,content_type:"promoBanner"}).then(function(e){o(function(){if(!e.items.length)throw new Error("CMS: Expected 1 entry but no entries found");if(1<e.items.length)throw new Error("CMS: Expected 1 entry but "+e.length+" entries returned");t.entry=e.items[0],t.entry.fields.hideBlock&&(t.hideBlock=t.entry.fields.hideBlock),t.backgroundImage=t.entry.fields.backgroundImage,t.mobileBackgroundImage=t.entry.fields.mobileBackgroundImage,t.entry.fields.isGradient?t.titleTextColor={background:t.entry.fields.titleTextColor.fields.value,"-webkit-background-clip":"text","-webkit-text-fill-color":"transparent","background-clip":"text","text-fill-color":"transparent"}:t.titleTextColor={color:t.entry.fields.titleTextColor.fields.value},t.ctaTextColor=t.entry.fields.ctaTextColor.fields.value,t.ctaBackground=t.entry.fields.ctaBackground.fields.value,t.secondCta=t.entry.fields.secondCta,t.entry.fields.secondCta&&(t.secondCtaTextColor=t.entry.fields.secondCtaTextColor.fields.value,t.secondCtaBackground=t.entry.fields.secondCtaBackground.fields.value),t.entry.fields.subtitle&&(t.subtitleColor=t.entry.fields.subtitleColor.fields.value)})},0)}}}]),e.directive("contentfulTopicCards",["contentful","$timeout",function(a,o){return{restrict:"A",scope:!0,link:function(t,e,n){n=n.contentfulTopicCards;t.topicOrder=[],a.getEntries({"fields.location":n,content_type:"topicCards"}).then(function(e){o(function(){e.items.forEach(function(e){t.topicOrder[e.fields.topicOrder]=e},0)})})}}}]),e.directive("contentfulFeaturedListType",["contentful","$timeout",function(a,o){return{restrict:"E",link:function(t,e,n){n=n.contentfulFeaturedListType;a.getEntries({"fields.type":n,content_type:"featuredList"}).then(function(e){o(function(){e.items.forEach(function(e){t.contentfulListId=e.fields.id},0)})})}}}]),e.directive("contentfulText",["contentful","$timeout",function(a,o){return{restrict:"A",scope:!0,link:function(t,e,n){n=n.contentfulText;a.getEntries({"fields.location":n,content_type:"text"}).then(function(e){o(function(){t.entry=e.items[0]},0)})}}}]),e.directive("contentfulCta",["contentful","$timeout",function(a,o){return{restrict:"A",scope:!0,link:function(t,e,n){n=n.contentfulCta;a.getEntries({"fields.location":n,content_type:"cta"}).then(function(e){o(function(){t.entry=e.items[0],t.hideElement=!0,t.entry&&(t.hideElement=!1,t.ctaTextColor=t.entry.fields.ctaTextColor.fields.value,t.ctaBackground=t.entry.fields.ctaBackground.fields.value,t.entry.fields.svgIcon.content[0]&&(t.svgIcon=t.entry.fields.svgIcon.content[0].content[0].value))},0)})}}}]),e.directive("contentfulLeaderboard",["contentful","$timeout",function(a,o){return{restrict:"A",scope:!0,link:function(t,e,n){n=n.contentfulLeaderboard;a.getEntries({"fields.location":n,content_type:"leaderboard"}).then(function(e){o(function(){t.entry=e.items[0],t.winners=t.entry.fields.winners},0)})}}}]),e.directive("contentfulHideItem",["contentful","$timeout",function(o,i){return{restrict:"A",scope:!0,link:function(t,e,n){var n=n.contentfulHideItem,a=e;o.getEntries({"fields.location":n,content_type:"hideItem"}).then(function(e){i(function(){e.items[0]?(t.entry=e.items[0],a[0].style.display="none"):a[0].style.display="revert"},0)})}}}]),e.directive("contentfulImage",["contentful","$timeout",function(a,o){return{restrict:"A",scope:!0,link:function(t,e,n){n=n.contentfulImage;a.getEntries({"fields.location":n,content_type:"image"}).then(function(e){o(function(){t.entries=e.items},0)})}}}]),e.directive("contentfulEmployee",["contentful","$timeout",function(a,o){return{restrict:"A",scope:!0,link:function(t,e,n){n=n.contentfulEmployee;a.getEntries({"fields.teamName":n,content_type:"employee"}).then(function(e){o(function(){t.entries=e.items},0)})}}}])}(),angular.module("patronicity.countdown",[]).directive("countdown",["$interval",function(o){return{restrict:"E",scope:{endDate:"@"},template:"{{outputString}}",link:function(r,e,s){r.outputString="";var c,l=void 0===s.unitTrailing?"left":s.unitTrailing,u=s.endMessage||"",t=null;function n(){var e=new Date,t=c-e;e=t,e=Math.floor(e/1e3),n=Math.floor(e/86400),e-=86400*n,a=Math.floor(e/3600),e-=3600*a,o=Math.floor(e/60);var n,a,o,i=function(e){var t={value:-1,units:"unknown"};0===e.days?0<e.hours?(t.value=e.hours,t.units="hour"):0<e.minutes?(t.value=e.minutes,t.units="minute"):(t.value=e.seconds,t.units="second"):(t.value=e.days,t.units="day");1!=t.value&&(t.units+="s");return t}({days:n,hours:a,minutes:o,seconds:e-=60*o});switch(s.resultType){case"units":r.outputString=t<0?u:""+i.units+l;break;case"value":r.outputString=t<0?"":i.value;break;default:r.outputString=i.value+" "+i.units+l}}function a(){t&&(o.cancel(t),t=null)}l.length&&(l=" "+l),r.$watch("endDate",function(e){if(void 0!==e&&e.length)try{c=new Date(r.endDate),n(),a(),t=o(function(){n()},1e3)}catch(e){}}),r.$on("$destroy",function(){a()})}}}]),function(){var e=angular.module("patronicity.credit_card",["mv.billing","mv.widgets","patronicity.configuration","patronicity.payment_providers","vcRecaptcha","patronicity.sentry"]);e.directive("creditCardForm",["$stateParams","api","patronicityConfig","$q","stripeOldApi","wepayApi","bluesnapApi","flutterwaveApi","adyenApi","cliqApi","User","$timeout","vcRecaptchaService","$sentry",function(e,p,i,m,r,s,g,f,h,y,v,b,c,l){return{restrict:"E",templateUrl:function(e,t){var n="",n=void 0!==t.templateUrl?t.templateUrl:"credit-card-form.html";return i.urlForTemplate(n)},scope:{settings:"=?",isGuest:"=",cardRequired:"=",cardSelected:"&",mode:"@"},link:function(d,e,t){var n,a=t.btnLabel||"Continue",t="payment"==(t.mode||"payment");function o(c){var t={number:d.data.card.number,exp_month:d.data.card.expirationMonth,exp_year:d.data.card.expirationYear,cvc:d.data.card.cvv,name:d.data.card.name,email:d.data.email,address_line1:d.data.address.street,address_line2:d.data.address.street2,address_city:d.data.address.city,address_state:d.data.address.state,address_zip:d.data.address.zip,address_country:d.data.address.country},l=(d.data.adding=!0,[]),u=(v.getPaymentProviderTypes().forEach(function(e){switch(e){case"stripe":l.push(r.createToken(t));break;case"wepay":l.push(s.createToken(t));break;case"bluesnap":l.push(g.createToken(t));break;case"flutterwave":l.push(f.createToken(t));break;case"adyen":l.push(h.createToken(t));break;case"cliq":l.push(y.createToken(t))}}),m.all(l).then(function(e){t=d.data.card.number.replace(/\D/g,"").substr(-4),n=parseInt(d.data.card.expirationMonth)<10?"0"+d.data.card.expirationMonth:""+d.data.card.expirationMonth,a=""+parseInt(d.data.card.expirationYear);var t,n,a,i,o=d.data.card.type+"|"+t+"|"+n+a,r=[],s=[];u=null,e.forEach(function(e){e.success?r.push({token:e.token,type:e.type,digest:o}):s.push(e)}),r.length==l.length?(i={Name:d.data.card.name,Address:d.data.address.street,Address2:d.data.address.street2,City:d.data.address.city,State:d.data.address.state,Zip:d.data.address.zip,Country:d.data.address.country},m(function(t,n){d.isGuest?p.user.guest.create(d.data.email,d.data.card.name).then(function(e){t({type:e.type,id:e.id,isGuest:!0,hash:e.hash})},function(e){d.data.errors=[{message:e,code:-101,type:"Guest User"}],n(e)}):v.get().then(function(){v.isLoggedIn()?t({type:"user",id:v.current().ID,isGuest:!1}):n()},n)}).then(function(o){p.user.cards.add(o.id,r,i,d.data.card.save,!1,o,c).then(function(e){p.user.cards.list(d.settings.username).then(function(e){d.settings.cards=e.cards,d.data.paymentDefault=e.paymentDefault,d.userId=e.userId});var t=d.isGuest,n=d.data.card.name,a=e.Location;d.data.adding=!1,d.data.adding=!1,d.data.errors=[],d.data.email="",d.data.address.street="",d.data.address.street2="",d.data.address.city="",d.data.address.state="",d.data.address.zip="",d.data.card.name="",d.data.card.number="",d.data.card.type="",d.data.card.expirationMonth="",d.data.card.expirationYear="",d.data.card.cvv="",d.data.card.save=!d.isGuest,d.newCardInformationForm.$setPristine(),d.toggleCardForm(),d.cardSelected({card:e,userId:o.id,guestData:{isGuest:t,type:o.type,hash:o.hash,name:n,location:a}})},function(e){d.data.errors=[{message:e,code:-101,type:"card"}],d.data.adding=!1,d.recaptchaBoolean&&d.recaptcha_expires()})},function(){alert("Unable to get the user id!")})):(d.data.errors=s,d.data.adding=!1,d.recaptchaBoolean&&d.recaptcha_expires())},function(e){d.data.adding=!1,d.recaptchaBoolean&&d.recaptcha_expires()}));b(function(){u&&console.log("10 seconds exceeded on tokenization")},1e4)}d.settings||(d.settings={cardListShown:!1,cardFormShown:!1,cards:[],username:null}),d.recaptchaBoolean=!1,v.get().then(function(){d.recaptchaBoolean=v.isRecaptchaActive(),void 0!==v.getPaymentProviderTypes()&&0<=v.getPaymentProviderTypes().indexOf("adyen")&&h.calculateFingerprint().then(function(e){0})}),d.data={adding:!1,button_label:a,errors:[],email:"",allowSaveChange:t,address:{street:"",street2:"",city:"",state:"patronicity"===i.applicationName?"AL":"",zip:"",country:""},card:{name:"",number:"",type:"",expirationMonth:"",expirationYear:"",cvv:"",save:!d.isGuest},paymentDefault:"none"},d.continueWithNewCard=function(e,t,n){d.$emit("add-card:added",e)},d.toggleCardList=function(){d.settings.cardListShown=!d.settings.cardListShown},d.toggleCardForm=function(){d.settings.cardFormShown=!d.settings.cardFormShown,d.toggleCardList()},d.$watch("isGuest",function(e){void 0!==e&&(e?(d.data.card.save=!1,d.data.email=""):v.get().then(function(){d.data.email=v.current().Email,d.data.card.save=!0}))}),d.$watch("data.address.country",function(e){d.mvAddressRequiredFields={street:!0,city:!0,country:!0,zip:!0,state:-1!=["CA","US"].indexOf(d.data.address.country)}}),d.submitCardWidgetId=function(e){e.preventDefault(),d.recaptchaBoolean?c.execute(n):o(null)},d.recaptcha_setWidgetId=function(e){n=e},d.recaptcha_setResponse=function(e){o(e)},d.recaptcha_expires=function(){c.reload(n)},d.recaptcha_error=function(){l.log("Recaptcha error!","debug"),c.reload(n)}}}}]),e.directive("cardTypeIcon",[function(){return{restrict:"E",scope:{card:"="},template:'<span style="background-image: url(&quot;https://i.imgur.com/GxhLVeU.png&quot;); height: 21px; width: 36px; background-size: cover; display: inline-flex;" ng-style="cardTypeStyle()"></span>',link:function(t,e,n){t.cardTypeStyle=function(){var e={};return t.card&&(-1!==t.card.type.toLowerCase().indexOf("visa")&&(e={"background-position":"0px"}),-1!==t.card.type.toLowerCase().indexOf("discover")&&(e={"background-position":"36px"}),-1!==t.card.type.toLowerCase().indexOf("amex")&&(e={"background-position":"72px"}),-1!==t.card.type.toLowerCase().indexOf("mastercard")&&(e={"background-position":"110px"})),e}}}}]),e.directive("cardTypeIconLgx",[function(){return{restrict:"E",scope:{card:"="},template:'<span style="background-image: url(&quot;https://i.imgur.com/GxhLVeU.png&quot;); height: 21px; width: 36px; background-size: cover; display: inline-flex;" ng-style="cardTypeStyle()"></span>',link:function(t,e,n){t.cardTypeStyle=function(){var e={};return t.card&&t.card.SimpleDescription&&(-1!==t.card.SimpleDescription.toLowerCase().indexOf("visa")&&(e={"background-position":"0px"}),-1!==t.card.SimpleDescription.toLowerCase().indexOf("discover")&&(e={"background-position":"36px"}),-1!==t.card.SimpleDescription.toLowerCase().indexOf("amex")&&(e={"background-position":"72px"}),-1!==t.card.SimpleDescription.toLowerCase().indexOf("mastercard")&&(e={"background-position":"110px"})),e}}}}])}(),function(){var e=angular.module("patronicity.project.dashboard",["ui.bootstrap","patronicity.api","ngTable","mv.utils","patronicity.configuration"]);e.directive("dashboardSponsor",["api","Dialogs","$filter",function(i,r,s){return{restrict:"E",templateUrl:"dashboardSponsor.html",scope:{sponsorId:"="},link:function(n,e,t){function a(e){n.loadingCount=2,i.dashboardSponsorTotals(e).then(function(e){n.totals=e,n.loadingCount--},function(e){alert(e)}),i.dashboardSponsorInformation(e).then(function(e){n.sponsor=e,n.sponsor.imageUrl=-1!==(e=n.sponsor.imageUrl).indexOf("https")?e:"//media.launchgood.com/06bc2411f7284f2a6f474e36ab2b263173b8c480/"+e,n.loadingCount--,n.tpiTooltip="Total project budget/cost not including the "+n.sponsor.sponsorName+" match. Includes dollars spent, dollars on hand, other grants/funding awarded, in-kind services received in dollar amount and crowdfunded dollars raised."},function(e){alert(e)})}n.$watch("sponsorId",function(e){e&&a(e)}),n.accessors={review:{},approved:{},live:{},completed:{},pipeline:{},rejected:{},all:{}},n.setType=function(e){switch(e){case"live":n.accessors.live.setType(e);break;case"all":n.accessors.all.setType(e);break;case"review":n.accessors.review.setType(e);break;case"approved":n.accessors.approved.setType(e);break;case"completed":n.accessors.completed.setType(e);break;case"pipeline":n.accessors.pipeline.setType(e);break;case"rejected":n.accessors.rejected.setType(e)}};var o=n.$watch("accessors.review",function(){n.setType("review"),o()});n.editBudget=function(){console.log("editing budget");var e,t;r.SingleTextAreaEntry("The current budget is "+(e=n.totals.budget,t="$",s("currency")(e,t))+". Please enter new budget: ","Edit Budget").then(function(e){i.sponsorBudget(n.sponsorId,e.textAreaEntry).then(function(){a(n.sponsorId)})})},n.statsBoxClass=function(){var e="col-md-6 col-xs-6";return e=n.totals&&(n.totals.Jobs||n.totals.Visitors)?"col-md-4 col-xs-4":e}}}}]),e.directive("sponsorProjectList",["api","NgTableParams","$filter","Dialogs",function(i,r,s,c){return{restrict:"E",templateUrl:"sponsorProjectList.html",scope:{sponsorId:"=",listType:"@?",accessor:"=",approvalLevels:"=",paymentLevels:"="},link:function(n,e,t){console.log("loading sponsor project list"),15===n.sponsorId?n.variableInfo={title:"Industry Type",value:"BusinessType"}:15==n.sponsorid||"live"!==n.listType&&"completed"!==n.listType?n.variableInfo={title:"Expected TPI",value:"ExpectedTPI"}:n.variableInfo={title:"TPI",value:"TPI"},n.currencyFilter=function(e,t){return"number"==typeof e?s("currency")(e,t):e},n.projects=[],n.loading=!0,n.allowActionButtons=!0,n.listType||(n.listType="actual"),n.loadData=function(e,t){n.loading=!0,i.sponsorProjects(e,t).then(function(e){o(e)}),i.sponsor.byId(e).then(function(e){n.sponsor=e})},n.loadList=function(e){n.loadData(n.sponsorId,e)};var a,o=function(e){n.projects=e,n.tableParams.page(1),n.tableParams.reload(),n.loading=!1};n.accessor&&(n.accessor.setType=function(e){a=e,n.loadList(e),n.allowActionButtons=!0}),n.approve=function(e){c.Confirm("Are you sure you want to APPROVE this project?","Approve Project").then(function(){i.sponsorStatus(n.sponsorId,e,"approved").then(function(){n.loadList(a)})})},n.reject=function(e){c.Confirm("Are you sure you want to REJECT this project?","Reject Project").then(function(){i.sponsorStatus(n.sponsorId,e,"rejected").then(function(){n.loadList(a)})})},n.review=function(e){c.Confirm("Are you sure you want to mark this project for sponsor review?","Review Project").then(function(){i.sponsorStatus(n.sponsorId,e,"review").then(function(){n.loadList(a)})})},n.resetApproval=function(e){c.Confirm("Are you sure you want to return this project to the pipeline for sponsor review?","Return to Pipeline").then(function(){i.sponsor.resetApproval(n.sponsorId,e).then(function(){n.loadList(a)})})},n.reloadList=function(){n.loadList(a)},n.tableParams=new r({page:1,count:100},{getData:function(e){var t=n.projects,t=e.filter()?s("filter")(t,e.filter()):t;return t=e.orderBy()?s("orderBy")(t,e.orderBy()):t,e.total(t.length),t=t.slice((e.page()-1)*e.count(),e.page()*e.count())}})}}}]),e.directive("projectNotes",["api","$uibModal","patronicityConfig",function(a,o,i){return{restrict:"EA",template:'<button class="btn btn-primary" ng-click="showNotesModal()">Notes{{noteCountLabel()}}</button>',scope:{projectId:"=",noteCount:"="},replace:!0,link:function(t,e,n){t.noteCountLabel=function(){var e="";return e=0<t.noteCount?"("+t.noteCount+")":e},t.showNotesModal=function(){o.open({templateUrl:i.urlForTemplate("project-notes-modal.html"),controller:["$scope","$uibModalInstance","projectId",function(t,e,n){t.addingNote=!1,t.note="",t.loadNotes=function(){a.viewNotes(n,"sponsor").then(function(e){t.notes=e},function(e){console.log("couldn't load notes!")})},t.loadNotes(),t.cancel=function(){e.close()},t.ok=function(){e.close()},t.newNote=function(){t.addingNote=!0},t.cancelNote=function(){t.addingNote=!1},t.saveNote=function(){a.addNote(n,"sponsor-note",t.note).then(function(e){t.addingNote=!1,t.note="",t.loadNotes()},function(e){alert(e)})}}],resolve:{projectId:function(){return t.projectId}}})}}}}]),e.directive("togglePaidProject",["api",function(a){return{restrict:"E",template:'<button class="btn" ng-click="togglePaid(level.flag)" ng-class="buttonClass(level.flag)" ng-repeat="level in paymentLevels">{{buttonLabel(level)}}</button>',scope:{projectId:"=",sponsorId:"=",paymentStatus:"@",paymentLevels:"=",paymentFlags:"="},link:function(n,e,t){n.buttonLabel=function(e){var t="Unpaid";return 1<n.paymentLevels.length?t=e.label:"1"==n.paymentStatus&&(t="Paid"),t},n.buttonClass=function(e){var t="";return 1<n.paymentLevels.length&&(t="btn-xs btn-block"),n.paymentStatus&e?t+=" btn-default":t+=" btn-danger",t},n.togglePaid=function(e){a.toggleSponsorPaid(n.projectId,n.sponsorId,e).then(function(e){n.paymentStatus=e},function(e){console.log("couldn't save payment")})}}}}]),e.directive("sponsorLevelApprovalButtons",["api","Dialogs","$q",function(o,i,r){return{restrict:"E",templateUrl:"sponsorLevelApprovalButton.html",scope:{projectId:"=",sponsorId:"=",approvalFlags:"=",rejectFlags:"=",reloadCallback:"&",approvalLevels:"="},link:function(n,e,t){function a(e){var t=r.defer();return o.sponsor.approvalStatus(n.sponsorId,n.projectId,e).then(function(e){n.flags=e.Level,n.updateApproval(),t.resolve()},function(e){console.log("couldn't save level approval")}),t.promise}n.toggleApproval=function(t){o.sponsor.approvalCheck(n.sponsorId,n.projectId,t).then(function(e){e?i.Confirm("This is the final approval. Are you sure you wish to mark this project as approved?","Approve Project").then(function(){a(t).then(function(){n.reloadCallback()})}):a(t)},function(e){console.log("couldn't save level approval")})},n.setApproved=function(t){o.sponsor.approvalCheck(n.sponsorId,n.projectId,t.flag).then(function(e){e?i.Confirm("This is the final approval. Are you sure you wish to mark this project as approved?","Approve Project").then(function(){o.sponsor.approveForLevel(n.sponsorId,n.projectId,t.flag).then(function(e){n.approvalFlags=e.ApprovalFlags,n.rejectFlags=e.RejectFlags,n.reloadCallback()})}):o.sponsor.approveForLevel(n.sponsorId,n.projectId,t.flag).then(function(e){n.approvalFlags=e.ApprovalFlags,n.rejectFlags=e.RejectFlags,n.reloadCallback()})})},n.setRejected=function(t){o.sponsor.rejectCheck(n.sponsorId,n.projectId,t.flag).then(function(e){e?i.Confirm("This is the final reject. Are you sure you wish to mark this project as rejected?","Reject Project").then(function(){o.sponsor.rejectForLevel(n.sponsorId,n.projectId,t.flag).then(function(e){n.approvalFlags=e.ApprovalFlags,n.rejectFlags=e.RejectFlags,n.reloadCallback()})}):o.sponsor.rejectForLevel(n.sponsorId,n.projectId,t.flag).then(function(e){n.approvalFlags=e.ApprovalFlags,n.rejectFlags=e.RejectFlags,n.reloadCallback()})})},n.showApproveAction=function(e){return n.approvalFlags&e.flag},n.showRejectAction=function(e){return n.rejectFlags&e.flag},n.isApproved=function(e){var t=!1;return t=e.flag&n.approvalFlags?!0:t},n.isRejected=function(e){var t=!1;return t=e.flag&n.rejectFlags?!0:t},n.updateApproval=function(){angular.forEach(n.approvalLevels,function(e){e.flag&n.approvalFlags?e.approved=!0:e.approved=!1})},n.updateApproval(),n.buttonClass=function(e){var t="btn-warning";return n.isApproved(e)?t="btn-success":n.isRejected(e)&&(t="btn-danger"),t},n.buttonLabel=function(e){var t="Approve";return t=n.flags&e?"Approved":t}}}}]),e.directive("summaryStats",["api","User","patronicityConfig",function(r,s,e){return{restrict:"E",templateUrl:e.urlForTemplate("summary-stats.html"),scope:{sponsorId:"@?",showMatched:"@",communityId:"@?",customFields:"@?",projectLabel:"@?"},link:function(t,e,n){t.summaryStats={},t.loaded=!1,t.showMatchedField="1"==t.showMatched,t.labels={};n=n.currency||null;function a(){var n=0;return angular.forEach(t.summaryStats.fundedAmount,function(e,t){n+=+e.amount}),n}function o(){t.summaryStats.customFields=t.$eval(t.customFields),angular.forEach(t.summaryStats.customFields,function(e){e.formula&&(e.value=t.$eval(e.formula))})}function i(){t.labels.users={},"launchgood"==s.getApplication()?t.labels.users={zero:"Donors",one:"Donor",other:"Donors"}:t.labels.users={zero:"Patrons",one:"Patron",other:"Patrons"},t.projectLabel&&0<t.projectLabel.length?t.labels.projects=JSON.parse(t.projectLabel):t.labels.projects={zero:"Projects",one:"Project",other:"Projects"}}t.sponsorId?r.sponsor.summaryStats(t.sponsorId).then(function(e){t.summaryStats=e,t.summaryStats.totalFunded=a(),t.customFields&&o(),i(),t.loaded=!0},function(e){console.log("Couldn't get summary stats")}):t.communityId&&r.community.statsForCommunity(t.communityId,n).then(function(e){t.summaryStats=e,t.summaryStats.totalFunded=a(),t.customFields&&o(),i(),t.loaded=!0},function(e){console.log("Couldn't get community summary stats")}),t.currencyCount=function(){if(t.summaryStats&&t.summaryStats.fundedAmount)return Object.keys(t.summaryStats.fundedAmount).length},t.itemClass=function(){return t.showMatchedField||t.customFields?"col-md-3":"col-md-4"},t.groupClass=function(){return t.showMatchedField||t.customFields?"col-md-12":"col-md-8 col-md-offset-2"}}}}]),e.directive("summaryAllStats",["api","patronicityConfig",function(e,t){return{restrict:"E",templateUrl:t.urlForTemplate("summary-all-stats.html"),link:function(t){t.stats={},t.loaded=!1,e.home.footerStats().then(function(e){t.stats=e,t.loaded=!0,console.log(e)})}}}]),e.directive("stats",["api","User","patronicityConfig",function(r,s,e){return{restrict:"A",link:function(t,e,n){function a(){var n=0;return angular.forEach(t.summaryStats.fundedAmount,function(e,t){n+=+e.amount}),n}function o(){t.summaryStats.customFields=t.$eval(t.customFields),angular.forEach(t.summaryStats.customFields,function(e){e.formula&&(e.value=t.$eval(e.formula))})}function i(){t.labels.users={},"launchgood"==s.getApplication()?t.labels.users={zero:"Donors",one:"Donor",other:"Donors"}:t.labels.users={zero:"Patrons",one:"Patron",other:"Patrons"},t.projectLabel&&0<t.projectLabel.length?t.labels.projects=JSON.parse(t.projectLabel):t.labels.projects={zero:"Projects",one:"Project",other:"Projects"}}console.log("stats called"),t.sponsorId=n.sponsorId||null,t.showMatched=n.showMatched||null,t.communityId=n.communityId||null,t.customFields=n.customFields||null,t.projectLabel=n.projectLabel||null,t.summaryStats={},t.loaded=!1,t.showMatchedField="1"==t.showMatched,t.labels={},t.sponsorId?r.sponsor.summaryStats(t.sponsorId).then(function(e){t.summaryStats=e,t.summaryStats.totalFunded=a(),t.summaryStats.fundedAmount.USD.amount=parseFloat(t.summaryStats.fundedAmount.USD.amount),t.customFields&&o(),i(),t.loaded=!0},function(e){console.log("Couldn't get summary stats")}):t.communityId&&r.community.statsForCommunity(t.communityId).then(function(e){t.summaryStats=e,t.summaryStats.totalFunded=a(),t.customFields&&o(),i(),t.loaded=!0},function(e){console.log("Couldn't get community summary stats")}),t.currencyCount=function(){if(t.summaryStats&&t.summaryStats.fundedAmount)return Object.keys(t.summaryStats.fundedAmount).length},t.itemClass=function(){return t.showMatchedField||t.customFields?"col-md-3":"col-md-4"},t.groupClass=function(){return t.showMatchedField||t.customFields?"col-md-12":"col-md-8 col-md-offset-2"}}}}]),e.directive("sponsorInfoPopup",["$uibModal",function(a){return{restrict:"E",template:'<button class="btn btn-primary" ng-click="showSponsorInfoModal()">View</button>',scope:{projectId:"="},link:function(e,t,n){e.showSponsorInfoModal=function(){a.open({templateUrl:"sponsor-info-modal.html",controller:["$scope","$uibModalInstance","projectId",function(e,t,n){e.projectId=n,e.cancel=function(){t.close()},e.ok=function(){t.close()}}],resolve:{projectId:function(){return e.projectId}},backdrop:"static"})}}}}]),e.directive("adminFormPopup",["$uibModal",function(a){return{restrict:"E",template:'<button class="btn btn-primary" ng-click="showSponsorInfoModal()">Open Form</button>',scope:{projectId:"="},link:function(e,t,n){e.showSponsorInfoModal=function(){a.open({templateUrl:"admin-form-modal.html",controller:["$scope","$uibModalInstance","projectId",function(e,t,n){e.projectId=n,e.cancel=function(){t.close()},e.ok=function(){t.close()}}],resolve:{projectId:function(){return e.projectId}},backdrop:"static"})}}}}]),e.directive("pipelinePriority",["api",function(a){return{restrict:"E",template:'<div class="fire" ng-class="buttonClass()"><span class="glyphicon glyphicon-fire"  ng-click="togglePipelinePriority()"></span></div>',scope:{projectId:"=",sponsorId:"=",isPriority:"="},link:function(t,e,n){t.togglePipelinePriority=function(){t.isPriority=!0,a.sponsor.togglePipelinePriority(t.projectId,t.sponsorId).then(function(e){t.isPriority=e},function(e){console.log("Couldn't toggle the priority")})},t.buttonClass=function(){var e="fire-off";return e=t.isPriority?"fire-on":e}}}}])}(),function(){var e=angular.module("patronicity.discover",["ui.bootstrap","patronicity.api","user","patronicity.configuration"]);e.directive("discoverProjects",["User","patronicityConfig","GivingManager",function(a,e,t){return{restrict:"E",templateUrl:e.urlForTemplate("discover-projects.html"),scope:{userLoggedIn:"@"},link:function(e,t,n){a.get().then(function(){a.isLoggedIn()?e.userLoggedIn=!0:e.userLoggedIn=!1})}}}]),e.directive("newDiscoverProjects",["User","patronicityConfig","api","GeolocationService","mvCountryLoader","CurrencyCodeProvider","$location","$q","$sanitize","$window",function(r,e,s,c,l,u,d,p,m,g){return{restrict:"E",templateUrl:e.urlForTemplate("new-discover-projects.html"),scope:{userLoggedIn:"@"},link:function(i){var t=800,n=/[\/\,\!\\\^\$\{\}\[\]\(\)\.\*\+\?\|\><\-\&\:]/g,e=(i.isMobileView=!1,i.projectCardGridData={},i.activeFilters={},i.discoverFilters=[],i.type="discovery",g.innerWidth<=t&&(i.isMobileView=!0),angular.element(g).on("resize",function(){var e=i.isMobileView;g.innerWidth<=t?i.isMobileView=!0:i.isMobileView=!1,e!=i.isMobileView&&i.$apply()}),i.$on("$destroy",function(){angular.element(g).off("resize")}),i.isLoadingUserInfo=!0,r.get().then(function(){i.userLoggedIn=r.isLoggedIn()}).finally(function(){i.isLoadingUserInfo=!1}),d.search().search),e=(e&&(i.searchTerm=i.displaySearchTerm=e,i.q=o(e)),(e=(e=d.search()["f[]"])&&"string"==typeof e?[e]:e)&&(angular.forEach(e,function(e){var t,e=e.split(":"),n=e[0],e=e[1];"entity"==n||"currency_code"==n||"category"==n?angular.forEach(e.split(","),function(e){i.activeFilters[n]||(i.activeFilters[n]={}),i.activeFilters[n][e]=!0}):("near_me"==n&&(t=e.split("|"))[0]&&t[1]&&(i.latitude=t[0],i.longitude=t[1]),"country_code"==n&&(i.selectedCountry=e),i.activeFilters[n]=!0)}),i.discoverFilters=e),s.categories().then(function(e){i.categoryData=e}),l),a=s.project.bannedCountryCodes();function o(e){return e&&m(e.replace(n,function(e){return e="\\"+e}))}p.all([e,a]).then(function(e){for(var t=e[0],n=e[1],a={},o=0;o<n.length;o++)a[n[o]]=!0;i.countryData=[],i.countryData.push({code:null,name:"All Countries"}),angular.forEach(t,function(e){var t;a[e.Code]||(t={code:e.Code,name:e.Name},i.countryData.push(t),i.selectedCountry&&i.selectedCountry==e.Code&&(i.selectedCountry=t))}),i.selectedCountry||(i.selectedCountry=i.countryData[0])}),u.supportedCodes("project").then(function(e){i.currencies=e,angular.forEach(i.currencies,function(e){e.label=e.symbol+" "+e.code})}),i.toggleMobileFilterView=function(){i.showMobileFilter=!i.showMobileFilter},i.resetFilters=function(){i.resetSelectedCountry(),i.resetSearchTerm(),i.activeFilters={},i.editDiscoverFilters()},i.resetSelectedCountry=function(){i.selectedCountry=i.countryData[0]},i.resetSearchTerm=function(){i.q=i.searchTerm=i.displaySearchTerm=null,d.search("search",null)},i.clearSearchTerm=function(){i.searchTerm=i.displaySearchTerm=null,document.getElementById("discover-page-search").focus(),i.resetSearchTerm()},i.searchCampaigns=function(){i.displaySearchTerm=i.searchTerm,i.q=o(i.searchTerm),d.search("search",i.searchTerm)},i.filterCampaignsByCategories=function(e){i.activeFilters.category||(i.activeFilters.category={}),i.activeFilters.category[e.Slug]=!i.activeFilters.category[e.Slug];var t=i.activeFilters.category[e.Slug];"food-water"==e.Slug?i.activeFilters.category.food=t:"other"==e.Slug?i.activeFilters.category.causes=t:"creative"==e.Slug&&(i.activeFilters.category.art=t,i.activeFilters.category.technology=t,i.activeFilters.category.fashion=t,i.activeFilters.category["film-video"]=t,i.activeFilters.category.music=t,i.activeFilters.category.publishing=t),i.editDiscoverFilters()},i.filterCampaignsByCountry=function(){i.activeFilters.country_code=!0,i.editDiscoverFilters()},i.filterCampaignsByCurrentLocation=function(){i.latitude&&i.longitude?i.editDiscoverFilters():(i.isGeolocationLoading=!0,c.getCurrentPosition().then(function(e){console.log("position: ",e),i.latitude=e.coords.latitude,i.longitude=e.coords.longitude,i.editDiscoverFilters()}).catch(function(e){i.activeFilters.near_me=!1,e&&1==e.code?alert('You have denied Geolocation. Enable the browser access to your location for the "Near me" filter.'):alert("Error locating your location. Please try again.")}).finally(function(){i.isGeolocationLoading=!1}))},i.editDiscoverFilters=function(e){var t,n=[];for(t in i.activeFilters)if("entity"==t||"currency_code"==t||"category"==t){var a,o=[];for(a in i.activeFilters[t])i.activeFilters[t][a]&&o.push(a);0<o.length&&n.push(t+":"+o.join())}else"near_me"==t&&i.activeFilters[t]?n.push(t+":"+i.latitude+"|"+i.longitude):"country_code"==t&&i.activeFilters[t]?i.selectedCountry.code&&n.push(t+":"+i.selectedCountry.code):i.activeFilters[t]&&n.push(t+":"+i.activeFilters[t]);i.discoverFilters=n,d.search("f[]",i.discoverFilters)}}}}]),e.directive("newDiscoverProjectsEngine",["User","patronicityConfig","api","searchApi",function(a,e,o,i){return{restrict:"E",templateUrl:e.urlForTemplate("new-discover-projects-engine.html"),link:function(n){function t(e){return n.isLoading=!0,n.hasError=!1,("Default"==n.selectedEngine?i.searchLegacy({type:"customList",listID:2,limit:10}).then(function(e){angular.forEach(e,function(e){n.cards.push(e)})}).catch(function(e){n.hasError=!0,console.log("error: ",e)}):o.aws["newRecommendationEngine"](e).then(function(e){for(var t in e.recommendations)n.projectIdList.push(t)}).catch(function(e){n.hasError=!0,console.log("error: ",e)})).finally(function(){n.isLoading=!1})}a.get().then(function(){var e;a.loggedIn()&&(e=a.current().ID,console.log("currentUserID: ",e),n.selectedEngine="One",n.projectIdList=[],n.cards=[],t(e).then(function(){}))}),n.loadList=function(){t()},n.searchProjectsByUserID=function(){n.projectIdList=[],n.cards=[],t(n.userIDToSearchBy).then(function(){})}}}}])}(),function(){var e=angular.module("patronicity.geo",["patronicity.api"]);e.service("loadGoogleMapAPI",["$window","$q",function(e,t){var n=t.defer();return e.initGMaps=function(){n.resolve()},(t=document.createElement("script")).src="https://maps.googleapis.com/maps/api/js?key=AIzaSyA2M3mNLZhe6K2FQMV4404qw2-4yD5xZno&libraries=places&callback=initGMaps",document.body.appendChild(t),n.promise}]),e.directive("googlePlace",["loadGoogleMapAPI","$log","$parse","$timeout",function(n,a,o,m){function g(e,t){var n=!0;return angular.forEach(e,function(e){t.types.indexOf(e)<0&&(n=!1)}),n}return{restrict:"EA",require:"ngModel",scope:{details:"=?",street:"=?",city:"=?",state:"=?",zip:"=?",country:"=?",locationChanged:"&?"},link:function(c,l,e,u){var d,p=e.missingFieldUndefined?void 0:"",t=(u||a.error("Missing model!"),{types:["geocode"]});e.locationChanged&&(d=o(e.locationChanged)),n.then(function(){c.gPlace=new google.maps.places.Autocomplete(l[0],t),google.maps.event.addListener(c.gPlace,"place_changed",function(){c.$apply(function(){var t,n,a,o,i,r,s,e=c.gPlace.getPlace();c.details=e,e=e,angular.forEach(e.address_components,function(e){g(["country","political"],e)&&(c.country=e.short_name)}),o=a="",s=r=i=p,angular.forEach(e.address_components,function(e){g(["administrative_area_level_1","political"],e)?i="US"==c.country||"CA"==c.country?e.short_name:e.long_name:g(["locality","political"],e)?r=e.long_name:g(["postal_code"],e)?s=e.long_name:g(["street_number"],e)?o=e.long_name:g(["route"],e)?a=e.long_name:g(["neighborhood","political"],e)?t=e.long_name:g(["postal_town"],e)&&(n=e.long_name)}),(r=r==p&&void 0!==t?t:r)==p&&void 0!==n&&(r=n),0<(e=o).length&&(e+=" "),0<(e+=a).length?c.street=e:c.street=p,c.state=i,c.city=r,c.zip=s,u.$setViewValue(l.val()),m(function(){d&&d(c,{})},1)})})})}}}]),e.factory("GeolocationService",["$q","$window",function(e,a){return{getCurrentPosition:function(){return e(function(t,n){a.navigator.geolocation?a.navigator.geolocation.getCurrentPosition(function(e){t(e)},function(e){n(e)}):n("Geolocation is not supported on this browser")})}}}])}(),function(){var e=angular.module("patronicity.giving.challenge",["ui.bootstrap","patronicity.api","user","patronicity.configuration"]);e.directive("challengeLanding",["patronicityConfig","$stateParams","GivingManager","User","GivingSettingsManager","$state","$window",function(e,r,s,c,l,u,t){return{restrict:"E",scope:{},templateUrl:e.urlForTemplate("giving/challenge/landing.html"),link:function(t,e,n){var a=r.name||n.slug||"friday-givers",o=r.type||n.type||"club";function i(){t.landing.onboardIncompletePosition=void 0,c.get().then(function(){c.isLoggedIn()?l.load(o,a).then(function(e){switch(e.state){case"new_user":t.landing.userJoined=!1;break;case"active":case"inactive":t.landing.userJoined=!0;break;case"incomplete":t.landing.onboardIncompletePosition=e.bestOnboardingState,(t.landing.challenge.chronology.isOpen||t.landing.challenge.chronology.isPending)&&u.go(o+".onboard",{name:a,onboardPosition:e.bestOnboardingState})}},function(){t.landing.userJoined=!1}):t.landing.userJoined=!1})}t.landing={loading:!0,challenge:void 0,onboardIncompletePosition:void 0,userJoined:!1},s.load(o,a).then(function(e){t.landing.challenge=e,t.landing.loading=!1}),t.$on("user:login-change",function(e,t){i()}),t.$on("giving:membership:changed",function(){i()}),i()}}}]),e.directive("challengeTeaser",["$compile","patronicityConfig","$stateParams",function(o,i,r){return{scope:{},restrict:"E",link:function(e,t,n){var a=r.name||n.slug||"ramadan_challenge_2018",n=(r.type||n.type,i.urlForTemplate("challenge/"+a+"/teaser.html"));t.append(o("<ng-include src=\"'"+n+"'\"></ng-include>")(e))}}}]),e.directive("challengeSummary",["$stateParams","$compile","patronicityConfig",function(o,i,r){return{restrict:"E",link:function(e,t,n){var a=o.name||n.slug||"ramadan_challenge_2018",n=(o.type||n.type,r.urlForTemplate("challenge/"+a+"/summary.html"));t.append(i("<ng-include src=\"'"+n+"'\"></ng-include>")(e))}}}]),e.directive("challengeUserSummary",["$stateParams","$compile","patronicityConfig",function(o,i,r){return{restrict:"E",link:function(e,t,n){var a=o.name||n.slug||"ramadan_challenge_2018",n=(o.type||n.type,r.urlForTemplate("challenge/"+a+"/individualSummary.html"));t.append(i("<ng-include src=\"'"+n+"'\"></ng-include>")(e))}}}]),e.directive("challengeComplete",["$stateParams","$compile","patronicityConfig","GivingSettingsManager","GivingManager","User","api","$rootScope",function(s,e,n,c,l,u,d,p){return{restrict:"E",templateUrl:function(e,t){s.name||t.slug;return n.urlForTemplate("challenge/dhul_hijjah_2022/challenge/complete.html")},link:function(a,e,t){var o=s.name||t.slug||"dhul_hijjah_2022",i=s.type||t.type||"challenge";function n(){a.completeSettings.saved=!1,d.user.saveGivingEnrollment(void 0,a.completeSettings.enrollments.ramadan,a.completeSettings.enrollments.dhul_hijjah,a.completeSettings.enrollments.friday_givers).then(function(e){a.completeSettings.processing=!1,a.completeSettings.saved=!0},function(e){a.completeSettings.processing=!1})}function r(e){e=e||!1,u.get().then(function(){var n;a.data.user=u.current(),l.load(i,o,e).then(function(e){a.data.isOpen=e.chronology.isOpen,a.data.dayIndexUnbound=e.chronology.dayIndexUnbound,a.data.userStats.ReferredUserCount=e.user&&e.user.referredUsers?e.user.referredUsers.count:0,a.data.signedUp=e.signedUp}),u.isLoggedIn()&&(n=e||!1,c.load(i,o).then(function(e){e.state&&"active"==e.state&&(a.data.isMember=!0),l.userStats(i,o,n).then(function(e){var t=0;n&&(a.data.userStats.daysDonated=0),a.data.isMember?e.entries.forEach(function(e){e.Donated&&(t+=1)}):t=e.userStats.TotalDonorCount,a.data.userStats.daysDonated=t,a.data.userStats.DonatedAmount=e.userStats.DonatedAmount||0,a.data.userStats.CurrencyCode=e.userStats.CurrencyCode||"USD",a.data.userStats.TotalRaisedBySupportedCampaigns=e.userStats.TotalRaisedBySupportedCampaigns||0,a.data.userStats.challengeCounts=e.challengeCounts||0})}))})}a.isLoggedIn=u.isLoggedIn(),a.completeSettings={processing:!1,enrollments:{},saved:!1},a.data={isMember:!1,user:u.current(),userStats:{daysDonated:0,DonatedAmount:0,CurrencyCode:"USD",ReferredUserCount:0,TotalRaisedBySupportedCampaigns:0,challengeCounts:0}},a.$on("user:login-change",function(e,t){a.data.user=u.current(),a.isLoggedIn=u.isLoggedIn(),r()}),a.pulseData={showMobile:!1},p.$on("grid:selection:changed",function(e,t){a.pulseData.showMobile=!0}),a.closeMobile=function(){a.pulseData.showMobile=!1},p.$on("day:mobileclosed",function(e,t){a.pulseData.showMobile=!1}),a.enrollmentSave=function(){a.completeSettings.processing=!0,u.isLoggedIn()?n():u.loginModal(!1,"lgx","login").then(function(e){n()},function(e){a.completeSettings.processing=!1})},a.$watchCollection("completeSettings.enrollments",function(e){a.completeSettings.saved=!1}),r(),a.loginSignUp=function(e){u.loginModal(!1,"lgx",e).then(function(e){})}}}}]),e.directive("challengeCompleteNonMember",["$stateParams","$compile","patronicityConfig",function(o,i,r){return{restrict:"E",link:function(e,t,n){var a=o.name||n.slug||"ramadan_challenge_2018",n=(o.type||n.type,r.urlForTemplate("challenge/"+a+"/completeNonMember.html"));t.append(i("<ng-include src=\"'"+n+"'\"></ng-include>")(e))}}}]),e.directive("challengeSignup",["$compile","patronicityConfig","GivingManager","$stateParams","User","GivingSettingsManager","$state",function(r,s,c,l,u,d,p){return{restrict:"E",scope:{},link:function(t,e,n){var a=l.name||n.slug||"ramadan_challenge_2018",o=l.type||n.type||"challenge",n=s.urlForTemplate("challenge/"+a+"/signup.html");function i(){var e=l.src;d.join(o,a,e).then(function(e){"idle"!==e.bestOnboardingState&&p.go(o+".onboard",{name:a,onboardPosition:e.bestOnboardingState})})}e.append(r("<ng-include src=\"'"+n+"'\"></ng-include>")(t)),t.data={loading:!0,userCount:0,totalParticipants:0,totalRaised:0,citiesCount:0},c.load(o,a).then(function(e){t.data.loading=!1,t.data.userCount=e.stats.general.memberCount,t.data.totalParticipants=e.stats.general.memberCount,t.data.totalRaised=e.stats.donation.totalAmount,t.data.totalRaisedCurrencyCode=e.stats.donation.totalCurrencyCode,t.data.citiesCount=e.stats.general.citiesCount,t.memberGoal=e.memberGoal,t.signedUp=e.signedUp,t.newMembers=e.stats.general.newMembers,t.memberCount=e.stats.general.memberCount,t.newUserPeriodSuffix=e.stats.general.newUserPeriodSuffix,t.data.chronology={isPending:e.chronology.isPending};e=new Date(e.startDate);e.setSeconds(e.getSeconds()+45),t.data.startDate=e.toISOString()}),t.join=function(){u.isLoggedIn()?i():u.loginModal(!1).then(function(e){i()})},t.isLoggedIn=function(){return u.isLoggedIn()}}}}]),e.directive("challengeBlock",["api","User","$sce","$analytics","$stateParams","GivingManager","GivingSettingsManager",function(e,c,t,n,l,u,d){return{restrict:"E",scope:{},templateUrl:"challengeBlock.html",link:function(e,t,n){var i=l.name||n.slug||"ramadan_challenge_2018",r=l.type||n.type||"challenge",o=[];function s(e,t,n,a){o=[],e<-30?o.push("teaser"):e<=0?a?n?o.push("active"):o.push("pending"):o.push("signup"):(e<t?a?o.push("active"):o.push("signup"):o.push("complete"),o.push("summary"))}function a(e){u.load(r,i,e||!1).then(function(e){var t=e.chronology.dayIndexUnbound,n=e.chronology.totalDays,a=e.chronology.isOpen,o=!1;c.isLoggedIn()?d.load(r,i).then(function(e){switch(e.state){case"new_user":o=!1;break;case"active":case"inactive":o=!0}s(t,n,a,o)},function(){s(t,n,a,o=!1)}):s(t,n,a,o=!1)})}e.showSection=function(e){return 0<=o.indexOf(e)},e.facebookLinked=function(){var e=!1;return e=c&&c.isFacebookLinked()?!0:e},e.$on("user:login-change",function(e,t){a()}),e.$on("giving:membership:changed",function(){a()}),e.$on("giving:event:started",function(){a(!0)}),a(),e.pageDetails={joining:!1},e.viewDetails={showGrid:!1,showBoard:!1},e.currencies=[{code:"USD",symbol:"$"},{code:"CAD",symbol:"$"},{code:"GBP",symbol:""},{code:"CAD",symbol:"$"},{code:"EUR",symbol:""},{code:"AUD",symbol:"$"}],e.symbolForCurrencyCode=function(t){var n;return angular.forEach(e.currencies,function(e){e.code==t&&(n=e.symbol)}),n},e.showStaticFaces=function(){return e.challenge.facebookFriends&&e.challenge.facebookFriends.length<2||!c.isLoggedIn()},e.showLiveFaces=function(){return e.challenge.facebookFriends&&2<=e.challenge.facebookFriends.length}}}}]),e.directive("userBox",["patronicityConfig","$stateParams","$compile","User","api",function(i,r,s,c,e){return{scope:{},restrict:"E",link:function(e,t,n){var a=r.name||n.slug||"ramadan_challenge_2018",n=(r.type||n.type,i.urlForTemplate("challenge/"+a+"/user-box.html"));function o(){e.data.isLoggedIn?e.data.signedUpCheck?e.data.showSignedUpUserBox=!0:e.data.showSignedUpUserBox=!1:e.data.showMenuSandwich=!0}t.append(s("<ng-include src=\"'"+n+"'\"></ng-include>")(e)),e.data={user:c.current(),isLoggedIn:c.isLoggedIn(),signedUpCheck:!1,showSettings:!1,showMenuSandwich:!1},o(),e.$on("giving:membership:changed",function(){o()}),e.$on("user:login-change",function(e,t){o()})}}}]),e.directive("challengePending",["patronicityConfig","$stateParams","GivingManager","$compile","$rootScope",function(i,r,s,c,l){return{restrict:"E",scope:{},link:function(t,e,n){var a=r.name||n.slug||"ramadan_challenge_2018",n=r.type||n.type||"challenge",o=i.urlForTemplate("challenge/"+a+"/pending.html");e.append(c("<ng-include src=\"'"+o+"'\"></ng-include>")(t)),t.data={loading:!0,finished:function(){l.$broadcast("giving:event:started")}},s.load(n,a).then(function(e){t.data.friendCount=e.user.referredUsers.count,t.data.memberGoal=e.memberGoal,t.data.memberCount=e.signedUp;e=new Date(e.startDate);e.setSeconds(e.getSeconds()+45),t.data.startDate=e.toISOString()})}}}]),e.directive("challengeGrid",["patronicityConfig","$stateParams","GivingManager","User","$window","$compile","$state","GivingSettingsManager","$rootScope","$timeout",function(m,g,f,h,y,v,e,b,w,C){return{restrict:"E",scope:{index:"=?"},link:function(o,e,t){var n=g.name||t.slug||"ramadan_challenge_2023",i=g.type||t.type||"challenge",a=t.isPending||!1,r="sitewidegrid"===t.page?m.urlForTemplate("giving/challenge/components/sitewide-grid.html"):m.urlForTemplate("challenge/"+n+"/grid.html"),s=(e.append(v("<ng-include src=\"'"+r+"'\"></ng-include>")(o)),o.url=window.location.pathname,o.challenge=g.name||t.slug||"ramadan_challenge_2023",o.data={selectedIndex:0,dayIndexUnbound:0,entries:[],nonMember:[],isPending:a,userSettings:{currencyCode:"USD",lastTen:!1},userStats:{donatedAmount:0,daysSupported:0}},o.fees={transaction_unit:.3,transaction:.029,platform:.05},[]);function c(a){f.userStats(i,n).then(function(e){o.data.entries=e.entries,o.data.nonMember=e.nonMemberDonations,a&&("/eid"===y.location.pathname?o.setSelectedIndex(o.data.dayIndexUnbound,!0):o.data.dayIndexUnbound>=o.data.totalDays?o.setSelectedIndex(o.data.totalDays-1,!1):o.setSelectedIndex(o.data.dayIndexUnbound,!1),o.$emit("challenge:setMobileView","overview"));var t,n=o.data.entries.length-1;null!=o.data.entries[n]&&o.data.entries[n].DayIndex==o.data.totalDays-1&&o.data.entries[n].Donated,e.userStats&&e.userStats.DonatedAmount&&(o.data.userStats.donatedAmount=e.userStats.DonatedAmount),o.data.userStats.daysSupported=(n=e.entries,t=0,angular.forEach(n,function(e){e.Donated&&t++}),t),u()})}function l(e){var t;return t=o.data.entries&&o.data.entries[e]?o.data.entries[e]:t}function u(){s=[];for(var e=0;e<o.data.totalDays;e++)s.push(o.generateChallengeDayClass(e));C(function(){d()},1e3)}function d(){$(".rc_grid svg g[id^='day']").each(function(){var e=$(this).attr("class");-1!==e.indexOf("supported")?(console.log("found class"),$(this).find("g[id^=filled]").css("display","inline"),$(this).find("g[id^=empty]").css("display","none"),$(this).find("g[id^=missed]").css("display","none")):-1!==e.indexOf("missed")&&($(this).find("g[id^=filled]").css("display","none"),$(this).find("g[id^=empty]").css("display","none"),$(this).find("g[id^=missed]").css("display","inline"))})}o.isActive="inactive",h.get().then(function(){h.isLoggedIn()&&b.load(i,n).then(function(e){var t;o.isActive=e.state,"active"==o.isActive&&(o.data.userSettings.currencyCode=e.currencyCode,1==e.coverFees?o.data.userSettings.goal=parseFloat(e.goal)+(t=e.goal,+(((o.fees.transaction+o.fees.platform)*t+o.fees.transaction_unit)/(1-o.fees.transaction)).toFixed(2)):o.data.userSettings.goal=e.goal,e.lastTen&&"1"==e.lastTen&&(o.data.userSettings.lastTen=!0),u())})}),f.load(i,n).then(function(e){o.data.dayIndexUnbound=e.chronology.dayIndexUnbound,o.data.totalDays=e.chronology.totalDays,e.chronology.isPending?(o.setSelectedIndex(0,!0),u()):c(!0)}),o.$on("challenge:refresh",function(e,t){c(!1)}),o.setSelectedIndex=function(e,t){t||(o.data.selectedIndex=e,w.$broadcast("grid:selection:changed",{index:e,entry:l(e)}))},o.isGridPage=function(){return!(!y.location.pathname.includes("/user/newprofile")&&"/"!==y.location.pathname&&!y.location.pathname.includes("/discover"))},o.clickDay=function(e){"sitewidegrid"===t.page?y.location.href=function(e){var t;if("active"!==e)switch(n){case"dhul_hijjah_2020":case"dhul_hijjah_2021":case"dhul_hijjah_2022":t="/dhc?utm_source=internal&utm_medium=not_logged_in_redirect&utm_campaign=dhc&src=lg_not_logged_in_redirect";break;case"ramadan_challenge_2020":case"ramadan_challenge_2021":case"ramadan_challenge_2022":case"ramadan_challenge_2023":t="/ramadan"}else switch(n){case"dhul_hijjah_2020":case"dhul_hijjah_2021":case"dhul_hijjah_2022":t="/dhchome?utm_source=internal&utm_medium=giving_grid&utm_campaign=leaves&src=lg_giving_grid#!/dhc/pulse";break;default:case"ramadan_challenge_2020":case"ramadan_challenge_2021":case"ramadan_challenge_2023":t="/ramadanhome/#!/ramadan/pulse"}return t}(o.isActive):(o.setSelectedIndex(e),d())},o.$on("grid:selection:set",function(e,t){o.setSelectedIndex(t.index,!1)}),o.generateChallengeDayClass=function(e){var t=[],n=(e<o.data.dayIndexUnbound?t.push("past"):e==o.data.dayIndexUnbound?t.push("current-day"):t.push("future"),l(e));return n?n.Donated?t.push("filled"):void 0!==o.data.nonMember?0<parseInt(o.data.nonMember[e+1].count)?t.push("filled"):0<=t.indexOf("past")&&t.push("missed"):(0<=t.indexOf("past")||o.data.userSettings.lastTen&&e<o.data.totalDays-10&&10<o.data.totalDays)&&t.push("missed"):(0<=t.indexOf("past")&&t.push("missed"),o.data.userSettings.lastTen&&e<o.data.totalDays-10&&o.data.totalDays&&t.push("missed")),e==o.data.selectedIndex&&t.push("active"),t.join(" ")},o.challengeDayClass=function(e){return s[e]},d();$(".dhc_main--giving-impact");var p=$(".dhc_main--giving-impact_scroll-container");$(".impact").first();$(".dhc_grid svg g[id^='day']").each(function(){console.log("found some grid items"),$(this).click(function(){console.log("click happened");var e,t=$(this).attr("data-no"),t=parseInt(t,10);p.find(".impact")&&(e=p.find(".impact").eq(t-1)).attr("data-no")!==t&&(e.position().left,0)})}),o.$watch("index",function(e,t){void 0!==e&&o.clickDay(o.index)})}}}]),e.directive("lastTenDaysAnimation",["patronicityConfig",function(e){return{restrict:"E",scope:{},templateUrl:e.urlForTemplate("giving/challenge/components/last-ten-days-animation.html"),link:function(e,t,n){e.hideTenAnimation=function(e){e}}}}]),e.directive("challengeDaySupportedStatus",["patronicityConfig","GivingManager","$stateParams",function(e,c,l){return{restrict:"E",scope:{selectedDay:"="},templateUrl:e.urlForTemplate("giving/challenge/components/challenge-day-supported-status.html"),link:function(e,t,n){var a,o=l.name||n.slug||"ramadan_challenge_2018",i=l.type||n.type||"challenge";function r(){void 0===a||void 0===e.selectedDay?e.data.status="loading":e.selectedDay<a.length?a[e.selectedDay].Donated?(e.data.status="complete",e.data.statusDescription="supported"):(e.data.status="incomplete",e.data.statusDescription="unsupported"):(e.data.status="future",e.data.statusDescription="is in the future!")}function s(){c.userStats(i,o).then(function(e){a=e.entries,r()})}e.data={status:"loading"},e.$watch("selectedDay",function(e){void 0!==e&&r()}),s(),e.$on("challenge:refresh",function(e,t){s()}),e.back=function(){e.$emit("challenge:setMobileView","overview")}}}}]),e.directive("challengeCampaignCard",["patronicityConfig","$stateParams","GivingManager","GivingProjectRandomizer","ProjectCardManager",function(e,l,u,d,p){return{restrict:"E",scope:{selectedDay:"=",activeMobilePage:"="},templateUrl:e.urlForTemplate("giving/challenge/components/challenge-campaign-card.html"),link:function(n,e,t){var a,o=l.name||t.slug||"ramadan_challenge_2018",i=l.type||t.type||"challenge";function r(e,t){n.data.projectId!=e&&(n.data.loadingProject=!0,n.data.loadingMobileProject=!0,n.data.projectId=e),n.data.donated=t}function s(){console.log(a),void 0!==a&&void 0!==n.selectedDay&&(n.selectedDay>=a.length?n.data.selectedOutOfBounds=!0:(n.data.selectedOutOfBounds=!1,a[n.selectedDay].DonatedProjectID?r(a[n.selectedDay].DonatedProjectID,!0):r(a[n.selectedDay].SponsoredProjectID,!1)))}function c(){u.userStats(i,o).then(function(e){a=e.entries,d.init(e.alternates),s()})}t.src&&p.setSource(t.src),n.data={loadingProject:!0,loadingMobileProject:!0,projectId:0,challengeId:void 0,donated:!1},u.load(i,o).then(function(e){n.data.challengeId=e.id,c()}),n.$on("challenge:refresh",function(e,t){c()}),n.alternateProject=function(){var e=d.nextProject(n.data.projectId);r(a[n.selectedDay].SponsoredProjectID=e,!1)},n.$watch("selectedDay",function(e){s()}),n.projectLoadCompleted=function(e){("main"!=e.type&&"community-card"!=e.type||(n.data.loadingProject=!1,"community-card"==e.type))&&(n.data.loadingMobileProject=!1)}}}}]),e.directive("challengeNextCharge",["api","patronicityConfig","$stateParams","GivingManager",function(e,t,o,i){return{restrict:"E",templateUrl:t.urlForTemplate("giving/challenge/components/next-charge.html"),link:function(t,e,n){var a=o.name||n.slug||"ramadan_challenge_2018",n=o.type||n.type||"challenge";t.finished=function(){},i.load(n,a).then(function(e){t.challenge=e})}}}]),e.directive("givingTimer",["api","patronicityConfig","$stateParams","GivingManager",function(e,t,s,c){return{restrict:"E",scope:{callback:"&?",maxTimeUnit:"@?",loadData:"="},templateUrl:t.urlForTemplate("giving/challenge/components/giving-timer.html"),link:function(n,e,t){var a=s.name||s.slug||t.slug||"friday-givers",o=s.givingType||s.type||t.givingType||"club",i=s.timerType||t.timerType||"start";function r(e,t){c.load(e,t).then(function(e){n.challenge=e,n.lbData.challengeStartDate=e.startDate,n.lbData.challengeEndDate=e.endDate,n.lbData.currentChallengeDayIndex=e.chronology.dayIndexUnbound,n.lbData.leaderboardDayIndex=e.chronology.dayIndexUnbound,n.lbData.leaderboardStartDate=new Date(n.lbData.challengeStartDate),n.lbData.leaderboardStartDate.setDate(n.lbData.leaderboardStartDate.getDate()+e.chronology.dayIndexUnbound),n.lbData.leaderboardEndDate=new Date(n.lbData.leaderboardStartDate.getTime()+8634e4),n.lbData.leaderboardEnd=n.lbData.leaderboardEndDate.toISOString(),n.challenge.nextCharge=e.nextCharge,n.challenge.lastTenStart=e.chronology.lastTenStart,n.challenge.lastTenNext=e.chronology.isLastTenOpen?e.nextCharge:e.chronology.lastTenStart,"start"==i?n.displayDate=n.lbData.challengeStartDate:"end"==i?n.displayDate=n.lbData.challengeEndDate:"next-day"==i?n.displayDate=n.lbData.leaderboardEnd:"next-charge"==i?n.displayDate=n.challenge.nextCharge:"last-ten-next"==i&&(n.displayDate=n.challenge.lastTenNext)})}a.includes("-")&&(a="friday-givers"!==a?a.replace(/-/g,"_"):a),n.lbData={},n.challenge={},n.finished=function(){n.callback&&n.callback()({timerType:t.timerType})},n.maxTimeUnit||(n.maxTimeUnit="day"),r(o,a),t.$observe("slug",function(e){"friday-givers"===e&&(o="club"),e.includes("-")&&(e="friday-givers"!==e?e.replace(/-/g,"_"):e),r(o,e)})}}}]),e.directive("challengeActivePage",["api","Thankyou","$compile","patronicityConfig","completeMessageFactory","$stateParams","GivingManager","$state","ProjectCardManager",function(e,t,r,s,n,c,l,u,d){return{restrict:"E",scope:{},link:function(a,e,t){var o=c.name||t.slug||"ramadan_challenge_2018",i=c.type||t.type||"challenge",t=s.urlForTemplate("challenge/"+o+"/active.html");function n(n){l.load(i,o,n).then(function(e){a.data.totalParticipants=e.stats.general.memberCount,a.data.dayIndexUnbound=e.chronology.dayIndexUnbound,a.data.totalRaised=e.stats.donation.totalAmount,a.data.totalRaisedCurrencyCode=e.stats.donation.totalCurrencyCode,a.data.totalDays=e.chronology.totalDays,a.data.user.friendCount=e.user.referredUsers.count,l.userStats(i,o,n).then(function(e){var t=0;e.entries.forEach(function(e){e.Donated&&(t+=1)}),a.data.entries=e.entries,a.data.user.daysDonated=t,a.data.user.participationPercent=t/a.data.totalDays,n&&a.$broadcast("challenge:refresh"),a.data.entries.length;console.log("total donated days "+a.data.user.daysDonated),a.data.user.daysDonated>=a.data.totalDays?console.log("fully donated"):console.log("need to donate more")}),e.introMessages&&0<e.introMessages.length&&u.go(i+".givingmessage",{name:o})})}e.append(r("<ng-include src=\"'"+t+"'\"></ng-include>")(a)),a.data={showLastTenDaysAnimation:!1,totalParticipants:0,dayIndexUnbound:0,totalRaised:0,totalRaisedCurrencyCode:"USD",totalDays:0,activeMobilePage:"overview",selectedDay:0,user:{daysDonated:0,participationPercent:0,friendCount:0}},a.$on("grid:selection:changed",function(e,t){a.data.selectedDay!=t.index&&(a.data.selectedDay=t.index),a.data.activeMobilePage="pod"}),n(!1),d.setSource("internal_challenge"),a.$on("challenge:donated",function(e,t){n(!0)}),a.$on("challenge:setMobileView",function(e,t){a.setMobileView(t)}),a.setMobileView=function(e){a.data.activeMobilePage=e},a.selectDay=function(e){switch(e){case"next":a.$broadcast("grid:selection:set",{index:a.data.selectedDay+1});break;case"prev":a.$broadcast("grid:selection:set",{index:a.data.selectedDay-1});break;default:a.$broadcast("grid:selection:set",{index:e})}},a.openCatchupModal=function(){u.go("challenge.catchup")}}}}]),e.directive("challengeCatModal",["$compile","$modal","patronicityConfig",function(e,a,o){return{restrict:"EA",scope:{slug:"="},link:function(e,t,n){e.showCatModal=function(){a.open({templateUrl:o.urlForTemplate("challenge/dhul_hijjah_2016/catmodal.html"),controller:["$scope","$modalInstance","slug",function(e,t,n){e.ok=function(){t.close({})}}],size:"md",resolve:{slug:function(){return e.slug}}})},t.on("click",function(){e.showCatModal()})}}}]),e.directive("challengeFriendsModal",["$compile","$modal","patronicityConfig",function(e,a,o){return{restrict:"EA",scope:{slug:"=",users:"="},link:function(e,t,n){e.showFriendsModal=function(){a.open({templateUrl:o.urlForTemplate("challenge/dhul_hijjah_2016/friendListModal.html"),controller:["$scope","$modalInstance","slug","users",function(e,t,n,a){e.users=a,e.ok=function(){t.close({})}}],size:"md",resolve:{slug:function(){return e.slug},users:function(){return e.users}}})},t.on("click",function(){e.showFriendsModal()})}}}]),e.directive("challengeCatchupModal",["$uibModal","patronicityConfig","User","$sce","api","$location","completeMessageFactory","Thankyou","searchApi",function(a,o,e,t,l,u,d,p,m){return{restrict:"EA",link:function(e,t,n){e.showCatchupModal=function(){a.open({templateUrl:o.urlForTemplate("challenge/dhul_hijjah_2017/catch-up.html"),controller:["$scope","$uibModalInstance","slug","challenge",function(n,e,t,a){n.challenge=a,n.selectedMissedCampaign=[],n.catchupDonationCompleted=!1,n.ok=function(){e.close({})},e.result.then(function(){n.$emit("loadStats",n.catchupDonationCompleted)},function(){n.$emit("loadStats",n.catchupDonationCompleted)}),n.cancel=function(){n.$emit("loadStats",r()),e.dismiss()};var o;n.challenge.totalDays;function i(){var e;0<=n.data.selectedIndex&&n.data.selectedIndex<n.data.entries.length?(e=n.data.entries[n.data.selectedIndex],n.data.sponsoredProjectID=e.SponsoredProjectID,n.data.donatedProjectID=e.DonatedProjectID,n.data.activeMobilePage="pod",n.data.alternateProjectId=void 0,n.data.selectedOutOfBounds=!1):(n.data.selectedOutOfBounds=!0,n.data.activeMobilePage="pod",n.data.loadingProject=!1,n.data.loadingMobileProject=!1),0===n.data.selectedIndex?n.data.nextProjectOffset=1:n.data.nextProjectOffset=0}function r(){l.challenges.userStatsForChallenge(n.challenge.id).then(function(e){n.data.entries=e.entries,n.data.userStats=e.userStats,n.data.selectedIndex<0||n.data.selectedIndex>=n.data.entries.length?n.data.selectedIndex=n.challenge.dayIndexUnbound:i(),n.data.entries[9]&&n.data.entries[9].DonatedProjectID&&d.showCompleteMessageModal(n.slug,n.urls,n.challenge)},function(e){alert(e)})}function s(){l.challenges.userStatsForChallenge(n.challenge.id).then(function(e){n.data.entries=e.entries,n.missedCampaigns=[];for(var t=n.data.entries.length;0<=t;t--)n.data.entries[t]&&n.data.entries[t]&&(n.data.entries[t].Status||n.missedCampaigns.push(n.data.entries[t]))})}n.data={entries:[],selectedIndex:-1,sponsoredProjectID:void 0,donatedProjectID:void 0,activeMobilePage:"overview",nextProjectOffset:0,alternateProjectId:void 0,loadingProject:!0,loadingMobileProject:!0,selectedOutOfBounds:!1,userStats:[],previousSelectedProjectID:void 0,resentQuery:!1,alternateProjectList:[]},n.showMessageFinal=function(){d.showCompleteMessageModal(n.slug,n.urls,n.challenge)},s(),n.setSelectedIndex=function(e){n.data.selectedIndex=e,n.data.activeMobilePage="pod"},n.$on("donation:completed",function(e,t){n.donationCompleted(t)}),n.$on("challenge:donated",function(e){r()}),n.$watch("data.selectedIndex",function(e,t){e!==t&&(n.data.previousSelectedProjectID===n.projectIdForDayIndex(e)||n.data.alternateProjectId==n.projectIdForDayIndex(e)?(n.data.loadingProject=!1,n.data.loadingMobileProject=!1,i()):(n.data.loadingProject=!0,n.data.loadingMobileProject=!0,i(),n.projectIdForDayIndex(e)&&(n.data.previousSelectedProjectID=n.projectIdForDayIndex(e))))}),n.$on("loadStats",function(e,t){t&&location.reload()}),n.setMobileView=function(e){n.data.activeMobilePage=e},n.alternateProject=function(e){for(n.data.loadingProject=!0,n.data.loadingMobileProject=!0;o=void 0===o?0:(o+1)%n.data.alternateProjectList.length,e==n.data.alternateProjectList[o].ID;);n.missedCampaigns[e].SponsoredProjectID=n.data.alternateProjectList[o].ID,n.currentMissedCampaign=n.missedCampaigns[e].dayIndex},n.getAlternateList=function(){var e={type:"challenge_alternate",limit:1e3,offset:0,category:void 0,param1:n.challenge.id};m.searchLegacy(e).then(function(e){n.data.alternateProjectList=e})},n.getAlternateList();n.projectIdForDayIndex=function(e){var t=null;return t=n.data.entries&&n.data.entries[e]?n.data.entries[e].DonatedProjectID||n.data.alternateProjectId||n.data.entries[e].SponsoredProjectID:t},n.donationCompleted=function(e){p.showModal(e.id),n.catchupDonationCompleted=!0,s(),n.data.activeMobilePage="overview"},n.raisedInUSD=(a=n.challenge.stats,c=0,angular.forEach(a,function(e){"USD"==e.CurrencyCode&&(c=e.Amount)}),c),n.projectLoadCompleted=function(e){"main"==e.type?n.data.loadingProject=!1:n.data.loadingMobileProject=!1},r();var c,a=u.search();a.did&&n.donationCompleted({id:a.did}),""!==u.path()&&(a=parseInt(u.path().substring(1),10),isNaN(a)||n.setSelectedIndex(a-1)),n.numberOrZero=function(e){return Math.max(0,e)}}],windowClass:"catchupModal",resolve:{slug:function(){return e.slug},challenge:function(){return e.challenge}}})},t.on("click",function(){e.showCatchupModal()})}}}]),e.directive("completeMessage",["$compile","patronicityConfig","User","completeMessageFactory","api","$window",function(e,t,a,n,o,i){return{restrict:"E",templateUrl:t.urlForTemplate("challenge/dhul_hijjah_2017/complete-message.html"),link:function(t,e,n){t.user=a.current(),t.userStats,i.doTheConfetti(),t.isLoggedIn=a.isLoggedIn(),t.signedUpCheck=t.challenge.currentUserSignedUp,o.challenges.userStatsForChallenge(t.challenge.id).then(function(e){t.userStats=e}),t.userEmail=a.isLoggedIn()?a.current().Email:""}}}]),e.factory("completeMessageFactory",["$uibModal","patronicityConfig","User","$sce",function(r,e,t,n){return{showCompleteMessageModal:function(e,t,n){var a,o,i;a=e,o=t,i=n,r.open({template:"<complete-message></complete-message>",controller:["$scope","$uibModalInstance","slug","urls","currentChallenge",function(e,t,n,a,o){e.challenge=o,e.ok=function(){t.close({})},console.log("message factory")}],windowClass:"completeMessageModal",resolve:{slug:function(){return a},urls:function(){return o},currentChallenge:function(){return i}}})}}}])}(),function(){var e=angular.module("patronicity.clubs",["ui.bootstrap","patronicity.api","user","patronicity.configuration","ui.router","patronicity.common.currency","patronicity.giving.factory","patronicity.giving.common"]);e.directive("clubUserBar",["patronicityConfig","$stateParams","User","GivingManager","GivingSettingsManager",function(e,r,s,c,l){return{restrict:"E",templateUrl:e.urlForTemplate("giving/clubs/parts/user-bar.html"),link:function(n,e,t){var a=r.name||t.slug||"friday-givers",o=r.type||t.slug||"club";function i(){var t;s.isLoggedIn()?(t=s.current(),l.load(o,a).then(function(e){n.barSettings.user={FirstName:t.FirstName,signupDate:e.signupDate,goal:e.goal,goalAndTip:parseFloat(e.tip)+parseFloat(e.goal)||e.goal,currencySymbol:e.currencySymbol,currencyCode:e.currencyCode,state:e.state,type:o,method:e.method,onboardIncompletePosition:e.bestOnboardingState}},function(){n.barSettings.user=void 0})):n.barSettings.user=void 0}n.barSettings={user:void 0},n.settingsUrl="user/newprofile#!/user-profile/auto-giving-and-challenges/"+s.current().UserName+"/"+o+"/"+a+"/settings",c.load(o,a).then(function(e){n.barSettings.periodAbbreviation=e.stats.general.periodAbbreviation}),n.$on("giving:membership:changed",function(){i()}),n.$on("user:login-change",function(){i()}),i()}}}]),e.directive("clubGivingAbout",["$state",function(e){return{restrict:"E",templateUrl:"clubGivingAbout.html"}}]),e.directive("clubNextCharge",["api","patronicityConfig","$stateParams","GivingManager",function(e,t,o,i){return{restrict:"E",templateUrl:t.urlForTemplate("giving/clubs/parts/next-charge.html"),link:function(t,e,n){var a=o.name||n.slug||"friday-givers",n=o.type||n.type||"club";t.finished=function(){},t.CopyRightDate=new Date,i.load(n,a).then(function(e){t.club=e})}}}]),e.directive("clubGivingHistory",["patronicityConfig","$stateParams","GivingManager",function(e,o,i){return{restrict:"E",templateUrl:e.urlForTemplate("giving/clubs/parts/giving-history.html"),link:function(t,e,n){t.club={};var a=o.name||n.slug||"friday-givers",n=o.type||n.type||"club";i.load(n,a).then(function(e){t.club=e})}}}]),e.directive("clubLanding",["patronicityConfig","$stateParams","User","GivingManager","GivingSettingsManager","$state","$compile","$dialog","givingDialogs",function(r,s,c,l,u,d,p,m,g){return{restrict:"E",link:function(n,e,t){var a=s.name||t.slug||"friday-givers",o=s.type||t.type||"club",t=r.urlForTemplate("giving/clubs/"+a+"/landing.html");function i(){n.landing.onboardIncompletePosition=void 0,c.isLoggedIn()?u.load(o,a).then(function(e){switch(e.state){case"new_user":n.landing.userJoined=!1;break;case"active":case"inactive":n.landing.userJoined=!0;break;case"incomplete":n.landing.onboardIncompletePosition=e.bestOnboardingState,(n.landing.club.chronology.isOpen||n.landing.club.chronology.isPending)&&d.go(o+".onboard",{name:a,onboardPosition:e.bestOnboardingState})}},function(){n.landing.userJoined=!1}):n.landing.userJoined=!1}e.append(p("<ng-include src=\"'"+t+"'\"></ng-include>")(n)),n.landing={club:{name:"Loading",creatorName:"Loading"},onboardIncompletePosition:void 0,userJoined:!1,currentTab:"history"},n.data={type:o},l.load(o,a).then(function(e){n.landing.club=e}),n.CopyRightDate=new Date,n.$on("giving:navigate",function(e,t){void 0!==t.tab&&(n.landing.currentTab=t.tab,$("html,body").animate({scrollTop:$("#club-tab-area").offset().top},"slow"))}),n.$on("user:login-change",function(e,t){i()}),n.$on("giving:membership:changed",function(){i()}),i(),n.openAutoDialog=function(){m.show({template:'<p-dlg-join-auto slug="'+a+'" type="'+o+'"></p-dlg-join-auto>'}).then(function(e){1==e&&m.show({template:'<giving-welcome type="'+o+'" slug="'+a+'"></giving-welcome>'})})},n.goToQuit=function(){g.showQuit(s)}}}}]),e.directive("stringToNumber",function(){return{require:"ngModel",link:function(e,t,n,a){a.$parsers.push(function(e){return""+e}),a.$formatters.push(function(e){return parseFloat(e)})}}}),e.directive("clubConfirmCancellation",["patronicityConfig","$stateParams","User","GivingManager","GivingSettingsManager","$state",function(e,o,t,i,n,a){return{restrict:"E",scope:{},templateUrl:e.urlForTemplate("giving/clubs/confirm-cancellation.html"),link:function(t,e,n){var a=o.name||n.slug||"friday-givers",n=o.type||n.type||"club";i.load(n,a).then(function(e){t.landing.club=e}),t.landing={},t.userOptOut=!1}}}]),e.directive("optOutButton",["patronicityConfig","User","GivingSettingsManager","$state","$stateParams","$analytics","api",function(e,o,t,n,i,a,r){return{restrict:"E",scope:{optoutstatus:"=",title:"@"},templateUrl:"optOutButton.html",link:function(t,e,n){i.name||n.slug,i.type||n.type;function a(){r.user.saveGivingEnrollment(void 0,t.settings.ramadan,t.settings.dhul_hijjah,!1,"friday_givers").then(function(e){t.optoutstatus=!0})}t.user=o.current(),o.isCountryEU()?t.settings={ramadan:!1,dhul_hijjah:!1,friday_givers:!1}:t.settings={ramadan:!0,dhul_hijjah:!0,friday_givers:!0},r.user.getGivingEnrollment().then(function(e){angular.forEach(e,function(e){t.settings[e.type]=1==e.value})}),t.optout=function(){o.isLoggedIn()?a():o.loginModal(!1).then(function(e){a()})}}}}])}(),function(){var e=angular.module("patronicity.clubs.timeline",["patronicity.api","user","patronicity.configuration","ui.router","patronicity.clubs","patronicity.giving.factory"]);e.directive("clubTimeline",["api","patronicityConfig","$stateParams","GivingManager",function(o,e,i,r){return{restrict:"E",templateUrl:e.urlForTemplate("giving/clubs/parts/timeline.html"),link:function(t,e,n){var a=i.name||n.slug||"friday-givers",n=i.type||n.type||"club";t.data={},t.timeline=[],t.maxShown=3;t.viewMore=function(){t.maxShown+=5},r.load(n,a).then(function(e){t.data={clubId:e.id,nextCharge:e.nextCharge,periodDonationAmount:e.stats.general.periodDonationAmount,currencySymbol:e.stats.donation.totalCurrencySymbol,memberCount:e.stats.general.memberCount},e=t.data.clubId,o.clubs.timeline(e).then(function(e){t.timeline=e},function(e){console.log("Couldn't load timeline"),console.log(e)})})}}}]),e.directive("clubTimelineGroup",function(){return{restrict:"E",templateUrl:"clubTimelineGroup.html",scope:{group:"="},link:function(e,t,n){e.maxShown=5;e.viewMore=function(){e.maxShown+=5}}}}),e.directive("clubTimelineItem",function(){return{restrict:"E",templateUrl:"clubTimelineItem.html",scope:{item:"="},link:function(e,t,n){}}})}(),function(){var e=angular.module("patronicity.giving.common",["patronicity.api","user","patronicity.configuration","ui.router","patronicity.clubs","patronicity.lgx.dialogs","patronicity.giving.factory"]);e.directive("givingJoinButton",["patronicityConfig","User","GivingSettingsManager","$state","$stateParams","$analytics",function(e,r,s,c,l,u){return{restrict:"E",scope:{title:"@"},templateUrl:e.urlForTemplate("giving/components/join-button.html"),link:function(e,t,n){var a=l.name||n.slug||"friday-givers",o=l.type||n.type||"club";function i(){var e=l.src;s.join(o,a,e).then(function(e){u.eventTrack("Join",{category:o,label:a}),u.eventTrack("Join",{segments:"5f34b7b3"}),"idle"===e.bestOnboardingState?u.eventTrack("AlreadyJoined",{category:o,label:a}):c.go(o+".onboard",{name:a,onboardPosition:e.bestOnboardingState},{reload:!0})})}e.user=r.current(),e.join=function(){r.isLoggedIn()?i():r.loginModal(!1,"lgx","login").then(function(e){i()})}}}}]),e.directive("givingTestButtons",["patronicityConfig","$stateParams","GivingSettingsManager","$rootScope","User",function(e,i,r,s,c){return{restrict:"E",scope:{},templateUrl:e.urlForTemplate("giving/components/test-buttons.html"),link:function(e,t,n){var a=i.type||n.type||"club",o=i.name||n.slug||"friday-givers";e.visible=!1,c.get().then(function(){e.visible="local"==c.getEnvironment()||"development"==c.getEnvironment()}),e.unjoin=function(){r.clear(a,o),s.$broadcast("giving:membership:changed")}}}}]),e.directive("givingTopNavigation",["User","$stateParams","patronicityConfig","GivingManager",function(o,i,e,r){return{restrict:"E",scope:{},templateUrl:e.urlForTemplate("giving/components/top-navigation.html"),link:function(n,e,t){var a=i.type||t.type||"club",t=i.name||t.slug||"friday-givers";n.data={subNavOpen:!1,user:o.current(),type:a,name:"club"==a?"Giving Clubs":"Ramadan Challenge",flag:"club"==a?"Beta":"2018"},r.load(a,t).then(function(e){n.data.name="challenge"==a?e.strings.shortName+" Challenge":e.strings.shortName,n.data.flag=e.strings.subtext}),n.data.user=o.current(),n.$on("user:login-change",function(e,t){n.data.user=o.current(),n.data.user&&(n.username=n.data.user.UserName)}),n.loginSignUp=function(e){o.loginModal(!1,"lgx",e).then(function(e){n.data.subNavOpen=!1})},n.logout=function(){o.logout(function(){})},n.toggleNavMenu=function(){n.data.subNavOpen=!n.data.subNavOpen;var e=document.getElementById("fc_frame");null!=e&&(e.classList.contains("lgx-hidefc")?e.classList.remove("lgx-hidefc"):e.classList.add("lgx-hidefc"))}}}}]),e.directive("givingInviteUsersButton",["patronicityConfig","$stateParams","GivingManager",function(e,o,i){return{restrict:"E",templateUrl:e.urlForTemplate("giving/components/invite-users-button.html"),link:function(t,e,n){var a=o.name||n.slug||"friday-givers",n=o.type||n.type||"club";t.data={friendCount:0,type:n},i.userStats(n,a).then(function(e){t.data.friendCount=e.referredUserCount})}}}]),e.directive("givingWaitlistSignup",["$stateParams","patronicityConfig","api",function(a,e,o){return{restrict:"E",scope:{},templateUrl:e.urlForTemplate("giving/components/giving-waitlist-signup.html"),link:function(t,e,n){a.name||n.slug,a.type||n.type;t.data={confirmed:!1,email:void 0},t.joinWaitlist=function(e){o.challenges.updateMailerlite(e).then(function(e){t.data.confirmed=!0},function(e){console.log("Failure: "+e)})}}}}]),e.directive("givingMemberList",["patronicityConfig","$stateParams","GivingManager","api",function(e,s,c,l){return{restrict:"E",templateUrl:e.urlForTemplate("giving/components/giving-member-list.html"),link:function(t,e,n){var a=s.name||n.slug||"friday-givers",o=s.type||n.type||"club",i=1;function r(e){t.data.loading=!0;e=10*Math.max(e-1,0);l.giving.members.list(o,a,11,e).then(function(e){t.data.members=t.data.members.concat(e.slice(0,10)),t.data.showViewMore=10<e.length,t.data.loading=!1})}t.data={citiesCount:"0",donationAmount:"",currencySymbol:"",memberCount:"0",members:[],showViewMore:!0,period:"weekly",loading:!1},t.viewMoreMembers=function(){r(i+=1)},r(i),c.load(o,a).then(function(e){t.data.memberCount=e.stats.general.memberCount,t.data.donationAmount=e.stats.general.periodDonationAmount,t.data.citiesCount=e.stats.general.citiesCount,t.data.currencySymbol=e.stats.donation.totalCurrencySymbol,t.data.period=e.stats.general.periodName})}}}]),e.directive("givingSvgDefs",["patronicityConfig",function(e){return{restrict:"E",scope:!1,templateUrl:e.urlForTemplate("giving/components/svg-defs.html")}}]),e.directive("givingGlobalStats",["patronicityConfig","$stateParams","GivingManager",function(e,o,i){return{restrict:"E",scope:{},templateUrl:e.urlForTemplate("giving/components/global-stats.html"),link:function(t,e,n){t.data={};var a=o.name||n.slug||"friday-givers",n=o.type||n.type||"club";i.load(n,a).then(function(e){t.data={donationAmount:e.stats.general.periodDonationAmount,periodName:e.stats.general.periodName,currencySymbol:e.stats.donation.totalCurrencySymbol,newMembers:e.stats.general.newMembers,memberCount:e.stats.general.memberCount,totalDonationAmount:e.stats.donation.totalAmount,nSupportedCampaigns:e.stats.donation.supportedCampaigns,newUserSuffix:e.stats.general.newUserPeriodSuffix,users:[{name:"Bilal A.",img:"//media.launchgood.com/06bc2411f7284f2a6f474e36ab2b263173b8c480/img/usr2.jpg"},{name:"Amany K..",img:"//media.launchgood.com/06bc2411f7284f2a6f474e36ab2b263173b8c480/img/usr3.jpg"},{name:"Amanda C.",img:"//media.launchgood.com/06bc2411f7284f2a6f474e36ab2b263173b8c480/img/usr5.jpg"}]}}),t.goToHistory=function(){t.$emit("giving:navigate",{tab:"history"})}}}}]),e.directive("givingSummary",["patronicityConfig","$stateParams","GivingManager","User","api","$window","$compile",function(i,r,s,c,l,u,d){return{restrict:"E",link:function(t,e,n){var a=r.name||n.slug||"friday-givers",o=r.type||n.type||"club",n=i.urlForTemplate(o+"/"+a+"/summary-component.html");e.append(d("<ng-include src=\"'"+n+"'\"></ng-include>")(t)),t.givingType=o,t.user=c.current(),u.doTheConfetti(),s.load(o,a).then(function(e){t.data={stats:{general:{memberCount:e.stats.general.memberCount},donation:{totalCampaigns:e.stats.donation.supportedCampaigns,totalDonated:e.stats.donation.totalAmount,totalCurrencyCode:e.stats.donation.totalCurrencyCode}}},e.user&&(t.data.user={referredUsers:{count:e.user.referredUsers.count,referredSum:e.user.referredUsers.referredSum,member:e.user.referredUsers.member}},t.data.user.referredUsers.member&&s.userStats(o,a).then(function(e){t.data.userStats=e.userStats,t.totalDonationsUserAndFriends=Number(t.data.user.referredUsers.referredSum)+Number(t.data.userStats.DonatedAmount)}))}),l.giving.members.leaderboard(o,a,3,0).then(function(e){t.data.leaders=e}),t.learnMore=function(){u.location.href="/club"}}}}]),e.directive("v2GivingOnboardOverview",["patronicityConfig","$stateParams","$location","GivingSettingsManager","$analytics","$compile","$state","api","CurrencyCodeProvider",function(r,s,c,l,u,d,p,m,g){return{restrict:"E",scope:{},link:function(a,e,t){var n=s.type||t.type||"club",o=s.name||t.slug||"friday-givers",t=r.urlForTemplate("challenge/"+o+"/onboarding/overview.html");function i(){g.minimumDonationForCode(a.overviewSettings.currencyCode,n).then(function(e){a.overviewSettings.minimum=e})}e.append(d("<ng-include src=\"'"+t+"'\"></ng-include>")(a)),l.setSrc(c.search().src),a.next=function(){a.overviewSettings.processing=!0,u.eventTrack("ObOverview",{category:n,label:o}),m.user.saveGivingEnrollment(void 0,a.overviewSettings.enrollments.ramadan,a.overviewSettings.enrollments.dhul_hijjah,a.overviewSettings.enrollments.friday_givers).then(function(e){l.storeSettings(n,o,void 0,void 0,void 0,"automatic",void 0,void 0,void 0),l.saveStoredSettings(n,o).then(function(e){p.go("ramadan.view.pulse")},function(e){a.overviewSettings.processing=!1})},function(e){a.overviewSettings.processing=!1})},a.overviewSettings={totalDonationAmount:0,processing:!1,enrollments:{},currencyCode:"USD",minimum:1,donationAmount:10,validCreditCard:!1,invalidAmexCard:!1},a.updateTotalDonationAmount=function(e){var t=0,n=0;e.daily_donation_goal&&(n=e.daily_donation_goal),e.tip_amount&&(t=e.tip_amount),e.hasOwnProperty("goal")&&(n=e.goal||a.overviewSettings.donationAmount),e.hasOwnProperty("tip")&&(t=e.tip||a.overviewSettings.minimum),a.overviewSettings.totalDonationAmount=parseFloat(n)+parseFloat(t),a.overviewSettings.currencyCode=e.challenge_currency,e.hasOwnProperty("currencyCode")&&e.currencyCode&&(a.overviewSettings.currencyCode=e.currencyCode)},l.load(n,o).then(function(e){a.updateTotalDonationAmount(e),e.lastTen&&(a.overviewSettings.lastTen=1==e.lastTen)}),i(),a.canSubmit=function(){var e=!1;return e=a.overviewSettings.amount>=a.overviewSettings.minimum&&a.overviewSettings.validCreditCard&&!a.overviewSettings.invalidAmexCard?!0:e},l.subscribe(a,function(e,t){"settingsChanged"===t.eventName&&(t.settings.challenge_currency!=a.overviewSettings.currencyCode&&(a.overviewSettings.currencyCode=t.settings.challenge_currency,i()),t.settings.daily_donation_goal&&(a.overviewSettings.amount=t.settings.daily_donation_goal),t.settings.giving_credit_card_id&&(a.overviewSettings.validCreditCard=!isNaN(t.settings.giving_credit_card_id)),"amex"==t.settings.giving_credit_card_type&&"USD"!=a.overviewSettings.currencyCode?a.overviewSettings.invalidAmexCard=!0:a.overviewSettings.invalidAmexCard=!1,a.updateTotalDonationAmount(t.settings),t.settings.last_ten&&(a.overviewSettings.lastTen=1==t.settings.last_ten))})}}}]),e.directive("v2GivingOnboardNewfeatures",["patronicityConfig","$stateParams","$location","GivingSettingsManager","$analytics","$compile","$state",function(i,r,s,c,l,u,d){return{restrict:"E",scope:{},link:function(e,t,n){var a=r.type||n.type||"club",o=r.name||n.slug||"friday-givers",n=i.urlForTemplate("challenge/"+o+"/onboarding/newfeatures.html");t.append(u("<ng-include src=\"'"+n+"'\"></ng-include>")(e)),c.setSrc(s.search().src),e.next=function(){l.eventTrack("ObNewfeatures",{category:a,label:o}),d.go("ramadan.onboard.giving-goal")}}}}]),e.directive("v2GivingOnboardGivingGoal",["patronicityConfig","$stateParams","GivingSettingsManager","User","$state","$analytics","$location","$compile","CurrencyCodeProvider",function(s,c,l,u,d,p,m,g,f){return{restrict:"E",scope:{},link:function(n,e,t){var a=c.type||t.type||"challenge",o=c.name||t.slug||"dhul_hijjah_2022",t=s.urlForTemplate("challenge/"+o+"/onboarding/giving-goal.html");function i(){var e=c.src||l.getSrc()||"";n.goalData.processing=!0,l.saveStoredSettings(a,o).then(function(t){l.join(a,o,e).then(function(e){p.eventTrack("Join",{category:a,label:o,value:t.goal}),l.load(a,o).then(function(e){e.migratedFromPreviousChallenge||(p.eventTrack("ObGivingGoal",{category:a,label:o}),d.go("ramadan.onboard.overview"))})},function(){n.goalData.processing=!1})},function(){n.goalData.processing=!1})}function r(){f.minimumDonationForCode(n.goalData.currencyCode,a).then(function(e){n.goalData.minimum=e})}e.append(g("<ng-include src=\"'"+t+"'\"></ng-include>")(n)),n.goalData={canSubmit:!1,minimum:1,currencyCode:"USD",amount:10,processing:!1,lastTen:!1},u.get().then(function(){u.isLoggedIn()&&l.load(a,o).then(function(e){"active"==e.state&&(e.migratedFromPreviousChallenge?d.go("ramadan.onboard.previous"):d.go("ramadan.view.pulse"))})}),n.submit=function(){u.get().then(function(){u.isLoggedIn()?i():(l.saveStoredSettings(a,o),u.loginModal(!1,"lgx").then(function(e){l.load(a,o,!0).then(function(e){"active"==e.state?d.go("ramadan.view.pulse"):i()})}))})},l.setSrc(m.search().src),r(),n.canSubmit=function(){var e=!1;return e=n.goalData.amount>=n.goalData.minimum?!0:e},l.subscribe(n,function(e,t){"settingsChanged"===t.eventName&&(t.settings.challenge_currency!=n.goalData.currencyCode&&(n.goalData.currencyCode=t.settings.challenge_currency,r()),t.settings.daily_donation_goal&&(n.goalData.amount=t.settings.daily_donation_goal))})}}}]),e.directive("v2GivingGoal",["patronicityConfig","$stateParams","GivingSettingsManager","CurrencyCodeProvider","User","$state","$q","$interval","$compile","$timeout",function(l,u,d,p,m,g,e,f,h,y){return{restrict:"E",scope:{display:"@"},link:function(n,e,t){var a,o=u.type||t.type||"challenge",i=u.name||t.slug||"dhul_hijjah_2022",t=l.urlForTemplate("giving/components/giving-goal.html"),r=(e.append(h("<ng-include src=\"'"+t+"'\"></ng-include>")(n)),n.display||(n.display="default"),p.defaultCurrencyCode()),e={code:r,symbol:p.symbolFromCode(r),emoji:p.emojiFromCode(r),label:"Loading.."};function s(){p.minimumDonationForCode(n.data.currencyCode.code,o).then(function(e){n.data.minimum=e}),p.suggestedGivingAmountsForCode(n.data.currencyCode.code,o).then(function(e){n.data.suggestedAmounts=e})}function c(t){var e=p.supportedCodes("challenge");return e.then(function(e){n.settings.currencyCodes=e.map(function(e){return e.emoji=p.emojiFromCode(e.code),e.label=e.emoji+" "+e.code,e.code==t&&(n.settings.currencyCode=e),e}),s()}),e}n.data={givingGoal:10,currencyCode:e,currencyCodes:[e],suggestedAmounts:[],minimum:1,processing:!0},n.settingChanged=function(){s(),d.storeSettings(o,i,n.data.givingGoal,n.data.currencyCode.code)},p.supportedCodes("challenge"),n.data.processing=!0,m.get().then(function(){m.isLoggedIn()?d.load(o,i).then(function(e){e.goal&&(n.data.givingGoal=parseFloat(e.goal)),c(e.currencyCode||r).then(function(){n.settingChanged()}).finally(function(){n.data.processing=!1})}):c(r).then(function(){n.settingChanged()}).finally(function(){n.data.processing=!1})}),n.incAmount=function(){n.data.givingGoal+=1,n.love(),n.settingChanged()},n.decAmount=function(){n.data.givingGoal=1<n.data.givingGoal?--n.data.givingGoal:1,n.settingChanged()},a=f(function(){n.love()},100,10),n.$on("$destroy",function(){angular.isDefined(a)&&(f.cancel(a),a=void 0)}),n.love=function(){var e,t,n,a,o,i,r;"ramadan.view.settings"!==g.current.name&&(e=document.getElementById("js-heart-container"),t=Math.floor(10*Math.random())+15,n=Math.floor(100*Math.random())+1,a=Math.floor(5*Math.random())+10,o=Math.random()+.25,i=document.createElementNS("http://www.w3.org/2000/svg","svg"),r=document.createElementNS("http://www.w3.org/2000/svg","path"),i.setAttribute("viewBox","0 0 32 32"),i.setAttribute("class","rc20__heart"),i.style.cssText="opacity: "+o+"; width: "+t+"px; height: "+t+"px; left:"+n+"%; animation: love "+a+"s linear",r.setAttribute("d","M31.656 8.275c-1.065-3.838-4.583-6.518-8.553-6.518-0.344 0-0.691 0.022-1.031 0.063-3.529 0.429-5.243 2.353-6.072 3.984-0.826-1.631-2.542-3.555-6.071-3.984-0.301-0.037-0.595-0.057-0.877-0.063-0.051-0.001-0.103-0.001-0.154-0.001-3.973 0-7.491 2.68-8.555 6.519-0.585 2.109-0.711 5.539 2.011 9.915 2.581 4.15 7.125 8.199 13.504 12.037 0.029 0.017 0.064 0.022 0.096 0.014 0.017-0.005 0.031-0.013 0.045-0.024 0.014 0.011 0.029 0.019 0.046 0.024 0.010 0.003 0.022 0.003 0.032 0.003 0.023 0 0.043-0.005 0.063-0.017 6.381-3.837 10.925-7.887 13.505-12.037 2.723-4.377 2.597-7.808 2.011-9.915z"),i.append(r),e.append(i))},y(function(){$("#js-heart-container").height($("#givingGoal").offset().top+50)},1e3)}}}]),e.directive("v2LastTenOption",["patronicityConfig","$stateParams","GivingSettingsManager","CurrencyCodeProvider","User","$state","$q","$interval","$compile","$timeout",function(i,r,s,e,t,n,a,o,c,l){return{restrict:"E",scope:{display:"@"},link:function(t,e,n){var a=r.type||n.type||"challenge",o=r.name||n.slug||"ramadan_challenge_2023",n=i.urlForTemplate("giving/components/giving-last-ten.html");e.append(c("<ng-include src=\"'"+n+"'\"></ng-include>")(t)),t.settings={lastTen:!1},s.load(a,o).then(function(e){t.settings.lastTen=e.lastTen}),t.settingChanged=function(){s.storeSettings(a,o,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,t.settings.lastTen)}}}}]),e.directive("v2GivingOnboardPaymentMethod",["patronicityConfig","$stateParams","GivingSettingsManager","$analytics","$state","$compile","$timeout",function(r,s,c,l,u,d,p){return{restrict:"E",scope:{},link:function(e,t,n){var a,o=s.type||n.type||"challenge",i=s.name||n.slug||"dhul_hijjah_2022",n=r.urlForTemplate("challenge/"+i+"/onboarding/payment-method.html");t.append(d("<ng-include src=\"'"+n+"'\"></ng-include>")(e)),e.settings={},e.payMethodData={showSaveAnim:!1},e.hasSelectedCard=function(){return!angular.equals({},e.settings.selectedCard)},e.save=function(){e.settings.processing=!0,e.payMethodData.showSaveAnim=!0,a=p(function(){},3e3),c.saveStoredSettings(o,i).then(function(e){l.eventTrack("ObPaymentMethod",{category:o,label:i}),a.then(function(){u.go("ramadan.onboard.remind")})},function(){e.settings.processing=!1,e.payMethodData.showSaveAnim=!1,p.cancel(a)})}}}}]),e.directive("v2GivingPaymentMethod",["addCardsFactory","patronicityConfig","$stateParams","GivingSettingsManager","api","$q","$compile","GivingManager",function(e,r,s,c,l,u,d,p){return{restrict:"E",scope:{settings:"=?",type:"@"},link:function(a,e,t){var n=s.type||t.type||"challenge",o=s.name||t.slug||"dhul_hijjah_2022",t=r.urlForTemplate("giving/components/payment-method.html"),i=(e.append(d("<ng-include src=\"'"+t+"'\"></ng-include>")(a)),a.settings={selectedCard:{},cardListShown:!1,cardFormShown:!1,coverFees:!0,cards:[],userSettings:{},autoDonationAmount:0,chronology:{},processing:!1},u.defer());a.fees={transaction_unit:.3,transaction:.029,platform:.05},""!=a.type&&null!=a.type||(a.type="1"),l.user.cards.forGivingType(o,n).then(function(e){a.settings.cards=e.cards,e.cards&&0<e.cards.length&&(a.selectCard(e.cards[0]),i.resolve())},function(){i.reject()}),a.cardSavedCallback=function(e,t,n){a.settings.cards.push(e),console.log(e),a.selectCard(e)},a.hasSelectedCard=function(){return!angular.equals({},a.settings.selectedCard)},a.selectCard=function(e){a.settings.selectedCard=e,a.settings.cardListShown=!1,a.settings.cardFormShown=!1,a.settingChanged()},a.settingChanged=function(){c.storeSettings(n,o,void 0,void 0,a.settings.selectedCard.ID,"automatic",void 0,void 0,a.settings.coverFees,void 0,void 0,void 0,a.settings.selectedCard.TypeEnum)},a.toggleCardList=function(){a.settings.cardListShown=!a.settings.cardListShown},a.toggleCardForm=function(){a.settings.cardFormShown=!a.settings.cardFormShown,a.toggleCardList()},a.excludeCurrentCard=function(e){return!a.settings.selectedCard||a.settings.selectedCard.ID!=e.ID},c.load(n,o).then(function(t){(a.settings.userSettings=t).coverFees&&(a.settings.coverFees=1==t.coverFees),a.updateAutoDonationAmount(),i.promise.then(function(){t.currentCardId&&angular.forEach(a.settings.cards,function(e){e.ID==t.currentCardId&&a.selectCard(e)})})}),p.load(n,o).then(function(e){a.settings.shortName=e.strings.shortName,a.settings.name="challenge"==n?e.strings.shortName+" Challenge":e.name,a.settings.nextCharge=e.nextCharge,a.settings.chronology=e.chronology}),a.updateAutoDonationAmount=function(){var e;a.settings.autoDonationAmount=parseFloat(a.settings.userSettings.goal),a.settings.coverFees&&(a.settings.autoDonationAmount+=(e=a.settings.userSettings.goal,+(((a.fees.transaction+a.fees.platform)*e+a.fees.transaction_unit)/(1-a.fees.transaction)).toFixed(2))),a.settingChanged()}}}}]),e.directive("v2GivingOnboardRemind",["patronicityConfig","$stateParams","GivingSettingsManager","api","$analytics","$state","$q","$compile",function(c,l,u,d,p,m,g,f){return{restrict:"E",scope:{reminder:"=?",page:"=?"},link:function(a,e,t){var n=l.type||t.type||"club",o=l.name||t.slug||"friday-givers",t=c.urlForTemplate("giving/components/sms-reminder.html");function i(){g(function(t,n){1==a.settings.reminder&&a.formHolder.getphonenumberform.phoneNumber.$valid&&a.formHolder.getphonenumberform.verifyCode.$untouched?(a.settings.needPhoneVerification=!0,a.settings.phone.completePhone="+"+a.settings.phone.countryCode+a.settings.phone.phoneNumber,d.smsReminder.sendVerification(a.settings.phone.completePhone).then(function(e){a.verifyWaiting=!0,t({message:"Please check your phone for verification code.",status:"sentVerification"})},function(e){n(e)})):1==a.settings.reminder&&a.formHolder.getphonenumberform.verifyCode.$valid&&a.formHolder.getphonenumberform.phoneNumber.$valid?d.smsReminder.verifyCode(a.settings.phone.verifyCode).then(function(e){a.msg=e.response,3==e.success?(a.settings.needPhoneVerification=!1,t({message:"Verified!",status:"verified"})):t({message:e.response,status:"verifyFailed"})},function(e){n(e)}):t({message:"",status:"noVerificationNeeded"})}).then(function(e){"verified"==e.status||"noVerificationNeeded"==e.status?("verified"==e.status?(a.settings.reminder=1,a.settingInProcessing(),s()):a.settings.reminder=0,r().then(function(e){a.settings.page||m.go("ramadan.onboard.stay-enrolled")},function(e){alert(e)})):(a.settings.phoneHelptext=e.message,a.settings.loading=!1)},function(e){a.settings.phoneHelptext=e.message,a.settings.loading=!1})}function r(){return u.save(n,o,void 0,void 0,void 0,void 0,a.settings.reminder,0).then(function(e){})}function s(){d.smsReminder.getUserChallengePhoneNumber().then(function(e){a.settings.phone.savedNumber=e.number})}e.append(f("<ng-include src=\"'"+t+"'\"></ng-include>")(a)),a.settings={needPhoneVerification:!1,phone:{countryCode:"1"},page:a.page||!1,reminder:!1,editSavedNumber:!1},a.formHolder={},a.$on("save-settings",function(){r()}),u.load(n,o).then(function(e){e.reminder&&(a.settings.reminder=1==e.reminder),a.settings.reminder&&s()}),a.editNumber=function(){a.settings.editSavedNumber=!0},a.reminderChanged=function(){a.reminder=a.settings.reminder,a.settings.reminder||(a.settings.phone.savedNumber=void 0)},a.settingInProcessing=function(){a.settings.reminder=!0,a.settings.editSavedNumber=!1,a.formHolder.getphonenumberform.$pristine=!0,a.settings.phoneHelptext=""},a.submit=function(){a.settings.reminder&&a.settings.phone.savedNumber&&a.formHolder.getphonenumberform.$pristine||!a.settings.reminder?(p.eventTrack("ObRemind",{category:n,label:o}),r(),a.settings.page||m.go("ramadan.onboard.stay-enrolled")):i()}}}}]),e.directive("v2GivingOnboardStayEnrolled",["patronicityConfig","$stateParams","$analytics","api","$compile","$state",function(i,r,s,c,l,u){return{restrict:"E",scope:{},link:function(e,t,n){e.settings={};var a=r.type||n.type||"club",o=r.name||n.slug||"friday-givers",n=i.urlForTemplate("challenge/"+o+"/onboarding/stay-enrolled.html");t.append(l("<ng-include src=\"'"+n+"'\"></ng-include>")(e)),e.save=function(){e.settings=this.settings,c.user.saveGivingEnrollment(void 0,e.settings.ramadan,e.settings.dhul_hijjah,e.settings.friday_givers).then(function(e){s.eventTrack("ObStayEnrolled",{category:a,label:o}),u.go("ramadan.guide.page1")})}}}}]),e.directive("v2GivingStayEnrolled",["patronicityConfig","$stateParams","api","User","$compile","givingDialogs",function(r,s,c,e,l,u){return{restrict:"E",scope:{enrollments:"=?",page:"@"},link:function(t,e,n){s.type||n.type;var a=n.slug||s.name||s.slug.replace(/-/g,"_")||"friday-givers",o="friday_givers"==a?r.urlForTemplate("challenge/dhul_hijjah_2022/components/stay-enrolled.html"):r.urlForTemplate("challenge/"+a+"/components/stay-enrolled.html");function i(){for(var e in t.showNotEnrolledHeader=!1,t.serverEnrollments)0==t.serverEnrollments[e]&&(t.showNotEnrolledHeader=!0)}e.append(l("<ng-include src=\"'"+o+"'\"></ng-include>")(t)),t.showNotEnrolledHeader=!0,t.futureEnrollmentInfo={ramadan:{description:"Ramadan Challenge",start:"March 2024"},dhul_hijjah:{description:"Dhul Hijjah Challenge",start:"June 2023"},friday_givers:{description:"Friday Givers",start:"each Friday after Ramadan"}},c.user.getGivingEnrollment().then(function(e){0!=e.length&&angular.forEach(e,function(e){n.currentenrollment!=e.type&&(1==e.value?t.serverEnrollments[e.type]=!0:t.serverEnrollments[e.type]=!1)})}).finally(function(){i()}),t.serverEnrollments={ramadan:!1,dhul_hijjah:!1,friday_givers:!1},t.currentChallenge=!a.includes("ramadan")&&a.includes("dhul_hijjah")?"dhul_hijjah":"ramadan",t.updateEnrollments=function(e){"profile"===n.page&&(1==e?u.profileEnroll(s,!0):u.profileEnroll(s,!1)),t.enrollments=t.serverEnrollments,i()}}}}]),e.directive("v2GivingOnboardPrevious",["patronicityConfig","$stateParams","$analytics","User","$compile","$state","GivingManager","api","GivingSettingsManager",function(i,r,s,c,l,u,d,p,m){return{restrict:"E",scope:{},link:function(a,e,t){var n=r.type||t.type||"club",o=r.name||t.slug||"friday-givers",t=i.urlForTemplate("challenge/"+o+"/onboarding/pre-enroll.html");e.append(l("<ng-include src=\"'"+t+"'\"></ng-include>")(a)),a.data={user:{},challengeStats:{},overviewSettings:{},processing:!1,pristine:!0},c.get().then(function(){var e;c.isLoggedIn()?(e=c.current(),a.data.user.firstName=e.FirstName,a.data.user.lastName=e.LastName,a.data.user.thumbnail=e.ThumbnailURL,a.data.userID=e.ID):a.data.pageLocked=!0}),d.load(n,o).then(function(e){a.data.challengeStats.isOpen=e.chronology.isOpen,e&&o==e.slug&&(0==e.introMessages.length&&e.introMessages.push({Slug:o}),a.introMessage=e.introMessages[0],p.giving.messages.saveViewed(e.slug,a.data.userID,a.introMessage).then(function(e){})),m.load(n,o).then(function(e){a.data.overviewSettings.goal=e.goal,a.data.overviewSettings.currencyCode=e.currencyCode,a.data.overviewSettings.tip=e.tip,a.updateTotalDonationAmount({daily_donation_goal:e.goal,tip_amount:e.tip})})}),a.save=function(){a.data.processing=!0,s.eventTrack("ObPreviousMember",{category:n,label:o}),m.saveStoredSettings(n,o).then(function(e){u.go("ramadan.view.pulse")},function(e){a.data.processing=!1})},a.updateTotalDonationAmount=function(e){var t=0,n=0,n=e.daily_donation_goal||a.data.overviewSettings.goal||0;e.tip_amount&&(t=e.tip_amount),a.data.overviewSettings.totalDonationAmount=parseFloat(n)+parseFloat(t),a.data.overviewSettings.currencyCode=e.challenge_currency,a.data.pristine=!(0<t)},m.subscribe(a,function(e,t){"settingsChanged"===t.eventName&&a.updateTotalDonationAmount(t.settings)})}}}]),e.directive("v2SettingsPreview",["patronicityConfig","$stateParams","GivingSettingsManager","api","$compile","User",function(i,r,s,c,l,u){return{restrict:"E",scope:{},link:function(n,e,t){var a=r.type||t.type||"club",o=r.name||t.slug||"friday-givers",t=i.urlForTemplate("challenge/"+o+"/components/settings-preview.html");e.append(l("<ng-include src=\"'"+t+"'\"></ng-include>")(n)),n.data={userSettings:{},user:{userName:""}},u.get().then(function(e){var t=u.current();n.data.user.userName=t.UserName}),n.getSettingsUrl=function(){return"/user/newprofile#!/user-profile/auto-giving-and-challenges/"+n.data.user.userName+"/challenge/"+o.replace(/_/g,"-")+"/settings"},s.load(a,o).then(function(t){n.data.userSettings.goal=t.goal,n.data.userSettings.currencyCode=t.currencyCode,n.data.userSettings.reminder=t.reminder,c.user.cards.forGivingType(o,a).then(function(e){angular.forEach(e.cards,function(e){e.ID==t.currentCardId&&(n.data.userSettings.card=e,n.lastFourCreditCardDigits=n.data.userSettings.card.SimpleDescription.split(" ")[1])})},function(){})})}}}]),e.directive("v2GivingOnboardFinished",["patronicityConfig","$stateParams","$analytics","$timeout","$state","$compile",function(i,r,s,c,l,u){return{restrict:"E",scope:{},link:function(e,t,n){var a=r.type||n.type||"club",o=r.name||n.slug||"friday-givers",n=i.urlForTemplate("challenge/"+o+"/onboarding/finished.html");t.append(u("<ng-include src=\"'"+n+"'\"></ng-include>")(e)),c(function(){s.eventTrack("ObFinished",{category:a,label:o}),l.go("ramadan.view.friends")},5e3)}}}]),e.directive("v2GivingFriends",["patronicityConfig","$stateParams","GivingSettingsManager","GivingManager","User","$compile","api",function(i,r,s,c,l,u,e){return{restrict:"E",scope:{},link:function(t,e,n){var a=r.type||n.type||"club",o=r.name||n.slug||"friday-givers",n=i.urlForTemplate("challenge/"+o+"/challenge/friends.html");e.append(u("<ng-include src=\"'"+n+"'\"></ng-include>")(t)),t.data={referredUsers:{},shownCount:5,allowShowMore:!1,perPage:5,pageLocked:!0,memberCount:0},l.get().then(function(){l.isLoggedIn()?s.load(a,o).then(function(e){"active"==e.state&&(t.data.pageLocked=!1)}):t.data.pageLocked=!0}),c.load(a,o).then(function(e){t.data.memberCount=e.stats.general.memberCount,e.user&&(t.data.referredUsers=e.user.referredUsers,t.data.referredUsers.referred.length>t.data.shownCount&&(t.data.allowShowMore=!0))}),t.showMore=function(){t.data.shownCount+=t.data.perPage,t.data.shownCount>=t.data.referredUsers.referred.length&&(t.data.allowShowMore=!1)}}}}]),e.directive("v2GivingDashboard",["patronicityConfig","$stateParams","GivingSettingsManager","GivingManager","User","$compile","api","searchApi",function(r,s,c,l,u,d,p,m){return{restrict:"E",scope:{},link:function(a,e,t){var n=s.type||t.type||"club",o=s.name||t.slug||"friday-givers",t=r.urlForTemplate("challenge/"+o+"/challenge/dashboard.html");function i(){u.get().then(function(){var e;u.isLoggedIn()?(e=u.current(),a.data.user.firstName=e.FirstName,a.data.user.lastName=e.LastName,a.data.user.thumbnail=e.ThumbnailURL,c.load(n,o).then(function(e){"active"==e.state&&(a.data.pageLocked=!1)})):a.data.pageLocked=!0})}e.append(d("<ng-include src=\"'"+t+"'\"></ng-include>")(a)),a.data={referredUsers:{},shownCount:5,allowShowMore:!1,perPage:5,pageLocked:!0,memberCount:0,user:{firstName:"",lastName:"",thumbnail:""},userStats:{},userSettings:{},challengeStats:{},nextGiveProject:void 0},i(),a.$on("user:login-change",function(e,t){i()}),l.load(n,o).then(function(e){a.data.memberCount=e.stats.general.memberCount,e.user&&(a.data.referredUsers=e.user.referredUsers,a.data.referredUsers.referred.length>a.data.shownCount&&(a.data.allowShowMore=!0),a.data.challengeStats.challengeDay=e.chronology.dayIndexUnbound+1,a.data.challengeStats.isOpen=e.chronology.isOpen),c.load(n,o).then(function(t){a.data.userSettings.goal=t.goal,a.data.userSettings.currencyCode=t.currencyCode,a.data.userSettings.reminder=t.reminder,p.user.cards.forGivingType(o,n).then(function(e){angular.forEach(e.cards,function(e){e.ID==t.currentCardId&&(a.data.userSettings.card=e)})},function(){})}),l.userStats(n,o).then(function(e){var t,n;a.data.userStats.supportedDays=(t=e.entries,n=0,angular.forEach(t,function(e){e.Donated&&n++}),n),a.data.userStats.donatedAmount=e.userStats.DonatedAmount,a.data.userStats.currencyCode=e.userStats.CurrencyCode}),p.user.points.total(void 0,"challenge").then(function(e){a.data.userStats.points=e})}),p.user.favorites.projectIds().then(function(e){0<e.giving_project_ids.length&&(e={type:"specific",limit:1,offset:0,filter:void 0,status:void 0,category:void 0,param1:e.giving_project_ids[0]},m.search(e).then(function(e){e&&1==e.length&&(a.data.nextGiveProject=e[0])}))}),a.showMore=function(){a.data.shownCount+=a.data.perPage,a.data.shownCount>=a.data.referredUsers.referred.length&&(a.data.allowShowMore=!1)}}}}]),e.directive("v2LandingHelper",["GivingSettingsManager","$window","User","GivingManager",function(o,e,i,r){return{restrict:"EA",link:function(t,e,n){function a(){var a={};window.location.href.replace(/[?&]+([^=&]+)=([^&]*)/gi,function(e,t,n){a[t]=n});return a}t.src="",t.slug=n.slug||"dhul_hijjah_2020",t.data={showMembersSection:!1,isLoggedIn:!1,isMember:!1,isOpen:!0},i.get().then(function(){i.isLoggedIn()&&(t.data.isLoggedIn=!0)}),o.setSrc(a().src),t.src=a().src,t.joinUrl=function(){var e;switch(t.slug){case"dhul_hijjah_2020":case"dhul_hijjah_2021":case"dhul_hijjah_2022":e="/dhchome/#!/dhc/onboard/giving-goal"+window.location.search;break;default:case"ramadan_challenge_2020":case"ramadan_challenge_2021":e="/ramadanhome/#!/ramadan/onboard/giving-goal"+window.location.search}return e},t.landingUrl=function(){var e;switch(t.slug){case"dhul_hijjah_2020":case"dhul_hijjah_2021":case"dhul_hijjah_2022":e="/dhchome/#!/dhc/pulse";break;default:case"ramadan_challenge_2020":case"ramadan_challenge_2021":e="/ramadanhome/#!/ramadan/pulse"}return e},t.previousSettingsUrl=function(){return"/dhchome/#!/dhc/onboard/previous"},t.checkMembership=function(){o.load("challenge",t.slug).then(function(e){"active"==e.state&&(t.data.isMember=!0)})},t.login=function(){i.loginModal(!1,"lgx").then(function(e){t.data.isLoggedIn=!0,t.checkMembership()})},r.load("challenge",t.slug).then(function(e){t.data.memberGoal=e.memberGoal,t.data.memberCount=e.stats.general.memberCount,t.data.newMembers=e.stats.general.newMembers,t.data.periodAbbreviation=e.stats.general.periodAbbreviation,t.data.newUserPeriodSuffix=e.stats.general.newUserPeriodSuffix,t.data.showMembersSection=!0,t.data.isOpen=e.chronology.isOpen,t.checkMembership()}),t.sillyProgress=function(e,t,n){return e/t*n}}}}]),e.directive("dhikrCounter",["patronicityConfig","$http",function(e,i){return{restrict:"E",templateUrl:e.urlForTemplate("giving/components/dhikr-counter.html"),link:function(o,e,t){var n="https://gs9y56jqoc.execute-api.us-east-1.amazonaws.com/dev/crowd-clicker";function a(){i.get(n,{}).then(function(e,t,n,a){e&&200==e.status&&(o.data.globalCounter=e.data.global)},function(e,t,n,a,o){})}o.data={globalCounter:0,userCounter:0,loading:!0},a(),o.bumpCounter=function(){i.post(n,{},{}).then(function(e,t,n,a){e&&200==e.status&&(o.data.globalCounter=e.data.global,o.data.userCounter++)},function(e,t,n,a,o){})},o.resetCounter=function(){o.data.userCounter=0,a()}}}}]),e.directive("v2LockedScreen",["patronicityConfig","GivingManager","$stateParams","$compile","User",function(r,s,c,l,u){return{restrict:"E",link:function(t,e,n){var a=c.type||n.type||"club",o=c.name||n.slug||"friday-givers",i=r.urlForTemplate("challenge/"+o+"/components/locked.html");e.append(l("<ng-include src=\"'"+i+"'\"></ng-include>")(t)),t.data={memberCount:0,pageMessage:n.pageMessage||"Join to experience Dhul Hijjah on LaunchGood"},s.load(a,o).then(function(e){t.data.memberCount=e.stats.general.memberCount}),t.login=function(){u.loginModal(!1).then(function(e){})}}}}]),e.directive("v2Leaderboards",["patronicityConfig","$compile","$stateParams","GivingManager",function(i,r,s,c){return{restrict:"E",link:function(t,e,n){var a=s.type||n.type||"club",n=s.name||n.slug||"friday-givers",o=i.urlForTemplate("challenge/"+n+"/components/leaderboards.html");e.append(r("<ng-include src=\"'"+o+"'\"></ng-include>")(t)),t.topData={processing:!1,pageLocked:!0,activeTab:"referrals",startDate:void 0,endDate:void 0,isOpen:!1,isPending:!1},c.load(a,n).then(function(e){t.topData.startDate=e.startDate,t.topData.endDate=e.endDate,t.topData.isOpen=e.chronology.isOpen,t.topData.isPending=e.chronology.isPending,t.topData.isOver=!e.chronology.isOpen&&!e.chronology.isPending}),t.setActiveTab=function(e){t.topData.activeTab=e}}}}]),e.directive("giveList",["patronicityConfig","User","GivingSettingsManager","$stateParams","api","supportInfo","$timeout","$compile",function(r,s,c,l,u,d,p,m){return{restrict:"E",scope:{type:"@",page:"@",suggestedListId:"@"},link:function(n,e,t){var a,o=l.type||t.type||"club",i=l.name||t.name||"friday-givers",t="profile"==n.page||"donations"==n.page?r.urlForTemplate("user-profile/pages/my-giving/give-list.html"):"autoGivingAndChallenges"==n.page?r.urlForTemplate("user-profile/pages/my-fundraising/givelist.html"):"club"==o?r.urlForTemplate("giving/clubs/parts/givelist.html"):r.urlForTemplate("challenge/"+i+"/challenge/give-list.html");e.append(m("<ng-include src=\"'"+t+"'\"></ng-include>")(n)),n.data={loading:!0,pageLocked:!0,project_ids:{giving_project_ids:[],you_may_like_project_ids:[],supported_project_ids:[],closed_project_ids:[]},limits:{giving_project_ids:5,you_may_like_project_ids:2,supported_project_ids:2,closed_project_ids:2},sections:[{title:"Campaigns you may like",source:"you_may_like_project_ids",discover:!0},{title:"Supported",source:"supported_project_ids",discover:!1},{title:"Closed",source:"closed_project_ids",discover:!1}],user:{}},n.sortableOptions={update:function(e,t){a&&a.cancel(),a=p(function(){u.user.favorites.setOrder(n.data.project_ids.giving_project_ids).then(function(e){n.data.project_ids=e,console.log(e)}),a=void 0},500)}},n.$on("favorite:status-changed",function(e,t){d.clearForProjectId(t.id),u.user.favorites.projectIds().then(function(e){n.data.project_ids=e,n.data.loading=!1})}),s.get().then(function(){s.isLoggedIn()&&(n.data.user.username=n.username=s.current().UserName,c.load(o,i).then(function(e){n.joined=e.onboard_complete,"active"==e.state&&(n.data.pageLocked=!1)}),u.user.favorites.projectIds(n.suggestedListId).then(function(e){n.data.project_ids=e,n.data.loading=!1}))}),n.showMore=function(e){n.data.limits[e]+=2},n.discoverCampaigns=function(){window.location.href="/discover"}}}}]),e.directive("v2LeaderboardPoints",["patronicityConfig","GivingManager","$stateParams","api","$compile",function(r,s,c,l,u){return{restrict:"E",link:function(t,e,n){var a=c.type||n.type||"challenge",o=c.name||n.slug||"dhul_hijjah_2022",n=r.urlForTemplate("challenge/"+o+"/components/leaderboard-points.html");function i(){t.data.page+=1,t.data.loading=!0,l.giving.members.pointRank(a,o,t.data.perPage,(t.data.page-1)*t.data.perPage).then(function(e){t.data.currentUser=e.me,t.data.leaders=t.data.leaders.concat(e.leaders),t.data.shownCount+=e.leaders.length,e.leaders.length<t.data.perPage?t.data.allowShowMore=!1:t.data.allowShowMore=t.data.shownCount<50}).finally(function(){t.data.loading=!1})}e.append(u("<ng-include src=\"'"+n+"'\"></ng-include>")(t)),t.data={loading:!1,memberCount:0,currentUser:{},shownCount:0,allowShowMore:!1,perPage:5,page:0,leaders:[]},s.load(a,o).then(function(e){t.data.memberCount=e.stats.general.memberCount}),i(),t.showMore=function(){i()}}}}]),e.directive("v2PulseFinal",["patronicityConfig","GivingManager","$stateParams","api","$compile","GivingSettingsManager","User",function(s,c,l,u,d,p,m){return{restrict:"E",link:function(a,e,t){var o,i=l.type||t.type||"challenge",r=l.name||t.slug||"ramadan_challenge_2020",t=s.urlForTemplate("challenge/"+r+"/challenge/eid.html");function n(){c.load(i,r).then(function(e){a.data.memberCount=e.stats.general.memberCount})}e.append(d("<ng-include src=\"'"+t+"'\"></ng-include>")(a)),a.data={loading:!1,memberCount:0,currentUser:{},shownCount:0,allowShowMore:!1,perPage:5,page:0,leaders:[]},n(),a.endData={isMember:!1,userStats:{daysDonated:0,DonatedAmount:0,CurrencyCode:"USD",ReferredUserCount:0,TotalRaisedBySupportedCampaigns:0}},o=o||!1,m.get().then(function(){var n;a.endData.user=m.current(),c.load(i,r,o).then(function(e){a.endData.isOpen=e.chronology.isOpen,a.endData.dayIndexUnbound=e.chronology.dayIndexUnbound,a.endData.userStats.ReferredUserCount=e.user&&e.user.referredUsers?e.user.referredUsers.count:0,a.endData.signedUp=e.signedUp,a.endData.userStats.totalDays=e.chronology.totalDays}),m.isLoggedIn()&&(n=o||!1,p.load(i,r).then(function(e){e.state&&"active"==e.state&&(a.endData.isMember=!0),c.userStats(i,r,n).then(function(e){var t=0;n&&(a.endData.userStats.daysDonated=0),a.endData.isMember?e.entries.forEach(function(e){e.Donated&&(t+=1)}):t=e.userStats.TotalDonorCount,a.endData.userStats.daysDonated=t,a.endData.userStats.DonatedAmount=e.userStats.DonatedAmount||0,a.endData.userStats.CurrencyCode=e.userStats.CurrencyCode||"USD",a.endData.userStats.TotalRaisedBySupportedCampaigns=e.userStats.TotalRaisedBySupportedCampaigns||0})}),u.user.points.total(void 0,"challenge").then(function(e){a.endData.userPoints=e}))}),a.login=function(){m.loginModal(!0).then(function(e){n()})}}}}]),e.directive("v2Pulse",["patronicityConfig","User","GivingSettingsManager","$stateParams","$compile","GivingManager","$window","api","searchApi","$rootScope",function(r,s,c,l,u,d,p,m,g,f){return{restrict:"E",link:function(a,e,t){var n=l.type||t.type||"challenge",o=l.name||l.slug||t.slug||"ramadan_challenge_2020",t=r.urlForTemplate("challenge/"+o+"/challenge/pulse-pre.html");function i(){s.get().then(function(e){var t;s.isLoggedIn()?(t=s.current(),a.pulseData.user.firstName=t.FirstName,a.pulseData.user.lastName=t.LastName,a.pulseData.user.userName=t.UserName,a.pulseData.user.giveListUrl="/user/newprofile#!/user-profile/give-list/"+a.pulseData.user.userName,c.load(n,o).then(function(e){a.pulseData.settings.goal=e.goal,a.pulseData.settings.currencyCode=e.currencyCode,a.pulseData.settings.tip=e.tip,a.pulseData.settings.dailyTotal=parseFloat(a.pulseData.settings.goal)+(a.pulseData.settings.tip?parseFloat(a.pulseData.settings.tip):0),e.lastTen&&(a.pulseData.settings.lastTen=1==e.lastTen),"active"==e.state?(a.pulseData.showShare=!0,a.pulseData.isMember=!0):p.location.href="/ramadan"}),d.userStats(n,o).then(function(e){var t,n;a.pulseData.userStats.supportedDays=(t=e.entries,n=0,angular.forEach(t,function(e){e.Donated&&n++}),n),a.pulseData.userStats.referredUserCount=e.referredUserCount})):p.location.href="/ramadan"}),d.load("challenge",o).then(function(e){a.pulseData.memberGoal=e.memberGoal,a.pulseData.memberCount=e.stats.general.memberCount,a.pulseData.newMembers=e.stats.general.newMembers,a.pulseData.periodAbbreviation=e.stats.general.periodAbbreviation,a.pulseData.newUserPeriodSuffix=e.stats.general.newUserPeriodSuffix,a.pulseData.challengeStats.challengeDay=e.chronology.dayIndexUnbound+1,a.pulseData.totalDays=e.chronology.totalDays,a.pulseData.isOpen=e.chronology.isOpen,a.pulseData.loading=!1,a.pulseData.slug=e.slug.replace(/_/g,"-")}),m.home.footerStats().then(function(e){a.pulseData.siteStats=e})}e.append(u("<ng-include src=\"'"+t+"'\"></ng-include>")(a)),a.pulseData={dayIndexBound:0,loading:!0,showShare:!1,challengeStats:{},userStats:{},user:{},latestEvent:{},settings:{currencyCode:"USD",goal:0,tip:0,dailyTotal:0,lastTen:!1},isPageReady:!1,nextGiveProject:void 0,isMember:!1,timestamp:Date.now(),isOpen:!0,showEidPage:!1,siteStats:{},showMobile:!1,slug:"",initialLoad:!0},a.quranplay=!1,a.quranPlayControl=!0,i(),a.getSettingsUrl=function(){return"/user/newprofile#!/user-profile/auto-giving-and-challenges/"+a.pulseData.user.userName+"/challenge/"+a.pulseData.slug+"/settings"},m.user.favorites.projectIds().then(function(e){0<e.giving_project_ids.length&&(e={type:"specific",limit:1,offset:0,filter:void 0,status:void 0,category:void 0,param1:e.giving_project_ids[0]},g.search(e).then(function(e){e&&1==e.length&&(a.pulseData.nextGiveProject=e[0])}))}),a.login=function(){s.loginModal(!1).then(function(e){i()})},f.$on("grid:selection:changed",function(e,t){a.pulseData.initialLoad?a.pulseData.initialLoad=!1:a.pulseData.showMobile=!0}),a.closeMobile=function(){a.pulseData.showMobile=!1},f.$on("day:mobileclosed",function(e,t){a.pulseData.showMobile=!1});e=(new Date).toLocaleString("en-US",{timeZone:Intl.DateTimeFormat().resolvedOptions().timeZone});(e=new Date(e)).toLocaleString().match(/PM/g)}}}]),e.directive("v2AudioPlayer",["patronicityConfig","$stateParams","$compile","$document",function(i,r,s,c){return{restrict:"E",scope:{},link:function(e,t,n){r.type||n.type;var a,o=r.name||n.slug||"ramadan_challenge_2020",o=i.urlForTemplate("challenge/"+o+"/components/audio-players.html");t.append(s("<ng-include src=\"'"+o+"'\"></ng-include>")(e)),e.data={title:n.title||"Dua",src:n.src||void 0,icon:n.icon||"",playLabel:n.playLabel||"Play",pauseLabel:n.pauseLabel||"Pause",player:void 0,audioPlay:!1},e.playerInit=function(){(a=c[0].createElement("audio")).src=e.data.src,e.data.player=a},e.playerInit(),e.playAudio=function(){e.data.audioPlay?(e.data.player.pause(),e.data.audioPlay=!1):(e.data.player.play(),e.data.audioPlay=!0)}}}}]),e.directive("v2ChallengeDay",["patronicityConfig","$stateParams","$compile","$rootScope","GivingManager","api","User",function(s,c,l,u,d,p,m){return{restrict:"E",scope:{index:"=?",givingurl:"=?"},link:function(n,e,t){var a=c.type||t.type||"challenge",t=t.slug||c.name||"dhul_hijjah_2022",o=s.urlForTemplate("challenge/"+t+"/challenge/day.html");function i(){return n.dayData.selectedIndex>n.challengeData.dayIndexUnbound}function r(){return n.challengeData.dayIndexUnbound==n.dayData.selectedIndex}e.append(l("<ng-include src=\"'"+o+"'\"></ng-include>")(n)),m.get().then(function(){var e=m.current().UserName;n.giveListUrl="/user/newprofile#!/user-profile/give-list/"+e}),n.dayData={processing:!1,pageLocked:!0,selectedDay:1,selectedIndex:0,activeMobilePage:"pod",donatedCampaigns:[],donatedToday:!1,showOnMobile:!1,initialLoad:!0,donatedMethod:""},n.challengeData={dayIndexUnbound:0,totalDays:30,giveList:[]},u.$on("grid:selection:changed",function(e,t){n.dayData.selectedIndex=t.index,n.dayData.donatedToday=!1,n.dayData.SponsoredProjectID=void 0,t.entry&&(t.entry.Donated&&(n.dayData.donatedToday=!0,n.dayData.donatedCampaigns=[t.entry.DonatedProjectID]),n.dayData.donatedMethod=t.entry.Method,n.dayData.SponsoredProjectID=t.entry.SponsoredProjectID),n.dayData.initialLoad?n.dayData.initialLoad=!1:n.dayData.showOnMobile=!0}),n.closeMobile=function(){u.$emit("day:mobileclosed",{})},n.dailyCampaigns=function(){return n.dayData.donatedCampaigns.join()},d.load(a,t).then(function(e){n.challengeData.dayIndexBound=e.chronology.dayIndexBound,n.challengeData.dayIndexUnbound=e.chronology.dayIndexUnbound,n.challengeData.totalDays=e.chronology.totalDays,n.challengeData.remainingDays=e.chronology.remainingDays,console.log(n.challengeData),p.user.favorites.projectIds().then(function(e){n.challengeData.giveList=e.giving_project_ids})}),n.showForState=function(e){var t=!1;switch(e){case"present_no_items":t=!n.dayData.donatedToday&&n.challengeData.dayIndexUnbound==n.dayData.selectedIndex&&0==n.challengeData.giveList.length&&r();break;case"missed":t=!n.dayData.donatedToday&&!i()&&!r();break;case"future_no_items":t=i();break;case"running_charges":break;case"donated":t=n.dayData.donatedToday;break;case"present_items":t=!n.dayData.donatedToday&&void 0!==n.dayData.SponsoredProjectID&&0<n.challengeData.giveList.length&&r()}return t},n.arrowClick=function(e){n.dayData.selectedIndex="left"===e?n.dayData.selectedIndex-1:n.dayData.selectedIndex+1,n.dayData.selectedIndex=n.dayData.selectedIndex>=n.challengeData.totalDays-1?n.challengeData.totalDays-2:n.dayData.selectedIndex<=0?0:n.dayData.selectedIndex,n.index=n.dayData.selectedIndex}}}}]),e.directive("v2Top",["patronicityConfig","$stateParams","$compile","GivingSettingsManager","User",function(a,o,i,e,t){return{restrict:"E",link:function(e,t,n){o.type||n.type;n=o.name||n.slug||"ramadan_challenge_2020",n=a.urlForTemplate("challenge/"+n+"/challenge/top.html");t.append(i("<ng-include src=\"'"+n+"'\"></ng-include>")(e)),e.topPageData={processing:!1,pageLocked:!1}}}}]),e.directive("v2Settings",["patronicityConfig","$stateParams","$compile","GivingSettingsManager","givingDialogs","$state","api",function(i,r,s,c,l,u,d){return{scope:{},restrict:"E",link:function(n,e,t){var a=r.type||t.type||"challenge",o=r.name||t.slug||"ramadan_challenge_2020",t=i.urlForTemplate("challenge/"+o+"/challenge/settings.html");e.append(s("<ng-include src=\"'"+t+"'\"></ng-include>")(n)),n.intData={isDirty:!0,processing:!1,isPaused:!1},n.remindSettings={},n.save=function(t){n.remindSettings=this.remindSettings,n.$broadcast("save-settings"),n.intData.processing=!0,c.saveStoredSettings(a,o).then(function(e){d.user.saveGivingEnrollment(void 0,n.remindSettings.ramadan,n.remindSettings.dhul_hijjah,n.remindSettings.friday_givers).then(function(e){(n.intData.processing=!1)!==t&&u.go("ramadan.view.dashboard")})},function(){n.intData.processing=!1})},n.goToQuit=function(){l.showQuit(r)},n.togglePause=function(){c.load(a,o).then(function(e){"automatic"==e.method?(c.storeSettings(a,o,void 0,void 0,void 0,"manual",void 0,void 0,void 0),n.save(!1),n.intData.isPaused=!0):"manual"==e.method?(c.storeSettings(a,o,void 0,void 0,void 0,"automatic",void 0,void 0,void 0),n.save(!1),n.intData.isPaused=!1):alert("You are not enrolled yet")})},c.load(a,o).then(function(e){"automatic"!=e.method&&(n.intData.isPaused=!0)})}}}]),e.directive("v2About",["patronicityConfig","$stateParams","$compile","GivingSettingsManager","User",function(a,o,i,e,t){return{restrict:"E",link:function(e,t,n){o.type||n.type;n=o.name||n.slug||"ramadan_challenge_2020",n=a.urlForTemplate("challenge/"+n+"/challenge/about.html");t.append(i("<ng-include src=\"'"+n+"'\"></ng-include>")(e))}}}]),e.directive("v2HowItWorks",["patronicityConfig","$stateParams","$compile","GivingSettingsManager","User",function(a,o,i,e,t){return{restrict:"E",link:function(e,t,n){o.type||n.type;n=o.name||n.slug||"ramadan_challenge_2020",n=a.urlForTemplate("challenge/"+n+"/challenge/how-it-works.html");t.append(i("<ng-include src=\"'"+n+"'\"></ng-include>")(e))}}}]),e.directive("v2CompFaq",["patronicityConfig","$stateParams","$compile","GivingSettingsManager","User",function(a,o,i,e,t){return{restrict:"E",link:function(e,t,n){o.type||n.type;n=o.name||n.slug||"ramadan_challenge_2020",n=a.urlForTemplate("challenge/"+n+"/challenge/comp-faq.html");t.append(i("<ng-include src=\"'"+n+"'\"></ng-include>")(e))}}}]),e.directive("sitewideBanner",["patronicityConfig","GivingManager","GivingSettingsManager","User",function(e,t,i,r){return{restrict:"E",scope:{},templateUrl:e.urlForTemplate("challenge/ramadan_challenge_2020/components/sitewide-banner.html"),link:function(n,e,t){var a=t.type||"challenge",o=t.slug||"ramadan_challenge_2020";n.data={member:!1,donated:!1,loaded:!1},n.showBar=function(e){var t="none";return(t=n.data.loaded&&!n.data.member?"notMember":t)==e},r.get().then(function(){r.isLoggedIn()?i.load(a,o).then(function(e){"active"==e.state&&(console.log("a member"),n.data.member=!0,n.data.loaded=!0)}):n.data.loaded=!0})}}}]),e.directive("v2ImpactScore",["api","patronicityConfig","$stateParams","$compile","GivingSettingsManager","User",function(a,o,i,r,e,t){return{restrict:"E",link:function(t,e,n){i.type||n.type;n=i.name||n.slug||"ramadan_challenge_2020",n=o.urlForTemplate("challenge/"+n+"/challenge/impact-score.html");e.append(r("<ng-include src=\"'"+n+"'\"></ng-include>")(t)),t.loading=!1,t.loading=!0,a.giving.gamePointSource().then(function(e){t.data=e,t.loading=!1})}}}]),e.directive("givingTipAmount",["patronicityConfig","$stateParams","GivingSettingsManager","CurrencyCodeProvider","moneyWithDecimalFilter",function(e,p,m,g,f){return{restrict:"E",scope:{},templateUrl:e.urlForTemplate("giving/components/giving-tip-amount.html"),link:function(i,e,t){i.template=t.template||"default";var n=p.givingType||t.givingType||"challenge",t=p.name||p.slug||t.slug||"dhul_hijjah_2022",a="friday-givers"!==t?t.replace(/-/g,"_"):t,r={id:4,amount:0,label:"Other..."},s={id:0,amount:0,label:"Select an amount...",disabled:!0};function o(){var e,t,n=[],a=i.tipData.currencyCode,o=(null===i.tipData.dailyTipAmount&&n.push(s),parseFloat(i.tipData.goal));if(isNaN(o))for(e=1;e<4;e++)t=(.25*e).toFixed(2),n.push({id:e,amount:t,default:1==t});else o<20?(n.push({id:1,amount:1,default:!0}),n.push({id:2,amount:2}),n.push({id:3,amount:3})):(n.push({id:1,label:"5% ("+f(c(o,.05),a)+")",amount:c(o,.05)}),n.push({id:2,label:"10% ("+f(c(o,.1),i.tipData.currencyCode)+")",amount:c(o,.1),default:!0}),n.push({id:3,label:"15% ("+f(c(o,.15),i.tipData.currencyCode)+")",amount:c(o,.15)}));for(n.push(r),i.tipData.dailyTips=n,e=0;e<n.length;e++)void 0===n[e].label&&(n[e].label=f(n[e].amount,a)),n[e].default&&(i.tipData.defaultAmount=n[e].amount)}function c(e,t){return Number((e*t).toFixed(2))}function l(){i.tipData.dailyTips.length&&0==i.tipData.dailyTips[0].id&&i.tipData.dailyTips.shift()}function u(){angular.forEach(i.tipData.dailyTips,function(e){e.default&&(i.tipData.selectedAmount=e,i.tipData.dailyTipAmount=e.amount)})}i.tipData={currencyCode:"USD",currencySymbol:"$",selectedAmount:s},o(),i.selectDailyTips=function(){i.tipData.selectedAmount||u(),i.tipData.selectedAmount.id==r.id?(l(),i.tipData.dailyTipAmount=i.tipData.defaultAmount):i.tipData.selectedAmount.id!=s.id&&(i.tipData.dailyTipAmount=i.tipData.selectedAmount.amount,l())},i.$watch("tipData.dailyTipAmount",function(e,t){void 0!==e&&i.settingChanged()});var d=!(i.settingChanged=function(){m.storeSettings(n,a,void 0,void 0,void 0,void 0,void 0,void 0,void 0,i.tipData.dailyTipAmount)});m.load(n,a).then(function(e){i.tipData.dailyTipAmount=null===e.tip?null:parseFloat(e.tip),i.tipData.currencyCode=e.currencyCode,i.tipData.currencySymbol=g.symbolFromCode(e.currencyCode),i.tipData.goal=parseFloat(e.goal),o();var t=i.tipData.dailyTipAmount;if(!angular.isNumber(t)||isNaN(t)||null===t)null===t?i.tipData.selectedAmount=i.tipData.dailyTips[0]:"preenrolled"!==i.template&&u();else{for(var n=!1,a=0;a<i.tipData.dailyTips.length;a++)if(i.tipData.dailyTips[a].amount==t){i.tipData.selectedAmount=i.tipData.dailyTips[a],n=!0;break}n||(i.tipData.selectedAmount=r)}d||(m.subscribe(i,function(e,t){var n,a=!1;"settingsChanged"===t.eventName&&(t=t.settings,n=parseFloat(t.daily_donation_goal),i.tipData.goal!=n&&(i.tipData.goal=n,a=!0),i.tipData.currencyCode!=t.challenge_currency&&(i.tipData.currencyCode=t.challenge_currency,i.tipData.currencySymbol=g.symbolFromCode(t.challenge_currency),a=!0),a&&(o(),u()))}),d=!0)})}}}]),e.directive("qurbaniSelector",["patronicityConfig","$uibModal",function(a,o){return{restrict:"E",scope:{},template:'<a ng-click="showModal()" class="lgx-button--default__cta-white" style="max-width: 311px !important; background: #1D7AB4; margin-bottom: 19px !important;">Give by country </a>',link:function(e,t,n){e.showModal=function(){o.open({templateUrl:a.urlForTemplate("challenge/components/qurbani-dialog.html"),controller:["$scope","$uibModalInstance",function(e,t){e.ok=function(){t.close({})},e.cancel=function(){t.close({})}}],resolve:{}})}}}}]),e.directive("qurbaniSelector",["patronicityConfig","$uibModal",function(a,o){return{restrict:"E",scope:{},template:'<a ng-click="showModal()" class="lgx-button--default__cta-white" style="max-width: 311px !important; background: #1D7AB4; margin-bottom: 19px !important;">Give by country </a>',link:function(e,t,n){e.showModal=function(){o.open({templateUrl:a.urlForTemplate("challenge/components/qurbani-dialog.html"),controller:["$scope","$uibModalInstance",function(e,t){e.ok=function(){t.close({})},e.cancel=function(){t.close({})}}],resolve:{}})}}}}])}(),function(){var e=angular.module("patronicity.giving.dialogs",["patronicity.api","user","patronicity.configuration","ui.router","patronicity.clubs","patronicity.lgx.dialogs","patronicity.giving.factory","patronicity.countdown"]);e.factory("givingDialogs",["$uibModal","patronicityConfig","$state","$stateParams","$dialog","$q","$rootScope","User","GivingSettingsManager",function(s,c,l,u,a,e,d,p,m){function o(n,r){return e(function(o,i){p.get().then(function(){var e,t;p.isLoggedIn()?(e=n.type||"club",t=n.name||"friday-givers",m.load(e,t).then(function(e){var t=!0,n=!1;switch(e.state){case"new_user":n=t=!1;break;case"incomplete":n=!(t=!0);break;case"active":case"inactive":n=t=!0;break;default:console.log("What is state: "+e.state)}var a=!1;switch(r){case"userphone":case"invite":case"leaderboard":case"welcome":case"vote":case"quit":case"challenge-catchup":case"giving-message":case"giving-last-day-message":a=t;break;case"step1":case"step2":case"previousSettings":case"automatic":case"autov2":a=!n;break;case"settings":a=n;break;case"quit-confirmed":a=!0;break;case"signup-promotion-faq":case"signup-promotion-share":case"manualv2":case"donation-type-select":a=!0}(a?o:i)()})):i()},function(){console.log("Unexpected reject on User.get?"),i()})})}function i(e,t){var n=u.type;l.go(n+"."+e,t)}function r(){var e=u.type;l.go(e="club"==e?"club.home":e,{name:u.name})}function t(){l.go("ramadan.view.settings")}return{dismiss:function(){a.dismiss()},showInvite:function(e,t){o(e,"invite").then(function(){var e="givingFamily.jpg";"challenge"==u.type&&"dhul_hijjah_2019"==u.name&&(e="dhc-modal-invitefriends.jpg"),a.show({template:'<giving-invite is-initial="'+t+'" title="See who joins through your link!" img="'+e+'"></giving-invite>'}).then(function(e){"giving_with_chris"==u.name&&(window.location.href="/club#!/giving_club/giving_with_chris"),t?i("welcome",{name:u.name}):r()},function(){t?i("welcome",{name:u.name}):r()})},r)},showOnboardStep:function(e){var t,n=function(e,t){var n;switch(e){case"previousSettings":n={name:"previousSettings",template:"<giving-onboard-previous-settings></giving-onboard-previous-settings>",next:{event:"giving:membership:changed",state:"invite",params:{name:t.name,isInitial:!0}},change:{state:"onboard",params:{name:t.name,onboardPosition:"challenge"==t.type?"donation-type-select":"step1"}}};break;case"automatic":n={name:"previousSettings",template:"<giving-onboard-manual-or-automatic></giving-onboard-manual-or-automatic>",next:{state:"onboard",params:{name:t.name,onboardPosition:"step1"}},nextManual:{state:"onboard",params:{name:t.name,onboardPosition:"userphone"}},backPrevious:{state:"onboard",params:{name:t.name,onboardPosition:"previousSettings"}}};break;case"step1":n={name:"step1",template:"<giving-onboard-step-one></giving-onboard-step-one>",next:{event:"giving:membership:changed",state:"onboard",params:{name:t.name,onboardPosition:"step2"}},nextManual:{state:"onboard",params:{name:t.name,onboardPosition:"userphone"}},backChallenge:{state:"onboard",params:{name:t.name,onboardPosition:"automatic"}},backPrevious:{state:"onboard",params:{name:t.name,onboardPosition:"previousSettings"}}};break;case"step2":n={name:"step2",template:"<giving-onboard-step-two></giving-onboard-step-two>",back:{state:"onboard",params:{name:t.name,onboardPosition:"step1"}},next:{event:"challenge"==t.type?"":"giving:membership:changed",state:"challenge"==t.type?"onboard":"invite",params:"challenge"==t.type?{name:t.name,onboardPosition:"userphone"}:{name:t.name,isInitial:!0}}};break;case"userphone":n={name:"userphone",template:"<giving-onboard-get-phone-number></giving-onboard-get-phone-number>",next:{event:"giving:membership:changed",state:"invite",params:{name:t.name,isInitial:!0}},backPrevious:{state:"onboard",params:{name:t.name,onboardPosition:"step2"}}};break;case"donation-type-select":n={name:"donation-type-select",template:"<giving-onboard-manual-or-automatic></giving-onboard-manual-or-automatic>",next:{event:"giving:membership:changed",state:"onboard",params:{name:t.name,onboardPosition:"autov2"}},nextManual:{state:"onboard",params:{name:t.name,onboardPosition:"manualv2"}},backChallenge:{state:"onboard",params:{name:t.name,onboardPosition:"automatic"}},backPrevious:{state:"onboard",params:{name:t.name,onboardPosition:"previousSettings"}}};break;case"autov2":n={name:"autov2",template:"<p-dlg-join-auto></p-dlg-join-auto>",next:{event:"giving:membership:changed",state:"invite",params:{name:t.name,isInitial:!0}},backPrevious:{state:"onboard",params:{name:t.name,onboardPosition:"donation-type-select"}}};break;case"manualv2":n={name:"manualv2",template:"<p-dlg-join-manual></p-dlg-join-manual>",next:{event:"giving:membership:changed",state:"invite",params:{name:t.name,isInitial:!0}},backPrevious:{state:"onboard",params:{name:t.name,onboardPosition:"donation-type-select"}}}}return n}(e.onboardPosition,e);n?o(e,(t=n).name).then(function(){a.show({template:t.template}).then(function(e){t[e.direction]?((e=t[e.direction]).event&&d.$broadcast(e.event),i(e.state,e.params)):r()},r)},r):r()},showLeaderboard:function(e){o(e,"leaderboard").then(function(){a.show({template:"<giving-leaderboard></giving-leaderboard>"}).then(function(e){"invite"===e.direction?i("invite",{name:u.name}):r()},r)},r)},showSettings:function(e){o(e,"settings").then(function(){a.show({template:"<giving-settings></giving-settings>"}).then(function(e){r()},r)},r)},showFAQ:function(e){a.show({templateUrl:c.urlForTemplate("giving/dialogs/faq.html")}).then(function(e){r()},r)},showWelcome:function(e){o(e,"welcome").then(function(){a.show({template:"<giving-welcome></giving-welcome>"}).then(function(e){r()},r)},r)},showUmrah:function(e){a.show({template:"<challenge-reward></challenge-reward>"}).then(r,r)},showVote:function(e){o(e,"vote").then(function(){a.show({template:"<giving-vote></giving-vote>"}).then(r,r)},r)},profileChangeChallengeStatus:function(e,r){var t=r?c.urlForTemplate("user-profile/dialogs/activate-challenge.html"):c.urlForTemplate("user-profile/dialogs/pause-challenge.html");s.open({templateUrl:t,controller:["$scope","$uibModalInstance","api",function(t,e,n){var a=u.slug,o="friday-givers"!==a?a.replace(/-/g,"_"):a,i=u.givingType;t.slugString={friday_givers:"Friday Givers",ramadan_challenge:"Ramadan Challenge",dhul_hijjah:"Dhul Hijjah Challenge"},t.currentSlugString="friday-givers"==a?t.slugString.friday_givers:"ramadan-challenge-2023"==a?t.slugString.ramadan_challenge:t.slugString.dhul_hijjah,t.changeStatus=function(){t.$broadcast("save-settings"),n.user.saveGivingEnrollment(void 0,void 0,void 0,void 0).then(function(e){m.storeSettings(i,o,void 0,void 0,void 0,r?"automatic":"manual",void 0,void 0,void 0),m.saveStoredSettings(i,o).then(function(){},function(e){alert(e)}).finally(function(){t.cancel(),l.reload()})})},t.cancel=function(){e.close()}}],resolve:{},backdrop:"static"})},profileEnroll:function(e,t){t=t?c.urlForTemplate("user-profile/dialogs/enroll.html"):c.urlForTemplate("user-profile/dialogs/un-enroll.html");s.open({templateUrl:t,controller:["$scope","$uibModalInstance",function(e,t){var n=u.slug;e.slugString={friday_givers:"Friday Givers",ramadan_challenge:"Ramadan Challenge",dhul_hijjah:"Dhul Hijjah Challenge"},e.currentSlugString="friday-givers"==n?e.slugString.friday_givers:"ramadan-challenge-2023"==n?e.slugString.ramadan_challenge:e.slugString.dhul_hijjah,e.cancel=function(){t.close()}}],resolve:{},backdrop:"static"})},profileShowQuit:function(e){s.open({templateUrl:c.urlForTemplate("user-profile/dialogs/leave-challenge.html"),controller:["$scope","$uibModalInstance","api",function(n,e,a){var t=u.slug,o="friday-givers"!==t?t.replace(/-/g,"_"):t,i=u.givingType,r=u.username;n.slugString={friday_givers:"Friday Givers",ramadan_challenge:"Ramadan Challenge",dhul_hijjah:"Dhul Hijjah Challenge"},n.currentSlugString=t.includes("friday-givers")?n.slugString.friday_givers:!t.includes("ramadan-challenge")&&t.includes("dhul-hijjah")?n.slugString.dhul_hijjah:n.slugString.ramadan_challenge,n.processing=!1,n.quit=function(){n.processing=!0,m.quit(i,o).then(function(e){var t={ramadan:!1,dhul_hijjah:!1,friday_givers:!1};a.user.getGivingEnrollment().then(function(e){angular.forEach(e,function(e){1==e.value&&(t[e.type]=!0)});t[{ramadan_challenge_2023:"ramadan",dhul_hijjah_2022:"dhul_hijjah","friday-givers":"friday_givers"}[o]]=!1,a.user.saveGivingEnrollment(void 0,t.ramadan,t.dhul_hijjah,t.friday_givers).then(function(e){d.$broadcast("giving:membership:changed"),n.$close({direction:"quit"}),n.cancel(),s.open({templateUrl:c.urlForTemplate("user-profile/dialogs/success.html"),controller:["$scope","$uibModalInstance",function(e,t){e.cancel=function(){t.close(),l.go("user-profile.auto-giving-and-challenges",{username:r},{reload:"user-profile.auto-giving-and-challenges"})}}],resolve:{},backdrop:"static"})})})}).finally(function(){n.processing=!1})},n.cancel=function(){e.close()}}],resolve:{},backdrop:"static"})},showQuit:function(e){"ramadan_challenge_2020"==e.name||"dhul_hijjah_2020"==e.name?o(e,"quit").then(function(){a.show({template:"<giving-quit-confirm></giving-quit-confirm>"}).then(function(e){console.log(e),"quit"===e.direction?i("quit-confirmed",{name:u.name}):t()},t)},t):o(e,"quit").then(function(){a.show({template:"<giving-quit-confirm></giving-quit-confirm>"}).then(function(e){console.log(e),"quit"===e.direction?i("quit-confirmed",{name:u.name}):r()},r)},r)},showQuitConfirmed:function(e){o(e,"quit-confirmed").then(function(){a.show({template:"<giving-quit-confirmed></giving-quit-confirmed>"}).then(r,r)},r)},showSignupPromotionFAQ:function(e){a.show({template:"<giving-signup-promotion-faq></giving-signup-promotion-faq>"}).then(r,r)},showSignupPromotionShare:function(e){o(e,"signup-promotion-share").then(function(){a.show({template:'<giving-invite type="challenges" isInitial="true" slug="ramadan_challenge_2018" title="Share Your Link for the Umrah Contest" img="_rc-umrah-share.png" text="Sign up with my link to LaunchGoods 30 Day Giving Challenge and help me win an Umrah! "></giving-invite>'}).then(r,r)},r)},showCatchupScreen:function(e){o(e,"challenge-catchup").then(function(){a.show({template:"<giving-catchup></giving-catchup>"}).then(r,r)},r)},showGivingMessageScreen:function(e){o(e,"giving-message").then(function(){a.show({template:"<giving-message></giving-message>"}).then(r,r)},r)},showGivingLastDayScreen:function(e){o(e,"giving-last-day-message").then(function(){a.show({template:"<giving-last-day-message></giving-last-day-message>"}).then(r,r)},r)}}}]),e.directive("givingInvite",["patronicityConfig","User","$sce","$state","$stateParams","$location","GivingManager",function(e,t,n,a,s,o,c){return{restrict:"E",templateUrl:e.urlForTemplate("giving/dialogs/invite.html"),link:function(t,e,n){var a=s.name||n.slug||"friday-givers",o=s.type||n.type||"club",i=n.isInitial&&"true"==n.isInitial||!1,r=n.text;t.meta={},t.meta.imgSlug=n.img,t.meta.title=n.title,t.shareUrls={loading:!0},c.load(o,a).then(function(e){t.shareUrls={copyText:"Copy Link",message:r||e.stats.general.callToAction,facebook:e.stats.share.facebook,userUnique:e.stats.share.url,isInitial:i,loading:!1}}),t.copySuccess=function(e){t.shareUrls.copyText="Copied!"}}}}]),e.directive("givingSettings",["patronicityConfig","User","$stateParams","GivingSettingsManager","GivingManager","$rootScope","$analytics","$state",function(e,t,s,c,l,u,d,p){return{restrict:"E",templateUrl:e.urlForTemplate("giving/dialogs/settings.html"),link:function(n,e,t){var a=s.name||t.slug||"friday-givers",o=s.type||t.type||"club",i=(d.eventTrack("LoadSettings",{category:o,label:a}),n.settings={},n.club={},{}),r=(l.load(o,a).then(function(e){n.club=e}),["goal","currencyCode","currencySymbol","cardId","state","method","reminder","tipAmount"]);c.load(o,a).then(function(e){e=e,n.settings.type=o,n.settings.goal=parseFloat(e.goal),n.settings.currencyCode=e.currencyCode,n.settings.currencySymbol=e.currencySymbol,n.settings.cardId=e.currentCardId,n.settings.state=e.state,n.settings.method=e.method,n.settings.name=e.name,n.settings.reminder=e.reminder,n.settings.tipAmount=isNaN(parseFloat(e.tip))?0:parseFloat(e.tip),r.forEach(function(e){i[e]=n.settings[e]})}),n.settingsChanged=function(){var t=!1;return r.forEach(function(e){i[e]!=n.settings[e]&&(t=!0)}),c.storeSettings(o,a,n.settings.goal,n.settings.currencyCode,n.settings.cardId,n.settings.method,n.settings.reminder,n.settings.emailReminder,!1,n.settings.tipAmount),t},n.goToQuit=function(){p.go(o+".quit")},n.update=function(){c.saveStoredSettings(o,a).then(function(e){d.eventTrack("SaveSettings",{category:o,label:a}),u.$broadcast("giving:membership:changed"),n.$close()},function(e){alert(e)})},n.totalWithTip=function(){return parseFloat(n.settings.goal)+parseFloat(n.settings.tipAmount)},c.subscribe(n,function(e,t){t&&t.settings&&null!=t.settings.tip_amount&&(n.settings.tipAmount=t.settings.tip_amount)})}}}]),e.directive("givingWelcome",["patronicityConfig","$stateParams","$timeout","$rootScope","GivingManager",function(e,o,i,r,s){return{restrict:"E",templateUrl:e.urlForTemplate("giving/dialogs/welcome-message.html"),link:function(t,e,n){var a=o.name||n.slug||"friday-givers",n=o.type||n.type||"club";t.data={name:"",type:n},t.isActive=!1,t.activeButton=function(){t.isActive=!0,i(function(){t.$close(),r.$broadcast("giving:membership:changed")},500)},s.load(n,a).then(function(e){t.data.name=e.name}),t.animatedClose=function(){t.$close()},i(function(){t.$close(),r.$broadcast("giving:membership:changed")},4e3)}}}]),e.directive("givingSignupPromotionFaq",["patronicityConfig","$stateParams","GivingManager","$state",function(e,i,r,s){return{restrict:"E",templateUrl:e.urlForTemplate("challenge/"+i.name+"/signup-promotion-faq.html"),link:function(e,t,n){var a=i.name||n.slug||"friday-givers",o=i.type||n.type||"club";r.load(o,a).then(function(e){}),e.share=function(){"club"===o?s.go("club.signup-promotion-share"):s.go("challenge.signup-promotion-share")}}}}]),e.directive("givingOnboardPreviousSettings",["patronicityConfig","$stateParams","CurrencyCodeProvider","GivingSettingsManager","api","$analytics",function(e,i,r,s,c,l){return{restrict:"E",templateUrl:e.urlForTemplate("giving/dialogs/onboardPreviousSettings.html"),link:function(n,e,t){var a=i.name||t.slug||"friday-givers",o=i.type||t.type||"club";n.settings={type:o,goal:"",currencyCode:r.defaultCurrencyCode(),cardId:void 0,cardDescription:"Loading..."},s.load(o,a).then(function(t){n.settings.goal=t.previous.daily_donation_goal,n.settings.method=t.previous.donation_method,n.settings.currencyCode=t.previous.challenge_currency,n.settings.card_id=t.previous.preferred_card_id,c.user.cards.forGivingType(a,o).then(function(e){e.cards.forEach(function(e){t.previous&&e.ID==t.previous.giving_credit_card_id&&(n.settings.cardDescription=e.SimpleDescription)})})}),n.change=function(){n.$close({direction:"change"})},n.save=function(){s.save(o,a,n.settings.goal,n.settings.currencyCode,n.settings.card_id,n.settings.method).then(function(){l.eventTrack("SavePreviousSettings",{category:o,label:a}),n.$close({direction:"next"})})}}}}]),e.directive("givingOnboardManualOrAutomatic",["patronicityConfig","$stateParams","GivingManager","GivingSettingsManager","$analytics",function(e,r,s,c,l){return{restrict:"E",templateUrl:e.urlForTemplate("giving/dialogs/onboardAutomaticManual.html"),link:function(t,e,n){var a=r.name||n.slug||"friday-givers",o=r.type||n.type||"club",i=(t.settings={period:void 0,name:"Ramadan",method:void 0,previousValid:!1},s.load(o,a).then(function(e){t.settings.name=e.strings.shortName,t.settings.period=e.stats.general.periodName,t.settings.periodSingular=e.stats.general.periodAbbreviation}),!1);c.load(o,a).then(function(e){t.settings.method=e.method,i=e.previous&&1==e.previous.onboard_complete}),t.back=function(){i?t.$close({direction:"backPrevious"}):t.$close({direction:"back"})},t.$watch("settings.method",function(e,t){}),t.next=function(){c.save(o,a,void 0,void 0,void 0,t.settings.method).then(function(){"manual"==t.settings.method?t.$close({direction:"nextManual"}):(l.eventTrack("GivingMethod",{category:o,label:a}),t.$close({direction:"next"}))})}}}}]),e.directive("givingOnboardStepOne",["patronicityConfig","$stateParams","CurrencyCodeProvider","GivingSettingsManager","$analytics",function(e,i,r,s,c){return{restrict:"E",templateUrl:e.urlForTemplate("giving/dialogs/onboardStepOne.html"),link:function(t,e,n){var a=i.name||n.slug||"friday-givers",o=i.type||n.type||"club";t.settings={goal:"",currencyCode:r.defaultCurrencyCode(),cardId:void 0},s.load(o,a).then(function(e){t.settings.goal=e.goal,t.settings.currencyCode=e.currencyCode,t.settings.method=e.method}),t.back=function(){"challenge"==o?t.$close({direction:"backChallenge"}):s.load(o,a).then(function(e){e.previous&&1==e.previous.onboard_complete?t.$close({direction:"backPrevious"}):t.$close({direction:"back"})})},t.next=function(){s.save(o,a,t.settings.goal,t.settings.currencyCode).then(function(){"manual"==t.settings.method?(c.eventTrack("OnboardComplete",{category:o,label:a}),t.$close({direction:"nextManual"})):(c.eventTrack("GivingAmount",{category:o,label:a}),t.$close({direction:"next"}))})}}}}]),e.directive("givingOnboardGetPhoneNumber",["api","patronicityConfig","$stateParams","CurrencyCodeProvider","GivingSettingsManager",function(i,e,r,t,s){return{restrict:"E",templateUrl:e.urlForTemplate("giving/dialogs/onboardGetPhoneNumber.html"),link:function(t,e,n){var a=r.name||n.slug||"friday-givers",o=r.type||n.type||"club";t.phonenumber=!0,t.verifyWaiting=!1,t.backPhone=!1,t.saveButtonText="Connect",t.regEx="d+((-d+)+)?",t.countryCode="1",t.connect=function(){t.getphonenumberform.phone.$valid&&t.getphonenumberform.verifyCode.$untouched?(t.completePhone="+"+t.countryCode+t.phone,i.smsReminder.sendVerification(t.completePhone).then(function(e){t.verifyWaiting=!0,t.backPhone=!0,t.phonenumber=!1,t.saveButtonText="Verify",t.msg="Please check your phone for verification code."},function(e){t.msg=e})):t.getphonenumberform.verifyCode.$valid&&t.getphonenumberform.phone.$valid&&i.smsReminder.verifyCode(t.verifyCode).then(function(e){t.msg=e.response,3==e.success&&s.load(o,a).then(function(e){s.save(o,a,e.goal,e.currencyCode,e.currentCardId,e.method,1).then(function(){t.$close({direction:"next"})})})},function(e){})},t.back=function(){t.$close({direction:"backPrevious"})},t.skip=function(){t.$close({direction:"next"})}}}}]),e.directive("givingOnboardStepTwo",["patronicityConfig","$stateParams","GivingSettingsManager","$analytics",function(e,i,r,s){return{restrict:"E",templateUrl:e.urlForTemplate("giving/dialogs/onboardStepTwo.html"),link:function(t,e,n){var a=i.name||n.slug||"friday-givers",o=i.type||n.type||"club";t.settings={goal:"",currencyCode:"USD",currencySymbol:"$",cards:[],card_id:void 0},r.load(o,a).then(function(e){t.settings.goal=e.goal,t.settings.currencyCode=e.currencyCode,t.settings.currencySymbol=e.currencySymbol,t.settings.card_id=e.currentCardId}),t.back=function(){t.$close({direction:"back"})},t.finish=function(){r.save(o,a,t.settings.goal,t.settings.currencyCode,t.settings.card_id).then(function(e){s.eventTrack("OnboardComplate",{category:o,label:a}),t.$close({direction:"next"})})}}}}]),e.directive("givingMessage",["patronicityConfig","$stateParams","GivingManager","$compile","User","api",function(e,o,i,r,s,c){return{restrict:"E",template:"<section></section>",link:function(t,n,e){var a=o.name||e.slug||"friday-givers",e=o.type||e.type||"club";t.data={messageToShow:{}},i.load(e,a).then(function(e){e.introMessages&&0<e.introMessages.length?(t.data.messageToShow=e.introMessages[0],e=angular.element(t.data.messageToShow.Content),n.replaceWith(e),r(e)(t)):(console.log("Message directive called but nothing to show!"),t.$close())}),t.close=function(){t.user=s.current(),c.giving.messages.saveViewed(a,t.user.ID,t.data.messageToShow).then(function(e){t.$close()})}}}}]),e.directive("givingPaymentMethod",["patronicityConfig","api","$stateParams","GivingManager","CurrencyCodeProvider","$dialog",function(e,r,s,c,l,u){return{restrict:"E",scope:{currencyCode:"=",cardId:"=",amount:"="},templateUrl:e.urlForTemplate("giving/dialogs/components/payment-method.html"),link:function(n,e,t){var a=s.name||t.slug||"friday-givers",o=s.type||t.type||"club";function i(){return n.paymentSettings.loading=!0,r.user.cards.forGivingType(a,o).then(function(e){1==e.cards.length&&n.paymentSettings.cardId==e.cards[0].ID&&(n.cardId=e.cards[0].ID),e.cards.unshift({ID:"new",SimpleDescription:"+ Add Card"}),n.paymentSettings.cards=e.cards,n.paymentSettings.loading=!1},function(){})}n.paymentSettings={currencyCode:"$",periodName:"week",loading:!0,cardId:n.cardId},n.$watch("cardId",function(e){n.paymentSettings.cardId!==e&&(n.paymentSettings.cardId=e)}),n.$watch("paymentSettings.cardId",function(e){"new"==e?u.show({template:"<giving-add-card-dialog></giving-add-card-dialog>"}).then(function(e){var t=e.ID;i().then(function(){n.cardId=t})},function(){n.paymentSettings.cardId=void 0}):n.cardId=e}),n.$on("user:login-change",function(){i()}),i(),c.load(o,a).then(function(e){n.paymentSettings.periodName=e.stats.general.periodName,n.paymentSettings.nextCharge=e.nextCharge}),null==n.currencyCode&&(n.currencyCode="USD"),n.$watch("currencyCode",function(){n.paymentSettings.currencySymbol=l.symbolFromCode(n.currencyCode)})}}}]),e.directive("challengeGetPhoneNumber",["api","patronicityConfig","$stateParams","CurrencyCodeProvider","GivingSettingsManager","User",function(o,e,t,n,a,i){return{restrict:"E",scope:{reminder:"="},templateUrl:e.urlForTemplate("giving/components/challenge-get-phone-number.html"),link:function(t,e,n){var a;t.phonenumber=!1,t.verifiedPhoneNumber=null,t.verifyWaiting=!1,t.backPhone=!1,t.saveButtonText="Connect",t.regEx="d+((-d+)+)?",t.countryCode="1",t.editNumberButton=!0,i.get().then(function(){a=i.current().Mobile,t.verifiedPhoneNumber=a}),t.changeNumber=function(){t.phonenumber=!0,t.verifiedPhoneNumber=null,t.editNumberButton=!1},t.cancel=function(){t.phonenumber=!1,t.verifiedPhoneNumber=a,t.saveButtonText="Connect",t.editNumberButton=!0,t.verifyWaiting=!1,t.verifyCode=null,t.getphonenumberform.verifyCode.$setUntouched()},t.connect=function(){t.getphonenumberform.phone.$valid&&t.getphonenumberform.verifyCode.$untouched?(t.completePhone="+"+t.countryCode+t.phone,o.smsReminder.sendVerification(t.completePhone).then(function(e){t.verifyWaiting=!0,t.backPhone=!0,t.phonenumber=!1,t.saveButtonText="Verify",t.msg="Please check your phone for verification code."},function(e){t.msg=e})):t.getphonenumberform.verifyCode.$valid&&t.getphonenumberform.phone.$valid&&o.smsReminder.verifyCode(t.verifyCode).then(function(e){t.msg=e.response,3==e.success&&t.$close({direction:"next"})},function(e){})},t.verify=function(){o.smsReminder.verifyCode(t.verifyCode).then(function(e){t.msg=e.response,3==e.success&&(t.verifyWaiting=!1,t.verifiedPhoneNumber=t.completePhone)},function(e){console.log(e),t.msg="Invalid code"})}}}}]),e.directive("givingGivingAmount",["patronicityConfig","CurrencyCodeProvider","GivingManager","$stateParams",function(e,i,r,s){return{restrict:"E",scope:{amount:"=",currencyCode:"="},templateUrl:e.urlForTemplate("giving/dialogs/components/giving-amount.html"),link:function(t,e,n){var a=s.name||n.slug||"friday-givers",o=s.type||n.type||"club";t.data={suggestedAmounts:[],period:"Weekly",currencyCodes:[],minimum:1},i.supportedCodes(o).then(function(e){t.data.currencyCodes=e.map(function(e){return e.code})}),r.load(o,a).then(function(e){t.data.period=(e=e.stats.general.periodName).charAt(0).toUpperCase()+e.slice(1)}),null==t.currencyCode&&(t.currencyCode="USD"),t.$watch("currencyCode",function(){t.changeCurrency()}),t.changeCurrency=function(){t.currencySymbol=i.symbolFromCode(t.currencyCode),i.minimumDonationForCode(t.currencyCode,o).then(function(e){t.data.minimum=e}),i.suggestedGivingAmountsForCode(t.currencyCode,o).then(function(e){t.data.suggestedAmounts=e})},t.changeCurrency()}}}]),e.directive("challengeMethodAutomaticOrManual",["patronicityConfig","$stateParams","GivingManager",function(e,o,i){return{restrict:"E",scope:{method:"="},templateUrl:e.urlForTemplate("giving/dialogs/components/challenge-method-automatic-manual.html"),link:function(t,e,n){var a=o.name||n.slug||"friday-givers",n=o.type||n.type||"club";t.settings={period:void 0,name:"Ramadan"},i.load(n,a).then(function(e){t.settings.name=e.strings.shortName,t.settings.period=e.stats.general.periodName,t.settings.periodSingular=e.stats.general.periodAbbreviation})}}}]),e.directive("clubMethodActiveOrPaused",["patronicityConfig","$stateParams","GivingManager",function(e,o,i){return{restrict:"E",scope:{method:"="},templateUrl:e.urlForTemplate("giving/dialogs/components/club-method-active-or-paused.html"),link:function(t,e,n){var a=o.name||n.slug||"friday-givers",n=o.type||n.type||"club";t.settings={period:void 0,name:"Ramadan"},i.load(n,a).then(function(e){t.settings.name=e.name,t.settings.period=e.stats.general.periodName,t.settings.periodSingular=e.stats.general.periodAbbreviation})}}}]),e.directive("givingAddCardDialog",["api","$stateParams","$analytics",function(e,i,r){return{restrict:"E",template:'<add-card-modal-contents template-url="giving/dialogs/addCard.html"></add-card-modal-contents>',link:function(n,e,t){var a=i.name||t.slug||"friday-givers",o=i.type||t.type||"club";n.$on("add-card:cancel",function(){n.$cancel()}),n.$on("add-card:added",function(e,t){r.eventTrack("AddCard",{category:o,label:a}),n.$close(t)})}}}]),e.directive("givingLeaderboardUserList",["api","$stateParams","GivingManager","patronicityConfig",function(l,u,e,t){return{restrict:"E",scope:{},templateUrl:t.urlForTemplate("giving/dialogs/components/givingLeaderboardUserList.html"),link:function(n,e,t){var a=u.name||t.slug||"friday-givers",o=u.type||t.type||"club",i=t.listType,r=t.perPage||5,t="Ramadan Challenge",s="Dhul Hijjah Challenge";function c(){var e,t=(n.settings.page-1)*r;n.settings.page+=1,e=r+1,("global"==i?l.giving.members.leaderboard:l.giving.user.friends)(o,a,e,t).then(function(e){n.settings.users=n.settings.users.concat(e.slice(0,r)),n.settings.showViewMore=e.length>r,"global"!=i&&(e.length?n.settings.title="club"===o?"Active friends who joined through you":"Friends who joined through you":(n.settings.title="club"===o?"No active friends who joined through you":"No one joined through you yet",n.settings.showNotification=!0))})}n.challengeText=t,a.includes("ramadan")||(n.challengeText=s),n.settings={type:i,title:"global"==i?"Members with most friends joined":"Loading...",users:[],showNotification:!1,page:1,showViewMore:!1,self:{}},l.giving.members.userRank(o,a).then(function(e){n.settings.self=e[0]}),n.viewMore=function(){c()},c()}}}]),e.directive("givingLeaderboard",["patronicityConfig","$stateParams","GivingManager",function(e,o,i){return{restrict:"E",templateUrl:e.urlForTemplate("giving/dialogs/leaderboard.html"),link:function(t,e,n){var a=o.name||n.slug||"friday-givers",n=o.type||n.type||"club";t.settings={tab:"personal",totalFriendsJoined:0},i.userStats(n,a).then(function(e){t.settings.totalFriendsJoined=e.referredUserCount}),t.showInviteModal=function(){t.$close({direction:"invite"})}}}}]),e.directive("challengeReward",["patronicityConfig","givingDialogs","api","$stateParams","GivingManager",function(e,t,n,i,r){return{templateUrl:e.urlForTemplate("giving/dialogs/reward.html"),link:function(t,e,n){var a,o=i.name||n.slug||"friday-givers",n=(t.slug=o,i.type||n.type||"club");r.userStats(n,o).then(function(e){t.settings.totalFriendsJoined=e.referredUserCount}),t.settings={tab:"personal",totalFriendsJoined:0},n=n,o=o,a=!1,t.data={},r.userStats(n,o,a).then(function(e){t.data.daysDonated=e.totalDaysDonated,t.data.friendsCounts=e.referredUserCount,t.data.points=e.points})}}}]),e.directive("givingVote",["patronicityConfig","$stateParams","GivingManager",function(e,o,i){return{restrict:"E",templateUrl:e.urlForTemplate("giving/dialogs/vote.html"),link:function(t,e,n){var a=o.name||n.slug||"friday-givers",n=o.type||n.type||"club";i.load(n,a).then(function(e){t.data={facebookVoteGroupID:e.stats.general.facebookVoteGroupID}})}}}]),e.directive("givingFaq",["patronicityConfig","$stateParams","GivingManager",function(e,o,i){return{restrict:"E",scope:{},templateUrl:e.urlForTemplate("giving/dialogs/components/faq.html"),link:function(t,e,n){var a=o.name||n.slug||"friday-givers",n=o.type||n.type||"club";i.load(n,a).then(function(e){t.data=e.faq})}}}]),e.directive("faqItem",["$compile",function(o){return{restrict:"E",scope:{item:"="},link:function(n,a,e){console.log("the faq item"),n.$watch("item",function(e){var t;e&&(t="<h2>"+e.title+"</h2>",t+="<p>"+e.body+"</p>",a.append(o(t)(n)))})}}}]),e.directive("givingQuitConfirm",["patronicityConfig","$stateParams","GivingManager","GivingSettingsManager","$rootScope",function(e,i,r,s,c){return{restrict:"E",templateUrl:e.urlForTemplate("giving/dialogs/quit-confirm.html"),link:function(n,e,t){var a=i.name||t.slug||"friday-givers",o=i.type||t.type||"club";n.settings={type:o,name:"",totalDays:0,totalDonation:0,currencyCode:void 0,method:void 0},r.load(o,a).then(function(t){"challenge"==o?(n.settings.name=t.strings.shortName+" Challenge",n.settings.totalDays=t.chronology.remainingDays,t.user.iterationsDonated&&t.user.iterationsDonated.forEach(function(e){e.Iteration==t.user.currentIteration&&--n.settings.totalDays}),s.load(o,a).then(function(e){n.settings.totalDonation=n.settings.totalDays*e.goal,n.settings.currencyCode=e.currencyCode,n.settings.method=e.method})):n.settings.name=t.name}),n.quit=function(){s.quit(o,a).then(function(e){c.$broadcast("giving:membership:changed"),n.$close({direction:"quit"})})}}}}]),e.directive("givingQuitConfirmed",["patronicityConfig","$stateParams","GivingManager",function(e,o,i){return{restrict:"E",templateUrl:e.urlForTemplate("giving/dialogs/quit-confirmed.html"),link:function(t,e,n){t.slug=o.name||n.slug||"friday-givers";var a=o.type||n.type||"club";t.settings={name:"",type:a},i.load(a,t.slug).then(function(e){t.settings.name="challenge"==a?e.strings.shortName+" Challenge":e.name})}}}]),e.directive("givingCatchup",["patronicityConfig","$stateParams","GivingManager","GivingSettingsManager","$rootScope","$timeout","GivingProjectRandomizer",function(e,s,c,t,l,u,d){return{restrict:"E",templateUrl:e.urlForTemplate("giving/dialogs/catchup.html"),link:function(a,e,t){var o,i=s.name||t.slug||"friday-givers",r=s.type||t.type||"club";function n(e){var n=e||!1;c.userStats(r,i,n).then(function(e){var t=0;n&&(a.data.member={alternates:[],catchupItems:[]},a.data.user.daysDonated=0),e.entries.forEach(function(e){(!e.Donated||(t+=1,-1<a.data.justSupported.indexOf(e.DayIndex)))&&a.data.member.catchupItems.push(e)}),d.init(e.alternates),a.data.user.daysDonated=t,a.data.user.daysToCatchUp=a.data.dayIndexUnbound+1-a.data.user.daysDonated,void 0===o&&(o=u(function(){var n=[];angular.forEach(a.data.member.catchupItems,function(e,t){e.Donated||n.push(e)}),a.data.member.catchupItems=n},7e3))})}a.data={type:r,dayIndexUnbound:0,id:void 0,user:{daysDonated:0,daysToCatchUp:0},member:{catchupItems:[]},justSupported:[],shortName:void 0},c.load(r,i).then(function(e){a.data.id=e.id,"challenge"==r&&(a.data.dayIndexUnbound=e.chronology.dayIndexUnbound,n()),e.name.includes("Ramadan")?a.data.shortName="Ramadan":e.name.includes("Dhul Hijjah")&&(a.data.shortName="Dhul Hijjah")}),a.afterCompleteUrl=function(){return encodeURI("/"+r+"#!/"+r+"/"+i+"/catchup")},a.alternateProject=function(n){a.data.member.catchupItems.forEach(function(e,t){e.DayIndex==n&&(e.SponsoredProjectID=d.nextProject(e.SponsoredProjectID))})},l.$on("challenge:donated",function(e,t){a.data.justSupported.push(t.day),n(!0)})}}}]),e.directive("givingLastDayMessage",["patronicityConfig","$stateParams","GivingManager",function(e,o,i){return{restrict:"E",templateUrl:e.urlForTemplate("giving/dialogs/last-day-message.html"),link:function(e,t,n){var a=o.name||n.slug||"friday-givers",n=o.type||n.type||"club";i.load(n,a).then(function(e){})}}}]),e.directive("pDlgJoinAuto",["patronicityConfig","$stateParams","GivingManager","GivingSettingsManager","api","User","$anchorScroll","$location","$analytics","CurrencyCodeProvider","givingDialogs",function(e,r,s,c,l,u,d,p,m,g,f){return{restrict:"E",templateUrl:e.urlForTemplate("pulse/dialogs/join-auto.html"),link:function(o,e,t){o.slug=r.name||t.slug||"ramadan_challenge_2019","giving_with_chris"==o.slug&&(o.giveWithText="This is the amount you will donate every time Chris donates. We will not charge you more than $100 per month.");var i=r.type||t.type||"challenge";function n(){c.load(i,o.slug).then(function(e){e=e,o.settings.type=i,e.goal&&(o.settings.goal=parseInt(e.goal)),e.name&&(o.settings.name=e.name),o.settings.currencyCode=e.currencyCode,o.settings.currencySymbol=e.currencySymbol,o.settings.cardId=e.currentCardId,o.settings.state=e.state,o.settings.method=e.method,o.settings.reminder=e.reminder,o.settings.emailReminder=e.emailReminder,o.settings.state=e.state}),l.user.cards.forGivingType(o.slug,i).then(function(e){o.settings.cards=e.cards},function(){})}function a(){return c.save(i,o.slug,o.settings.goal,o.settings.currencyCode,o.settings.cardId,o.settings.method,o.settings.reminder,o.settings.emailReminder,!1,o.settings.tipAmount).then(function(e){})}o.settings={name:"",type:i,goal:10,currencyCode:"USD",cards:[]},o.data={currencyCodes:[],minimumAmount:1,currencySymbol:"$",suggestedAmounts:[3,5,10,15,20,40]},o.clubs={"Friday Givers":"Friday"},o.addNewCard=!1,o.showAddCard=function(){o.addNewCard=!0;var e="addCardSection";p.hash()!==e&&p.hash(e),d("addCardSection"),o.settings.cardId=""},o.cardSavedCallback=function(e,t,n){o.settings.cardId=e.ID,o.settings.cards.push(e),o.cardSelected()},o.canSubmit=function(){var e=!1;return e=1<=o.settings.goal&&o.settings.cardId&&!o.invalidCardCurrencyPair?!0:e},s.load(i,o.slug).then(function(e){o.settings.shortName=e.strings.shortName,o.settings.name="challenge"==i?e.strings.shortName+" Challenge":e.name,o.settings.nextCharge=e.nextCharge}),g.supportedCodes(i).then(function(e){o.data.currencyCodes=e.map(function(e){return e.code})}),o.$watchCollection("settings",function(e,t){for(var n,a=0;a<o.settings.cards.length;a++)if(o.settings.cards[a].ID==o.settings.cardId){n=o.settings.cards[a].TypeEnum;break}c.storeSettings(i,o.slug,o.settings.goal,o.settings.currencyCode,o.settings.cardId,o.settings.method,o.settings.reminder,o.settings.emailReminder,!1,o.settings.tipAmount,void 0,void 0,n),e&&t&&e.currencyCode!==t.currencyCode&&(o.data.currencySymbol=g.symbolFromCode(e.currencyCode),g.minimumDonationForCode(e.currencyCode,i).then(function(e){o.data.minimumAmount=e}),g.suggestedGivingAmountsForCode(e.currencyCode,i).then(function(e){o.data.suggestedAmounts=e}))}),u.get().then(function(){n(),o.settings.email=u.current().Email}),o.back=function(){o.$close({direction:"backPrevious"})},o.save=function(){var e;o.settings.method="automatic",o.settings.emailReminder=0,o.settings.reminder=0,"new_user"==o.settings.state?(e=p.search().src,c.join(i,o.slug,e).then(function(e){m.eventTrack("Join",{category:i,label:o.slug})}).then(function(e){a().then(function(e){"giving_with_chris"==o.slug?f.showInvite(r):(m.eventTrack("OnboardComplate",{category:i,label:o.slug}),o.$close({direction:"next"}),p.hash(""))})},function(e){alert(e)})):a().then(function(e){"giving_with_chris"==o.slug?f.showInvite(r):(o.$close({direction:"next"}),p.hash(""))})},o.cardSelected=function(){o.addNewCard=!1},o.invalidCardCurrencyPair=!1,c.subscribe(o,function(e,t){t&&t.settings&&null!=t.settings.tip_amount&&(o.settings.tipAmount=t.settings.tip_amount),"amex"==t.settings.giving_credit_card_type&&"USD"!=t.settings.challenge_currency?o.invalidCardCurrencyPair=!0:o.invalidCardCurrencyPair=!1})}}}]),e.directive("pDlgJoinManual",["patronicityConfig","$stateParams","GivingManager","GivingSettingsManager","api","User","$q","$location","$analytics",function(e,s,c,l,u,d,p,m,g){return{restrict:"E",templateUrl:e.urlForTemplate("pulse/dialogs/join-manual.html"),link:function(a,e,t){var n=s.name||t.slug||"ramadan_challenge_2019",o=s.type||t.type||"challenge";function i(){l.load(o,n).then(function(e){e=e,a.settings.type=o,e.goal&&(a.settings.goal=parseInt(e.goal)),a.settings.currencyCode=e.currencyCode,a.settings.currencySymbol=e.currencySymbol,a.settings.cardId=e.currentCardId,a.settings.state=e.state,a.settings.method=e.method,a.settings.name=e.name,a.settings.reminder=e.reminder,a.settings.emailReminder=e.emailReminder,a.settings.state=e.state,a.settings.loading=!1})}function r(){a.settings.method="manual",p(function(t,n){1==a.settings.reminder&&a.getphonenumberform.phoneNumber.$valid&&a.getphonenumberform.verifyCode.$untouched?(a.settings.needPhoneVerification=!0,a.settings.phone.completePhone="+"+a.settings.phone.countryCode+a.settings.phone.phoneNumber,u.smsReminder.sendVerification(a.settings.phone.completePhone).then(function(e){a.verifyWaiting=!0,t({message:"Please check your phone for verification code.",status:"sentVerification"})},function(e){n(e)})):1==a.settings.reminder&&a.getphonenumberform.verifyCode.$valid&&a.getphonenumberform.phoneNumber.$valid?u.smsReminder.verifyCode(a.settings.phone.verifyCode).then(function(e){a.msg=e.response,3==e.success?(a.settings.needPhoneVerification=!1,t({message:"Verified!",status:"verified"})):t({message:e.response,status:"verifyFailed"})},function(e){n(e)}):t({message:"",status:"noVerificationNeeded"})}).then(function(e){"verified"==e.status||"noVerificationNeeded"==e.status?("verified"==e.status?a.settings.reminder=1:a.settings.reminder=0,l.save(o,n,a.settings.goal,a.settings.currencyCode,a.settings.cardId,a.settings.method,a.settings.reminder,a.settings.emailReminder).then(function(e){}).then(function(e){g.eventTrack("OnboardComplete",{category:o,label:n}),a.$close({direction:"next"})},function(e){alert(e)})):(a.settings.phoneHelptext=e.message,a.settings.loading=!1)},function(e){a.settings.phoneHelptext=e.message,a.settings.loading=!1})}a.settings={name:"",type:o,needPhoneVerification:!1,phoneHelptext:"",loading:!0,phone:{countryCode:"1",phoneNumber:"",completePhone:"",verifyCode:""}},c.load(o,n).then(function(e){a.settings.name="challenge"==o?e.strings.shortName+" Challenge":e.name}),d.get().then(function(){i(),a.settings.email=d.current().Email}),a.save=function(){var e;a.settings.loading=!0,a.settings.method="manual","new_user"==a.settings.state?(e=m.search().src,l.join(o,n,e).then(function(e){g.eventTrack("Join",{category:o,label:n})}).then(function(e){r()})):r()},a.back=function(){a.$close({direction:"backPrevious"})}}}}])}(),function(){var e=angular.module("patronicity.giving.factory",["ui.bootstrap","patronicity.api","user","patronicity.configuration","ui.router","patronicity.common.currency"]);e.factory("GivingManager",["api","$q","$rootScope",function(a,e,t){var o={};function n(){o={club:{items:{},stats:{},amounts:{}},challenge:{items:{},stats:{},amounts:{}}}}function i(e){"club"!=e&&"challenge"!=e&&alert("INVALID TYPE: "+e)}return n(),t.$on("giving:membership:changed",function(e){n()}),t.$on("user:login-change",function(e){n()}),{load:function(e,t,n){return i(e),void 0!==o[e].items[t]&&!n||(o[e].items[t]=a.giving.load(e,t)),o[e].items[t]},userStats:function(e,t,n){return i(e),void 0!==o[e].stats[t]&&!n||(o[e].stats[t]=a.giving.members.stats(e,t)),o[e].stats[t]}}}]),e.factory("GivingProjectRandomizer",function(){var a={queues:[],currentQueueIndex:0,totalProjectCount:0,scrambled:[],skippedProjectIds:[]};function o(e){for(var t=!1,n=e;n<a.queues.length;n++)if(a.scrambled=function(e){for(var t,n,a=e.slice(),o=0,o=a.length-1;0<o;--o)t=Math.floor(Math.random()*(o+1)),n=a[o],a[o]=a[t],a[t]=n;return a}(a.queues[n]),0<a.scrambled.length){a.currentQueueIndex=n,t=!0;break}t||alert("No Alternative Projects found!")}function i(){o(0)}return{init:function(e){a.queues=[],a.skippedProjectIds=[],a.totalProjectCount=0;var n=[];e.forEach(function(e){var t=[];e.forEach(function(e){-1==n.indexOf(e)&&(t.push(e),n.push(e),a.totalProjectCount++)}),a.queues.push(t)}),i()},nextProject:function(e){var t;a.skippedProjectIds.length>=a.totalProjectCount&&(a.skippedProjectIds=[],i()),-1==a.skippedProjectIds.indexOf(e)&&a.skippedProjectIds.push(e);do{0==a.scrambled.length&&o((a.currentQueueIndex+1)%a.queues.length);var n=a.scrambled.shift()}while(void 0===(t=-1==a.skippedProjectIds.indexOf(n)?n:t));return t}}}),e.factory("GivingSettingsManager",["api","$q","GivingManager","CurrencyCodeProvider","User","$rootScope",function(r,s,c,o,i,n){var t,l=o.defaultCurrencyCode(),y={},v={},u={challenge:{},club:{}};function d(e,t,n){var a="1",a=(i.isCountryEU()&&(a="0"),e.settings.reminder&&(a=e.settings.reminder),e.settings.emailReminder&&e.settings.email_reminder,{referringUserID:e.static.referringUserID,signupDate:e.static.signupDate,startDate:e.static.startDate,suspendDate:e.static.suspendDate,goal:e.settings.daily_donation_goal,onboard_complete:e.settings.onboard_complete,currentCardId:e.settings.giving_credit_card_id,method:e.settings.donation_method,reminder:a,state:e.settings.state,emailReminder:e.settings.email_reminder,coverFees:e.settings.cover_fees,migratedFromPreviousChallenge:e.settings.migrated_from_previous,tip:e.settings.tip_amount,previous:e.settings.previous,lastTen:e.settings.last_ten}),e=(e.static.isMember||(a.state="new_user"),void 0===e.settings.challenge_currency?(a.currencyCode=l,a.currencySymbol=o.symbolFromCode(l)):(a.currencyCode=e.settings.challenge_currency,a.currencySymbol=o.symbolFromCode(e.settings.challenge_currency)),a.bestOnboardingState=function(e){var t="idle";if(e.previous&&1==e.previous.onboard_complete&&void 0===e.method)t="previousSettings";else switch(e.method){case"automatic":t="autov2";break;case"manual":t="manualv2";break;default:t="donation-type-select"}return t}(a),{goal:a.goal,currencyCode:a.currencyCode,currentCardId:a.currentCardId,method:a.method,reminder:a.reminder,emailReminder:a.emailReminder,coverFees:a.coverFees,tip:a.tip,lastTen:a.lastTen});return p(t,n,a.goal,a.currencyCode,a.currentCardId,a.method,a.reminder,a.emailReminder,a.coverFees,a.tip,e,a.lastTen),a}function b(e,t,n,a,o){var i=!1,o=o||!1;return void 0===y[e]&&(y[e]={}),void 0===y[e][t]&&(y[e][t]={}),void 0===v[e]&&(v[e]={}),void 0===v[e][t]&&(v[e][t]={}),void 0!==a&&(o?JSON.stringify(v[e][t][n])!=JSON.stringify(a)&&(v[e][t]=a,i=y[e][t].server_data_loaded=!0):y[e][t][n]!=a&&(y[e][t][n]=a,i=!0)),i}function p(e,t,n,a,o,i,r,s,c,l,u,d,p){var m,g,f=!1,n=(f=(f=(f=(f=(f=(f=(f=(f=(f=(f=(f|=b(e,t,"daily_donation_goal",n))|b(e,t,"challenge_currency",a))|b(e,t,"giving_credit_card_id",o))|b(e,t,"giving_credit_card_type",p))|b(e,t,"donation_method",i))|b(e,t,"reminder",r))|b(e,t,"email_reminder",s))|b(e,t,"cover_fees",c))|b(e,t,"tip_amount",l))|b(e,t,"serverVersion",u,!0))|b(e,t,"last_ten",d),y[e][t]),h=v[e][t];f&&n.server_data_loaded&&(m={goal:n.daily_donation_goal,currencyCode:n.challenge_currency,currentCardId:n.giving_credit_card_id,method:n.donation_method,reminder:n.reminder,emailReminder:n.emailReminder,coverFees:n.cover_fees,tip:void 0===n.tip_amount?null:n.tip_amount,lastTen:n.last_ten},g={},angular.forEach(["goal","currencyCode","currentCardId","method","reminder","emailReminder","coverFees","tip","lastTen"],function(e){"tip"==e?(null===h[e]&&null!==m[e]||m[e]!=h[e])&&(g[e]={server:h[e],local:m[e]}):m[e]!=h[e]&&(g[e]={server:h[e],local:m[e]})}),w({eventName:"settingsChanged",settings:n,deltas:g,local:m,server:h}))}function m(o,i){var e=s(function(n,a){c.load(o,i).then(function(e){var t=y[o][i]||{};r.giving.user.settings.save(o,e.id,t).then(function(e){n(d(e,o,i))},a)},a)});return g(o,i,e)}function g(e,t,n){return u[e][t]=n,u[e][t]}function w(e){n.$emit("givingsettings-service-event",e)}return{load:function(e,t,n){var a,o;return void 0!==u[e][t]&&!n||(u[e][t]=(a=e,o=t,s(function(t,n){c.load(a,o).then(function(e){r.giving.user.settings.load(a,e.id).then(function(e){null===e||"object"!=typeof e||e instanceof Array?n():t(d(e,a,o))},n)},n)}))),u[e][t]},save:function(e,t,n,a,o,i,r,s,c,l,u){return p(e,t,n,a,o,i,r,s,c,l,void 0,u),g(e,t,m(e,t))},setState:function(a,o,i){return s(function(t,n){c.load(a,o).then(function(e){r.giving.user.settings.save(a,e.id,{newState:i}).then(function(e){t(d(e,a,o))},n)},n)})},clear:function(a,o){var e=s(function(t,n){c.load(a,o).then(function(e){r.giving.user.settings.clear(a,e.id).then(function(e){t(d(e,a,o))},n)},n)});return g(a,o,e)},join:function(a,o,e){var i={},e=(void 0!==e&&(i.src=e),s(function(t,n){c.load(a,o,!0).then(function(e){r.giving.user.join(a,e.id,i).then(function(e){t(d(e,a,o))},n)},n)}));return g(a,o,e)},quit:function(a,o){var e=s(function(t,n){c.load(a,o).then(function(e){r.giving.user.quit(a,e.id).then(function(e){t(d(e,a,o))},n)},n)});return g(a,o,e)},setSrc:function(e){null==t&&void 0!==e&&(t=e)},getSrc:function(e){return t},storeSettings:p,saveStoredSettings:m,subscribe:function(e,t){t=n.$on("givingsettings-service-event",t);e.$on("$destroy",t)},notify:w}}])}(),function(){var e=angular.module("patronicity.home",["patronicity.configuration"]);e.directive("homePage",["api","patronicityConfig","$timeout",function(e,t,a){return{restrict:"E",templateUrl:function(e,t){return void 0!==t.templateUrl?t.templateUrl:"home.html"},scope:{},link:function(e,t,n){a(function(){$(window).scroll(function(){var n=$(window).scrollTop();$(".lgx-home_banner--bg:not(.lgx-hone_banner--secondary.lgx-home_banner--bg)").each(function(){var e,t=$(this);1==t.isOnScreen()&&(e=t.offset().top,t.css("transform","translate3d(0, "+.3*(n-e)+"px, 0)"))})}),$.fn.isOnScreen=function(){var e=$(window),t={top:e.scrollTop(),left:e.scrollLeft()},e=(t.right=t.left+e.width(),t.bottom=t.top+e.height(),this.offset());return e.right=e.left+this.outerWidth(),e.bottom=e.top+this.outerHeight(),!(t.right<e.left||t.left>e.right||t.bottom<e.top||t.top>e.bottom)}},100)}}}]),e.controller("homeLgxController",["api","GlobalStatsManager","searchApi","moment","$scope","GivingManager","User","CurrencyCodeProvider","$window",function(e,t,n,a,o,i,r,s,c){o.stats={},o.searchIconClicked=!1,l(),i.load("club","friday-givers").then(function(e){o.newMembers=e.stats.general.newMembers,o.period=e.stats.general.newUserPeriodSuffix,o.totalMembers=e.stats.general.memberCount}),t.subscribe(o,function(e,t){l()});i=a().utc().subtract({hours:1}),a=a().utc();e.donationStream.donationsDuringInterval(i,a).then(function(e){e&&e.total_funded_during_interval&&(o.totalDonationsDuringPastHour=e.total_funded_during_interval)}),n.getTotalElasticSearchActiveDocuments().then(function(e){o.totalCampaigns=e}),r.get().then(function(){o.currencySymbol=s.symbolFromCode(r.getPreferredCurrency())});function l(){t.stats().then(function(e){o.stats=e})}o.isMobileView=!1,c.innerWidth<=800&&(o.isMobileView=!0),angular.element(c).on("resize",function(){var e=o.isMobileView;c.innerWidth<=800?o.isMobileView=!0:o.isMobileView=!1,e!=o.isMobileView&&o.$apply()}),o.$on("$destroy",function(){angular.element(c).off("resize")}),o.redirectToDiscoverPageWithSearchTerm=function(){o.searchIconClicked?o.searchTerm&&(c.location.href="/discover#!?search="+o.searchTerm):o.searchIconClicked=!0},o.$on("currency-selected",function(e,t){o.currencySymbol=s.symbolFromCode(t.currencyCode)})}]),e.directive("homepageBanners",["api","patronicityConfig",function(a,e){return{restrict:"E",templateUrl:"homepageBanners.html",scope:{},link:function(n,e,t){a.home.banners().then(function(e){for(var t=0;t<e.length;t++)e[t].Style={"background-image":"url("+e[t].ImageURL+")"};n.banners=e})}}}])}(),angular.module("patronicity-upload",["ngAnimate","angularFileUpload","ui.bootstrap","patronicity.configuration"]).service("imageUpload",["$http","$timeout","$upload","$uibModal","patronicityConfig",function(e,r,s,t,c){this.selectVideo=function(a,o,e){return t.open({templateUrl:c.urlForTemplate("video-upload-modal.html"),controller:["$scope","$uibModalInstance","$http",function(t,n,e){t.State="awaiting_add",t.progress=0,t.params={VideoURL:""},t.error="",t.cancel=function(){n.dismiss("cancel")},t.add=function(){t.State="uploading",e.post(c.databaseEndpointUrl("video-url-upload"),{type:a,id:o,url:t.params.VideoURL}).success(function(e){t.progress=100,e.success?n.close(e.result):(t.State="error","unrecognized"==e.message?t.unrecognizedError=!0:(t.unrecognizedError=!1,t.error=e.message))}).error(function(e,t,n,a){alert("ERROR: "+t)})}}]})},this.updateImageCaptionAndLink=function(a,o,e,i){return t.open({templateUrl:c.urlForTemplate("image-upload-modal.html"),controller:["$scope","$uibModalInstance",function(t,n){t.state="caption",t.dataUrl=a,t.params={caption:e,link:i},t.cancel=function(){n.dismiss("cancel")},t.ok=function(){var e={guid:o,url:a,caption:t.params.caption,link:t.params.link};n.close(e)}}],size:"sm"})},this.selectImage=function(a,o,i,e){return t.open({templateUrl:c.urlForTemplate("image-upload-modal.html"),windowClass:"center-modal",controller:["$scope","$uibModalInstance",function(n,t){n.fileReaderSupported=null!=window.FileReader,n.uploadRightAway=!0,n.howToSend=1,n.progress=-1,n.state="select",n.upload=null,n.params={caption:"",link:"http://"},n.usedLocation=!1,void 0!==e&&(n.usedLocation=e),n.hasUploader=function(){return null!=n.upload},n.abort=function(){n.upload.abort(),n.upload=null},n.onFileSelect=function(e){n.hasUploader()&&n.abort(),n.uploadResult=null,n.selectedFile=e[0],n.dataUrl=null;var t,e=e[0];window.FileReader&&-1<e.type.indexOf("image")&&((t=new FileReader).onload=function(e){r(function(){n.dataUrl=e.target.result})},t.readAsDataURL(e),n.uploadRightAway&&n.start())},n.start=function(){var e;n.state="uploading",n.progress=0,n.errorMsg=null,1==n.howToSend?n.upload=s.upload({url:c.apiEndpointURL("media/legacyUpload"),data:{type:a,id:o},file:n.selectedFile}).then(function(e){200==e.status?e.data.success?(n.uploadResult=e.data.result,i?n.state="caption":n.ok()):alert(e.data.message):alert("Error on upload: "+e.statusText)},function(e){0<e.status&&(n.errorMsg=e.status+": "+e.data)},function(e){n.progress=Math.min(100,parseInt(100*e.loaded/e.total)),100==n.progress&&(n.state="resizing")}):((e=new FileReader).onload=function(e){n.upload=s.http({url:c.apiEndpointURL("media/legacyUpload"),headers:{"Content-Type":n.selectedFile.type},data:e.target.result}).then(function(e){200==e.status?e.data.success?n.uploadResult=e.data.result:alert(e.data.message):alert("Error on upload: "+e.statusText)},function(e){0<e.status&&(n.errorMsg=e.status+": "+e.data)},function(e){n.progress=Math.min(100,parseInt(100*e.loaded/e.total))})},e.readAsArrayBuffer(n.selectedFile))},n.resetInputFile=function(){for(var e=document.getElementsByTagName("input"),t=0;t<e.length;t++)"file"==e[t].type&&(e[t].value=null)},n.ok=function(){var e={guid:n.uploadResult.guid,url:n.uploadResult.url,caption:n.params.caption,link:n.params.link};t.close(e)},n.cancel=function(){t.dismiss("cancel")}}],size:"sm"})}}]),function(){var e=angular.module("patronicity.lgx.navigation",["patronicity.api","user","patronicity.configuration"]);e.directive("lgxHeader",["patronicityConfig","User",function(e,t){return{restrict:"E",templateUrl:e.urlForTemplate("lgx-header.html"),scope:{},link:function(e,t,n){}}}]),e.directive("lgxFooter",["patronicityConfig","GlobalStatsManager","$filter","$window","GivingManager","User","CurrencyCodeProvider","moment",function(e,i,r,s,c,l,u,d){return{restrict:"E",templateUrl:e.urlForTemplate("lgx-footer.html"),scope:{},link:function(n,e,t){function a(){i.stats().then(function(e){n.stats=e})}n.stats={};var o=d().toDate();n.date=o,n.hijrahDate=r("hijrah")(o,"currentHijrah"),n.currentYear=d().year(),a(),i.subscribe(n,function(e,t){a()}),c.load("club","friday-givers").then(function(e){n.newMembers=e.stats.general.newMembers,n.period=e.stats.general.newUserPeriodSuffix,n.totalMembers=e.stats.general.memberCount}),l.get().then(function(){n.currencySymbol=u.symbolFromCode(l.getPreferredCurrency())}),n.$on("currency-selected",function(e,t){n.currencySymbol=u.symbolFromCode(t.currencyCode)});n.isMobileView=!1,s.innerWidth<=800&&(n.isMobileView=!0),angular.element(s).on("resize",function(){var e=n.isMobileView;s.innerWidth<=800?n.isMobileView=!0:n.isMobileView=!1,e!=n.isMobileView&&n.$apply()}),n.$on("$destroy",function(){angular.element(s).off("resize")})}}}]),e.directive("lgxUserMenu",["patronicityConfig","User","$window",function(e,a,o){return{restrict:"E",templateUrl:e.urlForTemplate("lgx-user-menu.html"),scope:{},link:function(n,e,t){n.data={subNavOpen:!1},a.get().then(function(){n.data.user=a.current(),n.data.isLoggedIn=a.isLoggedIn(),n.data.user&&(n.username=n.data.user.UserName)}),n.loginSignUp=function(e){a.loginModal(!1,"lgx",e).then(function(e){n.data.subNavOpen=!1;var t=document.getElementById("fc_frame");t&&t.classList.contains("lgx-hidefc")&&t.classList.remove("lgx-hidefc")})},n.logout=function(){a.logout()},n.toggleNavMenu=function(){n.data.subNavOpen=!n.data.subNavOpen;var e=document.getElementById("fc_frame"),e=(null!=e&&(e.classList.contains("lgx-hidefc")?e.classList.remove("lgx-hidefc"):e.classList.add("lgx-hidefc")),document.getElementById("mainheader")),t=document.body;n.data.subNavOpen?(e.classList.add("lgx-c-header-navopen"),t.classList.add("lgx-c-header-navopenbg"),n.myGiving=!1,n.myFundraising=!1,n.mySettings=!1):0==n.data.subNavOpen&&(e.classList.remove("lgx-c-header-navopen"),t.classList.remove("lgx-c-header-navopenbg"))},n.redirectToDiscoverPageWithSearchTerm=function(){n.searchTerm&&(o.location.href="/discover#!?search="+n.searchTerm,o.location.pathname.includes("/discover")&&o.location.reload())},n.$on("user:login-change",function(e,t){t.loggedIn?(n.data.user=t.user,n.username=n.data.user.UserName):n.data.user=null,n.data.isLoggedIn=a.isLoggedIn()})}}}])}(),angular.module("patronicity.lgx.dialogs",["ng.deviceDetector"]).factory("$dialog",["$q","$rootScope","$compile","$templateRequest","detectUtils","$window",function(e,c,l,a,t,n){var o=".lgx-c-modal";function u(n){return e(function(e,t){n.remove(),$("body").removeClass("has-modal"),e()})}function d(){t.isMobile()&&$(o).length&&(n.innerWidth<520?$(o).css({height:n.innerHeight}):$(o).css({height:"auto"}))}n.addEventListener("resize",d);var p=[];function m(e,t){for(var n,a=0,a=0;a<p.length;a++)if(p[a].scope==t){n=a;break}void 0!==n&&p.splice(n,1)}return{dismiss:function(){0<p.length&&p[p.length-1].scope.$dismiss()},show:function(s){return e(function(i,r){var n;n=s,e(function(t,e){n.template?t(n.template):n.templateUrl&&a(n.templateUrl).then(function(e){t(e)},e)}).then(function(e){var t,n=c.$new(!0),a=(o=n,t=angular.element('<div class="lgx-c-modal-wrap" ng-click="$clickBackground($event)"></div>'),l(t)(o),t),o=l(e)(n);a.append(o),p.push({scope:n,params:s}),$("body").append(a),$("body").addClass("has-modal"),d(),n.$dismiss=function(){m(0,n),u(a).then(function(){n.$destroy()})},n.$cancel=function(){m(0,n),u(a).then(function(){r(),n.$destroy()},r)},n.$close=function(e){m(0,n),u(a).then(function(){i(e),n.$destroy()},r)},n.$clickBackground=function(e){e.target!=a[0]||null!=s.backgroundCloses&&1!=s.backgroundCloses||n.$cancel()}},r)})}}}]),angular.module("patronicity.skeleton",["patronicity.api","user","patronicity.configuration"]).directive("skeletonLoading",["patronicityConfig",function(e){return{restrict:"A",transclude:!0,scope:!0,templateUrl:e.urlForTemplate("skeleton-loading.html"),link:function(e,t,n){e.type=n.type}}}]),function(){var e=angular.module("patronicity.navigation",["patronicity.api","user","patronicity.configuration"]);e.directive("topNavigation",["patronicityConfig",function(e){return{restrict:"E",templateUrl:e.urlForTemplate("navigation/navigation.html"),link:function(n,e,t){n.$on("user:login-change",function(e,t){t.loggedIn?n.user=t.user:n.user=null})}}}]),e.directive("bottomFooter",["patronicityConfig","GlobalStatsManager","User",function(e,o,i){return{restrict:"E",scope:{},templateUrl:e.urlForTemplate("navigation/footer.html"),link:function(n,e,t){function a(){o.stats().then(function(e){n.stats=e})}n.user=void 0,i.get().then(function(){i.loggedIn()&&(n.user=i.current())}),n.$on("user:login-change",function(e,t){t.loggedIn?n.user=t.user:n.user=null}),n.CopyRightDate=new Date,a(),o.subscribe(n,function(e,t){a()})}}}]),e.directive("globalStat",["GlobalStatsManager","$filter",function(o,i){return{restrict:"E",scope:{startDate:"@?",endDate:"@?",stat:"@?",format:"@?"},template:"<span>{{stats}}</span>",link:function(t,e,n){function a(){o.filterStats(t.startDate,t.endDate).then(function(e){return t.stats=function(e,t){var n=e;void 0!==t&&(n="numberSuffix"===t?i(t)(e,0):i(t)(e));return n}(e[t.stat],t.format),t.stats})}t.stats="",t.$watch("startDate",function(){t.startDate&&t.endDate&&a()}),a(),o.subscribe(t,function(e,t){a()})}}}]),e.factory("GlobalStatsManager",["api","$rootScope","$q",function(a,o,i){var r={},s=i.defer();function c(e,t,n){return void 0!==r.globalStats&&!e||(r.globalStats=a.home.footerStats()),void 0===r.liveStats[l(t,n)]&&t&&n&&(r.globalStats=a.donationStream.filterLoad(t,n)),r.globalStats.then(function(e){r.liveStats=e,s.resolve(r.liveStats)}),s.promise}function l(e,t){return parseInt(e)+parseInt(t)}return r={globalStats:void 0,liveStats:{}},{load:function(e){return void 0!==r.globalStats&&!e||(r.globalStats=a.home.footerStats()),r.globalStats},stats:function(e,t){return c(!1,e,t)},filterStats:function(e,t){var n=i.defer();return void 0===r.globalStats&&(r.globalStats=a.home.footerStats()),void 0===r.liveStats[l(e,t)]&&e&&t&&(r.globalStats=a.donationStream.filterLoad(e,t)),r.globalStats.then(function(e){r.liveStats=e,n.resolve(r.liveStats)}),n.promise},updateStat:function(e,t){var n,a;n=e,a=t,c().then(function(){r.liveStats[n]=a}),o.$emit("global-stats-service-event",void 0)},subscribe:function(e,t){t=o.$on("global-stats-service-event",t);e.$on("$destroy",t)},notify:function(e){o.$emit("global-stats-service-event",e)}}}]),e.directive("statsUnitSection",["patronicityConfig","moment","$filter",function(e,a,t){return{restrict:"EA",scope:{startDate:"@",endDate:"@",unit:"@"},template:'<global-stat start-date="{{ start }}" end-date="{{ end }}" stat="{{ key }}" format="noDecimalCurrency"></global-stat>',link:function(e,t,n){e.currentMoment=a.utc(),"today"==e.unit?(e.start=e.currentMoment.startOf("day").unix(),e.end=e.currentMoment.endOf("day").unix(),e.key=parseInt(e.start)+parseInt(e.end)):"lastweek"==e.unit?(e.start=a().utc().subtract(1,"week").startOf("day").unix(),e.end=a().utc().subtract(1,"day").endOf("day").unix(),e.key=parseInt(e.start)+parseInt(e.end)):"lastmonth"==e.unit?(e.start=a().utc().subtract(1,"month").startOf("day").unix(),e.end=a().utc().subtract(1,"day").endOf("day").unix(),e.key=parseInt(e.start)+parseInt(e.end)):"range"==e.unit?(e.start=a.parseZone(n.startDate).utc().unix(),e.end=a.parseZone(n.endDate).utc().unix(),e.key=parseInt(e.start)+parseInt(e.end)):"alltime"==e.unit&&(e.start=void 0,e.end=void 0,e.key="total_funded")}}}]),e.directive("searchAndUserNavigation",["api","User","patronicityConfig",function(e,a,t){return{restrict:"E",templateUrl:t.urlForTemplate("navigation/searchAndUserNavigation.html"),scope:{},link:function(n,e,t){n.user=void 0,a.loggedIn()&&(n.user=a.current()),n.logout=function(){a.logout()},n.$on("user:login-change",function(e,t){t.loggedIn?n.user=t.user:n.user=null})}}}]),e.directive("navigationSearchForm",function(){return{restrict:"E",templateUrl:"navigationSearchForm.html",scope:{sponsor:"="},link:function(e,t,n){var a=t.find("input[type=text]"),o=t.find(".sb-search");function i(){function t(e){r(),this.removeEventListener("click",t),this.removeEventListener("touchstart",t)}var e,n;o.addClass("sb-search-open"),e=navigator.userAgent||navigator.vendor||window.opera,n=!1,(n=!(!/(android|ipad|playbook|silk|bb\d+|meego).+mobile|avantgo|bada\/|blackberry|blazer|compal|elaine|fennec|hiptop|iemobile|ip(hone|od)|iris|kindle|lge |maemo|midp|mmp|netfront|opera m(ob|in)i|palm( os)?|phone|p(ixi|re)\/|plucker|pocket|psp|series(4|6)0|symbian|treo|up\.(browser|link)|vodafone|wap|windows (ce|phone)|xda|xiino/i.test(e)&&!/1207|6310|6590|3gso|4thp|50[1-6]i|770s|802s|a wa|abac|ac(er|oo|s\-)|ai(ko|rn)|al(av|ca|co)|amoi|an(ex|ny|yw)|aptu|ar(ch|go)|as(te|us)|attw|au(di|\-m|r |s )|avan|be(ck|ll|nq)|bi(lb|rd)|bl(ac|az)|br(e|v)w|bumb|bw\-(n|u)|c55\/|capi|ccwa|cdm\-|cell|chtm|cldc|cmd\-|co(mp|nd)|craw|da(it|ll|ng)|dbte|dc\-s|devi|dica|dmob|do(c|p)o|ds(12|\-d)|el(49|ai)|em(l2|ul)|er(ic|k0)|esl8|ez([4-7]0|os|wa|ze)|fetc|fly(\-|_)|g1 u|g560|gene|gf\-5|g\-mo|go(\.w|od)|gr(ad|un)|haie|hcit|hd\-(m|p|t)|hei\-|hi(pt|ta)|hp( i|ip)|hs\-c|ht(c(\-| |_|a|g|p|s|t)|tp)|hu(aw|tc)|i\-(20|go|ma)|i230|iac( |\-|\/)|ibro|idea|ig01|ikom|im1k|inno|ipaq|iris|ja(t|v)a|jbro|jemu|jigs|kddi|keji|kgt( |\/)|klon|kpt |kwc\-|kyo(c|k)|le(no|xi)|lg( g|\/(k|l|u)|50|54|\-[a-w])|libw|lynx|m1\-w|m3ga|m50\/|ma(te|ui|xo)|mc(01|21|ca)|m\-cr|me(rc|ri)|mi(o8|oa|ts)|mmef|mo(01|02|bi|de|do|t(\-| |o|v)|zz)|mt(50|p1|v )|mwbp|mywa|n10[0-2]|n20[2-3]|n30(0|2)|n50(0|2|5)|n7(0(0|1)|10)|ne((c|m)\-|on|tf|wf|wg|wt)|nok(6|i)|nzph|o2im|op(ti|wv)|oran|owg1|p800|pan(a|d|t)|pdxg|pg(13|\-([1-8]|c))|phil|pire|pl(ay|uc)|pn\-2|po(ck|rt|se)|prox|psio|pt\-g|qa\-a|qc(07|12|21|32|60|\-[2-7]|i\-)|qtek|r380|r600|raks|rim9|ro(ve|zo)|s55\/|sa(ge|ma|mm|ms|ny|va)|sc(01|h\-|oo|p\-)|sdk\/|se(c(\-|0|1)|47|mc|nd|ri)|sgh\-|shar|sie(\-|m)|sk\-0|sl(45|id)|sm(al|ar|b3|it|t5)|so(ft|ny)|sp(01|h\-|v\-|v )|sy(01|mb)|t2(18|50)|t6(00|10|18)|ta(gt|lk)|tcl\-|tdg\-|tel(i|m)|tim\-|t\-mo|to(pl|sh)|ts(70|m\-|m3|m5)|tx\-9|up(\.b|g1|si)|utst|v400|v750|veri|vi(rg|te)|vk(40|5[0-3]|\-v)|vm40|voda|vulc|vx(52|53|60|61|70|80|81|83|85|98)|w3c(\-| )|webc|whit|wi(g |nc|nw)|wmlb|wonu|x700|yas\-|your|zeto|zte\-/i.test(e.substr(0,4)))||n)||a.focus();document.addEventListener("click",t),document.addEventListener("touchstart",t)}function r(){a.blur(),o.removeClass("sb-search-open")}String.prototype.trim||(String.prototype.trim=function(){return this.replace(/^\s+|\s+$/g,"")}),o.bind("click touchstart",function(e){e.stopPropagation(),o.hasClass("sb-search-open")?o.hasClass("sb-search-open")&&/^\s*$/.test(a.val())&&(e.preventDefault(),r()):(e.preventDefault(),i())}),a.bind("click touchstart",function(e){e.stopPropagation()}),e.submitSearch=function(e){e.preventDefault()}}}})}(),angular.module("patronicity.notifications",["patronicity.api","patronicity.configuration"]).directive("notificationArea",["patronicityConfig",function(e){return{restrict:"E",scope:{userId:"@"},templateUrl:e.urlForTemplate("notification-template.html"),controller:["$scope","api",function(t,n){t.notifications=[],n.notifications.all().then(function(e){t.notifications=e}),t.readNotification=function(e){n.notifications.markRead(e,{})}}]}}]),angular.module("patronicity.payment_providers",["patronicity.payment_providers.wepay","patronicity.payment_providers.stripe","patronicity.payment_providers.bluesnap","patronicity.payment_providers.flutterwave","patronicity.payment_providers.adyen","patronicity.payment_providers.cliq"]),angular.module("patronicity.payment_methods.apple",["user","patronicity.configuration"]).factory("applePayFactory",["$q","User","$window","api","$timeout","$location",function(e,a,o,c,i,t){var l={scriptId:"apple-pay-id",srcUrl:"https://applepay.cdn-apple.com/jsapi/v1/apple-pay-sdk.js",merchantId:"000000000200565",environment:"stage",merchantName:"LaunchGood Inc.",verbose:!1};function u(e,t){l.verbose&&(t?console.info("ApplePay: "+e,t):console.info("ApplePay: "+e))}var r,s=e.defer();function n(){return null==r&&(r=e.defer(),a.get().then(function(){var e=a.getPaymentProviderMode("adyen-applepay"),t=a.getPaymentProviderKey("adyen-applepay"),n="launchgood"==a.getApplication()?"LaunchGood, Inc.":"Patronicity, LLC.";l.environment="production"==e?"PRODUCTION":"TEST",l.merchantId=t.length?t:void 0,"PRODUCTION"==l.environment&&"launchgood"==a.getApplication()&&(n="LaunchGood.com"),l.merchantName=n,document.getElementById(l.scriptId)||((e=document.createElement("script")).id=l.scriptId,e.src=l.srcUrl,e.addEventListener("load",function(e){i(function(){u("loadcheckout button complete"),s.resolve()},0)}),document.body.appendChild(e)),s.promise.then(function(){l.merchantId&&o.ApplePaySession?(u("paymentClientLoaded:",o.ApplePaySession),r.resolve(o.ApplePaySession)):r.reject()},r.reject)},r.reject)),r.promise}return{supported:function(){return e(function(t,e){n().then(function(e){u("supported:",e.canMakePayments()),t(e.canMakePayments())},e)})},getButton:function(a){return e(function(e,t){var n=document.createElement("apple-pay-button");n.setAttribute("buttonstyle","black"),n.setAttribute("type","support"),n.setAttribute("local","us-EN"),n.addEventListener("click",a),e(n)})},completeTransaction:function(e,t){var n={status:t?e.STATUS_SUCCESS:e.STATUS_FAILURE};u("completeTransaction: ",t),e.completePayment(n)},getTokenFromPaymenResult:function(e){var t=new Date,t=new Date(t.setMonth(t.getMonth()+1)),n=(""+(t.getMonth()+1)).padStart(2,"0"),t=""+t.getFullYear(),a=e.token.paymentMethod.displayName.split(" "),o="",i="";return 2==a.length&&(o=a[0].toLowerCase(),i=a[1]),u("getTokenFromPayentResult: ",e),{type:"adyen-applepay",token:{type:"adyen-applepay",currency:e.currency,encrypted:JSON.stringify(e.token.paymentData)},digest:o+"|"+i+"|"+n+t}},getShippingFromPaymentResult:function(e){var t;return u("getShippingFromPaymentResult",e),e.shipping_address&&(e=e.shipping_address).givenName&&e.familyName&&e.addressLines&&e.addressLines.length&&e.locality&&e.administrativeArea&&e.postalCode&&e.countryCode&&(t=e.addressLines.slice(1),t={id:void 0,name:(e.givenName+" "+e.familyName).trim(),line1:e.addressLines[0],line2:t.join(" ").trim(),city:e.locality,state:e.administrativeArea,zip:e.postalCode,country:e.countryCode,save:!1}),u("getShippingFromPaymentResult result =>",t),t},handleTransaction:function(e){return u("In handle transaction:",e),e.session.begin(),e.deferred},preflightTransaction:function(r){var s={session:null,deferred:null};return s.deferred=e(function(o,t){u("In preflight Transaction",r);var n=[],e=(angular.forEach(r.acceptedCards,function(e){switch(e.toLowerCase()){case"american express":n.push("amex");break;case"mastercard":n.push("masterCard");break;case"visa":n.push("visa");break;case"discover":n.push("discover")}}),{countryCode:r.country,currencyCode:r.currency,supportedNetworks:n,merchantCapabilities:["supports3DS"],total:{label:l.merchantName,amount:r.amount}}),a=[],i=(r.requireShipping&&(a=["postalAddress","name","phone"]),r.requireEmail&&a.push("email"),a.length&&(e.requiredShippingContactFields=a),u("Configuring apple pay with",e),new ApplePaySession(3,e));(s.session=i).onvalidatemerchant=function(e){u("onvalidatemerchant",e),c.donate.applePaySession(e.validationURL).then(function(e){u("Adyen Applpay session result",e),i.completeMerchantValidation(e.token)},function(e){u("api.donate.applePaySession result",e),t(e)})},i.onpaymentauthorized=function(e){var t=e.payment,n=(u("onpaymentauthorized",t),{session:i,token:t.token,currency:r.currency});if(r.requireEmail&&(n.email=t.shippingContact.emailAddress),r.requireShipping)for(var a in n.shipping_address={},t.shippingContact)"emailAddress"!=a&&(n.shipping_address[a]=t.shippingContact[a]);u("Payment Result",n),o(n)},i.onpaymentmethodselected=function(e){u("onpaymentmethodselected",e);e={newTotal:{label:l.merchantName,type:"final",amount:r.amount}};i.completePaymentMethodSelection(e)},i.oncouponcodechanged=function(e){u("Coupon code changed",e)},i.onshippingcontactselected=function(e){u("Shipping Contact Selected",e);e={newTotal:{label:l.merchantName,type:"final",amount:r.amount}};i.completeShippingContactSelection(e)},i.onshippingmethodselected=function(e){u("Shipping Method Selected",e);i.completeShippingMethodSelection({})},i.oncancel=function(e){u("oncancel called",e),t("Cancelled")}}),s}}}]),angular.module("patronicity.payment_methods.google",["user","patronicity.configuration"]).factory("googlePayFactory",["$q","User","$timeout",function(t,a,o){var i,d={merchantName:"",merchantId:"",environment:"TEST"},r={id:"google-pay-id",srcUrl:"https://pay.google.com/gp/p/js/pay.js"},p={apiVersion:2,apiVersionMinor:0},s={type:"CARD",parameters:{allowedAuthMethods:["PAN_ONLY","CRYPTOGRAM_3DS"],allowedCardNetworks:["AMEX","DISCOVER","INTERAC","JCB","MASTERCARD","VISA"]}},m=Object.assign({tokenizationSpecification:{type:"PAYMENT_GATEWAY",parameters:{gateway:"adyen",gatewayMerchantId:"LaunchGoodIncECOM"}}},s),c=t.defer();function g(){return null==i&&(i=t.defer(),a.get().then(function(){var e=a.getPaymentProviderKey("adyen-googlepay"),t=a.getPaymentProviderMode("adyen-googlepay"),n="launchgood"==a.getApplication()?"LaunchGood, LLC.":"Patronicity, LLC.";e&&e.length&&t&&t.length?(d.environment="production"==t?"PRODUCTION":"TEST",d.merchantId=e&&e.length?e:void 0,d.merchantName=n,document.getElementById(r.id)||((t=document.createElement("script")).id=r.id,t.src=r.srcUrl,t.addEventListener("load",function(e){o(function(){c.resolve()},0)}),document.body.appendChild(t)),c.promise.then(function(){var e=new google.payments.api.PaymentsClient({environment:d.environment});i.resolve(e)},i.reject)):i.reject()},i.reject)),i.promise}return{supported:function(){return t(function(n,a){g().then(function(e){var t=Object.assign({},p);t.allowedPaymentMethods=[s],e.isReadyToPay(t).then(function(e){n(e.result)}).catch(a)},a)})},getButton:function(n){return t(function(t,e){g().then(function(e){e=e.createButton({onClick:n,buttonSizeMode:"fill",buttonType:"plain"});t(e)},e)})},getTokenFromPaymenResult:function(e){var e=e.paymentMethodData,t=new Date,t=new Date(t.setMonth(t.getMonth()+1)),n=(""+(t.getMonth()+1)).padStart(2,"0"),t=""+t.getFullYear();return{type:"adyen-googlepay",token:{type:"adyen-googlepay",encrypted:e.tokenizationData.token},digest:e.info.cardNetwork.toLowerCase()+"|"+e.info.cardDetails+"|"+n+t}},getShippingFromPaymentResult:function(e){var t;return t=e.shippingAddress?{id:void 0,name:(e=e.shippingAddress).name,line1:e.address1,line2:(e.address2+" "+e.address3).trim(),city:e.locality,state:e.administrativeArea,zip:e.postalCode,country:e.countryCode,save:!1}:t},handleTransaction:function(e){return t(function(n,a){var o=e.country,i=e.amount,r=e.currency,s=e.requireShipping||!1,c=e.requireEmail||!1,l=e.settlementCurrency||"USD",u=[];angular.forEach(e.acceptedCards,function(e){switch(e.toLowerCase()){case"american express":u.push("AMEX");break;case"mastercard":u.push("MASTERCARD");break;case"visa":u.push("VISA");break;case"discover":u.push("DISCOVER");break;case"jcb":u.push("JCB")}}),g().then(function(e){var t=function(e,t,n,a){var o=Object.assign({},p);switch(o.allowedPaymentMethods=[m],o.allowedPaymentMethods[0].parameters.allowedCardNetworks=n,a){case"GBP":o.allowedPaymentMethods[0].tokenizationSpecification.parameters.gatewayMerchantId="LaunchGood_GBP";break;case"CAD":o.allowedPaymentMethods[0].tokenizationSpecification.parameters.gatewayMerchantId="LaunchGood_CAD";break;default:o.allowedPaymentMethods[0].tokenizationSpecification.parameters.gatewayMerchantId="LaunchGoodIncECOM"}return o.merchantInfo={merchantName:d.merchantName},void 0!==d.merchantId&&(o.merchantInfo.merchantId=d.merchantId),o.emailRequired=e,o.shippingAddressRequired=t,o}(c,s,u,l);t.transactionInfo={countryCode:o,currencyCode:r,totalPriceStatus:"FINAL",totalPrice:i,totalPriceLabel:"Total Donation"},e.loadPaymentData(t).then(function(e){n(e)}).catch(function(e){console.error(e),a(e)})},a)})}}}]),angular.module("patronicity.payment_methods",["patronicity.payment_methods.google","patronicity.payment_methods.apple"]),angular.module("patronicity.payment_providers.adyen",["user"]).factory("adyenApi",["$q","$window","User","api","$rootScope",function(n,a,o,i,r){var l={id:"adyen-js-id",fingerprintId:"adyen-fingerprint-id"},u=n.defer(),s=n.defer(),d=0;var c,p=1;function t(){var t,e;return void 0===c&&(c=n.defer(),document.getElementById(l.fingerprintId)||(e=new Date,t="https://live.adyen.com/hpp/js/df.js?"+("v="+e.getFullYear()+e.getMonth()+e.getDate()),(e=document.createElement("script")).id=l.fingerprintId,e.src=t,e.addEventListener("load",function(e){if(!a.dfDo)throw"Adyen requires that you have adyen.js installed. Include "+t+" into your html.";s.resolve(a.dfDo)}),document.body.appendChild(e)),s.promise.then(function(e){var t="adyen-fingerprint-"+p++,n=angular.element('<form id="'+t+'"><input type="hidden" name="foo" id="bar"/></form>'),a=($("body").append(n),document.documentElement.style.scrollbar3dLightColor=document.documentElement.style.scrollbar3dLightColor||"#4FBDDD",e("bar"),setInterval(function(){var e=$("#bar").val();""!=e&&($("form#"+t).remove(),clearInterval(a),r.$apply(function(){c.resolve(e)}))},100))},c.reject)),c.promise}return{createToken:function(c){return n(function(s,e){document.getElementById(l.id)||o.get().then(function(){var e="production"!==o.getPaymentProviderMode("adyen")?"https://test.adyen.com/hpp/cse/js/8015790388701222.shtml":"https://live.adyen.com/hpp/cse/js/2615948587082532.shtml",t=document.createElement("script");t.id=l.id,t.src=e,t.addEventListener("load",function(e){if(!a.adyen)throw"Adyen requires that you have adyen.js installed. Include "+l.srcUrl+" into your html.";u.resolve(a.adyen)}),document.body.appendChild(t)}),u.promise.then(function(r){c.name,c.email,c.number,c.cvc,c.exp_month,c.exp_year,c.address_country,c.address_line1,c.address_line2,c.address_city,c.address_state,c.address_zip;n(function(t,e){i.user.serverTime().then(function(e){t(e)},e)}).then(function(i){t().then(function(n){var e="adyen-form-"+d++,t=angular.element('<form method="POST" action="[payment request handler]" id="'+e+'"><input type="text" size="20" data-encrypted-name="number" value="'+c.number+'"/><input type="text" size="20" data-encrypted-name="holderName" value="'+c.name+'"/><input type="text" size="2" data-encrypted-name="expiryMonth" value="'+c.exp_month+'"/><input type="text" size="4" data-encrypted-name="expiryYear" value="'+c.exp_year+'"/><input type="text" size="4" data-encrypted-name="cvc" value="'+c.cvc+'"/><input type="hidden" value="'+i+'" data-encrypted-name="generationtime"/><input type="submit" value="Pay"/></form>'),a=($("body").append(t),document.getElementById(e)),o="adyen-token-data",t={};t.name=o,t.onsubmit=function(e){var t=a.elements[o].value;e.preventDefault(),s({success:!0,type:"adyen",token:{encrypted:t,user_name:c.name,fingerprint:n}})},r.createEncryptedForm(a,t),$("input[type=submit]",a).click(),$("form#"+e).remove()},e)},e)},function(){e("Unable to load Adyen!")})})},calculateFingerprint:t}}]),angular.module("patronicity.payment_providers.bluesnap",["user"]).factory("bluesnapApi",["$q","$window","User",function(e,o,s){var c={id:"bluesnap-js-id",fraudId:"bluesnap-fraud-id",kountMerchantId:void 0},l=e.defer(),i=e.defer(),u=0;function r(){return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(e){var t=16*Math.random()|0;return("x"==e?t:3&t|8).toString(16)}).replace(/-/g,"")}function t(){return document.getElementById(c.fraudId)||s.get().then(function(){var t=r(),e="production"!==s.getPaymentProviderMode("bluesnap"),n=e?"https://sandbox.bluesnap.com":"https://www.bluesnap.com",e=e?690763:1151534,a=document.createElement("iframe"),o=(a.width=1,a.height=1,a.frameborder=0,a.scrolling="no",a.id=c.fraudId,a.src=n+"/servlet/logo.htm?s="+t+(void 0===c.kountMerchantId?"":"&m="+c.kountMerchantId),document.createElement("img"));o.width=1,o.height=1,o.src=n+"/servlet/logo.gif?s="+t+"&d="+e+(void 0===c.kountMerchantId?"":"&m="+c.kountMerchantId),a.appendChild(o),a.addEventListener("load",function(e){i.resolve(t)}),document.body.appendChild(a)}),i}return{createToken:function(r){return e(function(i,e){document.getElementById(c.id)||s.get().then(function(){var n="production"!==s.getPaymentProviderMode("bluesnap"),a=s.getPaymentProviderKey("bluesnap"),e=n?"https://sandbox.bluesnap.com/js/cse/v1.0.4/bluesnap.js":"https://gateway.bluesnap.com/js/cse/v1.0.4/bluesnap.js",t=document.createElement("script");t.id=c.id,t.src=e,t.addEventListener("load",function(e){if(!o.BlueSnap)throw"BlueSnap requires that you have bluesnap.js installed. Include "+c.srcUrl+" into your html.";var t=new BlueSnap(a,n);l.resolve(t)}),document.body.appendChild(t)}),l.promise.then(function(o){t().promise.then(function(e){r.name,r.email,r.number,r.cvc,r.exp_month,r.exp_year,r.address_country,r.address_line1,r.address_line2,r.address_city,r.address_state,r.address_zip;var t="bluesnap-form-"+u++,n=angular.element('<form id="'+t+'" style="display:none;"><input type="text" data-bluesnap="encryptedCreditCard" value="'+r.number+'" /><input type="text" data-bluesnap="encryptedCvv" value="'+r.cvc+'" /></form>'),a=($("body").append(n),o.encrypt(t),$("input[name=encryptedCreditCard]",n).val()),n=$("input[name=encryptedCvv]",n).val();$("form#"+t).remove(),i({success:!0,type:"bluesnap",token:{user_name:r.name,enc_cc_number:a,enc_cvv:n,expiration_month:r.exp_month,expiration_year:r.exp_year,fraud_id:e}})})})})},getFraudId:function(){return t().promise}}}]),function(){var e=angular.module("patronicity.payment_providers.cliq",["user"]);e.factory("cliqUndocumentedApi",["$q","$http","$httpParamSerializerJQLike",function(e,c,n){function l(e,t){return c({url:e,method:"POST",data:n(t),headers:{"Content-Type":"application/x-www-form-urlencoded"}})}return{buildToken:function(t,n,a,o,i){var r,s=e.defer();return l(t.url+"create",{tokenizationKey:t.key}).then(function(e){e=e.data;r=e.token,l(t.url+"save_multipart_token",{tokenizationKey:t.key,tokenId:r,elementId:"ccnumber",value:n}).then(function(e){!function(e,t,n,a){a=(""+a).slice(-2);return l(e.url+"save_multipart_token",{tokenizationKey:e.key,tokenId:t,elementId:"ccexp",value:n+a})}(t,r,a,o).then(function(e){l(t.url+"save_multipart_token",{tokenizationKey:t.key,tokenId:r,elementId:"cvv",cvvDisplay:!0,value:i}).then(function(e){c.post(t.url+"lookup",{tokenizationKey:t.key,tokenId:r},{headers:{"Content-Type":"application/json"}}).then(function(e){s.resolve({success:!0,token:r,data:e.data})},function(e){s.reject({success:!1,message:""})})},function(e){s.reject({success:!1,message:""})})},function(e){s.reject({success:!1,message:""})})},function(e){s.reject({success:!1,message:""})})},function(e){s.reject({success:!1,message:""})}),s.promise}}}]),e.factory("cliqApi",["$q","User","cliqUndocumentedApi",function(e,t,o){var i=e.defer(),r="cliq";return{createToken:function(a){return e(function(n,e){t.get().then(function(){t.getPaymentProviderMode(r);var e={key:t.getPaymentProviderKey(r),url:"https://secure.cardflexonline.com/token/api/"};i.resolve(e)}),i.promise.then(function(e){var t={user_name:a.name,email:a.email,cc_number:a.number.replace(/ /g,""),cvv:a.cvc,expiration_month:a.exp_month,expiration_year:a.exp_year,address:{country:a.address_country,address1:a.address_line1,address2:a.address_line2,city:a.address_city,region:a.address_state,postal_code:a.address_zip}};o.buildToken(e,t.cc_number,t.expiration_month,t.expiration_year,t.cvv).then(function(e){n({success:!0,type:r,token:{user_name:t.user_name,token:e.token}})},function(e){n({success:!1,type:r,code:-1,message:"unknown error (cliq)"})})},e)})}}}])}(),function(){var e=angular.module("patronicity.payment_providers.flutterwave",["user"]);e.factory("flutterwaveTester",["flutterwaveApi","$q",function(a,n){var o=[{name:"Test MasterCard PIN authentication",number:"5531 8866 5214 2950",cvv:"564",exp_month:"09",exp_year:"22",pin:"3310",otp:"12345"},{name:"Test Visa Card 3D-Secure authentication",number:"4187 4274 1556 4246",cvv:"828",exp_month:"09",exp_year:"21",pin:"3310",otp:"12345"},{name:"Test MasterCard 3DSecure authentication",number:"5438 8980 1456 0229",cvv:"564",exp_month:"10",exp_year:"20",pin:"3310",otp:"12345"},{name:"Test MasterCard (3DSecure authentication) 2",number:"5377 2836 4507 7450",cvv:"789",exp_month:"09",exp_year:"21",pin:"3310",otp:"12345"},{name:"Test NoAuth Visa Card (This is not the same as NOAUTH_INTERNATIONAL)",number:"4751 7632 3669 9647",cvv:"564",exp_month:"09",exp_year:"21",pin:"3310",otp:"12345"},{name:"Test VisaCard 3D-Secure Authentication",number:"4242 4242 4242 4242",cvv:"812",exp_month:"01",exp_year:"21",pin:"3310",otp:"12345"},{name:"Test VisaCard (NOAUTH_INTERNATIONAL)",number:"4556 0527 0417 2643",cvv:"899",exp_month:"01",exp_year:"21",pin:"3310",otp:"12345"},{name:"Test MasterCard (NOAUTH_INTERNATIONAL)",number:"5590 1317 4329 4314",cvv:"887",exp_month:"11",exp_year:"20",pin:"3310",otp:"12345"},{name:"Test Card Insufficient Funds",number:"5258585922666506",cvv:"883",exp_month:"09",exp_year:"21",pin:"3310",otp:"12345"},{name:"Test Card - Invalid Transaction",number:"5551658157653822",cvv:"276",exp_month:"08",exp_year:"21",pin:"3310",otp:"12345"},{name:"Test Card - Restricted Card, Retain Card",number:"5551651630381384",cvv:"276",exp_month:"08",exp_year:"21",pin:"3310",otp:"12345"},{name:"Test Card - Function Not Permitted to Cardholder",number:"5258582054729020",cvv:"887",exp_month:"11",exp_year:"20",pin:"3310",otp:"12345"},{name:"Test Card - Function Not Permitted to Terminal",number:"5258588264565682",cvv:"887",exp_month:"11",exp_year:"20",pin:"3310",otp:"12345"},{name:"Test Card - Transaction Error",number:"5258589130149016",cvv:"887",exp_month:"11",exp_year:"20",pin:"3310",otp:"12345"}],i=[];function r(e,t,n){"message"==t?(void 0===i[e].messages&&(i[e].messages=[]),i[e].messages.push(n),console.log(n)):200==n.status?(i[e][t]=n.data,console.log(t+" Payload: "+JSON.stringify(n.data,null," "))):(i[e][t]=n,console.log(t+" Complete: "+JSON.stringify(n,null," ")))}return{test:function(){a.setDebugLogger(r);for(var e=[],t=0;t<o.length;t++)e.push(function(t){var e=o[t],n={number:e.number,cvc:e.cvv,exp_month:e.exp_month,exp_year:e.exp_year,email:"rdm4@martellventures.com",name:"Ryan Martell",address_zip:"28715",address_city:"Biltmore Lake",address_line1:"91 Orvis Stone Circle",address_state:"NC",address_country:"US"},e=(i[t]={card:e},a.createToken(n,t));return e.then(function(e){i[t].final_success=e},function(e){i[t].final_failure=e}),e}(t));n.all(e).then(function(){console.log(JSON.stringify(i,null," "))})}}}]),e.factory("flutterwaveApi",["$q","$http","$window","User","$timeout",function(u,d,e,t,p){var a=u.defer();function m(e,t){t=cryptico.encrypt(JSON.stringify(t),e.fwPublicKey).cipher;return{PBFPubKey:e.publicKey,client:t}}var o=function(e,t,n){"message"==t?console.log(n):(console.log(t+": "+JSON.stringify(n,null," ")),console.log(t+" Payload: "+JSON.stringifypayload.data,null," "))};function g(e,t,n){o&&o(e,t,n)}return{createToken:function(n,l){return u(function(c,e){t.get().then(function(){var e="production"!==t.getPaymentProviderMode("flutterwave"),e={fwPublicKey:"baA/RgjURU3I0uqH3iRos3NbE8fT+lP8SDXKymsnfdPrMQAEoMBuXtoaQiJ1i5tuBG9EgSEOH1LAZEaAsvwClw==",isTesting:e,publicKey:t.getPaymentProviderKey("flutterwave"),endpoint:e?"https://ravesandboxapi.flutterwave.com":"https://api.ravepay.co"};a.resolve(e)}),a.promise.then(function(i){var e=n.name.split(" "),t=e.shift(),e=e.join(" "),r={PBFPubKey:i.publicKey,cardno:n.number.replace(/ /g,""),cvv:n.cvc,expirymonth:n.exp_month,expiryyear:n.exp_year,currency:"USD",country:"NG",amount:1,email:n.email,firstname:t,lastname:e,txRef:"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(e){var t=16*Math.random()|0;return("x"==e?t:3&t|8).toString(16)})},s={billingzip:n.address_zip,billingcity:n.address_city,billingaddress:n.address_line1,billingstate:n.address_state,billingcountry:n.address_country},t=(g(l,"initial",r),m(i,r));d.post(i.endpoint+"/flwv3-pug/getpaidx/api/charge",t).then(function(e){g(l,"initial_response",e);var t,n=e.data,a=n.data;if("PIN"===a.suggested_auth)t=u.defer(),p(function(){t.resolve(1234)},5e3),t.then(function(e){r.suggested_auth="PIN",r.pin=e,g(l,"followup_pin",r),n=m(i,r),d.post(i.endpoint+"/flwv3-pug/getpaidx/api/charge",n).then(function(e){g(l,"followup_pin_response",e);e=e.data;e.data;"success"===e.status?c({success:!0,type:"flutterwave",message:"Call /validatecharge with pin data?",code:-1}):c({success:!1,type:"flutterwave",message:e.message,code:-1})},function(e){e.data,n.data;g(l,"followup_pin_response_failure",e),c({success:!1,type:"flutterwave",message:a.message,code:a.code})})},function(){c({success:!1,type:"flutterwave",message:"User cancelled PIN input.",code:"pin_cancel"})});else if("N/A"!==a.authurl&&"success-pending-validation"===a.status&&"02"===a.chargeResponseCode)g(l,"message","Should open "+a.authurl+" in a new window!"),c({success:!0,type:"flutterwave",message:"Should open "+a.authurl+" in a new window!",code:-1});else if("NOAUTH_INTERNATIONAL"===a.suggested_auth){for(var o in s)r[o]=s[o];g(l,"followup_noauth_intl",r),n=m(i,r),d.post(i.endpoint+"/flwv3-pug/getpaidx/api/charge",n).then(function(e){g(l,"followup_noauth_intl_response",e);var e=e.data,t=e.data;"success"===e.status?(g(l,"message","Open "+t.authurl+" in iFrame to finish..."),c({success:!0,type:"flutterwave",message:"Open "+t.authurl+" in iFrame to finish...",code:-1})):c({success:!1,type:"flutterwave",message:e.message,code:-1})},function(e){g(l,"followup_avb_noauth_response_failure",e);e=e.data.data;c({success:!1,type:"flutterwave",message:e.message,code:e.code})})}else"successful"==a.status&&"00"==a.chargeResponseCode?c({success:!0,type:"flutterwave",token:{chargeToken:a.chargeToken,customerId:a.customerId,flwRef:a.flwRef}}):c({success:!1,type:"flutterwave",message:a.chargeResponseMessage,code:a.code})},function(e){g(l,"initial_response_failure",e);e=e.data.data;c({success:!1,type:"flutterwave",message:e.message,code:e.code})})})})},setDebugLogger:function(e){o=e}}}])}(),function(){var e=angular.module("patronicity.payment_providers.stripe",["user"]);e.factory("stripeElementsApi",["$window","$q","User",function(t,a,n){var o,i={id:"stripe-js-id-v3",srcUrl:"https://js.stripe.com/v3/"},r=a.defer();function s(){var e;return document.getElementById(i.id)||((e=document.createElement("script")).id=i.id,e.src=i.srcUrl,e.addEventListener("load",function(e){if(!t.Stripe)throw"stripeElementsApi requires that you have stripe.js installed. Include "+i.srcUrl+" into your html.";n.get().then(function(){o=t.Stripe(n.getPaymentProviderKey("stripe").toString()),r.resolve()})}),document.body.appendChild(e)),r}return{loadElements:function(){return a(function(e,t){s().promise.then(function(){e(o.elements())},function(){t({type:"javascript_load",code:"unable to load stripe.js",message:"Unable to load the Stripe Javascript file!",param:null})})})},paymentRequest:function(e){return n=e,a(function(e,t){s().promise.then(function(){e(o.paymentRequest(n))},function(){t({type:"javascript_load",code:"unable to load stripe.js",message:"Unable to load the Stripe Javascript file!",param:null})})});var n}}}]),e.factory("stripePaymentRequest",["stripeElementsApi","$rootScope","User","$q",function(o,e,i,t){var r={paymentRequest:null,available:!1,isApplePay:!1};function s(e,t,n,a){var o;return a?o={country:"US",currency:t.toLowerCase(),total:{amount:100,label:"Nothing",pending:!0},requestPayerEmail:!0,requestShipping:!1}:(o={currency:t.toLowerCase(),total:{amount:e.totalAmount,label:"Pledge"},requestShipping:n},n&&(o.shippingOptions=[{id:"free",label:"Free Shipping",detail:"Free shipping once the item is available.",amount:0}])),o}return{load:function(e,a){return t(function(t,n){o.paymentRequest(s(e,a,!1,!0)).then(function(e){(r.paymentRequest=e).canMakePayment().then(function(e){e?(r.available=!0,r.isApplePay=e.applePay):r.available=!1,r.available&&"production"==i.getEnvironment()&&(r.available=!1),t(r)},n)},n)})},available:function(){return r.available},isApplePay:function(){return r.isApplePay},paymentRequest:function(){return r.paymentRequest},paymentRequestOptionsFromDonation:s}}]),e.factory("stripeOldApi",["$window","$q","User",function(i,e,n){var r={id:"stripe-js-id",srcUrl:"https://js.stripe.com/v2/"},s=e.defer();return{createToken:function(o){return e(function(a,e){var t;document.getElementById(r.id)||((t=document.createElement("script")).id=r.id,t.src=r.srcUrl,t.addEventListener("load",function(e){Stripe.setPublishableKey(n.getPaymentProviderKey("stripe")),s.resolve()}),document.body.appendChild(t)),s.promise.then(function(){if(!i.Stripe)throw"stripeOldApi requires that you have stripe.js installed. Include "+r.srcUrl+" into your html.";var e,t={},n=["number","cvc","exp_month","exp_year","address_zip","name","address_line1","address_line2","address_city","address_state","address_zip","address_country"];for(e in o)-1!=n.indexOf(e)&&0<o[e].trim().length&&(t[e]=o[e]);i.Stripe.createToken(t,function(e,t){t.error?a({success:!1,type:"stripe",error_type:t.error.type,code:t.error.code,message:t.error.message,param:t.error.param}):a({success:!0,token:{token:t.id},type:"stripe"})})},function(){a({success:!1,type:"stripe",error_type:"javascript_load",code:"unable to load stripe.js",message:"Unable to load the Stripe Javascript file!",param:null})})})}}}])}(),angular.module("patronicity.payment_providers.wepay",["user"]).factory("wepayApi",["$q","$window","User",function(e,o,i){var r={id:"wepay-js-id",srcUrl:"https://static.wepay.com/min/js/tokenization.3.latest.js"},s=e.defer();return{createToken:function(a){return e(function(t,e){var n;document.getElementById(r.id)||((n=document.createElement("script")).id=r.id,n.src=r.srcUrl,n.addEventListener("load",function(e){if(!o.WePay)throw"wepayApi requires that you have wepay.js installed. Include "+r.srcUrl+" into your html.";i.get().then(function(){var e=i.getPaymentProviderMode("wepay");WePay.set_endpoint(e),s.resolve()})}),document.body.appendChild(n)),s.promise.then(function(){if(!o.WePay)throw"WePay requires that you have wepay.js installed. Include "+r.srcUrl+" into your html.";var e={client_id:i.getPaymentProviderKey("wepay"),user_name:a.name,email:a.email,cc_number:a.number,cvv:a.cvc,expiration_month:a.exp_month,expiration_year:a.exp_year,card_on_file:!0,recurring:!0,address:{country:a.address_country,address1:a.address_line1,address2:a.address_line2,city:a.address_city,region:a.address_state,postal_code:a.address_zip}},e=o.WePay.credit_card.create(e,function(e){e.error?t({success:!1,type:"wepay",message:e.error_description,code:e.error_code}):t({success:!0,token:{token:e.credit_card_id},type:"wepay"})});void 0!==e&&!0!==e&&t({success:!1,type:"wepay",code:e.error,message:e.error_description})})})}}}]),function(){"use strict";angular.module("angulartics.google.tagmanager.transaction",["angulartics"]).config(["$analyticsProvider",function(e){e.registerTransactionTrack(function(e){(window.dataLayer=window.dataLayer||[]).push(e)})}])}(),angular.module("patronicity.press",["patronicity.api","patronicity.configuration"]).directive("pressList",["api","patronicityConfig",function(a,e){return{restrict:"E",templateUrl:e.urlForTemplate("press-list.html"),scope:{},link:function(t,e,n){console.log("press loaded"),t.limit=25,t.nextPage=function(){t.limit+=25},t.loading=!0,a.press.list().then(function(e){t.pressItems=e,t.loading=!1},function(e){t.loading=!1,console.log("couldn't get press items")}),t.isFeatured=function(e,t,n){return!!(2&e.Flags)},t.isNotFeatured=function(e,t,n){return!(2&e.Flags)}}}}]),angular.module("patronicity.programs.page",["patronicity.configuration"]).directive("programsPage",["patronicityConfig","sponsors",function(e,r){return{restrict:"E",templateUrl:"programsPage.html",link:function(t){r.sponsors().then(function(e){t.sponsors=e,angular.forEach(t.sponsors,function(e){e.imageUrl&&(e.imageUrl=-1!==(e=e.imageUrl).indexOf("https")?e:"//media.launchgood.com/06bc2411f7284f2a6f474e36ab2b263173b8c480/"+e)})});var e=document.getElementById("programs-page-contact-eb"),n=document.getElementById("contact-eb_inner"),a=document.getElementById("contact-eb_min"),o=document.getElementById("cta-email-toggle");function i(){e.classList.toggle("shrink-programs-cta"),n.style.display="none"===n.style.display?"flex":"none"}window.addEventListener("scroll",function(){100<window.scrollY&&(1<e.classList.length||e.classList.toggle("reveal-programs-cta"))}),a.addEventListener("click",i),o.addEventListener("click",i)}}}]),function(){var e=angular.module("patronicity.project-admin.account-providers.bluesnap-payment-method",["patronicity.api","ui.bootstrap","user","mv.widgets","patronicity.configuration","mv.banking"]);e.directive("bluesnapVendorPrincipalInformation",["api","moment",function(a,o){return{restrict:"E",templateUrl:"bluesnapVendorPrincipalInformation.html",scope:{accountId:"@",type:"@",projectCommunityId:"=",projectCommunityType:"="},link:function(t,e,n){t.data={loading:!1,saving:!1,complete:!1,errorMessage:"",labels:{title:"personal"==n.type?"Your Personal Information":"Business Owner Personal Information",prefix:"personal"==n.type?"Your":"Business Owner's"},owner:{firstName:"",lastName:"",email:"",birthDate:void 0,dlNumber:"",personalIdNumber:"",passportNumber:"",phone:"",address:{ID:"new",Name:"",Phone:"",Street:"",Street2:"",Country:"US",City:"",ZipCode:"",State:"",Save:!1}}},t.save=function(){t.data.saving=!0,t.data.errorMessage="",t.data.owner.birthDate=o(t.data.owner.birthDate).format("YYYY-MM-DD"),a.projectAdmin.bluesnap.account.saveSection(t.accountId,"principal",t.data.owner,t.projectCommunityId,t.projectCommunityType).then(function(e){t.data.owner=e.owner,t.data.complete=e.complete,""==t.data.owner.birthDate&&(t.data.owner.birthDate=void 0),t.$emit("payment-info-saved"),t.personalInfo.$setPristine()},function(e){t.data.errorMessage=e}).finally(function(){t.data.saving=!1})},t.data.loading=!0,a.projectAdmin.bluesnap.account.loadSection(t.accountId,"principal",t.projectCommunityId,t.projectCommunityType).then(function(e){t.data.owner=e.owner,t.data.complete=e.complete,""==t.data.owner.birthDate&&(t.data.owner.birthDate=void 0)}).finally(function(){t.data.loading=!1})}}}]),e.directive("bluesnapBankAccountInformation",["api","ibanProvider",function(o,i){return{restrict:"E",templateUrl:"bluesnapBankAccountInformation.html",scope:{accountId:"@",projectCommunityId:"=",projectCommunityType:"="},link:function(n,e,t){function a(){"WIRE"==n.data.bank.payoutMethod||"SEPA"==n.data.bank.payoutMethod?n.data.swiftAndIBAN=i.countrySupportsIBAN(n.data.bank.address.Country):n.data.swiftAndIBAN=!1,n.data.bank.swiftOrBankId="",n.data.bank.accountNumberOrIban="",n.data.swiftAndIBAN?(n.data.bank.swiftBic&&0<n.data.bank.swiftBic.trim().length&&(n.data.bank.swiftOrBankId=n.data.bank.swiftBic),n.data.bank.iban&&0<n.data.bank.iban.trim().length&&(n.data.bank.accountNumberOrIban=n.data.bank.iban)):(n.data.bank.bankId&&0<n.data.bank.bankId.trim().length&&(n.data.bank.swiftOrBankId=n.data.bank.bankId),n.data.bank.accountNumber&&0<n.data.bank.accountNumber.trim().length&&(n.data.bank.accountNumberOrIban=n.data.bank.accountNumber)),n.data.complete&&(n.data.showForEditing=!1)}n.data={loading:!1,saving:!1,complete:!1,swiftAndIBAN:!1,errorMessage:"",constants:{payoutMethods:[{id:"ACH",label:"ACH",enabled:!0},{id:"SEPA",label:"SEPA",enabled:!0},{id:"CHAPS",label:"CHAPS",enabled:!0},{id:"WIRE",label:"WIRE",enabled:!0}],settlementCurrencies:[]},bank:{currency:"",account_name:"",name:"",type:"",class:"",payoutMethod:"",swiftOrBankId:"",accountNumberOrIban:"",address:{ID:"new",Name:"",Phone:"",Street:"",Street2:"",Country:"US",City:"",ZipCode:"",State:"",Save:!1}}},n.$watch("data.bank.payoutMethod",function(e){a()}),n.$watch("data.bank.address.Country",function(e){n.updateBankCurrency()}),n.updateBankCurrency=function(){var t=[];n.data.constants.payoutMethods.forEach(function(e){switch(e.id){case"ACH":"USD"!=n.data.bank.currency&&"CAD"!=n.data.bank.currency||"US"!=n.data.bank.address.Country&&"CA"!=n.data.bank.address.Country?e.enabled=!1:e.enabled=!0;break;case"SEPA":"EUR"==n.data.bank.currency&&i.countrySupportsIBAN(n.data.bank.address.Country)?e.enabled=!0:e.enabled=!1;break;case"CHAPS":"GBP"==n.data.bank.currency&&"GB"==n.data.bank.address.Country?e.enabled=!0:e.enabled=!1;break;case"WIRE":e.enabled=!0}t.push(e),e.id==n.data.bank.payoutMethod&&0==e.enabled&&(n.data.bank.payoutMethod="")}),n.data.constants.payoutMethods=t,a()},n.save=function(){n.data.saving=!0,n.data.errorMessage="",n.data.bank.bankId="",n.data.bank.accountNumber="",n.data.bank.swiftBic="",n.data.bank.iban="",n.data.bank.isIBANSupported=n.data.swiftAndIBAN,n.data.swiftAndIBAN?(n.data.bank.iban=n.data.bank.accountNumberOrIban,n.data.bank.swiftBic=n.data.bank.swiftOrBankId):(n.data.bank.bankId=n.data.bank.swiftOrBankId,n.data.bank.accountNumber=n.data.bank.accountNumberOrIban),delete n.data.bank.swiftOrBankId,delete n.data.bank.accountNumberOrIban,o.projectAdmin.bluesnap.account.saveSection(n.accountId,"bank",n.data.bank,n.projectCommunityId,n.projectCommunityType).then(function(e){n.data.complete=e.complete,n.data.bank=e.bank,a(),n.bankInfo.$setPristine(),n.updateBankCurrency(),n.$emit("payment-info-saved")},function(e){n.data.errorMessage=e}).finally(function(){n.data.saving=!1})},n.data.loading=!0,o.projectAdmin.bluesnap.account.loadSection(n.accountId,"bank",n.projectCommunityId,n.projectCommunityType).then(function(e){n.data.bank=e.bank,n.data.complete=e.complete,a(),n.data.constants.settlementCurrencies=e.settlementCurrencies,n.updateBankCurrency()}).finally(function(){n.data.loading=!1})}}}]),e.directive("bluesnapBusinessAccountInformation",["api",function(a){return{restrict:"E",templateUrl:"bluesnapBusinessAccountInformation.html",scope:{accountId:"@",projectCommunityId:"=",projectCommunityType:"="},link:function(t,e,n){t.data={loading:!1,saving:!1,complete:!1,errorMessage:"",business:{name:"",phone:"",taxId:"",address:{ID:"new",Name:"",Phone:"",Street:"",Street2:"",Country:"US",City:"",ZipCode:"",State:"",Save:!1}}},t.businessIdLabelForCountryCode=function(e){var t="Business Tax ID Number";switch(e){case"US":t="EIN/TIN";break;case"CA":t="Business Number";break;case"GB":t="Company Number";break;case"AU":t="ABN (Business Tax Number)"}return t},t.save=function(){t.data.saving=!0,t.data.errorMessage="",a.projectAdmin.bluesnap.account.saveSection(t.accountId,"business",t.data.business,t.projectCommunityId,t.projectCommunityType).then(function(e){t.data.business=e.business,t.data.complete=e.complete,t.$emit("payment-info-saved"),t.businessInfo.$setPristine()},function(e){t.data.errorMessage=e}).finally(function(){t.data.saving=!1})},t.data.loading=!0,a.projectAdmin.bluesnap.account.loadSection(t.accountId,"business",t.projectCommunityId,t.projectCommunityType).then(function(e){t.data.business=e.business,t.data.complete=e.complete}).finally(function(){t.data.loading=!1})}}}]),e.directive("bluesnapAccountInformation",["api","$uibModal","patronicityConfig","$rootScope","User",function(i,r,e,s,c){return{restrict:"E",templateUrl:e.urlForTemplate("project-admin/account-providers/bluesnap-payment-method.html"),scope:{projectCommunityType:"@",projectCommunityId:"@",countryCode:"=",wepayAccount:"="},link:function(a,e,n){function o(){var t=[{id:"new",optionType:"bluesnap",display_name:"New Account.."}];a.data.accounts.forEach(function(e){e.country_code==a.countryCode&&t.push(e)}),a.data.wepayAccounts&&t.length<=1&&a.data.wepayAccounts.forEach(function(e){e.country_code==a.countryCode&&t.push(e)}),t.forEach(function(e){"wepay"==e.optionType?"US"!=a.countryCode&&"CA"!=a.countryCode||(a.paymentAccountTypeLabel="wepay"):a.paymentAccountTypeLabel="bluesnap"}),a.data.filtered_accounts=t,!(1<a.data.filtered_accounts.length)||"wepay"==a.paymentAccountTypeLabel?a.data.selectedAccount=a.data.filtered_accounts[0]:a.data.selectedAccount=a.data.filtered_accounts[1]}function t(){a.wepayAccount&&(a.data.loading=!0,i.projectAdmin.wepay.forProjectId(a.projectCommunityId,a.projectCommunityType).then(function(e){a.data.step=e.step,"basics"==a.data.step&&(a.data.wepayAccounts=e.accounts,o())},function(e){a.data.errorMessage=e}).finally(function(){a.data.loading=!1})),a.data.loading=!0,i.projectAdmin.bluesnap.forProjectId(a.projectCommunityId,a.projectCommunityType).then(function(t){a.data.step=t.step,a.data.complete=t.complete,a.data.approvalStatus=t.approvalStatus,a.data.initial.personal.owner.email=t.email,a.data.initial.business.email=t.email,a.data.initial.personal.owner.firstName=t.firstName,a.data.initial.personal.owner.lastName=t.lastName,n.currencyCode&&(a.data.countryLocked=!0),"basics"==a.data.step?(a.data.accounts=t.accounts,o()):"info"==a.data.step&&(["account_type","countryCode","accountId"].forEach(function(e){a.data[e]=t[e]}),"personal"==a.data.account_type?a.data.completion_phrase="Submit for Review":a.data.completion_phrase="Go Live"),a.data.complete&&window.scrollTo("#paymentInfoWarning",1e3)},function(e){a.data.errorMessage=e}).finally(function(){a.data.loading=!1})}a.data={successMessage:"",errorMessage:"",warningMessage:"",saving:!1,loading:!1,countryLocked:!1,accounts:[],account_type:"",accountId:"",filtered_accounts:[],initial:{personal:{owner:{email:"",firstName:"",lastName:""}},business:{email:"",name:""}},completion_phrase:"Submit for Review",step:"basics"},a.paymentAccountTypeLabel="bluesnap",a.setAccountTypeForlinked=function(e){e&&(a.getTypeForlinkedAccount=e)},a.changeCountry=function(){o()},a.$watch("countryCode",function(e){e&&o()}),a.$watch("data.selectedAccount",function(e){e&&(a.data.accountId=e.id,a.data.accountOptionType=e.optionType,a.paymentAccountTypeLabel=e.optionType)}),a.$on("payment-info-saved",function(){t()}),a.isAdmin=c.isAdmin(),a.setupAccount=function(e){var t,n=!1;a.data.saving=!0,e.preventDefault(),a.data.successMessage="",a.data.errorMessage="",a.data.warningMessage="","new"==a.data.accountId?(t=i.projectAdmin.bluesnap.setupCustomer(a.projectCommunityID,a.projectCommunityType,a.data.email,a.countryCode,a.data.account_type,a.data.initial.personal,a.data.initial.business,void 0),n=!0):t=("bluesnap"==a.data.accountOptionType?i.projectAdmin.bluesnap:i.projectAdmin.wepay).linkProjectToAccount(a.projectCommunityId,a.projectCommunityType,a.data.accountId),t.then(function(e){e.message&&(a.data.warningMessage=e.message),s.$broadcast("payment-info-saved")},function(e){a.data.errorMessage=e,n=!1}).finally(function(){a.data.saving=!1,n&&r.open({templateUrl:"blueSnapSuccess.html",controller:["$scope","$uibModalInstance",function(e,t){e.ok=function(){t.close({})}}],size:"md"})})},a.$watch(function(){return a.projectCommunityId+"-"+a.projectCommunityType},function(){a.projectCommunityId&&a.projectCommunityType&&t()})}}}]),e.directive("bluesnapVerificationDocuments",["api","$uibModal","$rootScope","patronicityConfig","$timeout",function(a,e,o,t,n){return{restrict:"E",scope:{accountId:"=",approvalStatus:"=",projectCommunityId:"=",projectCommunityType:"="},templateUrl:t.urlForTemplate("project-admin/sections/parts/bluesnap-verification-documents.html"),link:function(t,e,n){t.addDocumentvisible=!1,t.addDocumentbutton=!0,t.state={previewImgSrc:void 0,progress:0,uploading:!1},t.imgUploadClass="image-upload upload_button",t.fileExtention=["doc","docx","pdf"],t.loadDocumentList=function(){a.projectAdmin.bluesnap.account.loadSection(t.accountId,"doclist",t.projectCommunityId,t.projectCommunityType).then(function(e){t.documentList=e})},t.loadDocumentList(),o.$watch("fileUploadedResponse",function(e){e&&(t.loadDocumentList(),t.state.previewImgSrc=!1,t.addDocumentvisible=!1,t.addDocumentbutton=!0,t.documentType=!1)}),t.onFileSelect=function(e){t.$broadcast("upload-file-list-new",{files:e})},t.addDocument=function(){t.addDocumentvisible=!0}}}}]),e.directive("bluesnapDocumentsNote",["$uibModal","patronicityConfig","api","Dialogs",function(t,n,s,e){return{restrict:"E",template:'<button ng-click="openEditModal()" class="btn btn-primary btn-sm btn-block">{{label}}</button>',replace:!0,scope:{accountId:"=",doc:"=",area:"@",projectCommunityId:"=?",projectCommunityType:"=?"},link:function(e){e.label="Notes",e.openEditModal=function(){t.open({templateUrl:n.urlForTemplate("newadmin/bluesnap/bluesnap-documents-note.html"),controller:["$scope","$uibModalInstance","doc","accountId","area","projectCommunityId","projectCommunityType",function(e,t,n,a,o,i,r){e.doc=n,e.accountId=a,e.area=o,e.projectCommunityId=i,e.projectCommunityType=r,e.disabled=!1,"adminArea"==e.area&&(e.disabled=!0),e.saveNote=function(){t.dismiss({}),s.projectAdmin.bluesnap.account.saveSection(e.accountId,"docNoteSave",e.doc,e.projectCommunityId,e.projectCommunityType).then(function(e){})},e.cancelNote=function(){t.dismiss({})}}],size:"md",resolve:{doc:function(){return e.doc},accountId:function(){return e.accountId},area:function(){return e.area},projectCommunityId:function(){return e.projectCommunityId},projectCommunityType:function(){return e.projectCommunityType}}})}}}}]),e.directive("bluesnapAccountPayout",["api","patronicityConfig","$uibModal",function(r,e,s){return{restrict:"E",templateUrl:e.urlForTemplate("bluesnap-account-payout.html"),scope:{type:"@?",projectId:"=?",communityId:"=?",bluesnapId:"=?",currency:"=?",disabledPayout:"=?",complete:"=?"},link:function(t,e,n){function a(){t.adminArea?(t.payoutRequestSent=!1,r.admin.blueSnap.loadPayout(t.bluesnapId).then(function(e){t.data=e,t.data.refund_reserve=parseInt(e.refund_reserve),t.data.last_payout_request&&"DAILY"==t.data.frequency&&(t.payoutRequestSent=!0),r.admin.blueSnap.getPayoutFee(t.bluesnapId).then(function(e){t.fee=e},function(e){}),o()},function(e){})):r.projectAdmin.bluesnap.loadPayout(t.projectCommunityID,t.projectCommunityType).then(function(e){t.payoutRequestSent=!1,t.data=e,t.data.refund_reserve=parseInt(e.refund_reserve),t.data.last_payout_request&&"DAILY"==t.data.frequency&&(t.payoutRequestSent=!0),r.projectAdmin.bluesnap.getPayoutFee(t.projectCommunityID,t.projectCommunityType).then(function(e){t.fee=e},function(e){}),o()},function(e){})}function o(){t.adminArea?r.admin.blueSnap.getPendingUpdates(t.bluesnapId).then(function(e){t.pending=e,t.eachrow=e[0]},function(e){}):r.projectAdmin.bluesnap.getPendingUpdates(t.projectCommunityID,t.projectCommunityType).then(function(e){t.pending=e},function(e){})}t.frequencies=[{name:"Upon Request",value:"DAILY"},{name:"WEEKLY",value:"WEEKLY"},{name:"MONTHLY",value:"MONTHLY"}],t.adminArea=!1,t.payoutRequested=!1,t.$on("bluesnap-account-payout",function(){a()}),t.changed=function(){t.payoutRequested=!1,t.adminArea?r.admin.blueSnap.savePayout(t.bluesnapId,t.data.frequency,t.data.refund_reserve).then(function(e){t.data=e,t.data.refund_reserve=parseInt(e.refund_reserve),a()},function(e){t.data.errorMessage=e}):r.projectAdmin.bluesnap.savePayout(t.projectCommunityID,t.projectCommunityType,t.data.frequency,t.data.refund_reserve).then(function(e){t.data=e,t.data.refund_reserve=parseInt(e.refund_reserve),a()},function(e){t.data.errorMessage=e})},t.requestpayout=function(){t.payoutRequested=!0,r.projectAdmin.bluesnap.requestPayout(t.projectCommunityID,t.projectCommunityType).then(function(e){a()},function(e){})},t.updateReserveRefundAmount=function(e){t.adminArea&&r.admin.blueSnap.updateReserveRefundAmount(t.bluesnapId,e).then(function(e){a()},function(e){})},t.$watch("communityId",function(e){void 0!==t.communityId&&(t.projectCommunityID=t.communityId,t.projectCommunityType=t.type,a())}),t.$watch("projectId",function(e){void 0!==t.projectId&&(t.projectCommunityID=t.projectId,t.projectCommunityType=t.type,a())}),t.$watch("bluesnapId",function(e){void 0!==t.bluesnapId&&(t.adminArea=!0,a())});var i=t;t.openEditModal=function(){s.open({templateUrl:"adminReleasePayout.html",controllerAs:"$ctrl",controller:["$scope","$uibModalInstance",function(t,n){t.youcansave=!0,t.releasepayout=function(){r.admin.blueSnap.releasePayout(i.bluesnapId,t.executeDateTime).then(function(e){a(),n.dismiss({})},function(e){t.data.errorMessage=e})},t.cancel=function(){n.dismiss({})},t.save=function(){t.releasepayout()},t.$watch("executeDateTime",function(e){e&&(t.youcansave=!1)})}]})}}}}]),e.directive("bluesnapApproveAccount",["api",function(a){return{restrict:"E",scope:{accountId:"=",approvalStatus:"="},template:'<button type="button" class="btn btn-primary" ng-click="accountApprove()" > {{approveLabel}} </button',link:function(t,e,n){t.$watch("approvalStatus",function(e){t.approveLabel=e?"Un-Approve Account":"Approve Account"}),t.accountApprove=function(){a.admin.blueSnap.accountApproveUnapprove(t.accountId).then(function(e){t.approvalStatus=e.accountApproved}).finally(function(){})}}}}]),e.directive("payoutDetailReport",["$uibModal","patronicityConfig","api","$window","moment",function(t,n,e,i,a){return{restrict:"E",template:'<button ng-click="openEditModal()" class="btn btn-sm btn-primary">{{label}}</button>',scope:{accountId:"="},link:function(e){e.label="Payout Detail Report",e.openEditModal=function(){t.open({templateUrl:n.urlForTemplate("payout-detail-report.html"),controller:["$scope","$uibModalInstance","moment","accountId",function(n,a,o,e){n.accountId=e,n.daterange=!0,n.filter={StartDate:null,EndDate:null},n.cancel=function(){a.dismiss({})},n.submit=function(){var e=o(n.filter.StartDate).format("YYYY-MM-DD"),t=o(n.filter.EndDate).format("YYYY-MM-DD");n.accountId&&i.open("/project/account_payout_detail_report/"+n.accountId+"/"+e+"/"+t,"_blank"),a.dismiss({})},n.isRangeValid=function(){var e=o(n.filter.StartDate).format("YYYY-MM-DD"),t=o(n.filter.EndDate).format("YYYY-MM-DD");console.log(e,t),"Invalid date"!=e&&"Invalid date"!=t&&(e=o(e).add(12,"month").toDate(),n.future_date=o(e).format("YYYY-MM-DD"),t>n.future_date?(n.daterange=!0,n.dateMessage="End date should be under "+n.future_date):(n.dateMessage="",n.daterange=!1))},n.$watch("filter.StartDate",function(e){n.isRangeValid()}),n.$watch("filter.EndDate",function(e){n.isRangeValid()})}],size:"md",resolve:{accountId:function(){return e.accountId}}})}}}}])}(),function(){var e=angular.module("patronicity.project-admin.account-providers.internal",["patronicity.api","ui.bootstrap","user","mv.widgets","patronicity.configuration","mv.banking"]);e.directive("internalAccountInformation",["api","patronicityConfig","User","$uibModal","$rootScope",function(i,e,r,s,c){return{restrict:"E",scope:{projectCommunityType:"@",projectCommunityId:"@",countryCode:"="},templateUrl:e.urlForTemplate("project-admin/account-providers/internal.html"),link:function(a,e,n){function o(){var t=[{id:"new",optionType:"internal",display_name:"New Account.."}];a.data.accounts.forEach(function(e){e.country_code==a.countryCode&&t.push(e)}),a.data.filtered_accounts=t}function t(){a.data.loading=!0,i.projectAdmin.account.forProjectId(a.projectCommunityId,a.projectCommunityType).then(function(t){a.data.step=t.step,a.data.complete=t.complete,a.data.can_edit=t.can_edit,a.data.can_view=t.can_view,a.data.approvalStatus=t.approvalStatus,a.data.initial.personal.owner.email=t.email,a.data.initial.business.email=t.email,a.data.initial.personal.owner.firstName=t.firstName,a.data.initial.personal.owner.lastName=t.lastName,n.currencyCode&&(a.data.countryLocked=!0),"basics"==a.data.step?(a.data.accounts=t.accounts,o()):"info"==a.data.step&&(["account_type","countryCode","accountId"].forEach(function(e){a.data[e]=t[e]}),"personal"==a.data.account_type?a.data.completion_phrase="Submit for Review":a.data.completion_phrase="Go Live"),a.data.complete&&window.scrollTo("#paymentInfoWarning",1e3)},function(e){a.data.errorMessage=e}).finally(function(){a.data.loading=!1})}a.data={successMessage:"",errorMessage:"",warningMessage:"",saving:!1,loading:!1,countryLocked:!1,accounts:[],account_type:"",accountId:"",filtered_accounts:[],initial:{personal:{owner:{email:"",firstName:"",lastName:""}},business:{email:"",name:""}},completion_phrase:"Submit for Review",step:"basics"},a.paymentAccountTypeLabel="internal",a.changeCountry=function(){o()},a.$watch("countryCode",function(e){e&&o()}),a.$watch("data.selectedAccount",function(e){e&&(a.data.accountId=e.id,a.data.accountOptionType=e.optionType,a.paymentAccountTypeLabel=e.optionType)}),a.$on("payment-info-saved",function(){t()}),a.isAdmin=r.isAdmin(),a.setupAccount=function(e){var t,n=!1;a.data.saving=!0,e.preventDefault(),a.data.successMessage="",a.data.errorMessage="",a.data.warningMessage="","new"==a.data.accountId?(t=i.projectAdmin.account.setupCustomer(a.projectCommunityId,a.projectCommunityType,a.data.email,a.countryCode,a.data.account_type,a.data.initial.personal,a.data.initial.business,void 0),n=!0):t="internal"==a.data.accountOptionType?i.projectAdmin.account.linkProjectToAccount(a.projectCommunityId,a.projectCommunityType,a.data.accountId):i.projectAdmin.account.convertToNewInternalAccount(a.projectCommunityId,a.projectCommunityType,a.data.accountOptionType,a.data.accountId),t.then(function(e){e.message&&(a.data.warningMessage=e.message),c.$broadcast("payment-info-saved")},function(e){a.data.errorMessage=e,n=!1}).finally(function(){a.data.saving=!1,n&&s.open({templateUrl:"blueSnapSuccess.html",controller:["$scope","$uibModalInstance",function(e,t){e.ok=function(){t.close({})}}],size:"md"})})},a.$watch(function(){return a.projectCommunityType+"-"+a.projectCommunityId},function(){a.projectCommunityType&&a.projectCommunityId&&t()})}}}]),e.directive("helpText",["$rootScope",function(e){return{restrict:"E",templateUrl:"helpText.html",scope:{helpText:"@"},link:function(e,t,n){e.message=e.helpText}}}]),e.directive("labelDirective",["$rootScope",function(o){return{restrict:"EA",template:"{{label}}",scope:{type:"@",countryPersonal:"@",countryBank:"@",countryBusiness:"@"},link:function(n,e,t){function a(e,t){o.$broadcast(e,{countryCode:t,type:n.type},function(e){e&&(n.label=e)})}n.label="",n.$watch("countryPersonal",function(e,t){e&&a("get-principal-label",e)}),n.$watch("countryBank",function(e,t){e&&a("get-bank-label",e)}),n.$watch("countryBusiness",function(e,t){e&&a("get-business-label",e)})}}}]),e.directive("accountPrincipalInformation",["api","moment","$rootScope","User",function(i,r,s,n){return{restrict:"E",templateUrl:"accountPrincipalInformation.html",scope:{accountId:"@",type:"@"},link:function(o,e,t){function a(e){o.data.owner=e.owner,o.data.field_with_desc=e.field_with_desc,o.data.complete=e.complete,o.data.owner.sensitive=e.owner.sensitive,o.data.addressLoaded=!0,angular.forEach(e.owner.sensitive,function(e,t){o.disVal=!1,""!==e&&void 0!==e&&(o.disVal=!0),o[t]={value:e,initialDisabled:o.disVal}}),""==o.data.owner.birthDate&&(o.data.owner.birthDate=void 0),o.orig=angular.copy(o.data)}o.labels={default:{},US:{},CA:{},GB:{}},o.labels.default={birthDate:"Date of Birth",email:"Email Address",street:"Address",street2:"Address Line 2",country:"Country",firstName:"Given Name",lastName:"Family Name",phone:"Phone Number",city:"City",zip:"Postal Code",state:"State/Province/Region",personalId:"Your Government Issued ID"},o.labels.US={firstName:"First Name",lastName:"Last Name",state:"State",zip:"ZIP",phone:"Cell Phone Number",personalId:"Your ID"},o.labels.CA={firstName:"First Name",lastName:"Last Name",state:"Province",personalId:"Your ID"},o.labels.GB={firstName:"First Name",lastName:"Last Name",city:"Town",zip:"Postcode"},o.$on("get-principal-label",function(e,t,n){n(t.countryCode&&o.labels[t.countryCode]&&o.labels[t.countryCode][t.type]||o.labels.default[t.type])}),n.permittedCountries().then(function(e){o.data.permittedCountries=e}),o.filterCountry=function(e){return 0<=o.data.permittedCountries.indexOf(e.Code)},o.data={loading:!1,saving:!1,complete:!1,permittedCountries:[],errorMessage:"",showForEditing:!1,priorityCountryList:n.prioritizedCountries(),labels:{title:"personal"==t.type?"Your Personal Information":"Entity Owner Personal Information",prefix:"personal"==t.type?"Your":"Entity Owner's"},addressLoaded:!1,owner:{firstName:"",lastName:"",email:"",birthDate:void 0,dlNumber:"",personalIdNumber:"",passportNumber:"",phone:"",address:{ID:"new",Name:"",Phone:"",Street:"",Street2:"",Country:"",City:"",ZipCode:"",State:"",Save:!1}}},o.showForEditing=function(e){e.preventDefault(),o.data.showForEditing=!0},o.resetForm=function(e){e&&(e.$setPristine(),e.$setUntouched()),o.data=angular.copy(o.orig)},o.isDirty=function(){var e,t=o.orig&&o.orig.owner?o.orig.owner:void 0,n=o.data&&o.data.owner?o.data.owner:void 0,a=[];return void 0===t&&void 0!==n||void 0!==t&&void 0===n?a.push("all"):(angular.forEach(["firstName","lastName","email","birthDate","dlNumber","personalIdNumber","passportNumber","phone"],function(e){t[e]!==n[e]&&a.push(e)}),angular.forEach(["ID","Name","Phone","Street","Street2","Country","City","ZipCode","Save"],function(e){t.address[e]!==n.address[e]&&a.push("address."+e)}),e=t.address.State||"",(n.address.State||"")!=e&&a.push("address.State")),0<a.length},o.save=function(){o.data.saving=!0,o.data.errorMessage="";var n=function e(t){var n,a={};for(n in t){var o=t[n];"object"==typeof o?o=e(o):void 0===o&&(o=""),a[n]=o}return a}(o.data.owner);void 0!==o.data.owner.birthDate&&(n.birthDate=r(o.data.owner.birthDate).format("YYYY-MM-DD")),angular.forEach(o.data.owner.sensitive,function(e,t){void 0===o[t].value||o[t].value===o[t].oldValue||o[t].initialDisabled?(n.sensitive[t]=void 0,o.data.owner.sensitive[t]=void 0):(n.sensitive[t]=o[t].value,o.data.owner.sensitive[t]=o[t].value)}),i.projectAdmin.account.saveSection(o.accountId,"principal",n).then(function(e){a(e),o.data.complete&&(o.data.showForEditing=!1),o.$broadcast("reset-form-to-pristine"),o.$emit("payment-info-saved",{type:"principal",id:o.accountId,data:e.owner}),s.$broadcast("load-project-bar-data",{accountId:o.accountId})},function(e){o.data.errorMessage=e}).finally(function(){o.data.saving=!1})},o.$watch(function(){return o.accountId+"-"+o.type},function(){o.data.loading=!0,o.data.addressLoaded=!1,i.projectAdmin.account.loadSection(o.accountId,"principal").then(function(e){a(e)}).finally(function(){o.data.loading=!1})})}}}]),e.directive("pristineResetForm",function(){return{restrict:"A",require:"form",link:function(e,t,n,a){e.$on("reset-form-to-pristine",function(){a.$setPristine()})}}}),e.directive("accountPanel",function(){return{restrict:"E",templateUrl:"accountPanel.html",transclude:!0,scope:{title:"@",complete:"="},link:function(t,e,n){t.data={showForEditing:!1},t.showForEditing=function(e){e.preventDefault(),t.data.showForEditing=!0},t.$watch("complete",function(e){e&&t.data.showForEditing&&(t.data.showForEditing=!1)})}}}),e.directive("verificationDocumentsPanel",["api","$rootScope",function(a,o){return{restrict:"E",templateUrl:"verificationDocumentsPanel.html",scope:{accountId:"@",accountType:"@",category:"@"},link:function(n,e,t){n.saveBtnLabel="Save File",n.data={loading:!0,accountType:t.accountType,documents:[],types:[],showNewSection:!1,parameters:{imageDisabled:!1},state:{previewImgSrc:!1,progress:0,uploading:!1},document:{id:void 0,numberRequired:!1,numberLabel:"",number:""}},n.data.loading=!0,a.projectAdmin.account.listDocuments(n.accountId).then(function(e){n.data.documents=e.documents,n.data.types=e.types}).finally(function(){n.data.loading=!1}),n.startNewDocument=function(){n.data.showNewSection=!0},n.saveDocumentChanges=function(){n.saveBtnLabel="Saving...",n.data.document.type||(n.data.document.type={id:""},"business"==n.category?n.data.document.type.id="incorporation":"bank"==n.category&&(n.data.document.type.id="bank_statement")),n.data.loading=!0;var e={id:n.data.document.id,type:n.data.document.type.id,number:n.data.document.number};a.projectAdmin.account.saveDocument(n.accountId,e).then(function(e){n.data.documents=e.documents,n.data.showNewSection=!1,n.data.state.previewImgSrc=!1,n.data.state.progress=0,n.data.document.id=void 0,n.data.document.numberRequired=!1,n.data.document.numberLabel="",n.data.document.number="",n.data.document.type=void 0}).finally(function(){n.data.loading=!1,n.saveBtnLabel="Save File"})},n.updateNewDocumentType=function(){n.data.document.type&&n.data.document.type.id_query?(n.data.document.number=n.data.document.number||"",n.data.document.numberLabel=n.data.document.type.id_query,n.data.document.numberRequired=n.data.document.type.id_required):(n.data.document.numberLabel="",n.data.document.numberRequired=!1)},n.deleteDocument=function(e){return confirm("Are you sure you want to delete "+e.description)&&a.projectAdmin.account.deleteDocument(n.accountId,e.id).then(function(e){n.data.documents=e.documents},function(e){alert(e)}),!1},n.viewDocument=function(e){return window.open(e.url),!1},n.onFileSelect=function(e){n.$broadcast("upload-file-list-new",{files:e})},o.$on("file-uploaded",function(e,t){n.category&&n.category==t.category?(n.data.document.id=t.fileId,"personal"!=n.category&&n.saveDocumentChanges()):n.data.document.id=t.fileId})}}}]),e.directive("bankAccountInformation",["api","ibanProvider","$rootScope","User",function(o,i,r,s){function c(e){var t,n={};for(t in e){var a=e[t];"object"==typeof a?a=c(a):void 0===a&&(a=""),n[t]=a}return n}return{restrict:"E",templateUrl:"bankAccountInformation.html",scope:{accountId:"@",type:"@"},link:function(a,e,t){function n(){"WIRE"==a.data.bank.payoutMethod||"SEPA"==a.data.bank.payoutMethod?a.data.swiftAndIBAN=i.countrySupportsIBAN(a.data.bank.address.Country):a.data.swiftAndIBAN=!1,a.data.bank.swiftOrBankId="",a.data.bank.accountNumberOrIban="","CA"==a.data.bank.address.Country?("WIRE"==a.data.bank.payoutMethod?a.data.bank.swiftBic&&0<a.data.bank.swiftBic.trim().length&&(a.data.bank.swiftOrBankId=a.data.bank.swiftBic):a.data.bank.bankId&&9==a.data.bank.bankId.trim().length&&(a.data.CA.instituteNumber=a.data.bank.bankId.substr(1,3),a.data.CA.transitNumber=a.data.bank.bankId.substr(4,5),a.data.bank.swiftOrBankId=a.data.bank.bankId),a.data.bank.accountNumber&&0<a.data.bank.accountNumber.trim().length&&(a.data.bank.accountNumberOrIban=a.data.bank.accountNumber)):a.data.swiftAndIBAN?(a.data.bank.swiftBic&&0<a.data.bank.swiftBic.trim().length&&(a.data.bank.swiftOrBankId=a.data.bank.swiftBic),a.data.bank.iban&&0<a.data.bank.iban.trim().length&&(a.data.bank.accountNumberOrIban=a.data.bank.iban)):(a.data.bank.bankId&&0<a.data.bank.bankId.trim().length&&(a.data.bank.swiftOrBankId=a.data.bank.bankId),a.data.bank.accountNumber&&0<a.data.bank.accountNumber.trim().length&&(a.data.bank.accountNumberOrIban=a.data.bank.accountNumber)),a.data.complete&&(a.data.showForEditing=!1)}a.labels={default:{},US:{},CA:{},GB:{}},"personal"==t.type?a.accountNameLabel="Name of Account Holder (Must match bank records)":a.accountNameLabel="Name on the Account (Must match bank records)",a.labels.default={email:"Email Address",street:"Address",street2:"Address Line 2",country:"Country",city:"City",zip:"Postal Code",state:"State/Province/Region",class:"Bank Account Class",bankName:"Bank Name",routingNumber:"SWIFT/BIC",accountNumber:"IBAN",type:"Bank Account Type",name:a.accountNameLabel,currency:"Bank Account Settlement Currency",method:"Payout Method",bankStatement:"Your Bank Statement"},a.labels.US={state:"State",zip:"ZIP",phone:"Cell Phone Number",routingNumber:"Routing Number",accountNumber:"Account Number"},a.labels.CA={state:"Province",accountNumber:"Account Number",instituteNumber:"Institute Number",transitNumber:"Transit Number"},a.labels.GB={city:"Town",zip:"Postcode",bankType:"Bank Account Type"},a.$on("get-bank-label",function(e,t,n){t.countryCode&&a.labels[t.countryCode]&&a.labels[t.countryCode][t.type]?a.label=a.labels[t.countryCode][t.type]:a.label=a.labels.default[t.type],n(a.label)}),a.data={loading:!1,saving:!1,complete:!1,showForEditing:!1,swiftAndIBAN:!1,priorityCountryList:s.prioritizedCountries(),permittedCountries:[],addressLoaded:!1,errorMessage:"",CA:{instituteNumber:"",transitNumber:""},constants:{payoutMethods:[{id:"ACH",label:"ACH",enabled:!0},{id:"SEPA",label:"SEPA",enabled:!0},{id:"CHAPS",label:"CHAPS",enabled:!0},{id:"WIRE",label:"WIRE",enabled:!0},{id:"EFT",label:"EFT",enabled:!0}]},labels:{title:"personal"==t.type?"Your Bank Information":"Entity Bank Information"},bank:{currency:"",account_name:"",name:"",type:"",class:"",payoutMethod:"",swiftOrBankId:"",accountNumberOrIban:"",address:{ID:"new",Name:"",Phone:"",Street:"",Street2:"",Country:"US",City:"",ZipCode:"",State:"",Save:!1}}},a.showForEditing=function(e){e.preventDefault(),a.data.showForEditing=!0},a.$watch("data.bank.payoutMethod",function(e){n()}),s.permittedCountries().then(function(e){a.data.permittedCountries=e}),a.filterCountry=function(e){return 0<=a.data.permittedCountries.indexOf(e.Code)},a.updateBankCurrency=function(){var t=[];a.data.constants.payoutMethods.forEach(function(e){switch(e.id){case"ACH":"USD"!=a.data.bank.currency&&"CAD"!=a.data.bank.currency||"US"!=a.data.bank.address.Country?e.enabled=!1:e.enabled=!0;break;case"SEPA":"EUR"==a.data.bank.currency&&i.countrySupportsIBAN(a.data.bank.address.Country)?e.enabled=!0:e.enabled=!1,e.enabled=!1;break;case"CHAPS":"GBP"==a.data.bank.currency&&"GB"==a.data.bank.address.Country?e.enabled=!0:e.enabled=!1,e.enabled=!1;break;case"EFT":"CAD"!=a.data.bank.currency&&"USD"!=a.data.bank.currency||"CA"!=a.data.bank.address.Country?e.enabled=!1:e.enabled=!0;break;case"WIRE":e.enabled=!0}t.push(e),e.id==a.data.bank.payoutMethod&&0==e.enabled&&(a.data.bank.payoutMethod="")}),a.data.constants.payoutMethods=t,n()},a.$watch(function(){return a.data.CA.instituteNumber+a.data.CA.transitNumber},function(){"CA"==a.data.bank.address.Country&&"EFT"==a.data.bank.payoutMethod&&(a.data.bank.bankId="0"+a.data.CA.instituteNumber+a.data.CA.transitNumber)}),a.resetForm=function(e){e&&(e.$setPristine(),e.$setUntouched()),a.data=angular.copy(a.orig),a.data.originalBank=c(a.data.bank)},a.save=function(){a.data.saving=!0,a.data.errorMessage="",delete a.data.bank.bankId,delete a.data.bank.accountNumber,delete a.data.bank.swiftBic,delete a.data.bank.iban,a.data.bank.isIBANSupported=a.data.swiftAndIBAN,"CA"==a.data.bank.address.Country?("WIRE"==a.data.bank.payoutMethod?a.data.bank.swiftBic=a.data.bank.swiftOrBankId:a.data.bank.bankId="0"+a.data.CA.instituteNumber+a.data.CA.transitNumber,a.data.bank.accountNumber=a.data.bank.accountNumberOrIban):a.data.swiftAndIBAN?(a.data.bank.iban=a.data.bank.accountNumberOrIban,a.data.bank.swiftBic=a.data.bank.swiftOrBankId):(a.data.bank.bankId=a.data.bank.swiftOrBankId,a.data.bank.accountNumber=a.data.bank.accountNumberOrIban),delete a.data.bank.swiftOrBankId,delete a.data.bank.accountNumberOrIban,o.projectAdmin.account.saveSection(a.accountId,"bank",a.data.bank).then(function(e){a.data.complete=e.complete,a.data.bank=e.bank,a.data.field_with_desc=e.field_with_desc,n(),a.$broadcast("reset-form-to-pristine"),a.orig=angular.copy(a.data),a.data.originalBank=c(a.data.bank),a.updateBankCurrency(),a.$emit("payment-info-saved",{type:"bank",id:a.accountId,data:e.bank}),r.$broadcast("load-project-bar-data",{accountId:a.accountId})},function(e){a.data.errorMessage=e}).finally(function(){a.data.saving=!1})},a.hasChanges=function(){var e=c(a.data.bank);return 0<function e(t,n,a){var o,i=[],r=void 0===a?"":a+".";for(o in n){var s=n[o];if("object"==typeof s)for(var c=e(n[o],void 0!==t&&t[o]||{},r+o),l=0;l<c.length;l++)i.push(r+c[l]);else void 0!==t&&s===t[o]||i.push(r+o)}return i}(a.data.originalBank,e).length},a.$watch("data.bank.address.Country",function(e){a.updateBankCurrency()}),a.$watch(function(){return a.accountId+"-"+a.type},function(){a.data.loading=!0,a.data.addressLoaded=!0,o.projectAdmin.account.loadSection(a.accountId,"bank").then(function(e){a.data.bank=e.bank,a.data.field_with_desc=e.field_with_desc,a.data.complete=e.complete,a.data.constants.settlementCurrencies=e.settlementCurrencies,a.data.addressLoaded=!0,a.settlementCurrencies=a.data.constants.settlementCurrencies.filter(function(e){return e.id==a.data.bank.currency}),a.settlementCurrencies[0]||(a.data.bank.currency="USD"),a.updateBankCurrency(),a.orig=angular.copy(a.data),a.data.originalBank=c(a.data.bank)}).finally(function(){a.data.loading=!1})})}}}]),e.directive("businessAccountInformation",["api","$rootScope","User",function(n,o,i){return{restrict:"E",templateUrl:"businessAccountInformation.html",scope:{accountId:"@"},link:function(a,e,t){a.labels={default:{},US:{},CA:{},GB:{}},a.labels.default={street:"Address",street2:"Address Line 2",country:"Country",city:"City",zip:"Postal Code",state:"State/Province/Region",businessName:"Name of Entity (as legally registered)",businessPhone:"Phone Number",businessTaxId:"Company Registration Number",incorporationDocument:"Incorporation Document"},a.labels.US={state:"State",zip:"ZIP",businessTaxId:"EIN"},a.labels.CA={state:"Province",businessTaxId:"Business Number"},a.labels.GB={city:"Town",zip:"Postcode"},a.$on("get-business-label",function(e,t,n){t.countryCode&&a.labels[t.countryCode]&&a.labels[t.countryCode][t.type]?a.label=a.labels[t.countryCode][t.type]:a.label=a.labels.default[t.type],n(a.label)}),a.data={loading:!1,saving:!1,complete:!1,permittedCountries:[],priorityCountryList:i.prioritizedCountries(),errorMessage:"",addressLoaded:!1,business:{name:"",phone:"",taxId:"",address:{ID:"new",Name:"",Phone:"",Street:"",Street2:"",Country:"US",City:"",ZipCode:"",State:"",Save:!1}}},i.permittedCountries().then(function(e){a.data.permittedCountries=e}),a.filterCountry=function(e){return 0<=a.data.permittedCountries.indexOf(e.Code)},a.resetForm=function(e){e&&(e.$setPristine(),e.$setUntouched()),a.data=angular.copy(a.orig)},a.save=function(){a.data.saving=!0,a.data.errorMessage="",n.projectAdmin.account.saveSection(a.accountId,"business",a.data.business).then(function(e){a.$broadcast("reset-form-to-pristine"),a.data.business=e.business,a.data.field_with_desc=e.field_with_desc,a.data.complete=e.complete,a.orig=angular.copy(a.data),a.$emit("payment-info-saved",{type:"business",id:a.accountId,data:e.business}),o.$broadcast("load-project-bar-data",{accountId:a.accountId})},function(e){a.data.errorMessage=e}).finally(function(){a.data.saving=!1})},a.$watch("accountId",function(e){console.log("Business Account Information: AccountID and Type changed!"),a.data.loading=!0,a.data.addressLoaded=!1,n.projectAdmin.account.loadSection(a.accountId,"business").then(function(e){a.data.business=e.business,a.data.addressLoaded=!0,a.data.field_with_desc=e.field_with_desc,a.data.complete=e.complete,a.orig=angular.copy(a.data)}).finally(function(){a.data.loading=!1})})}}}])}(),angular.module("patronicity.project-admin.account-providers.wepay-payment-method",["patronicity.api","ui.bootstrap","user","mv.widgets","patronicity.configuration"]).directive("wepayAccountInformation",["api","$uibModal","patronicityConfig","$rootScope",function(i,r,e,s){return{restrict:"E",templateUrl:e.urlForTemplate("project-admin/account-providers/wepay-payment-method.html"),scope:{projectCommunityType:"@",projectCommunityId:"@",countryCode:"="},link:function(a,e,t){function n(){var t=[];a.data.accounts.forEach(function(e){e.country_code==a.countryCode&&t.push(e)}),a.data.filtered_accounts=t,a.data.filtered_accounts.length?a.data.accountId=a.data.filtered_accounts[0].id:a.data.accountId="new"}function o(){a.data.loading=!0,i.projectAdmin.wepay.forProjectId(a.projectCommunityId,a.projectCommunityType).then(function(t){a.data.step=t.step,"basics"==a.data.step?(a.data.email=t.email,a.data.firstName=t.firstName,a.data.lastName=t.lastName,a.data.accounts=t.accounts,a.data.mcc=t.mcc,n()):"info"==a.data.step&&(a.countryCode=t.countryCode,["firstName","lastName","email","currencyCode","user_state","account_state","review_status","action_reasons","disabled_reasons","display_name","account_type","urls","paymentNotice"].forEach(function(e){a.data[e]=t[e]}),t.project_is_live?a.data.completion_phrase="begin fundraising.":"personal"==a.data.account_type?a.data.completion_phrase="Submit for Review":a.data.completion_phrase="Go Live")},function(e){a.data.errorMessage=e}).finally(function(){a.data.loading=!1})}a.data={countries:[{code:"US",label:"United States",currency:"USD",enabled:!0},{code:"CA",label:"Canada",currency:"CAD",enabled:!0}],successMessage:"",errorMessage:"",warningMessage:"",saving:!1,loading:!1,countryLocked:!1,currencyCode:"",email:"",firstName:"",lastName:"",mcc:[],mccCategoryId:"",mccCategoryOptions:[],accounts:[],mccCode:"7299",mccUrlRequired:!1,account_type:"",filtered_accounts:[],businessPrimaryUrl:"",businessName:"",businessDescription:"",completion_phrase:"Submit for Review",canada:{debit_opt_in:!0},businessAddress:{ID:"new",Name:"",Phone:"",Street:"",Street2:"",Country:"US",City:"",ZipCode:"",State:"",Save:!1},step:"basics"},t.currencyCode&&(a.data.countries.forEach(function(e){e.currency==t.currencyCode?(e.enabled=!0,a.countryCode=e.code,a.data.currencyCode=e.currency):e.enabled=!1}),a.data.countryLocked=!0),a.updateCategoryOptions=function(){a.data.mcc.forEach(function(e){e.id==a.data.mccCategoryId&&(a.data.mccCategoryOptions=e.codes)})},a.updateUrlDisplayForCode=function(){a.data.mccCategoryOptions.forEach(function(e){e.code==a.data.mccCode&&(a.data.mccUrlRequired=e.url_required,a.data.mccUrlRequired=!1)})},a.$watch("countryCode",function(e){if(e){switch(e){case"US":a.data.currencyCode="USD";break;case"CA":a.data.currencyCode="CAD"}"CA"==(a.data.businessAddress.Country=e)&&(a.data.canada.debit_opt_in=!0),n()}}),a.$watch("data.account_type",function(e){if(void 0!==e)switch(e){case"personal":a.data.mccCode="7299";break;case"nonprofit":a.data.mccCode="8398"}}),a.$on("payment-info-saved",function(){o()}),a.showFees=function(){var e=a.countryCode;i.projectAdmin.wepay.fees(a.projectCommunityId,a.projectCommunityType,e).then(function(e){r.open({templateUrl:"wePayFees.html",controller:["$scope","$uibModalInstance","fees",function(e,t,n){e.fees=n,e.ok=function(){t.close({})}}],size:"md",resolve:{fees:function(){return e}}})})},a.resendConfirmation=function(){a.data.successMessage="",a.data.errorMessage="",i.projectAdmin.wepay.resendConfirmation(a.projectCommunityId,a.projectCommunityType,a.data.email).then(function(e){a.data.successMessage=e.message},function(e){a.data.errorMessage=e})},a.setupAccount=function(e){var t,n=!1;a.data.saving=!0,e.preventDefault(),a.data.successMessage="",a.data.errorMessage="",a.data.warningMessage="","new"==a.data.accountId?(e={},"CA"==a.countryCode&&(e.CA=a.data.canada),t=i.projectAdmin.wepay.setupCustomer(a.projectCommunityId,a.projectCommunityType,a.data.email,a.data.firstName,a.data.lastName,a.countryCode,a.data.currencyCode,a.data.account_type,a.data.mccCode,a.data.businessName,a.data.businessDescription,a.data.businessAddress,a.data.businessPrimaryUrl,e),n=!0):t=i.projectAdmin.wepay.linkProjectToAccount(a.projectCommunityId,a.projectCommunityType,a.data.accountId),t.then(function(e){e.message&&(a.data.warningMessage=e.message),s.$broadcast("payment-info-saved")},function(e){a.data.errorMessage=e,n=!1}).finally(function(){a.data.saving=!1,n&&r.open({templateUrl:"wePaySuccess.html",controller:["$scope","$uibModalInstance",function(e,t){e.ok=function(){t.close({})}}],size:"md"})})},a.$watch(function(){return a.projectCommunityType+"-"+a.projectCommunityId},function(){a.projectCommunityType&&a.projectCommunityId&&o()})}}}]),angular.module("patronicity.project-admin.donation-manager",["patronicity.api","user","mv.utils","patronicity.configuration"]).factory("DonationManager",["api","$uibModal","$filter","$q","Dialogs","patronicityConfig",function(c,t,l,e,u,n){function o(e){var t=!1;return t=0===parseInt(e.Limit)||parseInt(e.PrizeAwarded)<parseInt(e.Limit)?!0:t}function i(e){var t="";return t=0<parseInt(e.Limit)?e.PrizeAwarded+"/"+e.Limit:t}function r(e){return l("noDecimalCurrency")(e.ChallengeAmount)+" - "+e.Title+" "+i(e)}function s(t,e,n){return angular.forEach(e,function(e){e.ID==t&&(n=Math.max(n,e.ChallengeAmount))}),n}function d(o,i,r,s){return e(function(n,a){c.projectAdmin.donationTipCheck(o,i.amount,i.id).then(function(e){var t;e.willTip?(t="<strong>NOTICE:</strong> This donation will cause this project to reach or exceed its goal. All donors will be notified","0"==e.fundingOption?t+=" and all cards will be charged. ":t+=". ",t+="Are you sure the amount of <strong>"+l("currency")(i.amount,r)+"</strong> is correct?",u.Confirm(t,"Confirm Offline Donation",[{name:"Yes, that is correct",type:"ok"},{name:"Oops, let me change that",type:"cancel"}]).then(function(){c.projectAdmin.saveDonation(o,i.id,i).then(function(e){n({tipped:!0,donationID:i.id,again:s})},a)})):c.projectAdmin.saveDonation(o,i.id,i).then(function(e){n({tipped:!1,donationID:i.id,again:s})},a)})})}return{edit:function(e){return t.open({templateUrl:n.urlForTemplate("project-offline-donation-modal.html"),controller:["$scope","$uibModalInstance","Dialogs","donationID",function(n,t,e,a){c.projectAdmin.donationById(a).then(function(e){n.editmode=!0,n.donorType="individual",e.donation.GroupName&&""!==e.donation.GroupName&&(n.donorType="group"),n.anon=!1,"yes"===e.donation.Anonymous&&(n.anon=!0),n.donation={id:e.donation.ID,projectId:e.donation.ProjectID,amount:e.donation.Amount,donor_type:n.donorType,firstName:e.donation.FirstName,lastName:e.donation.LastName,groupName:e.donation.GroupName,groupDonorCount:e.donation.DonorCount,anonymous:n.anon,date:e.donation.AddedDate,email:e.donation.Email,paymentType:e.donation.Type,reward:e.donation.RewardID,street:e.donation.ShippingAddress,street2:e.donation.ShippingAddressLine2,city:e.donation.ShippingAddressCity,state:e.donation.ShippingAddressState,zip:e.donation.ShippingAddressZip,country:e.donation.ShippingAddressCountry,comments:e.donation.Comments,phone:e.donation.Phone,isOfflineDonation:e.donation.IsOfflineDonation},n.rewards=e.rewards,n.currencySymbol=e.currency_symbol},function(e){alert(e)}),n.validReward=o,n.rewardsRemaining=i,n.$watch("donation.reward",function(e,t){t!=e&&(n.donation.amount=s(e,n.rewards,n.donation.amount))}),n.ok=function(e){d(n.donation.projectId,n.donation,n.currencySymbol,!1).then(function(e){t.close(e)},function(e){alert(e)})},n.cancel=function(){t.dismiss()},n.rewardLabel=r}],size:"",resolve:{donationID:function(){return e}}}).result},add:function(a){return t.open({templateUrl:n.urlForTemplate("project-offline-donation-modal.html"),controller:["$scope","$uibModalInstance","projectID",function(n,t,e){n.donation={projectId:e,amount:"",donor_type:"individual",firstName:"",lastName:"",groupName:"",groupDonorCount:"",anonymous:!1,date:new Date,email:"",paymentType:"check",reward:0,street:"",street2:"",city:"",state:"",zip:"",country:"US",comments:"",phone:"",isOfflineDonation:"offline"},c.projectAdmin.donationProjectInfo(e).then(function(e){n.rewards=e.rewards,n.currencySymbol=e.currency_symbol},function(e){alert(e)}),n.validReward=o,n.$watch("donation.reward",function(e,t){t!=e&&(n.donation.amount=s(e,n.rewards,n.donation.amount))}),n.rewardsRemaining=i,n.ok=function(e){e=!!e;d(a,n.donation,n.currencySymbol,e).then(function(e){t.close(e)},function(e){alert(e)})},n.rewardLabel=r,n.cancel=function(){t.dismiss()}}],size:"",resolve:{projectID:function(){return a}}}).result}}}]),angular.module("patronicity.project-admin.edit-bar",["patronicity.api","ui.bootstrap","patronicity.project-admin.donation-manager","mv.utils","patronicity.configuration"]).directive("projectBar",["$rootScope","$location","$timeout","$uibModal","DonationManager","api","Dialogs","patronicityConfig","$q","$analytics","$state",function(a,e,o,d,c,p,m,g,f,h,y){return{restrict:"E",require:"^editManager",templateUrl:g.urlForTemplate("project-admin/project-bar.html"),scope:{},link:function(r,e,t,n){function i(t){angular.forEach(r.navigation,function(e){e.active=0===t.indexOf(e.state)})}function l(e){var t,n,a,o;r.manager=e.manager,r.faqUrl=e.faqUrl,r.navigation=(t=e.navigation,n=e.project,a=[],o=g.applicationName,angular.forEach(t,function(e){var t={id:e};switch(t.id){case"view":t.icon="glyphicon-sunglasses",t.label="View",t.tooltip="View your project",t.state="campaign.view";break;case"edit":t.icon="glyphicon-pencil",t.label="Edit",t.tooltip="Edit your project",t.state="campaign.edit";break;case"donors":t.icon="glyphicon-user",t.label="Donors",t.tooltip="View your donors",t.state="campaign.donors";break;case"summary":t.icon="glyphicon-credit-card",t.label="Financial",t.tooltip="Financial Details",t.state="campaign.summary";break;case"resources":t.icon="launchgood"==o?"glyphicon-adjust":"glyphicon-folder-close",t.label="launchgood"==o?"Ramadan":"Help & Tips",t.tooltip="Additional Resources",t.state="campaign.resources";break;case"insights":t.icon="glyphicon-dashboard",t.label="Insights",t.tooltip="Campaign Insights",t.state="campaign.insights"}t.url=n.slug+y.href(t.state,n),t.active=!1,a.push(t)}),a),r.canAddOfflineDonation=e.project.canAddOfflineDonation,r.projectStatus=e.project.status,r.dropdownOptions=e.project.dropdown,r.canSendUpdate=e.project.canSendUpdate,r.changingStatus=!1,r.coaching=e.project.coaching,r.preapproval=e.project.preApprovalInBar,r.sponsorName=e.project.sponsorName,r.communityPreApprovalInBar=e.project.communityPreApprovalInBar,r.paymentType=e.project.paymentType,r.slug=e.project.slug,r.creatorName=e.project.creatorName,r.IsCommunityCampaign=e.project.IsCommunityCampaign,r.IsCommunityCampaign&&(r.sponsorName=e.project.sponsorName),i(y.current.name)}function u(){r.visible=n.CanEdit(),p.projectAdmin.projectBarInfo(n.ProjectId()).then(function(e){l(e)},function(e){alert(e)})}r.hideBar=!1,r.navigation=[],r.statusMenuDropdown=!1,r.projectId=n.ProjectId(),r.changingStatus=!1,r.applicationName="launchgood"==g.applicationName?"Launchgood":"Patronicity",r.$on("hide-edit-bar",function(e,t){r.hideBar=t.hide,r.hideBar||u()}),r.$on("get-project-status",function(e,t,n){n(r.projectStatus)}),r.$on("load-project-bar-data",function(e,t){t?t.accountId&&p.projectAdmin.account.updatePreapproval(t.accountId).then(function(){u()}):u()}),r.$on("ui-state-changed",function(e,t,n,a,o){i(t)}),r.submitProjectV2=function(n,e){r.review=!1,r.live=!1,r.verb="submit-project",r.urgent="true"===e,p.projectAdmin.requirementsCheck(n).then(function(e){var t="";e.preapproval&&e.canSubmit?(t="preapproval",r.live=!0):r.review=!0,r.submit=function(e){p.projectAdmin.changeProjectState(n,r.verb,e).then(function(e){"start-project"==r.verb?h.eventTrack("GoLiveSubmitComplete",{category:"campaign",label:new Date}):h.eventTrack("ReviewSubmitComplete",{category:"campaign",label:new Date}),a.$broadcast("submitted-project-v2",{review:r.review,live:r.live})},function(e){e.includes("help@launchgood.com")&&alert(e)})},"launchgood"==e.application&&(t={coaching:!1,urgent:r.urgent,option:"nocall",DialogMsg:t||"nocall",canSubmit:e.canSubmit},r.submit(t))})},r.$on("submit-project-v2",function(e,t){r.submitProjectV2(n.ProjectId(),t.urgent)}),r.projectStatusLabel=function(){return r.changingStatus?"Saving...":r.projectStatus},r.handleDropdownOption=function(t){var o,i;"submit-project"==t.verb?(o=n.ProjectId(),i=t.verb,r.changingStatus=!0,p.projectAdmin.requirementsCheck(o).then(function(e){var t,n,a;e.canSubmit?(n=t="",e.preapproval&&(n="preapproval"),"launchgood"==e.application?r.IsCommunityCampaign?p.projectAdmin.changeProjectState(o,i).then(function(e){(n?m.Confirm("Your campaign is live - start raising funds! Our team will still review your campaign to make sure it follows our site guidelines.</p>","Campaign Submitted",[{name:"OK",type:"ok"}]):m.Confirm("<p>Your campaign has been submitted. <strong>"+r.sponsorName+"</strong> will review your campaign within 24-48 hours.</p>","Campaign Submitted",[{name:"OK",type:"ok"}])).then(function(){}),l(e)},function(e){e.includes("help@launchgood.com")&&(alert(e),u())}):s(o,i,n,e.internationalFee).then(function(e){switch(r.changingStatus=!1,"withcall"==e.option?r.callDialogs=" and assign a coach to share feedback within 24-48 hours!":r.callDialogs=".",e.DialogMsg){case"nocall":m.Confirm("Your campaign has been submitted. Please give us 24-48 hours to review!","Campaign Submitted",[{name:"OK",type:"ok"}]);break;case"urgent":m.Confirm("Your campaign has just been sent to the support@launchgood.com. We'll be with you shortly! <strong>Make sure to check your email for any follow up messages!</strong>","Campaign Submitted",[{name:"OK",type:"ok"}]);break;case"withcall":m.Confirm("Your campaign has now been submitted. Please give us 24-48 hours to review and assign a campaign coach who will email you to set up coaching call.","Campaign Submitted",[{name:"OK",type:"ok"}]);break;case"preapproval":m.Confirm("Your campaign is live - start raising funds! Our team will still review your campaign to make sure it follows our site guidelines"+r.callDialogs,"Campaign Submitted",[{name:"OK",type:"ok"}])}h.eventTrack("ReviewSubmitComplete",{category:"campaign",label:new Date})},function(e){r.changingStatus=!1}):"patronicity"==e.application&&(t="info@patronicity.com",m.Confirm('<p>Your campaign will now be submitted. Please give us 24-48 hours to review and assign a campaign coach who will help you set up your campaign for success!</p><p>If this is an emergency and needs immediate approval, please contact <a href="mailto:info@patronicity.com">info@patronicity.com</a> for immediate assistance.</p>',"Submit Campaign",[{name:"Submit",type:"ok"},{name:"Cancel",type:"cancel"}]).then(function(){p.projectAdmin.changeProjectState(o,i).then(function(e){l(e)},function(e){e.includes("help@launchgood.com")&&(alert(e),u())})},function(){r.changingStatus=!1}))):(r.changingStatus=!1,a="<ul>",angular.forEach(e.missingRequired,function(e){a+="<li>"+e+"</li>"}),a+="</ul>",m.Confirm("Your campaign is incomplete. Please visit the edit page and complete these items:<br><br>"+a,"Campaign Incomplete",[{name:"OK",type:"ok"}]))})):void 0!==t.confirm_message?m.Confirm(t.confirm_message,t.confirm_title,[{name:t.confirm_ok,type:"ok"},{name:t.confirm_cancel,type:"cancel"}]).then(function(e){m.SingleTextAreaEntry(t.dialog_message,t.dialog_title).then(function(e){r.changingStatus=!0,p.projectAdmin.changeProjectState(n.ProjectId(),t.verb,{reason:e.textAreaEntry}).then(function(e){"start-project"==t.verb&&h.eventTrack("GoLiveSubmitComplete",{category:"campaign",label:new Date}),l(e)},function(e){e.includes("help@launchgood.com")&&(alert(e),u())})},function(){r.changingStatus=!1})},function(){r.changingStatus=!1}):void 0!==t.dialog_message?m.SingleTextAreaEntry(t.dialog_message,t.dialog_title).then(function(e){r.changingStatus=!0,p.projectAdmin.changeProjectState(n.ProjectId(),t.verb,{reason:e.textAreaEntry}).then(function(e){"start-project"==t.verb&&h.eventTrack("GoLiveSubmitComplete",{category:"campaign",label:new Date}),l(e)},function(e){e.includes("help@launchgood.com")&&(alert(e),u())})}):(r.changingStatus=!0,p.projectAdmin.changeProjectState(n.ProjectId(),t.verb).then(function(e){"start-project"==t.verb&&h.eventTrack("GoLiveSubmitComplete",{category:"campaign",label:new Date}),l(e)},function(e){e.includes("help@launchgood.com")&&(alert(e),u())}))},r.handleSingleOption=function(e){angular.element("#project-status-dropdown").tooltip("toggleEnabled"),e&&(1==r.dropdownOptions.length?(r.statusMenuDropdown=!1,r.handleDropdownOption(r.dropdownOptions[0])):r.dropdownOptions.length<1?r.statusMenuDropdown=!1:r.statusMenuDropdown=!0)},r.addOfflineDonation=function(){c.add(n.ProjectId()).then(function(e){e.again&&o(function(){r.addOfflineDonation()},100),a.$broadcast("reload-donations")})},r.updateDonors=function(){d.open({templateUrl:"projectUpdateModal.html",controller:["$scope","projectId",function(t,e){t.updateDetails={projectId:e,bodyHTML:"",subject:"",type:"general",flags:0},t.updateDetails.flags|=1,t.checkbox={sendUpdate:!0},t.typeDescription="Select Type...",console.log("Loading types..."),p.projectAdmin.types(n.ProjectId()).then(function(e){console.log(e),t.possibleTypes=e,t.typeChanged()}),t.typeChanged=function(){"press"==t.updateDetails.type&&(console.log("Add Press display "),t.updateDetails.projectId,d.open({templateUrl:g.urlForTemplate("newadmin/press-edit.html"),controller:["$scope","projectId","$window",function(t,e,n){console.log("Creating new press: "+e),t.applicationName="launchgood"==g.applicationName?"Launchgood":"Patronicity","Patronicity"==t.applicationName?t.placeholders={url:"e.g. https://www.fastcompany.com/40404791/combining-crowdfunding-and-place-making-to-help-communities-improve-themselves",headline:"Combining Crowdfunding And Place-Making To Help Communities Improve Themselves",outlet_name:"Fast Company",description:"Our company was featured in Fast Company",image_url:"https://cdn.worldvectorlogo.com/logos/fast-company-1.svg"}:t.placeholders={url:"http://www.cnn.com/2015/07/08/us/muslims-help-southern-black-churches-irpt/index.html",headline:"Muslims raise funds to rebuild burned black churches",outlet_name:"CNN",description:"Our company was featured on CNN",image_url:"http://www.cnn.com/image.jpg"},t.adminEdit=!1,t.currDate=new Date((new Date).toISOString().split("T")[0]),t.editPress={ID:"new",ProjectId:e,ContentDate:t.currDate},t.projectDetails={},t.FlagDetails={Active:"1",Featured:"0"},t.editPress.ProjectId?(p.projectAdmin.getProjectImage(t.editPress.ProjectId).then(function(e){console.log("Get Project url"),t.projectDetails.projectImage=e.image}),p.projectAdmin.getProject(t.editPress.ProjectId).then(function(e){console.log("Get Project info"),t.projectDetails.project=e.project})):(console.log("ProjectId does not exist"),t.projectDetails.projectImage=null,t.projectDetails.project=null),t.preSave=function(){!function(){if(t.editPress.Url.startsWith("http://")||t.editPress.Url.startsWith("https://")){if(t.editPress.ImageUrl.startsWith("http://")||t.editPress.ImageUrl.startsWith("https://"))return console.log("Validation passed."),1;t.messageText="Image Url must start with - http:// or https://"}else t.messageText="URL must start with - http:// or https://";return console.log("Validation failed: "+t.messageText),0}()||(console.log("Saving..."),"1"==t.FlagDetails.Active?t.editPress.Flags|=1:t.editPress.Flags&=-2,"1"==t.FlagDetails.Featured?t.editPress.Flags|=2:t.editPress.Flags&=-3,"new"==t.editPress.ID&&(t.editPress.Type="press"),p.projectAdmin.savePress(t.editPress).then(function(e){console.log("Save complete."),t.$dismiss()}))},t.displayProject=function(){n.open("/campaign/"+t.projectDetails.project.Slug,"_blank")},t.cancel=function(){t.$dismiss("cancel")}}],size:"",backdrop:"static",resolve:{projectId:function(){return n.ProjectId()}}}),t.$dismiss("cancel")),t.possibleTypes.forEach(function(e){e.id==t.updateDetails.type&&(t.typeDescription=e.description)})},t.changeSendUpdate=function(){t.checkbox.sendUpdate?t.updateDetails.flags|=1:t.updateDetails.flags&=-2},t.cancel=function(){t.$dismiss("cancel")},t.ok=function(){t.$close({details:t.updateDetails})}}],size:"",backdrop:"static",resolve:{projectId:function(){return n.ProjectId()}}}).result.then(function(e){p.projectAdmin.sendProjectUpdate(e.details.projectId,e.details).then(function(e){d.open({templateUrl:"projectUpdateConfirmModal.html",controller:["$scope",function(e){e.ok=function(){e.$dismiss()}}],size:""})},function(e){alert(e)})})},r.$on("edit-project-id-changed",function(){u()}),n.Loaded()&&u(),r.statusLabelClass=function(e){var t="btn-primary";switch(e){case"In Review":t="btn-primary";break;case"Go Live!":case"Submit for Review":case"Suspended":t="btn-warning";break;default:t="btn-primary"}return t};var s=function(e,t,n,a){return f(function(s,c){d.open({templateUrl:g.urlForTemplate("project-admin/submit-coaching-option-modal.html"),controller:["$scope","$uibModalInstance","projectId","verb","preapproval","internationalFee",function(n,a,e,o,t,i){function r(t){n.details.isProcessing=!0,p.projectAdmin.changeProjectState(e,o,t).then(function(e){l(e),a.close(),n.details.isProcessing=!1,s(t)},function(e){e.includes("help@launchgood.com")&&alert(e),u(),n.cancel(),n.details.isProcessing=!1,c()})}n.details={isCollapsed:!0,isProcessing:!1},n.preapproval="preapproval"==t,n.internationalfee=i,n.cancel=function(){a.close(),c()},n.submitWithCall=function(){r({coaching:!0,urgent:!1,option:"withcall",DialogMsg:t||"withcall"})},n.submitWithoutCall=function(){r({coaching:!1,urgent:!1,option:"nocall",DialogMsg:t||"nocall"})},n.submitUrgent=function(){r({coaching:!1,urgent:!0,option:"urgent",DialogMsg:"urgent"})},n.toggleCollapse=function(){n.details.isCollapsed=!n.details.isCollapsed}}],resolve:{projectId:function(){return e},verb:function(){return t},preapproval:function(){return n},internationalFee:function(){return a}},backdrop:"static"})})}}}}]),function(){var e=angular.module("patronicity.project-admin.edit-manager",["patronicity.api","patronicity.configuration"]);e.directive("editManager",["$rootScope","$location","$q","User","api","patronicityConfig","$analytics",function(a,e,o,t,i,r,s){return{restrict:"EA",scope:{projectId:"@",projectSlug:"@"},controller:["$scope",function(n){var t,e=this;e.PaymentType=function(){return n.basicData.payment_type},e.AccountId=function(){return n.basicData.account_id||null},e.Loaded=function(){return void 0!==n.basicData},e.ProjectId=function(){return n.projectId},e.projectSlug=function(){return n.projectSlug},e.Slug=function(){return n.basicData.slug},e.CanEdit=function(){return n.basicData.canEdit},e.Tabs=function(){return n.basicData.tabs},e.Application=function(){return r.applicationName},e.validateTabs=function(){return o(function(t,e){n.basicDataCopy=angular.copy(n.basicData),i.projectAdmin.basicInfo(n.projectId).then(function(e){n.basicData.tabs=e.tabs,angular.forEach(n.basicData.tabs,function(e){if("valid"==e.status)for(var t=0;t<n.basicDataCopy.tabs.length;t++)if(n.basicDataCopy.tabs[t].id==e.id&&"valid"!==n.basicDataCopy.tabs[t].status){"started"==e.id?s.eventTrack("GetStartedComplete",{category:"campaign",label:new Date}):"story"==e.id?s.eventTrack("TellStoryComplete",{category:"campaign",label:new Date}):"account"==e.id&&s.eventTrack("PayInfoComplete",{category:"campaign",label:new Date});break}}),t()},e)})},t=n.projectId,n.basicData=void 0,i.projectAdmin.basicInfo(t).then(function(e){n.basicData=e,a.$broadcast("edit-project-id-changed",{id:t})},function(e){403==e.status?alert("Your session has expired. Please reload your page."):alert("There was an error loading this page. Please refresh your browser window. Code: "+e.status+" Message: "+e.statusText)})}]}}]),e.directive("appProtip",["patronicityConfig",function(i){return{restrict:"E",require:"^editManager",scope:{text:"@"},template:'<p class="help-block" ng-if="showTip"><span class="glyphicon glyphicon-flash pro-tip"></span> <strong>Pro Tip: </strong><span ng-bind-html="tip"></span></p>',link:function(e,t,n,a){var o=e.text.split("|");e.showTip=!0,e.tip="",1<o.length?"launchgood"==i.applicationName?o[0].length<=0?e.showTip=!1:e.tip=o[0]:o[1].length<=0?e.showTip=!1:e.tip=o[1]:e.tip=e.text}}}]),e.directive("projectText",["api","$uibModal","patronicityConfig",function(a,o,i){return{restrict:"EA",template:'<button class="btn btn-primary" ng-click="showSendTextDialog()">Text</button>',scope:{projectId:"="},replace:!0,link:function(e,t,n){e.showSendTextDialog=function(){o.open({templateUrl:i.urlForTemplate("project-text-modal.html"),controller:["$scope","$uibModalInstance","projectId",function(t,n,e){t.loadSMSData=function(){a.projectAdmin.getSMSData(e).then(function(e){t.smsData=e},function(e){console.log("couldn't load sms data!")})},t.loadSMSData(),t.cancel=function(){n.close()},t.ok=function(){n.close()},t.verifiedPhoneNumber=function(){return null!=t.smsData.verifiedPhoneNumber},t.sendText=function(){a.smsReminder.projectSendSMSText(e,t.smsData.verifiedPhoneNumber,t.body).then(function(e){n.close()},function(e){alert(e)})}}],resolve:{projectId:function(){return e.projectId}},backdrop:"static"})}}}}])}(),function(){var e=angular.module("patronicity.project-admin.payment-admin",["patronicity.api","ui.bootstrap","user","mv.upload.button","mv.widgets","patronicity.configuration","patronicity.project-admin.account-providers.wepay-payment-method","patronicity.project-admin.account-providers.bluesnap-payment-method","patronicity.project-admin.account-providers.internal"]);e.directive("paymentAdminPanel",["api","$uibModal","$rootScope","patronicityConfig","$timeout",function(r,s,c,e,l){return{restrict:"E",scope:{projectCommunityId:"@",projectCommunityType:"@"},templateUrl:e.urlForTemplate("project-admin/sections/parts/payment-admin-panel.html"),link:function(a,e,t){function n(){r.projectAdmin.projectInfoForPaymentPage(a.projectCommunityId,a.projectCommunityType).then(function(e){a.data.PaymentType=e.PaymentType,a.data.TempPaymentType=e.PaymentType,a.data.ConnectOrManagedAccountID=e.ConnectOrManagedAccountID,a.data.StripeDashboardUrl=e.StripeDashboardUrl,a.data.WePayAccountID=e.WePayAccountID,a.data.BlueSnapAccountID=e.BlueSnapAccountID,a.data.BlueSnapDashboardUrl=e.BlueSnapDashboardUrl,a.data.PreviousAccount=e.PreviousAccount,a.data.HasPreviousAccount=function(e){var t=!1;e&&e.accountId&&(t=!0);return t}(e.PreviousAccount),a.data.WePayDashboardUrl=e.WepayDashboardUrl,a.data.AccountID=e.AccountID,a.data.AccountDashboardUrl=e.AccountDashboardUrl,r.projectAdmin.paymentOptions(a.projectCommunityId,a.projectCommunityType).then(function(e){a.data.paymentOptions=e})},function(){console.log("failed loading project details")})}function o(){c.$broadcast("payment-info-saved")}function i(e){var n,t;switch(e){case"wepay":n="WePay",t=r.projectAdmin.wepay.resetAccount;break;case"bluesnap":n="BlueSnap",t=r.projectAdmin.bluesnap.resetAccount;break;case"internal":n="Internal",t=r.projectAdmin.account.resetAccount}s.open({templateUrl:"confirmWePayResetDialog.html",controller:["$scope","$uibModalInstance",function(e,t){e.name=n,e.reset=function(){t.close()},e.cancel=function(){t.dismiss()}}],size:"md"}).result.then(function(e){t(a.projectCommunityId,a.projectCommunityType).then(function(){o()},function(e){alert(e)})})}a.data={message:"",PaymentType:"",TempPaymentType:"",ConnectOrManagedAccountID:void 0,StripeDashboardUrl:void 0,WePayAccountID:void 0,WePayDashboardUrl:void 0},a.$on("payment-info-saved",function(){n()}),a.savePaymentOption=function(){r.projectAdmin.overridePaymentOptions(a.projectCommunityId,a.projectCommunityType,a.data.TempPaymentType).then(function(e){a.data.message=e.message,l(function(){a.data.message=""},1e4),o()},function(e){a.data.message=e})},a.confirmClearBlueSnap=function(){i("bluesnap")},a.confirmClearWepay=function(){i("wepay")},a.confirmClearAccount=function(){i("internal")},a.$watch(function(){return a.projectCommunityId+"-"+a.projectCommunityType},function(){a.projectCommunityId&&a.projectCommunityType&&n()})}}}]),e.directive("accountSearch",["api","patronicityConfig","$rootScope","$timeout","$uibModal",function(n,a,i,r,s){return{restrict:"E",scope:{id:"=?",type:"=?",paymentType:"=?",selectedAccountId:"=?"},templateUrl:a.urlForTemplate("newadmin/account-search.html"),link:function(o,e,t){o.searchAcconts=function(e){o.loading=!0,o.savingAccount=!1,o.errorMsg="",o.successMessage="";e={param1:e,paymentType:o.paymentType,limit:200,offset:0,category:void 0};return n.AccountSearch.query(e).$promise.then(function(e){return 0==e.length&&(o.errorMsg="No account is found"),o.accounts=e,o.loading=!1,o.accounts})},o.newAccountIDSave=function(){s.open({templateUrl:a.urlForTemplate("project-admin/sections/parts/confirm-admin-account-set.html"),controller:["$scope","$uibModalInstance",function(e,t){e.name=name,e.reset=function(){t.close()},e.cancel=function(){t.dismiss()}}],size:"md"}).result.then(function(){var e;switch(o.paymentType){case"wepay":e=n.projectAdmin.wepay.linkProjectToAccount(o.id,o.type,o.newAccountID,!0);break;case"bluesnap":e=n.projectAdmin.bluesnap.linkProjectToAccount(o.id,o.type,o.newAccountID,!0);break;case"internal":e=n.projectAdmin.account.linkProjectToAccount(o.id,o.type,o.newAccountID)}e.then(function(e){e.message&&(o.warningMessage=e.message),i.$broadcast("payment-info-saved"),o.selectedAccountIdNew="",o.successMessage="New Account has been saved",o.savingAccount=!1,r(function(){o.successMessage=!1,o.warningMessage=!1},3e3)},function(e){o.errorMessage=e,o.savingAccount=!1})},function(){})},o.itemSelected=function(e,t,n,a){o.savingAccount=!0,o.newAccountID=e.id},o.$watch("paymentType",function(e,t){switch(e){case"wepay":o.searchLabel="Search WePay Accounts";break;case"bluesnap":o.searchLabel="Search BlueSnap Accounts";break;case"internal":o.searchLabel="Search Accounts"}})}}}])}(),function(){var e=angular.module("patronicity.project-admin.payment-method",["patronicity.api","ui.bootstrap","user","mv.upload.button","mv.widgets","patronicity.configuration","patronicity.project-admin.account-providers.wepay-payment-method","patronicity.project-admin.account-providers.bluesnap-payment-method","patronicity.project-admin.account-providers.internal"]);e.directive("stripeConnectPaymentMethodForm",["api","User",function(o,i){return{restrict:"E",scope:{projectId:"@"},templateUrl:"stripeConnectPaymentMethodForm.html",link:function(a,e,t){var n;a.stripeAuthURL="",a.isAdmin=i.isAdmin(),a.save=function(){a.connectInfo.$save(function(e){a.$emit("payment-info-saved")})},a.cancel=function(){a.$emit("payment-method-cancelled")},a.dashboardUrlForAccount=function(t){var n;return"new"!==t&&angular.forEach(a.connectInfo.StripeAccounts,function(e){t==e.ID&&(n=e.DashboardUrl)}),n},n=a.projectId,a.connectInfo=o.projectAdmin.connectInfo.get({id:n},function(e){angular.forEach(e.StripeAccounts,function(e){"new"===e.ID&&(a.stripeAuthURL=e.url)})})}}}]),e.directive("bankPaymentMethodForm",["api","User","patronicityConfig",function(a,o,e){return{restrict:"E",scope:{projectId:"@",paymentMethod:"=",countryCode:"=?"},templateUrl:"bankPaymentMethodForm.html",link:function(t,e,n){t.accountTypes=[],a.projectAdmin.accountTypes().then(function(e){t.accountTypes=e}),n=n.projectId,t.bankInfo=a.projectAdmin.bankInfo.get({id:n},function(e){void 0===e.BillingAddress&&(e.BillingAddress={Country:o.countryCode()})}),t.save=function(){t.bankInfo.PaymentMethod=t.paymentMethod,t.bankInfo.$save(function(e){t.$emit("payment-info-saved")})},t.cancel=function(){t.$emit("payment-method-cancelled")}}}}]),e.directive("paymentAdditionalInfoRequiredWarning",["api","$window","patronicityConfig",function(a,o,i){return{restrict:"E",scope:{projectId:"@"},templateUrl:"paymentAdditionalRequiredWarning.html",link:function(t,e,n){t.infoRequired=!1,t.emailVerified=!0,t.phoneVerified=!0,t.$watch("projectId",function(e){e&&(a.projectAdmin.paymentInfoValid(e).then(function(e){"invalid"==e.state||"partial"==e.state?t.infoRequired=!0:t.infoRequired=!1}),a.projectAdmin.infoVerified(e).then(function(e){t.emailVerified=e.emailValidated,t.phoneVerified=e.phoneValidated,t.username=e.username,t.userID=e.userID}).catch(function(){}))}),t.verifyPhone=function(){o.location.href="/user/newprofile#!/user-profile/edit-settings/"+t.username},t.applicationName=i.applicationName}}}]),e.directive("managedAccountAdditionalOwnerInformation",function(){return{restrict:"E",scope:{owner:"=",ownerIndex:"@",removeOwner:"&",uploadingOwnerDocument:"=",accountId:"@"},templateUrl:"managedAccountAdditionalOwnerInformation.html",link:function(a,e,t){function n(e){var t=[];return e=Array.isArray(e)?e:[e],angular.forEach(e,function(e){"legal_entity.additional_owners"==e?t.push(e):t.push("legal_entity.additional_owners."+a.ownerIndex+"."+e)}),t}a.state={displayIndex:parseInt(a.ownerIndex)+1,uploading:!1},a.fieldsLocked=function(e){return a.$parent.fieldsLocked(n(e))},a.showField=function(e){return a.$parent.showField(n(e))},a.$watch("state.uploading",function(e){a.uploadingOwnerDocument=e}),a.fileUploaded=function(e,t,n){a.imageSrc=null,a.owner.VerificationDocumentThumbnailURL=n,a.$parent.save(!0)}}}}),e.directive("managedAccountPaymentMethodForm",["api","$filter","$uibModal","User",function(c,l,u,d){return{restrict:"E",scope:{projectId:"@",requiredFields:"=",managedFieldsInfo:"=",countryCode:"="},templateUrl:"managedAccountPaymentMethodForm.html",link:function(o,e,t){o.fields={},o.state={availableStripeCountries:[],uploadingDocument:!1},o.isAdmin=d.isAdmin(),c.projectAdmin.supportedAccountCountries().then(function(e){o.state.availableStripeCountries=e});var n,a=[];function i(){o.countryInfo&&o.countryInfo.verification_fields&&o.countryInfo.verification_fields[o.managed.EntityType]&&(a=o.countryInfo.verification_fields[o.managed.EntityType])}function r(e){var t;switch(e){case"AL":t={validation:"[A-Za-z]{2}\\d{2}\\d{8}[A-Za-z0-9]{16}",description:"This is the IBAN account number.  It should be a two letter country prefix followed by 10 digits, and then 16 numbers or characters.",maxLength:28,placeholder:"AL47212110090000000235698741"};break;case"AD":t={validation:"[A-Za-z]{2}\\d{2}\\d{8}[A-Za-z0-9]{12}",description:"This is the IBAN account number.  It should be a two letter country prefix followed by 10 digits and then 12 numbers or characters.",maxLength:24,placeholder:"AD1200012030200359100100"};break;case"AT":t={validation:"[A-Za-z]{2}\\d{18}",description:"This is the IBAN account number.  It should be a two letter country prefix followed by 18 digits.",maxLength:20,placeholder:"AT611904300234573201"};break;case"AZ":t={validation:"[A-Za-z]{2}\\d{2}[A-Za-z0-9]{4}\\d{20}",description:"This is the IBAN account number.  It should be a two letter country prefix followed by 2 digits, then 4 characters, and finally 20 digits.",maxLength:28,placeholder:"AZ21NABZ00000000137010001944"};break;case"BH":t={validation:"[A-Za-z]{2}\\d{2}[A-Za-z]{4}[A-Za-z0-9]{14}",description:"This is the IBAN account number.  It should be a two letter country prefix followed by 2 digits, then 4 characters, and finally 14 numbers or characters.",maxLength:22,placeholder:"BH67BMAG00001299123456"};break;case"BE":t={validation:"[A-Za-z]{2}\\d{14}",description:"This is the IBAN account number.  It should be a two letter country prefix followed by 14 digits.",maxLength:16,placeholder:"BE68539007547034"};break;case"BA":t={validation:"[A-Za-z]{2}\\d{18}",description:"This is the IBAN account number.  It should be a two letter country prefix followed by 18 digits.",maxLength:20,placeholder:"BA391290079401028494"};break;case"BR":t={validation:"[A-Za-z]{2}\\d{2}\\d{23}[A-Za-z]{1}[A-Za-z0-9]{1}",description:"This is the IBAN account number.  It should be a two letter country prefix followed by 25 digits, a letter and then a number or letter.",maxLength:29,placeholder:"BR9700360305000010009795493P1"};break;case"BG":t={validation:"[A-Za-z]{2}\\d{2}[A-Za-z]{4}\\d{6}[A-Za-z0-9]{8}",description:"This is the IBAN account number.  It should be a two letter country prefix followed by 18 digits.",maxLength:22,placeholder:"BG80BNBG96611020345678"};break;case"CR":case"CR":t={validation:"[A-Za-z]{2}\\d{19}",description:"This is the IBAN account number.  It should be a two letter country prefix followed by 19 digits.",maxLength:21,placeholder:"CR05015202001026284066"};break;case"HR":t={validation:"[A-Za-z]{2}\\d{19}",description:"This is the IBAN account number.  It should be a two letter country prefix followed by 19 digits.",maxLength:21,placeholder:"HR1210010051863000160"};break;case"CY":t={validation:"[A-Za-z]{2}\\d{2}\\d{8}[A-Za-z0-9]{16}",description:"This is the IBAN account number.  It should be a two letter country prefix followed by 10 digits, then 16 letters or digits.",maxLength:28,placeholder:"CY17002001280000001200527600"};break;case"CZ":t={validation:"[A-Za-z]{2}\\d{22}",description:"This is the IBAN account number.  It should be a two letter country prefix followed by 22 digits.",maxLength:24,placeholder:"CZ6508000000192000145399"};break;case"DK":t={validation:"[A-Za-z]{2}\\d{16}",description:"This is the IBAN account number.  It should be a two letter country prefix followed by 16 digits.",maxLength:18,placeholder:"DK5000400440116243"};break;case"DO":t={validation:"[A-Za-z]{2}\\d{2}[A-Za-z]{4}\\d{20}",description:"This is the IBAN account number.  It should be a two letter country prefix followed by 2 digits, then 4 letters and finally 20 letters or numbers.",maxLength:28,placeholder:"DO28BAGR00000001212453611324"};break;case"EE":t={validation:"[A-Za-z]{2}\\d{18}",description:"This is the IBAN account number.  It should be a two letter country prefix followed by 18 digits.",maxLength:20,placeholder:"EE382200221020145685"};break;case"FO":t={validation:"[A-Za-z]{2}\\d{16}",description:"This is the IBAN account number.  It should be a two letter country prefix followed by 16 digits.",maxLength:18,placeholder:"FO6264600001631634"};break;case"FI":t={validation:"[A-Za-z]{2}\\d{16}",description:"This is the IBAN account number.  It should be a two letter country prefix followed by 16 digits.",maxLength:18,placeholder:"FI2112345600000785"};break;case"FR":t={validation:"[A-Za-z]{2}\\d{12}[A-Za-z0-9]{11}\\d{2}",description:"This is the IBAN account number.  It should be a two letter country prefix followed by 12 digits, then 11 letters or digits and finally 2 digits.",maxLength:27,placeholder:"FR1420041010050500013M02606"};break;case"GE":t={validation:"[A-Za-z]{2}\\d{2}[A-Za-z0-9]{2}\\d{16}",description:"This is the IBAN account number.  It should be a two letter country prefix followed by 2 digits, then 2 letters or digits and finally 16 digits.",maxLength:22,placeholder:"GE29NB0000000101904917"};break;case"DE":t={validation:"[A-Za-z]{2}\\d{20}",description:"This is the IBAN account number.  It should be a two letter country prefix followed by 20 digits.",maxLength:22,placeholder:"DE89370400440532013000"};break;case"GI":t={validation:"[A-Za-z]{2}\\d{2}[A-Za-z]{4}[A-Za-z0-9]{15}",description:"This is the IBAN account number.  It should be a two letter country prefix followed by 2 digits, then 4 letters and then 15 numbers or letters.",maxLength:23,placeholder:"GI75NWBK000000007099453"};break;case"GR":t={validation:"[A-Za-z]{2}\\d{9}[A-Za-z0-9]{16}",description:"This is the IBAN account number.  It should be a two letter country prefix followed by 9 digits, then 16 letters or digits.",maxLength:27,placeholder:"GR1601101250000000012300695"};break;case"GL":t={validation:"[A-Za-z]{2}\\d{16}",description:"This is the IBAN account number.  It should be a two letter country prefix followed by 16 digits.",maxLength:18,placeholder:"GL8964710001000206"};break;case"GT":t={validation:"[A-Za-z]{2}\\d{2}[A-Za-z0-9]{20}",description:"This is the IBAN account number.  It should be a two letter country prefix followed by 2 digits, then 24 letters or numbers.",maxLength:28,placeholder:"GT82TRAJ01020000001210029690"};break;case"HU":t={validation:"[A-Za-z]{2}\\d{26}",description:"This is the IBAN account number.  It should be a two letter country prefix followed by 26 digits.",maxLength:28,placeholder:"HU42117730161111101800000000"};break;case"IS":t={validation:"[A-Za-z]{2}\\d{24}",description:"This is the IBAN account number.  It should be a two letter country prefix followed by 24 digits.",maxLength:26,placeholder:"IS140159260076545510730339"};break;case"IE":t={validation:"[A-Za-z]{2}\\d{2}[A-Za-z0-9]{4}\\d{14}",description:"This is the IBAN account number.  It should be a two letter country prefix followed by 2 digits, then 4 letters or numbers, and finally 14 digits.",maxLength:22,placeholder:"IE29AIBK93115212345678"};break;case"IL":t={validation:"[A-Za-z]{2}\\d{21}",description:"This is the IBAN account number.  It should be a two letter country prefix followed by 21 digits.",maxLength:23,placeholder:"IL620108000000099999999"};break;case"IT":t={validation:"[A-Za-z]{2}\\d{2}[A-Za-z]{1}\\d{10}[A-Za-z0-9]{12}",description:"This is the IBAN account number.  It should be a two letter country prefix followed by 2 digits, then a letter, then 10 digits, and finally 12 letters or numbers.",maxLength:27,placeholder:"IT60X0542811101000000123456"};break;case"KZ":t={validation:"[A-Za-z]{2}\\d{5}[A-Za-z0-9]{13}",description:"This is the IBAN account number.  It should be a two letter country prefix followed by 5 digits, and then 13 letters or numbers.",maxLength:20,placeholder:"KZ86125KZT5004100100"};break;case"KW":t={validation:"[A-Za-z]{2}\\d{2}[A-Za-z]{4}[A-Za-z0-9]{22}",description:"This is the IBAN account number.  It should be a two letter country prefix followed by 2 digits, and then 4 letters and finally 22 letters or digits.",maxLength:30,placeholder:"KW81CBKU0000000000001234560101"};break;case"LV":t={validation:"[A-Za-z]{2}\\d{2}[A-Za-z]{4}[A-Za-z0-9]{13}",description:"This is the IBAN account number.  It should be a two letter country prefix followed by 2 digits, and then 4 letters and finally 13 letters or digits.",maxLength:21,placeholder:"LV80BANK0000435195001"};break;case"LB":t={validation:"[A-Za-z]{2}\\d{6}[A-Za-z0-9]{20}",description:"This is the IBAN account number.  It should be a two letter country prefix followed by 6 digits, and then 20 letters or digits.",maxLength:28,placeholder:"LB62099900000001001901229114"};break;case"LI":t={validation:"[A-Za-z]{2}\\d{7}[A-Za-z0-9]{12}",description:"This is the IBAN account number.  It should be a two letter country prefix followed by 7 digits, and then 12 letters or digits.",maxLength:21,placeholder:"LI21088100002324013AA"};break;case"LT":t={validation:"[A-Za-z]{2}\\d{18}",description:"This is the IBAN account number.  It should be a two letter country prefix followed by 18 digits.",maxLength:20,placeholder:"LT121000011101001000"};break;case"LU":t={validation:"[A-Za-z]{2}\\d{5}[A-Za-z0-9]{13}",description:"This is the IBAN account number.  It should be a two letter country prefix followed by 5 digits and then 13 numbers or letters.",maxLength:20,placeholder:"LU280019400644750000"};break;case"MK":t={validation:"[A-Za-z]{2}\\d{5}[A-Za-z0-9]{10}\\d{2}",description:"This is the IBAN account number.  It should be a two letter country prefix followed by 5 digits and then 10 numbers or letters, and finally two digits.",maxLength:19,placeholder:"MK07250120000058984"};break;case"MT":t={validation:"[A-Za-z]{2}\\d{2}[A-Za-z]{4}\\d{5}[A-Za-z0-9]{18}",description:"This is the IBAN account number.  It should be a two letter country prefix followed by 2 digits, then 4 letters,  then 5 digits, and finally 18 numbers or letters.",maxLength:31,placeholder:"MT84MALT011000012345MTLCAST001S"};break;case"MR":t={validation:"[A-Za-z]{2}\\d{25}",description:"This is the IBAN account number.  It should be a two letter country prefix followed by 25 digits.",maxLength:27,placeholder:"MR1300020001010000123456753"};break;case"MU":t={validation:"[A-Za-z]{2}\\d{2}[A-Za-z]{4}\\d{19}[A-Za-z]{3}",description:"This is the IBAN account number.  It should be a two letter country prefix followed by 2 digits, then 4 letters, 19 numbers, and finally 3 letters.",maxLength:30,placeholder:"MU17BOMM0101101030300200000MUR"};break;case"MC":t={validation:"[A-Za-z]{2}\\d{12}[A-Za-z0-9]{11}\\d{2}",description:"This is the IBAN account number.  It should be a two letter country prefix followed by 12 digits, then 11 letters or numbers and finally 2 digits.",maxLength:27,placeholder:"MC5811222000010123456789030"};break;case"MD":t={validation:"[A-Za-z]{2}\\d{2}[A-Za-z0-9]{2}\\d{18}",description:"This is the IBAN account number.  It should be a two letter country prefix followed by 2 digits, then 2 letters or numbers and finally 18 digits.",maxLength:24,placeholder:"MD24AG000225100013104168"};break;case"ME":t={validation:"[A-Za-z]{2}\\d{20}",description:"This is the IBAN account number.  It should be a two letter country prefix followed by 20 digits.",maxLength:22,placeholder:"ME25505000012345678951"};break;case"NL":t={validation:"[A-Za-z]{2}\\d{2}[A-Za-z]{4}\\d{10}",description:"This is the IBAN account number.  It should be a two letter country prefix followed by 2 digits, then 4 letters, and finally 10 digits.",maxLength:18,placeholder:"NL91ABNA0417164300"};break;case"NO":t={validation:"[A-Za-z]{2}\\d{13}",description:"This is the IBAN account number.  It should be a two letter country prefix followed by 13 digits.",maxLength:15,placeholder:"NO9386011117947"};break;case"PK":t={validation:"[A-Za-z]{2}\\d{2}[A-Za-z0-9]{4}\\d{16}",description:"This is the IBAN account number.  It should be a two letter country prefix followed by 2 digits, then 4 letters or numbers, and finally 16 digits.",maxLength:24,placeholder:"PK36SCBL0000001123456702"};break;case"PS":t={validation:"[A-Za-z]{2}\\d{2}[A-Za-z0-9]{4}\\d{21}",description:"This is the IBAN account number.  It should be a two letter country prefix followed by 2 digits, then 4 letters or numbers, and finally 21 digits.",maxLength:29,placeholder:"PS92PALS000000000400123456702"};break;case"PL":t={validation:"[A-Za-z]{2}\\d{26}",description:"This is the IBAN account number.  It should be a two letter country prefix followed by 26 digits.",maxLength:28,placeholder:"PL61109010140000071219812874"};break;case"PT":t={validation:"[A-Za-z]{2}\\d{23}",description:"This is the IBAN account number.  It should be a two letter country prefix followed by 23 digits.",maxLength:25,placeholder:"PT50000201231234567890154"};break;case"RO":t={validation:"[A-Za-z]{2}\\d{2}[A-Za-z]{4}[A-Za-z0-9]{16}",description:"This is the IBAN account number.  It should be a two letter country prefix followed by 2 digits, then 4 letters, and finally 16 letters or digits.",maxLength:24,placeholder:"RO49AAAA1B31007593840000"};break;case"SM":t={validation:"[A-Za-z]{2}\\d{2}[A-Za-z]{1}\\d{10}[A-Za-z0-9]{12}",description:"This is the IBAN account number.  It should be a two letter country prefix followed by 2 digits, then 1 letter, then 10 digits, then finally 12 letters or digits.",maxLength:27,placeholder:"SM86U0322509800000000270100"};break;case"SA":t={validation:"[A-Za-z]{2}\\d{4}[A-Za-z0-9]{18}",description:"This is the IBAN account number.  It should be a two letter country prefix followed by 4 digits, then 18 letters or digits.",maxLength:24,placeholder:"SA0380000000608010167519"};break;case"RS":t={validation:"[A-Za-z]{2}\\d{20}",description:"This is the IBAN account number.  It should be a two letter country prefix followed by 20 digits.",maxLength:22,placeholder:"RS35260005601001611379"};break;case"SK":t={validation:"[A-Za-z]{2}\\d{22}",description:"This is the IBAN account number.  It should be a two letter country prefix followed by 22 digits.",maxLength:24,placeholder:"SK3112000000198742637541"};break;case"SI":t={validation:"[A-Za-z]{2}\\d{17}",description:"This is the IBAN account number.  It should be a two letter country prefix followed by 17 digits.",maxLength:19,placeholder:"SI56263300012039086"};break;case"ES":t={validation:"[A-Za-z]{2}\\d{22}",description:"This is the IBAN account number.  It should be a two letter country prefix followed by 22 digits.",maxLength:24,placeholder:"ES9121000418450200051332"};break;case"SE":t={validation:"[A-Za-z]{2}\\d{22}",description:"This is the IBAN account number.  It should be a two letter country prefix followed by 22 digits.",maxLength:24,placeholder:"SE4550000000058398257466"};break;case"CH":t={validation:"[A-Za-z]{2}\\d{7}[A-Za-z0-9]{12}",description:"This is the IBAN account number.  It should be a two letter country prefix followed by 7 digits, and then 12 letters or numbers.",maxLength:21,placeholder:"CH9300762011623852957"};break;case"TN":t={validation:"[A-Za-z]{2}\\d{22}",description:"This is the IBAN account number.  It should be a two letter country prefix followed by 22 digits.",maxLength:24,placeholder:"TN5910006035183598478831"};break;case"TR":t={validation:"[A-Za-z]{2}\\d{7}[A-Za-z0-9]{17}",description:"This is the IBAN account number.  It should be a two letter country prefix followed by 7 digits, then 17 letters or numbers.",maxLength:26,placeholder:"TR330006100519786457841326"};break;case"AE":t={validation:"[A-Za-z]{2}\\d{21}",description:"This is the IBAN account number.  It should be a two letter country prefix followed by 21 digits.",maxLength:23,placeholder:"AE070331234567890123456"};break;case"GB":t={validation:"[A-Za-z]{2}\\d{2}[A-Za-z]{4}\\d{14}",description:"This is the IBAN account number.  It should be a two letter country prefix followed by 2 digits, then 4 letters, and then 14 digits.",maxLength:22,placeholder:"GB29NWBK60161331926819"};break;case"VG":t={validation:"[A-Za-z]{2}\\d{2}[A-Za-z0-9]{4}\\d{16}",description:"This is the IBAN account number.  It should be a two letter country prefix followed by 2 digits, then 4 letters or numbers, and finally 16 digits.",maxLength:24,placeholder:"VG96VPVG0000012345678901"};break;default:t={validation:"[A-Za-z]{2}\\d{20}",description:"This is the IBAN account number.  It should be a two letter country prefix followed by 20 digits.",maxLength:22,placeholder:"DE89370400440532013000"}}return t}function s(e,t){switch("CA"!==e&&(o.fields.transitNumber=void 0,o.fields.institutionNumber=void 0),e){case"US":o.fields.routingNumber={validation:"\\d{9}",description:"This is required and should be the 9 digit ACH routing number, not the wire routing number. <a href='http://www.routingnumbers.org/' target='_blank'>This number can be found on a check associated with your account.</a>",maxLength:9,placeholder:"012345678"},o.fields.accountNumber={validation:"\\d{8,14}",description:"This is the Checking account number to transfer the funds into.  This should be 8-14 digits and <a href='http://www.routingnumbers.org/' target='_blank'>can be found on a check associated with your account.</a>",maxLength:14,placeholder:"000123456789"},o.fields.personalID={name:"Social Security Number",validation:"\\d{9}",description:"Your Social Security Number (SSN) (9 digits, no spaces)",maxLength:9,placeholder:"0000000000"},o.fields.businessTaxID={name:"Business EIN",validation:"\\d{9}",description:"Your Business EIN number (9 digits, no spaces)",maxLength:9,placeholder:"0000000000"};break;case"CA":o.fields.routingNumber=void 0,o.fields.transitNumber={validation:"\\d{5}",description:"This is required and should be the branch transit number. 5 digits. <a href='https://www.tdcanadatrust.com/lending/cheque.html' target='_blank'>Where do I find this number?</a>",maxLength:5,placeholder:"01234"},o.fields.institutionNumber={validation:"\\d{3}",description:"This is required and should be the institution number. 3 digits. <a href='https://www.tdcanadatrust.com/lending/cheque.html' target='_blank'>Where do I find this number?</a>",maxLength:3,placeholder:"987"},o.fields.accountNumber={validation:"\\d{7,12}",description:"This is the Checking account number to transfer the funds into.  This should be 7-12 digits. <a href='https://www.tdcanadatrust.com/lending/cheque.html' target='_blank'>Where do I find this number?</a>",maxLength:12,placeholder:"000123456789"},o.fields.personalID={name:"Social Insurance Number",validation:"\\d{9}",description:"Your Social Insurance Number (SIN) (9 digits, no spaces)",maxLength:9,placeholder:"0000000000"},o.fields.businessTaxID={name:"Business Number",validation:"\\d{9}",description:"Your Business number (9 digits, no spaces)",maxLength:9,placeholder:"0000000000"};break;case"AU":o.fields.routingNumber={validation:"\\d{6}",description:"This is required and is the bank routing number.  It should be 6 digits.",maxLength:6,placeholder:"111000"},o.fields.accountNumber={validation:"\\d{9}",description:"This is the Checking account number to transfer the funds into.  This should be 9 digits.",maxLength:9,placeholder:"000123456"};break;case"JP":o.fields.routingNumber={validation:"\\d{6}",description:"This is required and is the bank routing number.  It should be 6 digits.",maxLength:6,placeholder:"111000"},o.fields.accountNumber={validation:"\\d{8}",description:"This is the Checking account number to transfer the funds into.  This should be 8 digits.",maxLength:8,placeholder:"00012345"};break;case"GB":"EUR"==t?(o.fields.routingNumber=void 0,o.fields.accountNumber=r(e)):(o.fields.routingNumber={validation:"\\d{6}",description:"This is required and is the bank sort code.  It should be 6 digits.",maxLength:6,placeholder:"108800"},o.fields.accountNumber={validation:"\\d{8}",description:"This is the Checking account number to transfer the funds into.  This should be 8 digits.",maxLength:8,placeholder:"00012345"}),o.fields.businessTaxID={name:"Company Number",validation:"\\d{8}|[A-Za-z]{2}\\d{6}",description:"Your Company number (8 digits, or 2 letters followed by 6 digits)",maxLength:8,placeholder:"00000000"};break;default:o.fields.routingNumber=void 0,o.fields.accountNumber=r(e),o.fields.businessTaxID={name:"Company Number",validation:"\\d{8}|[A-Za-z]{2}\\d{6}",description:"Your Company number (8 digits, or 2 letters followed by 6 digits)",maxLength:8,placeholder:"00000000"}}i()}o.infoRequired=!1,o.fieldClass=function(e){e=Array.isArray(e)?e:[e];var n=!1,t="";return angular.forEach(e,function(t){angular.forEach(o.managedFieldsInfo.FieldsNeeded,function(e){e==t&&(n=!0)})}),t=n?"field-info-needed":t},o.removeAdditionalOwner=function(n){var a=-1;angular.forEach(o.managed.AdditionalOwners,function(e,t){e==n&&(a=t)}),-1<a&&o.managed.AdditionalOwners.splice(a,1),0===o.managed.AdditionalOwners.length&&(o.managed.AdditionalOwners=void 0)},o.dashboardUrlForAccount=function(t){var n;return"new"!==t&&angular.forEach(o.accounts.ManagedAccounts,function(e){t==e.ID&&(n=e.DashboardURL)}),n},o.$watch("managed",function(e,t){e&&e!==t&&(console.log("managed changed"),console.log(e),"new"==o.managed.ID&&(o.$broadcast("mv-reload-countries"),o.managed.CountryCode=o.countryCode))}),o.$watch("countryCode",function(e,t){e&&e!==t&&(console.log("changing country"),"new"==o.managed.ID&&(o.$broadcast("mv-reload-countries"),o.managed.CountryCode=o.countryCode))}),o.addAdditionalOwner=function(){var e={FirstName:"",LastName:"",BirthDate:void 0,Address:{ID:"new",Name:"",Phone:"",Street:"",Street2:"",Country:o.managed.CountryCode,City:"",ZipCode:"",State:"",Save:!1}};void 0===o.managed.AdditionalOwners&&(o.managed.AdditionalOwners=[]),o.managed.AdditionalOwners.push(e)},o.$watch("managed.CurrencyCode",function(e){s(o.managed.CountryCode,e)}),o.$watch("managed.CountryCode",function(n){n&&(o.$broadcast("mv-reload-countries"),c.projectAdmin.accountFieldsForCountry(n).then(function(e){o.countryInfo=e,o.state.currencies=[];var t;angular.forEach(e.supported_bank_account_currencies,function(e,t){angular.forEach(e,function(e){e==n&&o.state.currencies.push(l("uppercase")(t))})}),o.showCurrencyCode=1<o.state.currencies.length,o.showCurrencyCode?(t=!1,angular.forEach(o.state.currencies,function(e){e==o.managed.CurrencyCode&&(t=!0)}),t||(o.managed.CurrencyCode=void 0)):o.managed.CurrencyCode=l("uppercase")(o.state.currencies[0]),s(n,o.managed.CurrencyCode)}))}),o.$watch("managed.EntityType",function(e){e&&i()}),o.showField=function(e){return e=e,n=!1,e=Array.isArray(e)?e:[e],angular.forEach(e,function(t){var e;angular.forEach(a.minimum,function(e){switch(t==e&&(n=!0),o.managed.CountryCode){case"US":switch(t){case"legal_entity.ssn_last_4":n=!1;break;case"legal_entity.personal_id_number":"individual"==o.managed.EntityType&&(n=!0)}break;case"GB":if("individual"==o.managed.EntityType)switch(t){case"legal_entity.personal_address.city":case"legal_entity.personal_address.line1":case"legal_entity.personal_address.postal_code":n=!1}}"legal_entity.additional_owners"==e&&n&&2==(2&o.managed.Flags)&&(n=!1)}),!n&&o.managed&&(e=o.managed.FieldsNeeded.split(","),angular.forEach(e,function(e){t==e&&(n=!0)}))}),n||!1;var n},o.newOrFailedToSave=function(){var e=!1;return e=!o.managed||"new"!=o.managed.ID&&0!=(1&o.managed.Flags)?e:!0},o.fieldsLocked=function(e){var t,n=!1;return o.managed&&(o.managed.FieldsNeeded&&(t=o.managed.FieldsNeeded.split(","),e=Array.isArray(e)?e:[e],angular.forEach(t,function(t){angular.forEach(e,function(e){e==t&&(n=!0)})})),o.newOrFailedToSave()&&(n=!0)),!n},o.changeAccount=function(){angular.forEach(o.accounts.ManagedAccounts,function(e){e.ID==o.accounts.StripeManagedAccountID&&(o.managed=e)})},o.fileUploaded=function(e,t,n){o.imageSrc=null,o.managed&&(o.managed.VerificationDocumentThumbnailURL=n,o.save(!0))},o.selectedCountryOnly=function(e){var t=o.managed.CountryCode||"US",n=!1;return n=e.Code==t?!0:n},o.save=function(e){!o.managedAccountForm.$valid||o.managedAccountForm.$pristine&&!e||(o.saving=!0,o.accounts.$save(function(t){angular.forEach(t.ManagedAccounts,function(e){e.ID==t.StripeManagedAccountID&&(o.managed=e)}),o.managed&&o.managed.FieldsNeeded.length?(o.failureTitle="Additional Information Required",o.failureMessage="Our payment processor has asked for some additional fields for identity verification.  Please enter them above."):(o.failureMessage=void 0,u.open({templateUrl:"accountCreationComplete.html",controller:["$scope","$uibModalInstance",function(e,t){e.ok=function(){t.close({})}}],size:"md"}).result.then(function(){o.$emit("payment-info-saved")})),o.saving=!1},function(e){o.failureTitle="Saving Account Failure",o.failureMessage=e.data,o.saving=!1}))},o.cancel=function(){o.$emit("payment-method-cancelled")},n=o.projectId,o.accounts=c.projectAdmin.managedInfo.get({id:n},function(t){o.PledgeAmount=t.PledgeAmount,angular.forEach(t.ManagedAccounts,function(e){e.ID==t.StripeManagedAccountID&&(o.managed=e)})})}}}]),e.directive("paypalInfo",["api","User",function(a,o){return{restrict:"E",scope:{projectId:"@"},templateUrl:"paypalInfo.html",link:function(t,e,n){t.paypalInfo=a.projectAdmin.paypalInfo.get({id:t.projectId},function(e){t.paypalInfo=e}),t.isAdmin=!1,o.get().then(function(){t.isAdmin=o.isAdmin()}),t.save=function(){t.paypalForm.$invalid&&t.paypalForm.$pristine||t.paypalInfo.$save(function(e){t.$emit("payment-info-saved"),t.paypalForm.$setPristine()})}}}}]),e.directive("projectPaymentMethod",["$http","User","$compile","api","Dialogs","patronicityConfig",function(e,i,t,r,n,s){return{restrict:"E",require:"^editManager",scope:{},templateUrl:s.urlForTemplate("project-admin/sections/payment-method.html"),link:function(t,e,n,a){function o(){r.projectAdmin.projectInfoForPaymentPage(t.project.ID).then(function(e){t.payment.PaymentType=e.PaymentType,t.payment.TempPaymentType=e.PaymentType,t.project.Flags=e.Flags,t.project.Status=e.Status,e.Country&&(t.countryCode=e.Country),t.payment.ShowCountryField=e.ShowCountryField,t.payment.LockCountryField=e.LockCountryField,t.payment.ShowPaymentForm=e.ShowPaymentForm,t.payment.AllowSkipPayment=e.AllowSkipPayment,t.payment.SponsorName=e.SponsorName,t.payment.ConvertingToWePay=e.ConvertingToWePay,t.payment.ProjectCurrencyCode=e.CurrencyCode,t.payment.WePayCurrencySupported=0<=["USD","CAD","GBP"].indexOf(e.CurrencyCode)},function(){console.log("failed loading project details")}),r.projectAdmin.needsAdditionalInformationForAccountWithProject(t.project.ID).then(function(e){e.ManagedAccount?(t.payment.ManagedFieldsInfo=e,t.payment.ManagedFieldsInfo.FieldsNeeded.length&&(t.payment.ManagedFieldsInfo.FieldsNeeded=t.payment.ManagedFieldsInfo.FieldsNeeded.split(","))):t.payment.ManagedFieldsInfo=[]})}t.project={ID:a.ProjectId()},t.application=s.applicationName,t.flashalert={},i.get().then(function(){t.isAdmin=i.isAdmin()}),t.payment={PaymentType:t.project.PaymentType,ManagedFieldsInfo:{},ShowPaymentForm:!0,ConvertingToWePay:!1},o(),t.$on("payment-info-saved",function(){console.log("payment info saved"),t.$emit("saved-project-data"),"transfer"!=t.selectedOption&&"paypal"!=t.selectedOption||t.selectOption(""),t.flashalert.type="success",t.flashalert.message="Payment information saved!",t.flashalert.duration=5e3,o()})}}}]),e.directive("countryAutocomplete",["mvCountryLoader",function(n){return{restrict:"E",template:'<input type="text" class="form-control input-lg" placeholder="Country" ng-model="countryCode" uib-typeahead="country.Code as country.Name for country in countries | filter:$viewValue | limitTo:8" typeahead-show-hint="true" typeahead-editable="false" typeahead-input-formatter="formatOutput($model)" typeahead-select-on-blur="true" ng-model-options="{getterSetter: true}" ng-disabled="disabled">',link:function(a,e,t){a.countries=[],n.then(function(e){a.countries=e}),a.formatOutput=function(e){for(var t="",n=0;n<a.countries.length;n++)if(e==a.countries[n].Code){t=a.countries[n].Name;break}return t},a.disabled=!1,void 0!==t.ngDisabled&&t.ngDisabled&&a.$watch(t.ngDisabled,function(e){a.disabled=e})}}}]),e.directive("accountOptions",["api",function(i){return{restrict:"E",templateUrl:"accountOptions.html",require:"^editManager",link:function(a,e,t,n){function o(){a.loading=!0,i.projectAdmin.accountOptions(a.countryCode,n.ProjectId()).then(function(e){a.options=e,a.options.selected&&0<a.options.selected.length?a.selectOption(a.options.selected):1==a.options.available.length?a.selectOption(a.options.available[0]):a.selectOption(""),a.skippedPaymentDetails=!1,a.loading=!1,a.$emit("saved-project-data")})}a.options={available:[],selected:""},a.selectedOption="",a.skippedPaymentDetails=!1,a.loading=!0,a.$watch("countryCode",function(e,t){console.log("cc changed"),console.log(e),e&&e!==t&&o()}),o(),a.showOption=function(e){for(var t=!1,n=0;n<a.options.available.length;n++)if(a.options.available[n]==e){t=!0;break}return t},a.actualBankOption=function(){for(var e="",t=0;t<a.options.available.length;t++)if("managed"==a.options.available[t]||"connect"==a.options.available[t]||"transfer"==a.options.available[t]){e=a.options.available[t];break}return e},a.showBankContainer=function(){var e=!1;return e="managed"!=a.selectedOption&&"connect"!=a.selectedOption&&"transfer"!=a.selectedOption?e:!0},a.selectOption=function(e){console.log("selecting option "+e),a.selectedOption=e},a.skipPaymentOptions=function(){i.projectAdmin.skipPaymentOptions(n.ProjectId()).then(function(e){a.$emit("saved-project-data"),a.skippedPaymentDetails=!0})},a.showFeeWarning=function(){var t,e=!1;return e="launchgood"==a.application&&0<a.options.available.length&&(t=!1,a.options.available.forEach(function(e){"managed"!=e&&"connect"!=e&&"wepay"!=e||(t=!0)}),!t)?!0:e},a.showActualOption=function(){"bank"==a.selectedOption?-1===a.options.available.indexOf("managed")&&a.options.available.indexOf("connect"):a.selectedOption}}}}]),e.directive("managedDisabledWarning",[function(){return{restrict:"E",template:'<div class="alert alert-warning" ng-if="showMessage() && message() !== \'\'" ng-bind-html="message()"></div>',link:function(t,e,n){t.showMessage=function(){var e=!1;return e="managed"==t.payment.PaymentType&&null!==t.payment.ManagedFieldsInfo.DisabledReason?!0:e},t.message=function(){var e="";return t.showMessage&&(e="listed"===t.payment.ManagedFieldsInfo.DisabledReason?"Our payment processor, Stripe, is further reviewing your account; in the meantime you're welcome to continue the review process.":"Our payment processor, Stripe, cannot approve this account right now. <a href='mailto:info@launchgood.com'>Contact LaunchGood</a> to discuss further."),t.isAdmin&&(e+="<br><strong>ADMIN:</strong> Disabled reason: "+t.payment.ManagedFieldsInfo.DisabledReason),e}}}}])}(),angular.module("patronicity.project-admin",["patronicity.project-admin.payment-method","patronicity.project-admin.payment-admin","patronicity.project-admin.unified-payment-method","patronicity.project-admin.edit-bar","patronicity.project-admin.routing","patronicity.project-admin.sections.get-started","patronicity.project-admin.sections.your-story","patronicity.project-admin.sections.giving-levels","patronicity.project-admin.sections.social","patronicity.project-admin.sections.admin","patronicity.project-admin.sections.sponsor","patronicity.project-admin.edit-manager","patronicity.project-admin.tabs.view","patronicity.project-admin.tabs.edit","patronicity.project-admin.tabs.financial","patronicity.project-admin.tabs.donors","patronicity.project-admin.tabs.resources","patronicity.project-admin.tabs.insights","patronicity.configuration","patronicity.project-creation"]),function(){var e=angular.module("patronicity.project-creation",["patronicity.api","user","patronicity.configuration","patronicity.project-creation.step-0","patronicity.project-creation.step-1","patronicity.project-creation.step-2","patronicity.project-creation.step-3","patronicity.project-creation.step-4","patronicity.project-creation.step-5","patronicity.project-creation.step-6","patronicity.project-creation.community-search","patronicity.project-creation.select-country","patronicity.project-creation.preview-card","patronicity.project-creation.in-review","patronicity.project-creation.share-live"]);e.directive("createProjectHeader",["User","$state","$parse","$compile",function(e,t,n,a){return{restrict:"E",scope:{},templateUrl:"create-project-header.html",link:function(n){switch(n.data={user:void 0,step:1,bar_step:1,showing_start_message:!1,message:""},t.current.name.split(".").pop()){case"step_0":n.data.showing_start_message=!0,n.data.step=1;break;case"community_search":n.data.message="Discover charities, causes & organizations.",n.data.step=2;break;case"select_country":n.data.message="Select country.",n.data.step=2;break;case"step_1":n.data.step=3,n.data.message="Set a goal and name for your campaign.";break;case"step_2":n.data.step=4,n.data.message="About your fundraiser";break;case"step_3":n.data.step=5,n.data.message="Tell your story";break;case"step_4":n.data.step=6,n.data.message="Almost there...";break;case"step_5":n.data.step=7,n.data.message="Terms and Conditions";break;case"step_6":n.data.step=8,n.data.message="Loading...";break;case"in_review":n.data.step=8,n.data.message="Thank You!";break;case"share":n.data.step=8,n.data.message="Alhamdulilah, all set!<br/>Your campaign is live."}n.data.bar_step=n.data.step-1,n.data.bar_visible=1<=n.data.bar_step&&n.data.bar_step<=7,n.$on("set-campaign-creation-title",function(e,t){n.data.message=t.title}),e.get().then(function(){n.data.user=e.current()},function(){}),n.$on("user:login-change",function(e,t){t.loggedIn?n.data.user=t.user:n.data.user=null})}}}]),e.directive("createProjectFooterButtons",["$state",function(a){return{restrict:"E",templateUrl:"create-project-footer-buttons.html",scope:{next:"&?",back:"&?",skip:"&?",nextValid:"=",backValid:"=?",showTerms:"@?",backLabel:"@?",nextClass:"@?",nextLabel:"=?"},link:function(t,e,n){t.backLabel=n.backLabel||"Back",t.showTerms=!!n.showTerms,t.nextClass=n.nextClass||"lgx-button--default__cta-black",t.processing=!1,(t.errorMessage=void 0)===t.nextLabel&&(t.nextLabel="Next"),t.handleNext=function(){var e;t.next&&(e=t.nextLabel,t.processing=!0,t.errorMessage=void 0,t.nextLabel="Saving...",t.next({}).then(function(e){e.new_state&&a.go(e.new_state.name,e.new_state.params)},function(e){t.errorMessage=e}).finally(function(){t.processing=!1,t.nextLabel=e}))},t.handleBack=function(){var e;t.back&&(e=t.backLabel,t.processing=!0,t.errorMessage=void 0,t.backLabel="Going Back...",t.back({}).then(function(e){e.new_state&&a.go(e.new_state.name,e.new_state.params)},function(e){t.errorMessage=e}).finally(function(){t.processing=!1,t.backLabel=e}))},t.handleSkip=function(){var e;t.skip&&(e=t.nextLabel,t.processing=!0,t.errorMessage=void 0,t.nextLabel="Skipping...",t.skip({}).then(function(e){e.new_state&&a.go(e.new_state.name,e.new_state.params)},function(e){t.errorMessage=e}).finally(function(){t.processing=!1,t.nextLabel=e}))}}}}]),e.directive("createProjectContainer",["$rootScope",function(e){return{restrict:"EA",templateUrl:"create-project-container.html",scope:{},link:function(n){function e(e){n.processing=!0,n.broadcast(e)}n.data={backBtn:{disabled:!0,label:"Back"},nextBtn:{disabled:!1,label:"Next"},skipAvailable:!1,showButtons:!0,processing:!1,showTerms:!0},n.next=function(){e("save")},n.skip=function(){e("skip")},n.back=function(){e("back")},n.$on("set-campaign-creation-title",function(e,t){t.broadcasting||(t.broadcasting=!0,n.$broadcast("set-campaign-creation-title",t))})}}}]),e.factory("CampaignWizardFactory",["$q","api",function(t,i){return{guard:function(o){return t(function(t,n){var e,a;"new"==o.params.slug?(e=o.current.name,void 0===o.params.raising_for?e="create_campaign":void 0!==o.params.account_country||"myself"!==o.params.raising_for&&"organization"!==o.params.raising_for?void 0===o.params.community_id&&"community"===o.params.raising_for?e="create_campaign.community_search":console.info("Guard slip state?",o):e="create_campaign.select_country",e!=o.current.name&&(o.go(e),n("invalid slug in wizard.guard"))):(a=["create_campaign.in_review","create_campaign.share"],i.projectAdmin.create.step("guard","load",{slug:o.params.slug}).then(function(e){e.wizard_complete&&-1==a.indexOf(o.current.name)?(window.location=e.enhance_url,n("redirect to campaign")):t()},n))})},save:function(e,t){return i.projectAdmin.create.step(e,"save",t)},saveAndNext:function(a,e){return t(function(t,n){i.projectAdmin.create.step(a,"save",e).then(function(e){e.new_state={name:"create_campaign.step_"+(a+1),params:{slug:e.slug}},t(e)},function(e){n(e)})})},skip:function(a,e){return t(function(t,n){i.projectAdmin.create.step(a,"skip",e).then(function(e){e.new_state={name:"create_campaign.step_"+(a+1),params:{slug:e.slug}},t(e)},function(e){n(e)})})},back:function(n,a){return t(function(e,t){e({new_state:{name:"create_campaign.step_"+(n-1),params:{slug:a}}})})},loadOptions:function(e,t){return i.projectAdmin.create.step(e,"options",{slug:t})},loadCampaign:function(e,t){return i.projectAdmin.create.step(e,"load",{slug:t})}}}]),e.directive("lgAddress",["mvCountryLoader",function(n){return{restrict:"E",templateUrl:function(e,t){return t.templateUrl},scope:{address:"=",requiredFields:"=",useStreet2:"=?",fieldChanged:"&?",filterCountries:"&?",priorityCountries:"=?"},link:function(s,e,c){function l(e){t=e,angular.forEach(s.data.countries,function(e){e.Code==t&&(n=e)});var t,n,a,o,i,e=n;e&&(s.data.states=e.States||[],s.data.states.length&&(e=s.address.State,a=s.data.states,i=null,void 0!==e&&e&&(o=e.trim().toLowerCase(),angular.forEach(a,function(e){o!=e.Abbreviation.toLowerCase()&&o!=e.Name.toLowerCase()||(i=e)})),e=i,s.address.State=e?e.Abbreviation:""))}function t(){n.then(function(e){var a,o,t,i=e,n=(s.priorityCountries&&s.priorityCountries.length&&(a=[],o=[],angular.forEach(s.priorityCountries,function(n){angular.forEach(i,function(e,t){e.Code==n&&(a.push(e),o.push(t))})}),angular.forEach(i,function(e,t){o.indexOf(t)<0&&a.push(e)}),i=a),c.filterCountries&&(t=[],angular.forEach(i,function(e){s.filterCountries({country:e})&&t.push(e)}),i=t),s.data.countries=i,!1),r=!1;angular.forEach(s.data.countries,function(e){"US"==e.Code&&(r=!0),s.address.Country==e.Code&&(n=!0)}),n?l(s.address.Country):c.defaultCountryCode?s.address.Country=c.defaultCountryCode:s.address.Country=r?"US":s.data.countries[0].Code})}s.data={countries:[],states:[],disabled:!1,lastSelectedState:{}},void 0!==c.ngDisabled&&s.$parent.$watch(c.ngDisabled,function(e){s.data.disabled=e}),s.address.Street||(s.address.Street=""),s.useStreet2&&!s.address.Street2&&(s.address.Street2=""),s.address.City||(s.address.City=""),s.address.State||(s.address.State=""),s.address.ZipCode||(s.address.ZipCode=""),s.address.State&&s.address.Country&&(s.data.lastSelectedState[s.country]=s.state),s.$watch("address.Country",function(e,t){l(e),s.data.lastSelectedState[e]&&(s.address.State=s.data.lastSelectedState[e])}),s.$watch("address.State",function(e,t){s.data.lastSelectedState[s.address.Country]=e}),s.stateRequired=function(){return s.data.states.length&&s.requiredFields.state},s.$watch("priorityCountries",function(){t()}),t(),s.$on("mv-reload-countries",function(){t()})}}}]),e.directive("inlineUploadButton",["api","$q","$http","$parse",function(e,w,C,a){return{restrict:"A",scope:!1,link:function(p,t,m){t.append('<input type="file" accept="'+m.accept+'">');var g=null,f=null,h=null,n=null;function y(e){console.error("Errors ",e),p.$emit("inline-upload-button-error",{error:e.join("\n"),lines:e})}function v(){var e=t.find("input[type=file]");e.wrap("<form>").closest("form").get(0).reset(),e.unwrap()}function b(e){n&&n.assign(p,e)}m.previewImageSrc&&(g=a(m.previewImageSrc)),m.onCompletion&&(f=a(m.onCompletion)),m.uploadProgress&&(h=a(m.uploadProgress)),m.uploading&&(n=a(m.uploading)),p.$on("inline-upload-button-upload",function(e,t){var t=t.files,n=t[0].name,a=t[0].type,o=!1,i=[],r=(o=(m.accept.includes(",")?(i=m.accept.split(","))[0]:m.accept).split("/"),n.split(".")),s=a.split("/"),c=!0;if(o.length==s.length)for(var l=0;l<o.length;l++)o[l]!=s[l]&&"*"!=o[l]&&(c=!1);if(i.forEach(function(e){(e=e.replace(".",""))==r[1]&&(c=!0)}),c){var u=t[0];!function(o,t,i){return w(function(n,a){var e;window.FileReader?((e=new FileReader).onloadend=function(e){var t=this.result;o.$apply(function(){void 0!==i&&0<i&&e.lengthComputable&&e.total>i?a(["File is too big.  "+e.total+" exceeds "+i]):n({data:t})})},e.readAsDataURL(t)):n({data:null})})}(p,u,m.maxUploadSize||0).then(function(a){var i,t,n,r,s,e=m.minImageWidth||0,o=m.minImageHeight||0;i=p,t=u,n=a.data,r=e,s=o,w(function(a,o){var e;/^image/.test(t.type)&&((e=new Image).onload=function(){var t=this.height,n=this.width;i.$apply(function(){var e;r&&n<r||s&&t<s?((e=[]).push("This image is too small."),r&&e.push("It must be at least "+r+" pixels wide (It is currently "+n+")"),s&&e.push("It must be at least "+s+" pixels tall (It is currently "+t+")"),o(e)):a()})},n)?e.src=n:a()}).then(function(){var n,e,t;m.defaultPreviewImage&&g.assign(p,m.defaultPreviewImage),/^image/.test(u.type)&&a.data&&g.assign(p,a.data),e=(n=u).name,t=n.type,C.post(m.endpointUrl,{verb:"upload-parameters",filename:e,id:m.identifier,type:m.type,mimeType:t}).then(function(e){var t,i,r;e.data.success?(t={postURL:e.data.result.url,uploadBucket:e.data.result.bucket,uploadParameters:e.data.result.params,uploadKey:e.data.result.params.key,mimeType:e.data.result.mimeType},b(!0),i=n,r=t,w(function(t,n){var e,a=new FormData;for(e in r.uploadParameters)a.append(e,r.uploadParameters[e]);a.append("success_action_status",201),a.append("file",i);var o=new XMLHttpRequest;o.upload.addEventListener("progress",function(e){var t;e.lengthComputable&&(t=Math.round(100*e.loaded/e.total),h&&t!=h(p)&&p.$apply(function(){h.assign(p,t)}))},!1),o.addEventListener("load",function(e){e&&201==e.currentTarget.status?p.$apply(function(){t()}):p.$apply(function(){n({reason:"loadFailed",evt:e.currentTarget})})},!1),o.addEventListener("error",function(e){p.$apply(function(){n({reason:"error",evt:e})})},!1),o.addEventListener("abort",function(e){p.$apply(function(){n({reason:"aborted"})})},!1),h&&h.assign(p,0),o.open("POST",r.postURL,!0),o.send(a)}).then(function(e){var a;a=t,w(function(t,n){C.post(m.endpointUrl,{verb:"upload-complete",id:m.identifier,bucket:a.uploadBucket,key:a.uploadKey,type:m.type,mimeType:a.mimeType}).then(function(e){e.data.success?(p.uploadResponse=e.data.result.mediaID,t(e.data)):(alert(e.data.message),n([e.data.message]))},function(e){n([e])})}).then(function(e){f?f(p,e.result):p.$emit("inline-file-upload-complete",e.result)},function(e){y([e])}).finally(function(){b(!1),v()})},function(e){var t=e.reason;switch(e.reason){case"loadFailed":case"error":t="There was an error attempting to upload the file."+e.evt.response;break;case"aborted":t="The upload has been canceled by the user or the browser dropped the connection."}b(!1),y([t]),v()})):(y([e.data.message]),v())})},function(e){y(e),v()})},function(e){y(e),v()})}else{var d="Invalid file type!";if(o.length)switch(o[0]){case"video":d="The selected file is not a valid video file.";break;case"image":d="The selected file is not a valid image file.";break;case"audio":d="The selected file is not a valid audio file."}y([d]),v()}}),t.find("input[type=file]").on("change",function(){var e;$(this).val()&&(e=this.files||[]).length&&p.$apply(function(){p.$emit("inline-upload-button-upload",{files:e})})})}}}])}(),angular.module("patronicity.project-creation.community-search",["patronicity.api","user","patronicity.configuration"]).directive("createCampaignCommunitySearch",["patronicityConfig","mvCountryLoader","api","CurrencyCodeProvider","User","$q","$state","searchApi","CampaignWizardFactory",function(e,i,r,t,n,s,c,l,u){return{restrict:"EA",templateUrl:e.urlForTemplate("project-creation/sections/community_search.html"),scope:{},link:function(a){a.data={search:{term:"",searched:!1,results:[],offset:0,total:0},countries:[],project:{community_id:c.params.community_id,raising_for:c.params.raising_for}},u.guard(c),a.$watch("data.search.term",function(e){var t;(e&&e.trim().length||a.data.search.searched)&&(n=e.trim().replace("*","")+"*",t={docType:"community",type:"discovery",limit:o,offset:a.data.search.offset,q:n,"f[]":"can_choose_in_campaign_creation:true"},l.search(t).then(function(e){t.q==n&&(console.log("Result:",e),a.data.search.searched=!0,a.data.search.results=e.projects,a.data.search.offset=e.query.offset,a.data.search.total=e.total_hits.value)}))});var n,o=10;a.countryNameForCode=function(e){return a.data.countries[e]||""},a.back=function(){return s(function(e,t){e({new_state:{name:"create_campaign.step_0",params:{slug:c.params.slug,raising_for:"community"}}})})},a.saveAndNext=function(){return s(function(e,t){a.data.project.slug=c.params.slug,e({new_state:{name:"create_campaign.step_1",params:{slug:c.params.slug,raising_for:a.data.project.raising_for,community_id:a.data.project.community_id}}})})},a.loading=!0,s.all([s(function(t,n){"new"!=c.params.slug.toLowerCase()?r.projectAdmin.create.step(0,"load",{slug:c.params.slug}).then(function(e){a.data.project=e,t(e)},function(e){n(e)}):t()}),s(function(t,n){r.projectAdmin.create.suggestedCommunities().then(function(e){a.data.search.results=e.communities,a.data.search.offset=0,a.data.search.total=e.communities.length,t(e)},function(e){n(e)})}),s(function(t,n){i.then(function(e){a.data.countries=[],e.forEach(function(e){a.data.countries[e.Code]=e.Name}),t(e)},function(e){n(e)})})]).then(function(){},function(e){a.data.errorMessage="Loading returned: "+e}).finally(function(){a.loading=!1})}}}]),angular.module("patronicity.project-creation.in-review",["patronicity.api","user","patronicity.configuration"]).directive("createCampaignInReview",["patronicityConfig","$q","$state","CampaignWizardFactory",function(e,n,a,o){return{restrict:"EA",templateUrl:e.urlForTemplate("project-creation/sections/in_review.html"),scope:{},link:function(t){t.data={project:{view_url:""}},o.guard(a),t.loading=!0,n.all([o.loadCampaign(7,a.params.slug).then(function(e){t.data.project=e})]).then(function(){},function(e){t.data.errorMessage="Loading returned: "+e}).finally(function(){t.loading=!1})}}}]),angular.module("patronicity.project-creation.preview-card",["patronicity.api","user","patronicity.configuration"]).directive("createCampaignPreviewCard",["patronicityConfig","User","$q","$state","CampaignWizardFactory","supportInfo",function(e,n,a,o,i,r){return{restrict:"EA",templateUrl:e.urlForTemplate("project-creation/sections/preview_card.html"),scope:{},link:function(t){t.data={project:{go_live_status:!1,go_live_invalid_reasons:[]},nextButtonLabel:"Submit for Review",show_non_go_live_info:!1,show_failure_reasons:!1},i.guard(o),n.get().then(function(){t.data.show_non_go_live_info=n.isAdmin()}),t.toggleShowingFailureReasons=function(){t.data.show_failure_reasons=!t.data.show_failure_reasons},t.back=function(){return i.back(6,o.params.slug)},t.saveAndNext=function(){return t.data.project.desired_status=t.data.project.go_live_status?"live":"submit_review",t.data.project.wizard_complete=!0,a(function(n,e){i.save(6,t.data.project).then(function(e){var t=e.is_live?"share":"in_review";r.clearForProjectId(e.id),e.new_state={name:"create_campaign."+t,params:{slug:e.slug}},n(e)},e)})},t.loading=!0,a.all([i.loadCampaign(6,o.params.slug).then(function(e){t.data.project=e,t.data.nextButtonLabel=e.go_live_status?"Go Live":"Submit for Review"}),i.loadOptions(6,o.params.slug).then(function(e){t.options=e,t.$emit("set-campaign-creation-title",{title:e.step_title})})]).then(function(){},function(e){t.data.errorMessage="Loading returned: "+e}).finally(function(){t.loading=!1})}}}]),angular.module("patronicity.project-creation.select-country",["patronicity.api","user","patronicity.configuration"]).directive("createCampaignSelectCountry",["patronicityConfig","mvCountryLoader","api","User","$q","$state","CampaignWizardFactory",function(e,n,a,r,s,c,l){return{restrict:"EA",templateUrl:e.urlForTemplate("project-creation/sections/select_country.html"),scope:{},link:function(i){function t(n){var a;n?(i.data.countryBanned=!(0<=o.indexOf(n)),a=n,angular.forEach(i.options.countries,function(e,t){e.Code==n&&(a=e.Name)}),i.data.bannedMessage="We do not currently support campaigns from "+a+"."):i.data.countryBanned=!1}i.data={project:{raising_for:c.params.raising_for,account_country:c.params.account_country},countryBanned:!1,bannedMessage:""},i.options={countries:[]},l.guard(c),i.$watch("data.project.account_country",function(e){t(e)});var o=[];i.back=function(){return s(function(e,t){e({new_state:{name:"create_campaign.step_0",params:{slug:c.params.slug,raising_for:i.data.project.raising_for,account_country:i.data.project.account_country}}})})},i.saveAndNext=function(){return s(function(t,e){i.data.project.slug=c.params.slug;var n={new_state:{name:"create_campaign.step_1",params:{slug:c.params.slug,raising_for:i.data.project.raising_for,account_country:i.data.project.account_country}}};"new"!==c.params.slug?l.saveAndNext(0,i.data.project).then(function(e){e.new_state=n.new_state,t(e)},e):t(n)})},i.loading=!0,s.all([s(function(t,n){"new"!=c.params.slug.toLowerCase()?a.projectAdmin.create.step(0,"load",{slug:c.params.slug}).then(function(e){i.data.project=e,t(e)},function(e){n(e)}):t()}),n.then(function(e){var a=[],o=[];angular.forEach(["US","GB","CA","MY","AU","NZ"],function(n){angular.forEach(e,function(e,t){e.Code==n&&(a.push(e),o.push(t))})}),angular.forEach(e,function(e,t){o.indexOf(t)<0&&a.push(e)}),i.options.countries=a}),r.permittedCountries().then(function(e){o=e})]).then(function(){t(i.data.project.account_country)},function(e){i.data.errorMessage="Loading returned: "+e}).finally(function(){i.loading=!1})}}}]),angular.module("patronicity.project-creation.share-live",["patronicity.api","user","patronicity.configuration"]).directive("createCampaignShareLive",["patronicityConfig","mvCountryLoader","api","CurrencyCodeProvider","User","$q","$state","searchApi","CampaignWizardFactory",function(e,t,n,a,o,i,r,s,c){return{restrict:"EA",templateUrl:e.urlForTemplate("project-creation/sections/share_live.html"),scope:{},link:function(t){t.data={project:{view_url:""}},c.guard(r),t.loading=!0,i.all([c.loadCampaign(7,r.params.slug).then(function(e){t.data.project=e})]).then(function(){},function(e){t.data.errorMessage="Loading returned: "+e}).finally(function(){t.loading=!1})}}}]),angular.module("patronicity.project-creation.step-0",["patronicity.api","user","patronicity.configuration"]).directive("createCampaignStep0",["patronicityConfig","api","$q","$state","CampaignWizardFactory",function(e,a,t,i,r){return{restrict:"EA",templateUrl:e.urlForTemplate("project-creation/sections/step_0.html"),scope:{},link:function(o){o.data={project:{raising_for:i.params.raising_for},show_community_option:!!i.params.show_community},"community"==i.params.raising_for&&(o.data.show_community_option=!0),o.selectRaisingFor=function(e,t){e.target===e.currentTarget&&(o.data.project.raising_for=t)},o.saveAndNext=function(){return t(function(t,e){o.data.project.slug=i.params.slug;var n="";switch(o.data.project.raising_for){case"organization":case"myself":n="create_campaign.select_country";break;case"community":n="create_campaign.community_search"}var a={new_state:{name:n,params:{slug:i.params.slug,raising_for:o.data.project.raising_for,account_country:i.params.account_country}}};"new"!==i.params.slug?r.saveAndNext(0,o.data.project).then(function(e){e.new_state=a.new_state,t(e)},e):t(a)})},o.loading=!0,t.all([t(function(t,n){"new"!=i.params.slug.toLowerCase()?a.projectAdmin.create.step(0,"load",{slug:i.params.slug}).then(function(e){o.data.project=e,t(e)},function(e){n(e)}):t()})]).then(function(){},function(e){o.data.errorMessage="Loading returned: "+e}).finally(function(){o.loading=!1})}}}]),angular.module("patronicity.project-creation.step-1",["patronicity.api","user","patronicity.configuration"]).directive("createCampaignStep1",["patronicityConfig","mvCountryLoader","api","CurrencyCodeProvider","$q","$state","CampaignWizardFactory","User",function(e,t,a,n,o,r,s,c){return{restrict:"EA",templateUrl:e.urlForTemplate("project-creation/sections/step_1.html"),scope:{},link:function(i){i.data={project:{raising_for:r.params.raising_for,goal:"",title:"",currency:void 0,account_country:r.params.account_country,community_id:r.params.community_id}},i.options={currencies:[],countries:[],countriesWithLevel:[]},s.guard(r),i.canChangeAfterLive=function(e){return!0},i.symbolForCode=function(t){var n="?";return angular.forEach(i.options.currencies,function(e){e.code==t&&(n=e.symbol)}),n},i.back=function(){return o(function(e,t){var n;switch(i.data.project.raising_for){case"organization":case"myself":n="create_campaign.select_country";break;case"community":n="create_campaign.community_search"}e({new_state:{name:n,params:{slug:r.params.slug,raising_for:i.data.project.raising_for,community_id:i.data.project.community_id,account_country:i.data.project.account_country}}})})},i.saveAndNext=function(){return o(function(t,n){o(function(t,e){c.isLoggedIn()?t():c.loginModal(!1,"lgx","login").then(function(e){t()},function(){e()})}).then(function(){i.data.project.slug=r.params.slug,a.projectAdmin.create.step(1,"save",i.data.project).then(function(e){e.new_state={name:"create_campaign.step_2",params:{slug:e.slug}},t(e)},function(e){n(e)})},n)})},i.loading=!0,o.all([t.then(function(e){var a=[],o=[];angular.forEach(["US","GB","CA","MY","AU","NZ"],function(n){angular.forEach(e,function(e,t){e.Code==n&&(a.push(e),o.push(t))})}),angular.forEach(e,function(e,t){o.indexOf(t)<0&&a.push(e)}),i.options.countries=a}),n.supportedCodes("project").then(function(e){i.options.currencies=e.map(function(e){return{label:e.symbol+" "+e.code,code:e.code,symbol:e.symbol}}),void 0===i.data.project.currency&&(i.data.project.currency=i.options.currencies[0].code)}),o(function(t,n){"new"!=r.params.slug.toLowerCase()?a.projectAdmin.create.step(1,"load",{slug:r.params.slug}).then(function(e){i.data.project=e,t(e)},function(e){n(e)}):t()})]).then(function(){},function(e){i.data.errorMessage="Loading returned: "+e}).finally(function(){i.loading=!1})}}}]),function(){var e=angular.module("patronicity.project-creation.step-2",["patronicity.api","user","patronicity.configuration","patronicity.skeleton"]);e.directive("createCampaignStep2",["patronicityConfig","mvCountryLoader","$q","$state","CampaignWizardFactory","$timeout",function(e,a,o,i,r,l){return{restrict:"EA",templateUrl:e.urlForTemplate("project-creation/sections/step_2.html"),scope:{},link:function(s){var c;function n(){var e,n,t=!1,a=[],o=["street","city","zipCode"];for(e in o){var i=o[e];void 0!==s.data.project[i]&&0<s.data.project[i].length&&a.push(s.data.project[i])}void 0!==s.data.project.state&&0<s.data.project.state.length&&(n=!1,c&&void 0!==s.data.project.country&&angular.forEach(c,function(e){var t;e.Code==s.data.project.country&&void 0!==e.States&&(t=s.data.project.state.trim().toLowerCase(),angular.forEach(e.States,function(e){t!=e.Abbreviation.toLowerCase()&&t!=e.Name.toLowerCase()||(a.push(e.Name),n=!0)}))}),n||a.push(s.data.project.state)),void 0!==s.data.project.country&&0<s.data.project.country.length&&(c?angular.forEach(c,function(e){e.Code==s.data.project.country&&a.push(e.Name)}):a.push(s.data.project.country));var r=a.join(", ");return 0<r.length?(s.data.currentAddress=r,t=!(s.data.location_error=!1)):s.data.currentAddress=void 0,t}function e(){n()||(s.data.location="",s.data.location_error=!0)}function t(){s.loading=!0,o.all([r.loadOptions(2,i.params.slug).then(function(e){s.options=e}),a.then(function(e){c=e}),r.loadCampaign(2,i.params.slug).then(function(e){s.data.project=e,s.data.changeableFields=e.changeable_fields,delete s.data.project.changeable_fields,n()})]).then(function(){},function(e){s.data.errorMessage="Loading returned: "+e}).finally(function(){s.loading=!1})}s.loading=!0,s.data={project:void 0,location:void 0,errorMessage:void 0,changeableFields:[],location_error:!1},s.options={categories:[],funding:[],currencies:[]},s.locationBlurred=function(){l(function(){e()},100)},s.locationChanged=function(){e()},s.isValid=function(){var e,t=["end_date","title","image","funding","country","category_id"],n=[];for(e in t){var a=t[e];void 0!==s.data.project&&void 0!==s.data.project[a]&&null!=s.data.project[a]&&0!=(s.data.project[a]+"").length||n.push(a)}return 0==n.length},s.$on("uploaded-image-changed",function(e,t){s.data.project.image=t.url}),s.changeAddress=function(){var e,t=["street","city","state","country","zipCode"];for(e in t)s.data.project[t[e]]="";n(),s.data.location=""},s.saveAndNext=function(){return r.saveAndNext(2,s.data.project)},s.back=function(){return r.back(2,i.params.slug)},s.skip=function(){return r.skip(2,s.data.project)},s.canChange=function(e){return 0<=s.data.changeableFields.indexOf(e)},r.guard(i).then(function(){t()})}}}]),e.directive("projectImageUploadV2",["$rootScope",function(a){return{restrict:"E",scope:{uploadResponse:"=?ngModel",minWidth:"@",minHeight:"@",identifier:"@",type:"@",group:"@",currentFileUrl:"=",disabled:"=?"},templateUrl:"projectImageUploadV2.html",link:function(n,e,t){n.state={previewImgSrc:void 0,progress:0,uploading:!1,errors:[]},a.isImageUploading=!1,n.$watch("currentFileUrl",function(e){e&&(n.state.previewImgSrc=e)}),n.$watch("disabled",function(e,t){n.imageDisabled=!!e}),n.$on("campaign-default-image-removed",function(e,t){n.changeImage()}),n.$on("inline-upload-button-error",function(e,t){n.state.errors=t.lines}),n.changeImage=function(){n.state.previewImgSrc=void 0},n.removeImage=function(){n.$emit("campaign-default-image-removing",{})},n.uploadComplete=function(e){n.state.errors=[],n.$emit("uploaded-image-changed",{url:e})},n.onFileSelect=function(e){n.state.errors=[],n.$broadcast("inline-upload-button-upload",{files:e})}}}}])}(),angular.module("patronicity.project-creation.step-3",["patronicity.api","user","patronicity.configuration","patronicity.skeleton"]).directive("createCampaignStep3",["patronicityConfig","$q","$state","CampaignWizardFactory",function(e,n,a,o){return{restrict:"EA",templateUrl:e.urlForTemplate("project-creation/sections/step_3.html"),scope:{},link:function(t){function e(){t.loading=!0,n.all([o.loadCampaign(3,a.params.slug).then(function(e){t.data.project=e,t.data.changeableFields=e.changeable_fields,delete t.data.project.changeable_fields})]).then(function(){},function(e){t.data.errorMessage="Loading returned: "+e}).finally(function(){t.loading=!1})}t.loading=!0,t.data={project:void 0,errorMessage:void 0,changeableFields:[]},t.saveAndNext=function(){return o.saveAndNext(3,t.data.project)},t.back=function(){return o.back(3,a.params.slug)},t.skip=function(){return o.skip(3,t.data.project)},t.canChange=function(e){return 0<=t.data.changeableFields.indexOf(e)},o.guard(a).then(function(){e()})}}}]),function(){var e=angular.module("patronicity.project-creation.step-4",["patronicity.api","user","patronicity.configuration"]);e.directive("createCampaignStep4",["patronicityConfig","$q","$state","api","CampaignWizardFactory",function(e,t,i,r,s){return{restrict:"EA",templateUrl:e.urlForTemplate("project-creation/sections/step_4.html"),scope:{},link:function(a){function n(){return s.loadOptions(4,i.params.slug).then(function(e){a.options=e})}function o(e){a.loading=e,t.all([s.loadCampaign(4,i.params.slug).then(function(e){a.data.project=e}),n()]).then(function(){var t;a.data.project.account_id||(angular.forEach(a.options.accounts,function(e){(void 0===t||0==t.can_go_live&&1==e.can_go_live||t.can_go_live==e.can_go_live&&e.id>t.id)&&(t=e)}),t&&(a.data.project.account_id=t.id))},function(e){a.data.errorMessage="Loading returned: "+e}).finally(function(){a.loading=!1})}a.data={project:{raising_for:"",goal:"",title:"",currency:void 0,account_country:void 0},creating_account:!1,can_create_account:!0,create_account_error_message:void 0},a.options={raised_for_label:"",accounts:[],account_type:""},s.guard(i),a.createAccount=function(){a.data.creating_account=!0,a.data.create_account_error_message=void 0,r.projectAdmin.create.account(a.data.project.id).then(function(e){o(!1),a.data.can_create_account=!1},function(e){0<(a.data.create_account_error_message=e).indexOf("already have")&&(a.data.can_create_account=!1)}).finally(function(){a.data.creating_account=!1})},a.accountCanGoLive=function(){return n=!(t="can_go_live"),a.data.project&&a.data.project.account_id&&angular.forEach(a.options.accounts,function(e){e.id==a.data.project.account_id&&(n=e[t])}),n;var t,n},a.saveAndNext=function(){return s.saveAndNext(4,a.data.project)},a.back=function(){return s.back(4,i.params.slug)},a.skip=function(){return s.skip(4,a.data.project)},a.accountSetAndValid=function(){var t=!1;return angular.forEach(a.options.accounts,function(e){e.id==a.data.project.account_id&&(t=!e.has_missing_fields)}),t},a.$on("payment-info-saved",function(e,t){console.log("Payment info saved: "+e,t),t&&("bank"==t.type&&(e=t.data).address&&e.address.Country&&e.address.Country!=a.data.project.account_country?o:n)()}),o(!0)}}}]),e.directive("verificationDocumentsPanelV2",["api","$rootScope",function(n,e){function a(e,t){var n=[];return angular.forEach(e,function(e){e.category==t&&n.push(e)}),n}return{restrict:"E",templateUrl:"verificationDocumentsPanelV2.html",scope:{accountId:"@",category:"@"},link:function(o,e,t){o.data={loading:!0,saving:!1,documents:[],types:[],errors:[],showNewSection:!1,state:{previewImgSrc:!1,progress:0,uploading:!1,uploaded_id:!1},documentType:void 0,documentNumber:"",invalidDocumentDetails:!0},o.startNewDocument=function(){o.data.showNewSection=!0,o.data.errors=[]},o.saveDocumentChanges=function(){var e;o.data.invalidDocumentDetails||(o.data.saving=!0,e={id:o.data.state.uploaded_id,type:o.data.documentType.id,number:o.data.documentNumber},n.projectAdmin.account.saveDocument(o.accountId,e).then(function(e){o.data.documents=a(e.documents,o.category),o.data.showNewSection=!1,o.data.state.previewImgSrc=!1,o.data.state.progress=0,o.data.state.uploaded_id=!1,o.data.documentType=void 0,o.data.documentNumber=""}).finally(function(){o.data.saving=!1}))},o.deleteDocument=function(e){return confirm("Are you sure you want to delete "+e.description)&&n.projectAdmin.account.deleteDocument(o.accountId,e.id).then(function(e){o.data.documents=a(e.documents,o.category)},function(e){alert(e)}),!1},o.viewDocument=function(e){return window.open(e.url),!1},o.onFileSelect=function(e){o.data.errors=[],o.$broadcast("inline-upload-button-upload",{files:e})},o.uploadComplete=function(e,t,n,a){o.data.errors=[],o.data.state.uploaded_id=a,o.data.state.previewImgSrc=n,1==o.data.types.length&&o.saveDocumentChanges()},o.$on("inline-upload-button-error",function(e,t){o.data.errors=t.lines}),o.$watch(function(){return(o.data.documentType?o.data.documentType.id:"undefined")+"-"+o.data.documentNumber},function(){var e,t=!1;o.data.documentType&&(!o.data.documentType.id_required||2<=(e=o.data.documentNumber||"").length&&e.length<=20)&&(t=!0),o.data.invalidDocumentDetails=!t}),o.$watch("accountId",function(e){o.data.loading=!0,n.projectAdmin.account.listDocuments(o.accountId).then(function(e){o.data.documents=a(e.documents,o.category);var t=[];angular.forEach(e.types,function(e){e.category==o.category&&t.push(e)}),o.data.types=t,1==o.data.types.length&&(o.data.documentType=o.data.types[0])}).finally(function(){o.data.loading=!1})})}}}])}(),angular.module("patronicity.project-creation.step-5",["patronicity.api","user","patronicity.configuration"]).directive("createCampaignStep5",["patronicityConfig","$q","$state","CampaignWizardFactory",function(e,n,a,o){return{restrict:"EA",templateUrl:e.urlForTemplate("project-creation/sections/step_5.html"),scope:{},link:function(t){function e(e){t.loading=e,n.all([o.loadCampaign(5,a.params.slug).then(function(e){t.data.project=e}),o.loadOptions(5,a.params.slug).then(function(e){t.options=e})]).then(function(){},function(e){t.data.errorMessage="Loading returned: "+e}).finally(function(){t.loading=!1})}t.data={project:{}},t.options={},t.saveAndNext=function(){return o.saveAndNext(5,t.data.project)},t.back=function(){return o.back(5,a.params.slug)},t.clickIncomplete=function(e){a.go(e.route_name,{slug:a.params.slug})},t.toggleAgreeAll=function(){var e=!0;t.data.project.agreements.privacy&&t.data.project.agreements.terms&&t.data.project.agreements.payment&&(e=!1),t.data.project.agreements.privacy=e,t.data.project.agreements.terms=e,t.data.project.agreements.payment=e},o.guard(a).then(function(){e("create_campaign.step_5"==a.current.name)})}}}]),angular.module("patronicity.project-creation.step-6",["patronicity.api","user","patronicity.configuration"]).directive("createCampaignStep6",["patronicityConfig","$q","$state","CampaignWizardFactory",function(e,a,o,i){return{restrict:"EA",templateUrl:e.urlForTemplate("project-creation/sections/step_6.html"),scope:{},link:function(t){function e(e){t.data.project.wizard_complete=!0,void 0!==e&&(t.data.project.desired_status=e),i.saveAndNext(6,t.data.project).then(function(e){window.location=t.data.project.enhance_url},function(e){console.error(e)})}function n(){t.loading=!0,a.all([i.loadCampaign(6,o.params.slug).then(function(e){t.data.project=e}),i.loadOptions(6,o.params.slug).then(function(e){t.options=e})]).then(function(){t.data.visible=!0},function(e){t.data.errorMessage="Loading returned: "+e}).finally(function(){t.loading=!1})}t.data={visible:!1,project:{slug:"",id:"",enhance_url:"",go_live_status:""}},t.options={},t.cancel=function(){o.go("create_campaign.step_5",{slug:o.params.slug})},t.enhance=function(){e()},t.reviewOrGoLive=function(){t.data.project.go_live_status?e("live"):e("submit_review")},i.guard(o).then(function(){n()})}}}]),function(){var e=angular.module("patronicity.project-admin.routing",["ui.router","patronicity.configuration"]);e.run(["$transitions","User","$state",function(e,t,n){function a(){document.body.scrollTop=document.documentElement.scrollTop=0}e.onStart({to:"user.editprofile"},function(e){var t=e.injector().get("UserProfileEditor"),e=e.params();return t.canEdit(e.username)}),e.onError({to:"user.editprofile"},function(e){console.log("On Error!");e=e.params();return n.go("user",e)}),e.onSuccess({to:"create_campaign.step_1"},function(e){a()}),e.onSuccess({to:"create_campaign.step_2"},function(e){a()}),e.onSuccess({to:"create_campaign.step_3"},function(e){a()}),e.onSuccess({to:"create_campaign.step_4"},function(e){a()}),e.onSuccess({to:"create_campaign.step_5"},function(e){a()}),e.onSuccess({to:"create_campaign.step_6"},function(e){a()}),e.onSuccess({to:"create_campaign.share"},function(e){a()}),e.onSuccess({to:"create_campaign.in_review"},function(e){a()})}]),e.config(["$stateProvider","$urlRouterProvider","patronicityConfigProvider","$injector",function(e,t,n,a){function o(e){return n.options.templateBasePath+e}function i(){return location.pathname.split("/")}location.pathname.split("/");var r=location.hash.split("?src=Partial")[0].split("/")[2]||"friday-givers";window.location.search.substr(1).split("=");e.state("none",{}).state("community",{url:"^/community/:slug",template:"<community-admin ></community-admin>"}).state("community.view",{url:"/",template:"<community-page-preview></community-page-preview>"}).state("community.edit",{url:"/edit",templateUrl:o("community/admin/tab/left-sections.html"),redirectTo:"community.edit.detail"}).state("community.edit.detail",{url:"/detail",views:{"":{templateUrl:o("community/admin/tab/left-sections.html")},editSection:{templateUrl:o("community/admin/sections/edit-detail.html")}}}).state("community.edit.account",{url:"/account",views:{"":{templateUrl:o("community/admin/tab/left-sections.html")},editSection:{templateUrl:o("community/admin/sections/account.html")}}}).state("community.edit.enhance",{url:"/enhance",views:{"":{templateUrl:o("community/admin/tab/left-sections.html")},editSection:{templateUrl:o("community/admin/sections/enhance.html")}}}).state("community.edit.communityoptions",{url:"/communityoptions",views:{"":{templateUrl:o("community/admin/tab/left-sections.html")},editSection:{templateUrl:o("community/admin/sections/community-options.html")}}}).state("community.edit.branding",{url:"/branding",views:{"":{templateUrl:o("community/admin/tab/left-sections.html")},editSection:{templateUrl:o("community/admin/sections/branding.html")}}}).state("community.edit.admin",{url:"/admin",views:{"":{templateUrl:o("community/admin/tab/left-sections.html")},editSection:{templateUrl:o("community/admin/sections/admin.html")}}}).state("community.campaigns",{url:"/campaigns",template:"<community-admin-tabs-campaigns></community-admin-tabs-campaigns>"}).state("community.reports",{url:"/reports",template:"<community-admin-tabs-reports></community-admin-tabs-reports>"}).state("community.insights",{url:"/insights",template:"<community-admin-tabs-insights></community-admin-tabs-insights>"}).state("community.resources",{url:"/resources",template:"<community-admin-tabs-resources></community-admin-tabs-resources>"}).state("campaign",{url:"^",params:{donate:!1,rewardID:!1,squash:!0},template:'<div ui-view="body"></div>',redirectTo:function(){var e=i(),t=e.filter(function(e){return 0<e.trim().length});return 1==t.length&&"create"==t[0].toLowerCase()?{state:"create_campaign"}:2<e.length&&("project"==e[1].toLowerCase()||"campaign"==e[1].toLowerCase())?{state:"campaign.view"}:2<e.length&&"communitypage"==e[1].toLowerCase()?(t="community.view",{state:t=3<e.length&&"edit"==e[3]?"community.edit":t,params:{slug:e[2]}}):"none"}}).state("campaign.view",{url:"/",views:{"body@campaign":{templateUrl:function(){return"project"==i()[1].toLowerCase()?o("project-admin/tabs/project-view.html"):o("project-admin/tabs/view.html")}}},redirectTo:function(){var e=i();if(2<=e.length&&""==e[0]&&"create"==e[1])return"create_campaign"}}).state("campaign.donate",{url:"/donate?rewardID",template:"",controller:["$state","$stateParams",function(e,t){e.go("campaign",{donate:!0,rewardID:t.rewardID})}]}).state("campaign.edit",{url:"/edit",views:{"body@campaign":{templateUrl:o("project-admin/tabs/edit.html")}},redirectTo:"campaign.edit.started"}).state("campaign.edit.started",{url:"/get_started",views:{"body@campaign":{templateUrl:o("project-admin/tabs/edit.html")},"editSection@campaign.edit.started":{templateUrl:o("project-admin/sections/get_started.html")}}}).state("campaign.editv2",{url:"/editv2",views:{"body@campaign":{templateUrl:o("project-admin-v2/tabs/edit.html")}},redirectTo:"campaign.editv2.step_1"}).state("campaign.editv2.step_1",{url:"/step_1",views:{"body@campaign":{templateUrl:o("project-admin-v2/tabs/edit.html")},"editSection@campaign.editv2.step_1":{templateUrl:o("project-admin-v2/sections/step_1.html")}}}).state("campaign.editv2.step_2",{url:"/step_2",views:{"body@campaign":{templateUrl:o("project-admin-v2/tabs/edit.html")},"editSection@campaign.editv2.step_2":{templateUrl:o("project-admin-v2/sections/step_2.html")}}}).state("campaign.editv2.step_3",{url:"/step_3",views:{"body@campaign":{templateUrl:o("project-admin-v2/tabs/edit.html")},"editSection@campaign.editv2.step_3":{templateUrl:o("project-admin-v2/sections/step_3.html")}}}).state("campaign.editv2.payment_info",{url:"/payment_info",views:{"body@campaign":{templateUrl:o("project-admin-v2/tabs/edit.html")},"editSection@campaign.editv2.payment_info":{templateUrl:o("project-admin-v2/sections/payment_info.html")}}}).state("campaign.editv2.terms_and_conditions",{url:"/terms_and_conditions",views:{"body@campaign":{templateUrl:o("project-admin-v2/tabs/edit.html")},"editSection@campaign.editv2.terms_and_conditions":{templateUrl:o("project-admin-v2/sections/terms-and-conditions.html")}}}).state("campaign.editv2.building_campaign",{url:"/building_campaign",views:{"body@campaign":{templateUrl:o("project-admin-v2/tabs/edit.html")},"editSection@campaign.editv2.building_campaign":{templateUrl:o("project-admin-v2/sections/building_campaign.html")}}}).state("campaign.edit.story",{url:"/your_story",views:{"body@campaign":{templateUrl:o("project-admin/tabs/edit.html")},"editSection@campaign.edit.story":{templateUrl:o("project-admin/sections/your_story.html")}}}).state("campaign.edit.levels",{url:"/giving_levels",views:{"body@campaign":{templateUrl:o("project-admin/tabs/edit.html")},"editSection@campaign.edit.levels":{templateUrl:o("project-admin/sections/giving_levels.html")}}}).state("campaign.edit.social",{url:"/social",views:{"body@campaign":{templateUrl:o("project-admin/tabs/edit.html")},"editSection@campaign.edit.social":{templateUrl:o("project-admin/sections/social.html")}}}).state("campaign.edit.account",{url:"/account",views:{"body@campaign":{templateUrl:o("project-admin/tabs/edit.html")},"editSection@campaign.edit.account":{templateUrl:o("project-admin/sections/account.html")}}}).state("campaign.edit.admin",{url:"/admin",views:{"body@campaign":{templateUrl:o("project-admin/tabs/edit.html")},"editSection@campaign.edit.admin":{templateUrl:o("project-admin/sections/admin.html")}},onlyAdmin:!0}).state("campaign.edit.sponsor",{url:"/sponsor",views:{"body@campaign":{templateUrl:o("project-admin/tabs/edit.html")},"editSection@campaign.edit.sponsor":{templateUrl:o("project-admin/sections/sponsor.html")}}}).state("campaign.summary",{url:"/summary",views:{"body@campaign":{templateUrl:o("project-admin/tabs/financial.html")}}}).state("campaign.payment",{url:"/payment",views:{"body@campaign":{templateUrl:o("project-admin/tabs/payment-info.html")}}}).state("campaign.donors",{url:"/donors",views:{"body@campaign":{templateUrl:o("project-admin/tabs/donors.html")}}}).state("campaign.sponsor-info",{url:"/sponsor-info",views:{"body@campaign":{templateUrl:o("sponsor-form-view.html"),controller:"SponsorFormController"}}}).state("campaign.resources",{url:"/resources",views:{"body@campaign":{templateUrl:o("project-admin/tabs/resources.html"),controller:["$scope","User",function(e,t){t.get().then(function(){e.application=t.getApplication()})}]}}}).state("campaign.insights",{url:"/insights",views:{"body@campaign":{templateUrl:o("project-admin/tabs/insights.html")}}}).state("create_campaign",{url:"^/create/:slug",params:{slug:"new"},template:'<div ui-view="body"></div>',redirectTo:"create_campaign.step_0"}).state("create_campaign.step_0",{url:"/raising_for?raising_for&show_community&account_country",views:{"body@create_campaign":{templateUrl:o("project-creation/layout.html")},"creationSteps@create_campaign.step_0":{template:"<create-campaign-step-0></create-campaign-step-0>"}}}).state("create_campaign.select_country",{url:"/country?raising_for&account_country",views:{"body@create_campaign":{templateUrl:o("project-creation/layout.html")},"creationSteps@create_campaign.select_country":{template:"<create-campaign-select-country></create-campaign-select-country>"}}}).state("create_campaign.community_search",{url:"/community_search?raising_for&community_id",views:{"body@create_campaign":{templateUrl:o("project-creation/layout.html")},"creationSteps@create_campaign.community_search":{template:"<create-campaign-community-search></create-campaign-community-search>"}}}).state("create_campaign.step_1",{url:"/basics?raising_for&community_id&account_country",views:{"body@create_campaign":{templateUrl:o("project-creation/layout.html")},"creationSteps@create_campaign.step_1":{template:"<create-campaign-step-1></create-campaign-step-1>"}}}).state("create_campaign.step_2",{url:"/about",views:{"body@create_campaign":{templateUrl:o("project-creation/layout.html")},"creationSteps@create_campaign.step_2":{template:"<create-campaign-step-2></create-campaign-step-2>"}}}).state("create_campaign.step_3",{url:"/story",views:{"body@create_campaign":{templateUrl:o("project-creation/layout.html")},"creationSteps@create_campaign.step_3":{template:"<create-campaign-step-3></create-campaign-step-3>"}}}).state("create_campaign.step_4",{url:"/account",views:{"body@create_campaign":{templateUrl:o("project-creation/layout.html")},"creationSteps@create_campaign.step_4":{template:"<create-campaign-step-4></create-campaign-step-4>"}}}).state("create_campaign.step_5",{url:"/conditions",views:{"body@create_campaign":{templateUrl:o("project-creation/layout.html")},"creationSteps@create_campaign.step_5":{template:"<create-campaign-step-5></create-campaign-step-5>"}}}).state("create_campaign.step_6",{url:"/preview",views:{"body@create_campaign":{templateUrl:o("project-creation/layout.html")},"creationSteps@create_campaign.step_6":{template:"<create-campaign-preview-card></create-campaign-preview-card>"}}}).state("create_campaign.share",{url:"/share",views:{"body@create_campaign":{templateUrl:o("project-creation/layout.html")},"creationSteps@create_campaign.share":{template:"<create-campaign-share-live></create-campaign-share-live>"}}}).state("create_campaign.in_review",{url:"/thanks",views:{"body@create_campaign":{templateUrl:o("project-creation/layout.html")},"creationSteps@create_campaign.in_review":{template:"<create-campaign-in-review></create-campaign-in-review>"}}}).state("user_set_pass",{url:"^/users/reset_pass/:code",template:"<set-password></set-password>"}).state("user",{url:"^/user/:username",template:"<profile></profile>",redirectTo:"user.campaigns"}).state("user.campaigns",{url:"/campaigns",views:{"":{template:"<profile></profile>"},"profileSection@user":{templateUrl:o("user/profile-campaigns.html")}},redirectTo:"user.campaigns.created"}).state("user.campaigns.created",{url:"/created",views:{"":{template:"<profile></profile>"},"cardSection@user.campaigns":{template:'<project-card-grid default-type="created" max-per-load="6" category="all" type="created" show-load-more="true" param1="profileDetails.user.ID"></project-card-grid>'}}}).state("user.campaigns.supported",{url:"/supported",views:{"":{template:"<profile></profile>"},"cardSection@user.campaigns":{template:'<project-card-grid default-type="supported" max-per-load="6" category="all" type="supported" show-load-more="true" param1="profileDetails.user.ID"></project-card-grid>'}}}).state("user.campaigns.liked",{url:"/liked",views:{"":{template:"<profile></profile>"},"cardSection@user.campaigns":{template:'<project-card-grid default-type="liked" max-per-load="6" category="all" type="liked" show-load-more="true" param1="profileDetails.user.ID"></project-card-grid>'}}}).state("user.campaigns.assigned",{url:"/assigned",views:{"":{template:"<profile></profile>"},"cardSection@user.campaigns":{template:'<project-card-grid default-type="assigned" max-per-load="6" category="all" type="assigned" show-load-more="true" param1="profileDetails.user.ID"></project-card-grid>'}}}).state("user.communities",{url:"/communities",views:{"":{template:"<profile></profile>"},"profileSection@user":{template:'<user-community-pages user-id="profileDetails.user.ID"></user-community-pages>'}}}).state("user.donations",{url:"/donations",views:{"":{template:"<profile></profile>"},"profileSection@user":{templateUrl:o("user/profile-donations.html")}}}).state("user.editprofile",{url:"/profile",views:{"":{template:"<profile></profile>"},"profileSection@user":{templateUrl:o("user/profile-edit.html")}}}).state("user.cards",{url:"/cards",views:{"":{template:"<profile></profile>"},"profileSection@user":{template:"<my-cards></my-cards>"}}}).state("challenge",{url:"^/challenge/:name?src",template:"<challenge-landing></challenge-landing>",params:{name:{value:"ramadan_challenge_2018"},type:{value:"challenge"}}}).state("challenge.umrah",{url:"/umrah",onEnter:["givingDialogs","$stateParams",function(e,t){e.showUmrah(t)}],onExit:["givingDialogs",function(e){e.dismiss()}]}).state("challenge.onboard",{url:"/onboard/:onboardPosition",onEnter:["givingDialogs","$stateParams",function(e,t){e.showOnboardStep(t)}],onExit:["givingDialogs",function(e){e.dismiss()}]}).state("challenge.leaderboard",{url:"/leaderboard",onEnter:["givingDialogs","$stateParams",function(e,t){e.showLeaderboard(t)}],onExit:["givingDialogs",function(e){e.dismiss()}]}).state("challenge.settings",{url:"/settings",onEnter:["givingDialogs","$stateParams",function(e,t){e.showSettings(t)}],onExit:["givingDialogs",function(e){e.dismiss()}]}).state("challenge.faq",{url:"/faq",onEnter:["givingDialogs","$stateParams",function(e,t){e.showFAQ(t)}],onExit:["givingDialogs",function(e){e.dismiss()}]}).state("challenge.welcome",{url:"/welcome",onEnter:["givingDialogs","$stateParams",function(e,t){e.showWelcome(t)}],onExit:["givingDialogs",function(e){e.dismiss()}]}).state("challenge.invite",{url:"/invite?isInitial",onEnter:["givingDialogs","$stateParams",function(e,t){var n=t.isInitial||!1;e.showInvite(t,n)}],onExit:["givingDialogs",function(e){e.dismiss()}]}).state("challenge.vote",{url:"/vote",onEnter:["givingDialogs","$stateParams",function(e,t){e.showVote(t)}],onExit:["givingDialogs",function(e){e.dismiss()}]}).state("challenge.quit",{url:"/quit",onEnter:["givingDialogs","$stateParams",function(e,t){e.showQuit(t)}],onExit:["givingDialogs",function(e){e.dismiss()}]}).state("challenge.quit-confirmed",{url:"/quit-confirmed",onEnter:["givingDialogs","$stateParams",function(e,t){e.showQuitConfirmed(t)}],onExit:["givingDialogs",function(e){e.dismiss()}]}).state("challenge.signup-promotion-faq",{url:"/signupPromotionFaq",onEnter:["givingDialogs","$stateParams",function(e,t){e.showSignupPromotionFAQ(t)}],onExit:["givingDialogs",function(e){e.dismiss()}]}).state("challenge.signup-promotion-share",{url:"/signupPromotionShare",onEnter:["givingDialogs","$stateParams",function(e,t){e.showSignupPromotionShare(t)}],onExit:["givingDialogs",function(e){e.dismiss()}]}).state("challenge.catchup",{url:"/catchup",onEnter:["givingDialogs","$stateParams",function(e,t){e.showCatchupScreen(t)}],onExit:["givingDialogs",function(e){e.dismiss()}]}).state("challenge.givingmessage",{url:"/message",onEnter:["givingDialogs","$stateParams",function(e,t){e.showGivingMessageScreen(t)}],onExit:["givingDialogs",function(e){e.dismiss()}]}).state("challenge.lastday",{url:"/lastday",onEnter:["givingDialogs","$stateParams",function(e,t){e.showGivingLastDayScreen(t)}],onExit:["givingDialogs",function(e){e.dismiss()}]}).state("club",{url:"^/giving_club/:name?src",abstract:!0,params:{name:{value:r},type:{value:"club"}},onEnter:["$state","$stateParams",function(e,t){"settings"==t.name&&e.go("club.home",{name:t.name})}]}).state("club.home",{template:"<club-landing></club-landing>",params:{name:{value:r},type:{value:"club"}},onEnter:["$state","$stateParams",function(e,t){"settings"==t.name&&e.go("club.home",{name:t.name})}]}).state("club.cancellation",{url:"/confirm-cancellation",template:"<club-confirm-cancellation></club-confirm-cancellation>",params:{name:{value:"friday-givers"},type:{value:"club"}}}).state("club.onboard",{url:"/onboard/:onboardPosition",template:"<club-landing></club-landing>",onEnter:["givingDialogs","$stateParams",function(e,t){e.showOnboardStep(t)}],onExit:["givingDialogs",function(e){e.dismiss()}]}).state("club.leaderboard",{url:"/leaderboard",template:"<club-landing></club-landing>",onEnter:["givingDialogs","$stateParams",function(e,t){e.showLeaderboard(t)}],onExit:["givingDialogs",function(e){e.dismiss()}]}).state("club.settings",{url:"/settings",template:"<club-landing></club-landing>",onEnter:["givingDialogs","$stateParams",function(e,t){e.showSettings(t)}],onExit:["givingDialogs",function(e){e.dismiss()}]}).state("club.faq",{url:"/faq",template:"<club-landing></club-landing>",onEnter:["givingDialogs","$stateParams",function(e,t){e.showFAQ(t)}],onExit:["givingDialogs",function(e){e.dismiss()}]}).state("club.welcome",{url:"/welcome",template:"<club-landing></club-landing>",onEnter:["givingDialogs","$stateParams",function(e,t){e.showWelcome(t)}],onExit:["givingDialogs",function(e){e.dismiss()}]}).state("club.invite",{url:"/invite?isInitial",template:"<club-landing></club-landing>",onEnter:["givingDialogs","$stateParams",function(e,t){var n=t.isInitial||!1;e.showInvite(t,n)}],onExit:["givingDialogs",function(e){e.dismiss()}]}).state("club.vote",{url:"/vote",template:"<club-landing></club-landing>",onEnter:["givingDialogs","$stateParams",function(e,t){e.showVote(t)}],onExit:["givingDialogs",function(e){e.dismiss()}]}).state("club.quit",{url:"/quit",template:"<club-landing></club-landing>",onEnter:["givingDialogs","$stateParams",function(e,t){e.showQuit(t)}],onExit:["givingDialogs",function(e){e.dismiss()}]}).state("club.quit-confirmed",{url:"/quit-confirmed",template:"<club-landing></club-landing>",onEnter:["givingDialogs","$stateParams",function(e,t){e.showQuitConfirmed(t)}],onExit:["givingDialogs",function(e){e.dismiss()}]}).state("club.signup-promotion-faq",{url:"/signupPromotionFaq",template:"<club-landing></club-landing>",onEnter:["givingDialogs","$stateParams",function(e,t){e.showSignupPromotionFAQ(t)}],onExit:["givingDialogs",function(e){e.dismiss()}]}).state("newadmin",{url:"^/admin",template:'<div ui-view="admin"></div>'}).state("newadmin.team_dashboard",{url:"/team_dashboard",views:{"admin@newadmin":{template:"<admin-team-dashboard></admin-team-dashboard>"}}}).state("newadmin.campaign_dashboard",{url:"/campaign_dashboard",views:{"admin@newadmin":{template:"<admin-campaign-dashboard></admin-campaign-dashboard>"}}}).state("newadmin.challenges",{url:"/challenges",views:{"admin@newadmin":{template:"<admin-challenges></admin-challenges>"}}}).state("newadmin.challenge",{url:"/challenge/:id",redirectTo:"newadmin.challenge.stats"}).state("newadmin.challenge.projects",{url:"/projects",views:{"admin@newadmin":{template:"<admin-giving-edit-projects></admin-giving-edit-projects>"}},params:{type:{value:"challenge"}}}).state("newadmin.challenge.stats",{url:"/stats",views:{"admin@newadmin":{template:"<admin-challenge-stats></admin-challenge-stats>"}}}).state("newadmin.challenge.user_stats",{url:"/userstats",views:{"admin@newadmin":{template:"<admin-challenge-user-stats></admin-challenge-user-stats>"}}}).state("newadmin.challenge.graph_stats",{url:"/graphstats",views:{"admin@newadmin":{template:"<admin-challenge-graph-stats></admin-challenge-graph-stats>"}}}).state("newadmin.challenge.source_summary",{url:"/sourcesummary",views:{"admin@newadmin":{template:"<admin-challenge-source-summary></admin-challenge-source-summary>"}}}).state("newadmin.challenge.referral_summary",{url:"/referralsummary",views:{"admin@newadmin":{template:"<admin-challenge-referral-summary></admin-challenge-referral-summary>"}}}).state("newadmin.challenge.users",{url:"/users",views:{"admin@newadmin":{template:"<admin-challenge-users></admin-challenge-users>"}}}).state("newadmin.challenge.preview",{url:"/preview",views:{"admin@newadmin":{template:"<admin-challenge-preview></admin-challenge-preview>"}},data:{hideNav:!0}}).state("newadmin.challengeteam",{url:"/challengeteam",views:{"admin@newadmin":{template:"<admin-challenge-team></admin-challenge-team>"}}}).state("newadmin.projects",{url:"/projects",views:{"admin@newadmin":{template:"<admin-projects></admin-projects>"}}}).state("newadmin.projects.featured_order",{url:"/featured",views:{"admin@newadmin":{template:"<admin-featured-order-projects></admin-featured-order-projects>"}}}).state("newadmin.projectlist",{url:"/projectlist",views:{"admin@newadmin":{template:"<admin-project-list></admin-project-list>"}}}).state("newadmin.projectlist.list_items",{url:"/:id/items",views:{"admin@newadmin":{template:"<admin-project-list-items></admin-project-list-items>"}}}).state("newadmin.coaches",{url:"/coaches",views:{"admin@newadmin":{template:"<admin-coaches></admin-coaches>"}}}).state("newadmin.coach",{url:"/coach/:id",redirectTo:"newadmin.coach.reviews"}).state("newadmin.coach.projects",{url:"/projects/:status",views:{"admin@newadmin":{template:"<admin-projects></admin-projects>"}}}).state("newadmin.coach.tips",{url:"/tips",views:{"admin@newadmin":{template:"<admin-coaches-tips></admin-coaches-tips>"}}}).state("newadmin.coach.reviews",{url:"/reviews",views:{"admin@newadmin":{template:"<admin-coaches-reviews></admin-coaches-reviews>"}}}).state("newadmin.dashboard",{url:"/dashboard",views:{"admin@newadmin":{template:"<admin-dashboard></admin-dashboard>"}}}).state("newadmin.sms",{url:"/sms",redirectTo:"newadmin.sms.template"}).state("newadmin.sms.reminder",{url:"/reminder",views:{"admin@newadmin":{template:"<admin-sms-reminder></admin-sms-reminder>"}}}).state("newadmin.sms.templates",{url:"/templates",views:{"admin@newadmin":{template:"<admin-sms-templete></admin-sms-templete>"}}}).state("newadmin.press",{url:"/press",views:{"admin@newadmin":{template:"<admin-press></admin-press>"}}}).state("newadmin.banners",{url:"/banners",views:{"admin@newadmin":{template:"<admin-banners></admin-banners>"}}}).state("newadmin.redirects",{url:"/redirects",views:{"admin@newadmin":{template:"<admin-redirects></admin-redirects>"}}}).state("newadmin.templates",{url:"/templates",views:{"admin@newadmin":{template:"<admin-templates></admin-templates>"}}}).state("newadmin.users",{url:"/users",views:{"admin@newadmin":{template:"<admin-users></admin-users>"}}}).state("newadmin.pages",{url:"/pages",views:{"admin@newadmin":{template:"<admin-pages></admin-pages>"}}}).state("newadmin.pages.wrappers",{url:"/wrappers",views:{"admin@newadmin":{template:"<page-wrapper-list></page-wrapper-list>"}}}).state("newadmin.sponsors",{url:"/sponsors",views:{"admin@newadmin":{template:"<admin-sponsors></admin-sponsors>"}}}).state("newadmin.sponsors.resource_items",{url:"/resources/:id/items",views:{"admin@newadmin":{template:"<admin-sponsors-resource-items></admin-sponsors-resource-items>"}}}).state("newadmin.sponsors.causes",{url:"/causes",views:{"admin@newadmin":{template:"<admin-sponsor-causes></admin-sponsor-causes>"}}}).state("newadmin.sponsor",{url:"/sponsor/:id",redirectTo:"newadmin.sponsor.metadata"}).state("newadmin.sponsor.metadata",{url:"/metadata",views:{"admin@newadmin":{template:"<admin-sponsors-metadata></admin-sponsors-metadata>"}}}).state("newadmin.sponsor.users",{url:"/users",views:{"admin@newadmin":{template:"<admin-sponsors-users></admin-sponsors-users>"}}}).state("newadmin.sponsor.resources",{url:"/resources",views:{"admin@newadmin":{template:"<admin-sponsors-resources></admin-sponsors-resources>"}}}).state("newadmin.sponsor.campaigns",{url:"/campaigns",views:{"admin@newadmin":{template:"<admin-sponsors-campaigns></admin-sponsors-campaigns>"}}}).state("newadmin.communitylist",{url:"/communitylist",views:{"admin@newadmin":{template:"<admin-community-list></admin-community-list>"}}}).state("newadmin.communitylist.list_items",{url:"/:id/items",views:{"admin@newadmin":{template:"<admin-community-list-items></admin-community-list-items>"}}}).state("newadmin.testimonials",{url:"/testimonials",views:{"admin@newadmin":{template:"<admin-testimonials></admin-testimonials>"}}}).state("newadmin.messages",{url:"/messages",views:{"admin@newadmin":{template:"<admin-messages></admin-messages>"}}}).state("newadmin.accounting",{url:"/accounting",views:{"admin@newadmin":{template:"<admin-accounting-reports></admin-accounting-reports>"}}}).state("newadmin.pulse",{url:"/pulse",views:{"admin@newadmin":{template:"<admin-pulse-page></admin-pulse-page>"}}}).state("newadmin.reporting",{url:"/reporting",views:{"admin@newadmin":{template:"<admin-reporting-queries></admin-reporting-queries>"}}}).state("newadmin.forms",{url:"/forms",views:{"admin@newadmin":{template:"<admin-forms></admin-forms>"}}}).state("newadmin.form",{url:"/form/:id",redirectTo:"newadmin.form.fields"}).state("newadmin.form.fields",{url:"/fields",views:{"admin@newadmin":{template:"<admin-forms-fields></admin-forms-fields>"}}}).state("newadmin.bluesnap",{url:"/bluesnap",redirectTo:"newadmin.bluesnap.accounts"}).state("newadmin.bluesnap.accounts",{url:"/accounts",views:{"admin@newadmin":{template:"<admin-bluesnap></admin-bluesnap>"}}}).state("newadmin.bluesnap.account",{url:"/account/:id",views:{"admin@newadmin":{template:"<admin-bluesnap-account-detail></admin-bluesnap-account-detail>",controller:["$stateParams","$state",function(e,t){"new"==e.id&&t.go("newadmin.bluesnap.accounts")}]}}}).state("newadmin.internal",{url:"/internal",redirectTo:"newadmin.internal.accounts"}).state("newadmin.internal.accounts",{url:"/accounts",views:{"admin@newadmin":{template:"<admin-internal-accounts></admin-internal-accounts>"}}}).state("newadmin.internal.settlements",{url:"/settlement",views:{"admin@newadmin":{template:"<admin-internal-settlement-accounts></admin-internal-settlement-accounts>"}}}).state("newadmin.internal.account",{url:"/account/:id",views:{"admin@newadmin":{template:"<admin-internal-account-detail></admin-internal-account-detail>",controller:["$stateParams","$state",function(e,t){"new"==e.id&&t.go("newadmin.internal.accounts")}]}}}).state("newadmin.internal.account.subaccount",{url:"/subaccount/:subaccount_id",views:{"admin@newadmin":{template:"<h1>Fixme</h1>"}}}).state("newadmin.internal.account.subaccount.transactions",{url:"/transactions?start&end&useSettlementDate",params:{start:{dynamic:!0,type:"date"},end:{dynamic:!0,type:"date"},useSettlementDate:{dynamic:!0,type:"bool"}},views:{"admin@newadmin":{template:"<admin-internal-account-transactions></admin-internal-account-transactions>"}}}).state("newadmin.internal.transfers",{url:"/transfers",views:{"admin@newadmin":{template:"<admin-transfer-home></admin-transfer-home>"}}}).state("newadmin.internal.transfers.list",{url:"/list?state",views:{"admin@newadmin":{template:"<admin-transfers-list></admin-transfers-list>"}}}).state("newadmin.internal.transfers.accounts",{url:"/accounts?filter",views:{"admin@newadmin":{template:"<admin-transfers-home></admin-transfer-home>"}}}).state("newadmin.internal.transfer",{url:"/transfer/:id",views:{"admin@newadmin":{template:"<admin-transfer></admin-transfer>",controller:["$stateParams","$state",function(e,t){"new"==e.id&&t.go("newadmin.internal.transfers")}]}}}).state("newadmin.internal.transfers.batches",{url:"/batches",views:{"admin@newadmin":{template:"<admin-transfer-batch-list></admin-transfer-batch-list>"}}}).state("newadmin.internal.transfers.batch",{url:"/batch/:id",views:{"admin@newadmin":{template:"<admin-transfer-batch></admin-transfer-batch>",controller:["$stateParams","$state",function(e,t){"new"==e.id&&t.go("newadmin.internal.transfers")}]}}}).state("newadmin.clubs",{url:"/clubs",views:{"admin@newadmin":{template:"<admin-clubs></admin-clubs>"}}}).state("newadmin.club",{url:"/club/:id",redirectTo:"newadmin.club.stats"}).state("newadmin.club.stats",{url:"/stats",views:{"admin@newadmin":{template:"<admin-club-stats></admin-club-stats>"}}}).state("newadmin.club.projects",{url:"/projects",views:{"admin@newadmin":{template:"<admin-giving-edit-projects></admin-giving-edit-projects>"}},params:{type:{value:"club"}}}).state("newadmin.club.edit",{url:"/edit",views:{"admin@newadmin":{template:"<admin-club-edit></admin-club-edit>"}}}).state("newadmin.club.graph_stats",{url:"/graphstats",views:{"admin@newadmin":{template:"<admin-club-graph-stats></admin-club-graph-stats>"}}}).state("newadmin.club.sources",{url:"/sourcesummary",views:{"admin@newadmin":{template:"<admin-club-source-summary></admin-club-source-summary>"}}}).state("newadmin.club.referrals",{url:"/referralsummary",views:{"admin@newadmin":{template:"<admin-club-referral-summary></admin-club-referral-summary>"}}}).state("newadmin.rasuljoin",{url:"/rasuljoin",views:{"admin@newadmin":{template:"<admin-rasul-join></admin-rasul-join>"}}}).state("newadmin.bannedCountries",{url:"/banned-countries",views:{"admin@newadmin":{template:"<admin-banned-countries></admin-banned-countries>"}}}).state("ramadan",{url:"/{which:(?:ramadan|dhc)}",params:{name:{value:"ramadan_challenge_2023",dynamic:!1},type:{value:"challenge"},src:{value:null}},controller:["User","GivingSettingsManager","$stateParams","$state","$scope","$location","$window",function(t,n,e,a,o,i,r){n.setSrc(i.search().src);var s,c={};e&&e.which&&(s="dhc"==e.which?"dhul_hijjah_2022":"ramadan_challenge_2023",c.name=s,c.type=e.type||"challenge",c.src=i.search().src||n.getSrc(),a.go(a.current,c)),"ramadan"==a.current.name&&t.get().then(function(){t.isLoggedIn()?n.load(e.type,e.name).then(function(e){}):a.go("ramadan.onboard")}),o.login=function(){t.loginModal(!1).then(function(e){t.get().then(function(){t.isLoggedIn()&&n.load("challenge","ramadan_challenge_2020").then(function(e){"active"==e.state&&(r.location.href="/ramadanhome/#!/ramadan/friends")})})})}}],templateUrl:o("challenge/dhul_hijjah_2022/onboarding/wrapper.html")}).state("ramadan.view",{url:"/",views:{"body@ramadan":{template:"<v2-pulse></v2-pulse>"},"header@ramadan":{templateUrl:o("challenge/dhul_hijjah_2022/challenge/nav.html")}}}).state("ramadan.view.pulse",{url:"pulse",views:{"body@ramadan":{template:"<v2-pulse></v2-pulse>"}}}).state("ramadan.view.dashboard",{url:"dashboard",views:{"body@ramadan":{template:"<v2-giving-dashboard></v2-giving-dashboard>"}}}).state("ramadan.view.settings",{url:"settings",views:{"body@ramadan":{template:"<v2-settings></v2-settings>"}}}).state("ramadan.view.top",{url:"top",views:{"body@ramadan":{template:"<v2-top></v2-top>"}}}).state("ramadan.view.day",{url:"day/:challengeDay",views:{"body@ramadan":{template:"<v2-challenge-day></v2-challenge-day>"}}}).state("ramadan.view.friends",{url:"friends",views:{"body@ramadan":{template:"<v2-giving-friends></v2-giving-friends>"}}}).state("ramadan.view.about",{url:"about",views:{"body@ramadan":{template:"<v2-about></v2-about>"}}}).state("ramadan.view.how-it-works",{url:"how-it-works",views:{"body@ramadan":{template:"<v2-how-it-works></v2-how-it-works>"}}}).state("ramadan.view.comp-faq",{url:"comp-faq",views:{"body@ramadan":{template:"<v2-comp-faq></v2-comp-faq>"}}}).state("ramadan.view.impact-score",{url:"impact-score",views:{"body@ramadan":{template:"<v2-impact-score></v2-impact-score>"}}}).state("ramadan.view.give-list",{url:"give-list",views:{"body@ramadan":{template:'<give-list suggested-list-id="3"></give-list>'}}}).state("ramadan.onboard",{url:"/onboard",redirectTo:"ramadan.onboard.overview",views:{"header@ramadan":{templateUrl:function(e){return o("challenge/"+(e.name||"ramadan_challenge_2020")+"/components/onboarding_header.html")}},"body@ramadan":{templateUrl:function(e){return o("challenge/"+(e.name||"ramadan_challenge_2020")+"/components/onboarding_body.html")}}}}).state("ramadan.onboard.overview",{url:"/overview",views:{"header_progress@ramadan.onboard":{template:'<progress class="dhc20-onboarding--progress-bar col-xs-12" aria-label="Onboarding progress: 1 of 7" value="1" max="7"></progress>'},"content@ramadan.onboard":{template:"<v2-giving-onboard-overview></v2-giving-onboard-overview>"}}}).state("ramadan.onboard.newfeatures",{url:"/newfeatures",views:{"header_progress@ramadan.onboard":{template:'<progress class="dhc20-onboarding--progress-bar col-xs-12" aria-label="Onboarding progress: 2 of 7" value="2" max="7"></progress>'},"content@ramadan.onboard":{template:"<v2-giving-onboard-newfeatures></v2-giving-onboard-newfeatures>"}}}).state("ramadan.onboard.giving-goal",{url:"/giving-goal?src",views:{"header_progress@ramadan.onboard":{template:'<progress class="dhc20-onboarding--progress-bar col-xs-12" aria-label="Onboarding progress: 1 of 4" value="1" max="4"></progress>'},"content@ramadan.onboard":{template:"<v2-giving-onboard-giving-goal></v2-giving-onboard-giving-goal>"}}}).state("ramadan.onboard.payment-method",{url:"/payment-method",views:{"header_progress@ramadan.onboard":{template:'<progress class="dhc20-onboarding--progress-bar col-xs-12" aria-label="Onboarding progress: 2 of 4" value="2" max="4"></progress>'},"content@ramadan.onboard":{template:"<v2-giving-onboard-payment-method></v2-giving-onboard-payment-method>"}}}).state("ramadan.onboard.remind",{url:"/remind",views:{"header_progress@ramadan.onboard":{template:'<progress class="dhc20-onboarding--progress-bar col-xs-12" aria-label="Onboarding progress: 3 of 4" value="3" max="4"></progress>'},"content@ramadan.onboard":{template:"<v2-giving-onboard-remind></v2-giving-onboard-remind>"}}}).state("ramadan.onboard.stay-enrolled",{url:"/stay-enrolled",views:{"header_progress@ramadan.onboard":{template:'<progress class="dhc20-onboarding--progress-bar col-xs-12" aria-label="Onboarding progress: 4 of 4" value="4" max="4"></progress>'},"content@ramadan.onboard":{template:"<v2-giving-onboard-stay-enrolled></v2-giving-onboard-stay-enrolled>"}}}).state("ramadan.onboard.finished",{url:"/finished",views:{"header_progress@ramadan.onboard":{template:'<progress class="dhc20-onboarding--progress-bar col-xs-12" aria-label="Onboarding progress: 7 of 7" value="7" max="7"></progress>'},"content@ramadan.onboard":{template:"<v2-giving-onboard-finished></v2-giving-onboard-finished>"}}}).state("ramadan.onboard.previous",{url:"/previous",views:{"header_progress@ramadan.onboard":{template:'<progress class="dhc20-onboarding--progress-bar col-xs-12" aria-label="Onboarding progress: 4 of 4" value="4" max="4"></progress>'},"content@ramadan.onboard":{template:"<v2-giving-onboard-previous></v2-giving-onboard-previous>"}}}).state("ramadan.guide",{url:"/guide",redirectTo:"ramadan.guide.page1",views:{"header@ramadan":{templateUrl:function(e){return o("challenge/"+(e.name||"dhul_hijjah_2020")+"/guide/guide_header.html")}},"body@ramadan":{templateUrl:function(e){return o("challenge/"+(e.name||"dhul_hijjah_2020")+"/guide/guide_body.html")}}}}).state("ramadan.guide.page1",{url:"/page1",views:{"header@ramadan.guide":{template:"<h1>Header</h1>"},"content@ramadan.guide":{templateUrl:function(e){return o("challenge/"+(e.name||"dhul_hijjah_2020")+"/guide/page1.html")}}}}).state("ramadan.guide.page2",{url:"/page2",views:{"header@ramadan.guide":{template:"<h1>Header for page 2</h1>"},"content@ramadan.guide":{templateUrl:function(e){return o("challenge/"+(e.name||"dhul_hijjah_2020")+"/guide/page2.html")}}}}).state("ramadan.guide.page3",{url:"/page3",views:{"header@ramadan.guide":{template:"<h1>Header for page 3</h1>"},"content@ramadan.guide":{templateUrl:function(e){return o("challenge/"+(e.name||"dhul_hijjah_2020")+"/guide/page3.html")}}}}).state("ramadan.guide.page4",{url:"/page4",views:{"header@ramadan.guide":{template:"<h1>Header for page 4</h1>"},"content@ramadan.guide":{templateUrl:function(e){return o("challenge/"+(e.name||"dhul_hijjah_2020")+"/guide/page4.html")}}}}),t.otherwise(function(e,t){for(var n=window.location.pathname.split("/"),a="/",o=location.hash.split("?src")[0].split("/")[2]||"friday-givers";n.length&&0==n[0].length;)n.shift();var i={};if([window.location.search,t.url()].forEach(function(e){var t;e&&1<e.length&&(1<(e=e.split("?")).length&&(e=e[1],t=i,1<e.length&&e.split("&").forEach(function(e){e=e.split("=");2==e.length&&(t[e[0].toLowerCase()]=e[1])}),i=t))}),0<n.length)switch(n[0].toLowerCase()){case"projects":a="/";break;case"club":return void e.invoke(["$state",function(e){e.go("club.home",{name:o,src:i.src||"Partial"})}]);case"challenge":return void e.invoke(["$state",function(e){e.go("challenge",{name:"dhul_hijjah_2019",src:i.src||"Partial"})}]);case"newadmin":a="admin"}return a})}])}(),function(){var e=angular.module("patronicity.project-admin.sections.admin",["patronicity.api","user"]);e.directive("editProjectAdmin",["api","$log","$uibModal","patronicityConfig",function(o,e,t,i){return{restrict:"E",require:"^editManager",scope:{},templateUrl:"editProjectAdmin.html",link:function(n,e,t,a){n.projectId=a.ProjectId(),n.project={},n.FreshDeskView=!1,n.applicationName=i.applicationName,n.loading={params:!0,info:!0},o.admin.listParams().then(function(e){n.listDetails=e,n.loading.params=!1}),n.adminTabInfo=function(){o.projectAdmin.adminTabInfo(n.projectId).then(function(e){n.project=e,n.loading.info=!1})},n.adminTabInfo(),n.isLoading=function(){var e=!0;return e=n.loading.params||n.loading.info?e:!1},n.editFreshDesk=function(){n.FreshDeskView=!0},n.addFreshDesk=function(e,t){o.admin.addFreshDesk(e,t).then(function(e){n.FreshDeskView=!1,n.ticket="",n.adminTabInfo()})},n.justHelpingOption=function(){o.admin.justHelpingOption(n.project.ID,n.project.HideHelping).then(function(e){n.adminTabInfo()})},n.formatFeeInformation=function(e){return"Platform Rate: "+e.ApplicationRate+"<br>Platform Unit: "+e.ApplicationUnit+"<br>Offline Rate: "+e.OfflineApplicationRate+"<br>Offline Unit: "+e.OfflineApplicationUnit+"<br>Transaction Rate: "+e.TransactionRate+"<br>Transaction Unit: "+e.TransactionUnit},n.$on("reload-data-admintab",function(){n.adminTabInfo()})}}}]),e.directive("customProjectSlug",["api","$q",function(o,i){return{restrict:"A",require:"ngModel",link:function(e,t,n,a){if(!a)throw"Missing ngModel!";a.$parsers.push(function(e){var t=e?e.replace(/[^A-Za-z0-9_]/g,""):null;return t!=e&&(a.$setViewValue(t),a.$render()),t}),a.$asyncValidators.uniqueUrl=function(e,t){e=e||t;return e&&0<e.length&&""!==n.projectId?o.admin.validCampaignSlug("validation",n.projectId,e):i.resolve()}}}}]),e.directive("insightButton",["api","$uibModal","patronicityConfig","$window",function(a,o,i,e){return{restrict:"EA",scope:{project:"=",redirectAfterSuccess:"@"},replace:!0,template:'<button class="btn btn-primary" ng-click="editMessage()">Edit</button>',link:function(e,t,n){e.saved=!1,e.failed=!1,e.editMessage=function(){void 0!==e.project&&o.open({templateUrl:i.urlForTemplate("project-insights-custom-message-modal.html"),controller:["$scope","$uibModalInstance","project",function(t,e,n){t.project=n,t.newProject=angular.copy(t.project),t.cancel=function(){e.close()},t.ok=function(){e.close()},t.save=function(){a.projectAdmin.saveInsightsCustomMessage(t.project.ID,t.newProject.InsightsCustomMessage).then(function(e){t.saved=!0,t.project.InsightsCustomMessage=e.InsightsCustomMessage},function(e){t.failed=!0})}}],resolve:{project:function(){return e.project}}})}}}}]),e.directive("campaignSlugChange",["api","$uibModal","patronicityConfig",function(a,o,i){return{restrict:"EA",template:'<button class="btn btn-primary" ng-click="showCampaignSlugModal()">Edit</button>',scope:{project:"="},replace:!0,link:function(e,t,n){e.showCampaignSlugModal=function(){o.open({templateUrl:i.urlForTemplate("project-slug-change-modal.html"),controller:["$scope","$uibModalInstance","project",function(t,n,e){t.project=e,t.newProject=angular.copy(t.project),t.applicationName=i.applicationName,t.cancel=function(){n.close()},t.ok=function(){n.close()},t.save=function(){a.admin.campaignSlugChange("save",t.newProject.ID,t.newProject.Slug).then(function(e){e.Slug!=t.project.Slug&&o.open({templateUrl:i.urlForTemplate("project-URL-change-modal.html"),controller:["$scope","$uibModalInstance",function(e,t){e.ok=function(){t.close()}}]}).result.then(function(){n.close(),window.location=e.URL+"#!/edit/admin"})},function(e){})}}],resolve:{project:function(){return e.project}},backdrop:"static"})}}}}])}(),function(){var e=angular.module("patronicity.project-admin.sections.get-started",["patronicity.api","user","patronicity.geo","mv.forms","ui.bootstrap.datetimepicker"]);e.directive("charactersRemaining",function(){return{restrict:"E",scope:{field:"=",maxLength:"@"},template:"{{ label }}",link:function(t,e,n){function a(){var e=t.field||"",e=t.maxLength-e.length;t.label=1==e?"1 character remaining.":e+" characters remaining."}t.$watch("field",function(e){a()}),a()}}}),e.directive("fieldLock",["User","api",function(e,t){return{restrict:"E",scope:{fieldName:"@",value:"=",lock:"="},template:'<span ng-show="data.visible" class="lockfield fa fa-lock" ng-class="{\'fa-lock\': lock, \'fa-unlock\': !lock}" ng-click="toggleLock()"></span>',link:function(n){var a=!(n.data={visible:!1});function t(e){var t;e?(t=!1,"string"!=typeof e&&Array.isArray(e),!(t=!0)||a||n.lock||(t=!1),n.data.visible=t):n.data.visible=!1}function o(e){n.lock=e,n.$emit("field-lock-changed",{name:n.fieldName,value:n.value,locked:n.lock})}e.get().then(function(){a=e.isAdmin(),t(n.value)}),n.$watch("value",function(e){t(e)}),n.$on("set-field-locks",function(e,t){n.data.visible&&a&&o(t.locked)}),n.toggleLock=function(){a&&o(!n.lock)}}}}]),e.directive("newProjectEndDate",["api","User",function(n,o){return{restrict:"E",scope:{date:"=",disabled:"=",projectId:"=",lockedStatus:"="},templateUrl:"newProjectEndDate.html",link:function(a,e,t){a.state={editing:!1,localTimeZone:(new Date).toString().match(/\(([A-Za-z\s].*)\)/)[1],disabled:a.disabled},a.$watch("disabled",function(e,t){a.state.disabled=e}),a.showEdit=function(){a.state.editing=!0},a.onTimeSet=function(e,t){a.state.editing=!1},a.beforeRenderEndDate=function(e,t,n,a,o){for(var i=moment(),r=0;r<t.length;r++)t[r].localDateValue()<=i.valueOf()&&(t[r].selectable=!1)},o.get().then(function(){a.isAdmin=o.isAdmin()}),a.timezones=n.Timezones.query({},function(e){for(var t=-(new Date).getTimezoneOffset(),n=0;n<e.length;n++)if(t==parseInt(e[n].offsetMinutes)){a.timezone=e[n];break}a.timezone||(a.timezone=e[0])})}}}]),e.directive("projectImageUpload",["$rootScope",function(a){return{restrict:"E",scope:{uploadResponse:"=?ngModel",minWidth:"@",minHeight:"@",identifier:"@",type:"@",group:"@",currentFileUrl:"=",disabled:"=?"},templateUrl:"projectImageUpload.html",link:function(n,e,t){n.state={previewImgSrc:void 0,progress:0,uploading:!1},a.isImageUploading=!1,n.$watch("currentFileUrl",function(e){e&&(n.state.previewImgSrc=e)}),n.$watch("disabled",function(e,t){n.imageDisabled=!!e}),n.$on("campaign-default-image-removed",function(e,t){n.changeImage()}),n.changeImage=function(){n.state.previewImgSrc=void 0,n.$emit("new-mv-image-uploaded",{url:""})},n.removeImage=function(){n.$emit("campaign-default-image-removing",{})},n.onFileSelect=function(e){n.$broadcast("upload-file-list-new",{files:e})}}}}]),e.directive("smsTextPhoneNumber",["api",function(r){return{restrict:"E",scope:{data:"="},templateUrl:"smsTextPhoneNumber.html",link:function(a,e,t){function n(){a.msg=""}function o(e){null!=e.verificationExpiry&&null==e.verifiedPhoneNumber&&null!=e.defaultUserPhone&&null!=e.unverifiedPhoneNumber||null!=e.verificationExpiry&&null==e.verifiedPhoneNumber&&null==e.defaultUserPhone&&null!=e.unverifiedPhoneNumber?(a.phone=i(e.unverifiedPhoneNumber),a.verifyWaiting=!0,a.phonenumber=!0,a.disabledme=!0):null==e.verificationExpiry&&null==e.verifiedPhoneNumber&&null==e.defaultUserPhone&&null!=e.unverifiedPhoneNumber?(a.phone=i(e.unverifiedPhoneNumber),a.verifyWaiting=!0,a.phonenumber=!0,a.disabledme=!0,a.connectme=!1):null==e.verifiedPhoneNumber&&null!=e.defaultUserPhone&&(a.phone=i(e.defaultUserPhone),a.verifyWaiting=!1,a.phonenumber=!0,a.disabledme=!1),null!=e.verificationExpiry&&null==e.verifiedPhoneNumber&&(e.expiration?(a.verifyWaiting=!1,a.disabledme=!1,a.connectme=!0):(a.verifyWaiting=!0,a.disabledme=!0,a.connectme=!1)),null==e.verifiedPhoneNumber&&null==e.defaultUserPhone&&null==e.unverifiedPhoneNumber&&a.cancel()}function i(e){if(a.sortedCountries)for(var t=0;t<a.sortedCountries.length;t++){var n=new RegExp("^\\+"+a.sortedCountries[t].value+"(.+)$");if(e.match(n))return a.countryCode=a.sortedCountries[t].value,e.replace(n,"$1")}}a.verifyWaiting=!1,a.saveButtonText="Verify Number",a.regEx="d+((-d+)+)?",a.countryCode="1",a.phonenumber=!1,a.disabledme=!1,a.connectme=!0,a.changeNumber=function(){n(),a.cancel(),a.phone=i(a.data.smsData.verifiedPhoneNumber),a.data.smsData.verifiedPhoneNumber=null},a.cancel=function(){n(),a.phonenumber=!0,a.verifyWaiting=!1,a.disabledme=!1,a.connectme=!0,r.smsReminder.projectClearSMSData(a.data.id,a.data.smsData).then(function(e){},function(e){a.msg=e})},a.connect=function(){n(),a.getphonenumberform.phone.$valid&&(a.completePhone="+"+a.countryCode+a.phone,r.smsReminder.projectSendVerification(a.completePhone,a.data.id,a.data.smsData).then(function(e){a.verifyWaiting=!0,a.phonenumber=!0,a.connectme=!1,a.disabledme=!0,a.msg="Please check your phone for verification code."},function(e){a.msg=e}))},a.verify=function(){n(),r.smsReminder.projectVerifyCode(a.verifyCode,a.data.id,a.data.smsData).then(function(e){a.msg=e.response,a.verifyWaiting=!1,a.verifyCode=null,a.phonenumber=!1,a.data.smsData.verifiedPhoneNumber=a.completePhone},function(e){console.log(e),a.msg="Invalid code"})},r.projectAdmin.phoneCountries().then(function(e){a.phoneCountries=e,a.sortedCountries=a.phoneCountries.slice().sort(function(e,t){return t.value-e.value}),a.data&&a.data.smsData&&o(a.data.smsData)}),a.$watch("data.smsData",function(e){null!=e&&(a.data.smsData.UIPhoneNumber=!0,o(e))}),a.$watch("phone",function(){a.data&&null!=a.data.smsData&&(null==a.phone?a.data.smsData.UIPhoneNumber=!1:a.data.smsData.UIPhoneNumber=!0)})}}}]),e.directive("editProjectGetStarted",["api","mvCountryLoader","$timeout","$log","$uibModal","patronicityConfig","User","$sentry","$analytics","$rootScope",function(d,p,m,g,f,h,y,v,b,w){return{restrict:"E",require:"^editManager",scope:{},templateUrl:"editProjectGetStarted.html",link:function(r,e,t,a){var s,o;function i(){if(void 0!==r.data){var e,n,a=[],t=["street","city","zipCode"];for(e in t){var o=t[e];void 0!==r.data[o]&&0<r.data[o].length&&a.push(r.data[o])}void 0!==r.data.state&&0<r.data.state.length&&(n=!1,s&&void 0!==r.data.country&&angular.forEach(s,function(e){var t;e.Code==r.data.country&&void 0!==e.States&&(t=r.data.state.trim().toLowerCase(),angular.forEach(e.States,function(e){t!=e.Abbreviation.toLowerCase()&&t!=e.Name.toLowerCase()||(a.push(e.Name),n=!0)}))}),n||a.push(r.data.state)),void 0!==r.data.country&&0<r.data.country.length&&(s?angular.forEach(s,function(e){e.Code==r.data.country&&a.push(e.Name)}):a.push(r.data.country));var i=a.join(", ");0<i.length?r.data.currentAddress=i:r.data.currentAddress=void 0}}function c(){var t=0;angular.forEach(r.data.categories,function(e){e.selected&&t++}),r.selectedCategoryCount=t}function l(e){if(r.data=e,angular.forEach(r.data.currencies,function(e){e.selected&&(r.calculated.currency=e)}),r.isApplicationLaunchgood){r.hasInactiveCategories=!1;for(var t=0;t<r.data.categories.length;t++){var n=r.data.categories[t];if(n&&n.inactive){r.hasInactiveCategories=!0;break}}}else c();i()}function u(e){o&&(m.cancel(o),o=void 0);var n=a.ProjectId();o=m(function(){var t=r.data.slug;d.projectAdmin.saveGettingStarted(n,r.data).then(function(e){e.slug!=t?f.open({templateUrl:h.urlForTemplate("project-URL-change-modal.html"),controller:["$scope","$uibModalInstance",function(e,t){e.ok=function(){t.close()}}]}).result.then(function(){window.location=e.URL+"#!/edit/get_started"}):(l(e),r.$emit("saved-project-data")),w.$broadcast("load-project-bar-data")},function(e){alert("An error occurred: "+e)})},e?0:5e3)}function n(){d.projectAdmin.loadGettingStarted(a.ProjectId(),"US").then(function(e){l(e)},function(e){v.log("An error occurred "+e,"debug")})}"patronicity"==h.applicationName&&b.eventTrack("SPA Page View",{category:"PEP Section View",label:"Getting Started"}),r.calculated={currency:{}},r.showSaved=!1,r.applicationName=h.applicationName,r.isApplicationLaunchgood="launchgood"==r.applicationName,y.get().then(function(){r.isAdmin=y.isAdmin()}),r.taglineOrObjective="patronicity"===r.applicationName?"Campaign Objective":"Campaign Tagline",r.$on("field-lock-changed",function(e,t){d.projectAdmin.lockedField(a.ProjectId(),t.name,t.locked).then(function(e){n()},function(e){})}),r.selectCurrency=function(t){angular.forEach(r.data.currencies,function(e){e.selected=e.code==t.code,e.selected&&(r.calculated.currency=e)}),r.changed("currency")},r.toggleCategory=function(e){if(r.isApplicationLaunchgood){if(!e.selected){if(r.hasInactiveCategories){var t=[];r.hasInactiveCategories=!1;for(var n=0;n<r.data.categories.length;n++){var a=r.data.categories[n];a&&!a.inactive&&t.push(a)}r.data.categories=t}angular.forEach(r.data.categories,function(e){e.selected=!1}),e.selected=!0,r.changed("category")}}else e.selected=!e.selected,c()},r.selectFundingType=function(t){angular.forEach(r.data.funding,function(e){e.selected=e.id==t.id}),r.changed("funding")},p.then(function(e){s=e,i()}),r.changed=function(t){var n=!0;switch(g.info("Get Started field: "+t+" changed!"),t){case"title":case"tagline":r.gettingStartedForm.$error&&r.gettingStartedForm.$error.required&&angular.forEach(r.gettingStartedForm.$error.required,function(e){e.$name==t&&(n=!1)})}n&&u(!1)},r.locationChanged=function(){i(),r.changed("address")},r.changeAddress=function(){var e,t=["street","city","state","country","zipCode"];for(e in t)r.data[t[e]]="";i(),r.data.location=""},a.Loaded()&&n(),r.$on("edit-project-id-changed",function(e,t){n()}),r.$on("save-panel",function(e,t){u(!0)})}}}]),e.directive("step1",function(){return{restrict:"E",require:"^editManager",scope:{},templateUrl:"editStep1.html",link:function(e,t,n,a){e.projectId=a.ProjectId()}}}),e.directive("step1Body",["patronicityConfig","api","$window","User","$analytics","$location","CurrencyCodeProvider","mvCountryLoader","$timeout","$log","$uibModal","$sentry","$rootScope","$filter","$http",function(l,u,d,p,m,g,f,h,y,e,v,b,w,C,t){return{restrict:"E",templateUrl:l.urlForTemplate("start-project-v2/step_1_body.html"),scope:{verb:"@",projectId:"@"},link:function(i,e,t){var a,n=g.search().payment_modal;w.backBtnDisabled=!0,i.disableCompletePaymentBtn=!0,i.showSaved=!1,i.onBehalfChanged=!1,i.user=void 0,p.loggedIn()&&(i.user=p.current()),i.$on("user:login-change",function(e,t){t.loggedIn?i.user=t.user:i.user=null});function o(e){if(i.level=C("filter")(i.countriesWithLevel,{CountryCode:e}),i.level)return i.level[0].FieldValue}i.calculated={currency:{}},i.data={successMessage:"",errorMessage:"",warningMessage:"",saving:!1,loading:!1,countryLocked:!1,accounts:[],account_type:"",accountId:"",currencies:[],banned:!1,bannedMessage:""},i.newProject={goal:"",title:"",campaign:"defaultCampaign",currencycode:"USD",currencylabel:"$",type:"project",countryCode:"",beneficiaryName:""},i.base={projectId:i.projectId,type:"project"},i.data_new={},i.data.newAccount={id:"new",accountOwner:!0},i.campaignFor="",i.countries=[],i.countriesWithlevel=[],i.loadCountry=function(){p.permittedCountries().then(function(e){h.then(function(e){var a=[],o=[];angular.forEach(p.prioritizedCountries(),function(n){angular.forEach(e,function(e,t){e.Code==n&&(a.push(e),o.push(t))})}),angular.forEach(e,function(e,t){o.indexOf(t)<0&&a.push(e)}),i.countries=a})}),u.project.countryLevels().then(function(e){i.countriesWithLevel=e})},i.resetSelection=function(){i.myself=!1,i.organization=!1,i.business=!1,i.onbehalf=!1},i.resetOption=!0,i.collapse=function(e){w.backBtnDisabled=!1,i.resetSelection(),i.resetOption=!1,w.$broadcast("disableBackBtn"),i[e]=!0},i.personalExist=!1,i.corporateExist=!1,i.loadAccount=function(){u.projectAdmin.account.byUserId().then(function(e){i.personalExist=0<C("filter")(e.accounts,{type:"personal"}).length,i.corporateExist=0<C("filter")(e.accounts,{type:"corporate"}).length,e.accounts.unshift({id:"",type:"personal",accountOwner:!0,display_name:"Select account",disabled:!0},{id:"",type:"corporate",accountOwner:!0,display_name:"Select account",disabled:!0},{id:"new",type:"corporate",accountOwner:!0,display_name:"Create a new payout account..."},{id:"new",type:"personal",accountOwner:!0,display_name:"Create a new payout account..."}),i.data.accounts=e.accounts,i.myAccount=i.data.accounts.filter(function(e){return e.id==i.data.accountId}),i.beneficiaryAccount=i.data.accounts.filter(function(e){return 0==e.accountOwner}),i.personalAccountForBeneficiary=i.data.accounts.filter(function(e){return 1==e.accountOwner&&(""!==e.countryBeneficiary||""==e.id||"new"==e.id)&&"personal"==e.type}),i.data.newAccount=i.myAccount[0],""!==i.data.newAccount.id&&(i.checkCountry(),i.collapse(i.data.campaign_for),n&&i.loadPaymentInfo())},function(e){i.data.errorMessage=e})},i.changeOwner=function(e){i.data.accounts[0]&&(i.data.newAccount=i.data.accounts[0],i.data.newAccount.accountOwner=e)},i.resetOpen=function(e,t){e.target===e.currentTarget&&(p.isLoggedIn()?(i.data.accountId="",i.loadAccount(),i.collapse(t)):p.loginModal(!1,"lgx","login").then(function(e){i.loadAccount(),i.collapse(t)},function(e){console.log(e),w.processing=!1}),i.campaignFor=t)},i.loadPaymentInfo=function(){i.data_new.AccountID=i.data.newAccount.id,i.data_new.AccountType=i.data.newAccount.type,i.showNewPaymentModal()},i.loadCurrencies=function(){f.supportedCodes("project").then(function(e){i.data.currencies=e.map(function(e){return{label:e.symbol+" "+e.code,code:e.code,symbol:e.symbol,selected:e.selected}}),i.calculated.currency=i.data.currencies[0]})},i.loadProjectData=function(e){i.data=e,i.data.currencies=e.currencies.map(function(e){return{label:e.symbol+" "+e.code,code:e.code,symbol:e.symbol,selected:e.selected}}),i.data_new.URL=e.URL,i.data_new.CurrentAccountID=e.accountId,i.data_new.AccountID=e.accountId,angular.forEach(i.data.currencies,function(e){e.selected&&(i.calculated.currency=e)}),i.countries=[],h.then(function(e){i.countries=e}),i.campaignFor=i.data.campaign_for},i.selectCurrency=function(){angular.forEach(i.data.currencies,function(e){e.selected=e.code==i.calculated.currency.code,e.selected&&(i.calculated.currency=e)}),i.changed("currency")},i.additionalStep=!1,i.new_payment=!1,i.completePayout=!1,i.setupPayment=function(){"new"!=i.data.newAccount.id&&""!=i.data.newAccount.id&&i.data.newAccount.id||("organization"==i.campaignFor||"business"==i.campaignFor?i.data.newAccount.type="corporate":i.data.newAccount.type="personal",i.data.newAccount.id="new",i.new_payment=!0),i.newProject=i.data.newAccount},i.changeable={currency:{1:!0,2:!1,3:!1,4:!1},title:{1:!0,2:!1,3:!0,4:!0}};var r=[];function s(e){return 0<=r.indexOf(e)}function c(){i.data.banned=!1,i.additionalStep=!1,i.data.newAccount.countryFundraiser&&(i.countryLevelFundraiser=o(i.data.newAccount.countryFundraiser.Code),console.log("Country "+i.data.newAccount.countryFundraiser.Code+" set to "+i.countryLevelFundraiser),s(i.data.newAccount.countryFundraiser.Code)||(i.data.banned=!0,i.data.bannedMessage="We do not currently support campaigns from "+i.data.newAccount.countryFundraiser.Name+".")),"onbehalf"==i.campaignFor&&i.data.newAccount.countryBeneficiary&&(i.countryLevelBeneficiary=o(i.data.newAccount.countryBeneficiary.Code),s(i.data.newAccount.countryBeneficiary.Code)||(i.data.banned=!0,i.data.bannedMessage="We do not currently support campaigns from "+i.data.newAccount.countryBeneficiary.Name+"."))}p.permittedCountries().then(function(e){r=e}),i.countryLevelFundraiser="",i.countryLevelBeneficiary="",i.$watch("data.newAccount.countryFundraiser",function(e){i.data.banned=!1,i.additionalStep=!1,e&&c()}),i.$watch("data.newAccount.countryBeneficiary",function(e){i.data.banned=!1,i.additionalStep=!1,e&&c()}),i.createProject=function(){0;var t="/step_2";i.completePayout&&(t="/step_1?payment_modal=true"),i.additionalStep?(i.nextUrl="/projects/additional_form",u.projectAdmin.account.setupAccount("AdditionalInfo",i.base.type,i.newProject).then(function(e){d.location.href=i.nextUrl+"?id="+e.accountID},function(e){alert("Failed submitting application. Please try again."),0})):(m.eventTrack("Create",{category:"campaign",label:i.newProject.title}),m.eventTrack("CreateCampaign",{category:"campaign",label:new Date}),u.projectAdmin.createProjectV2(i.newProject).then(function(e){i.nextUrl=e.editUrl+t,u.projectAdmin.account.setupAccount(e.projectId,i.base.type,i.newProject).then(function(){d.location.href=i.nextUrl},function(e){alert("Project created but there was an error with creating or linking the account."),0})},function(e){alert("There was an error creating your project.  Please try again."),0}))},i.setupProject=function(){i.setupPayment(),i.newProject.title=i.data.title,i.newProject.goal=i.data.goal,i.newProject.currencycode=i.calculated.currency.code,i.newProject.countryCode=i.data.newAccount.countryFundraiser.Code,i.newProject.campaign_for=i.campaignFor,p.isLoggedIn()?i.createProject():p.loginModal(!1,"lgx","login").then(function(e){i.createProject(),w.$broadcast("hide-edit-bar",{hide:!0})},function(e){alert(e),w.processing=!1})},i.canSubmitCampaign=function(){var e=!1;return w.nextBtnDisabled=!0,i.data.goal&&i.data.title&&!i.data.banned&&!i.additionalStep&&(i.data.newAccount?(i.data.newAccount.canGoLive||i.data.newAccount.countryFundraiser&&(!i.onbehalf||i.data.newAccount.countryBeneficiary))&&(i.disableCompletePaymentBtn=!(e=!0)):i.disableCompletePaymentBtn=!(e=!1)),e},i.$on("can-create-project",function(e,t,n){n(i.canSubmitCampaign())}),i.$on("create-project",function(e,t){i.setupProject()}),i.$on("back-panel",function(e,t){i.resetSelection(),i.resetOption=!0,w.backBtnDisabled=!0,w.nextBtnDisabled=!0,i.data.banned=!1}),i.changeAccount=function(e){i.onBehalfChanged?i.prompt=!0:i.prompt=d.confirm("Are you sure you want to change your payment account?"),i.prompt&&(i.campaignFor!==i.data.campaign_for&&i.changed("campaign_for"),u.projectAdmin.account.setupAccount(i.base.projectId,i.base.type,i.newProject).then(function(){i.resetSelection(),alert("Account updated!"),e?(d.location.href=i.data_new.URL+"#!/editv2/step_1?payment_modal=true",d.location.reload()):d.location.href=i.data_new.URL+"#!/editv2/step_2"}))},i.changeOnbehalf=function(){i.onBehalfChanged=!0},i.$on("save-panel",function(e,t){i.setupPayment(),i.new_payment||(i.data_new.AccountID=i.data.newAccount.id,i.data_new.AccountID!==i.data_new.CurrentAccountID||i.onBehalfChanged)?i.changeAccount(!1):d.location.href=i.data_new.URL+"#!/editv2/step_2"}),i.changed=function(t){var n,e;"create"!=i.verb&&(n=!0,console.log("Get Started field: "+t+" changed!"),"title"===t&&i.gettingStartedForm.$error&&i.gettingStartedForm.$error.required&&angular.forEach(i.gettingStartedForm.$error.required,function(e){e.$name==t&&(n=!1)}),n&&(e=!1,a&&(y.cancel(a),a=void 0),a=y(function(){var t=i.data.slug;i.data.campaign_for=i.campaignFor,u.projectAdmin.saveGettingStarted(i.projectId,i.data).then(function(e){e.slug!=t?v.open({templateUrl:l.urlForTemplate("project-URL-change-modal.html"),controller:["$scope","$uibModalInstance",function(e,t){e.ok=function(){t.close()}}]}).result.then(function(){window.location=e.URL+"#!/editv2/step_1"}):(i.loadProjectData(e),i.loadAccount(),w.$broadcast("load-project-bar-data"),i.$emit("saved-project-data"))},function(e){alert("An error occurred: "+e)})},e?0:5e3)))},i.completePayoutAccount=function(e){i.projectId?"new"==i.data.newAccount.id?(i.setupPayment(),i.changeAccount(!0)):i.loadPaymentInfo():(i.completePayout=!0,i.setupProject())},i.fillAdditionalForm=function(){i.setupProject()},i.showNewPaymentModal=function(){v.open({templateUrl:l.urlForTemplate("project-admin-v2/sections/payment_info.html"),controller:["$scope","$uibModalInstance","params","base",function(e,t,n,a){e.data={},e.cancel=function(){t.dismiss()},e.accountId=n.AccountID,e.accountType=n.AccountType,e.currentAccountId=n.CurrentAccountID,e.projectUrl=n.URL,e.base=a,e.new_payment=!1,e.submitAccount=function(){e.accountId!==e.currentAccountId?(w.$broadcast("change-account",{new_payment:!1}),t.close()):(t.close(),d.location.href=e.projectUrl+"#!/editv2/step_2")}}],resolve:{params:function(){return i.data_new},base:function(){return i.base}},backdrop:"static"})},i.loadGettingStartedData=function(){u.projectAdmin.loadGettingStarted(i.projectId,"US").then(function(e){i.loadProjectData(e),i.loadCountry(),i.loadAccount()},function(e){b.log("An error occurred "+e,"debug")})},i.$on("change-account",function(e,t){i.setupPayment(),i.changeAccount(!1)}),i.$on("payment-info-saved",function(){i.loadGettingStartedData()}),i.loadCreateProjectData=function(){i.loadCountry(),i.loadCurrencies(),i.loadAccount()},"create"==i.verb?i.loadCreateProjectData():i.loadGettingStartedData()}}}]),e.directive("buildingCampaign",["$uibModal","$window","$rootScope","$location","api",function(o,i,r,s,e){return{restrict:"E",require:"^editManager",scope:{},templateUrl:"buildingCampaign.html",link:function(t,e,n,a){r.skip=!0,r.$broadcast("get-project-status",{},function(e){t.projectStatus=e}),t.$on("back-panel",function(e,t){r.backBtnDisabled=!1,r.nextBtnDisabled=!0,window.history.back()}),t.review=!1,t.live=!1,o.open({templateUrl:"campaignReady.html",backdrop:!1,controller:["$scope","$uibModalInstance","statusLabel",function(n,e,t){n.liveLabel=t,n.liveBtn=n.liveLabel,n.urgent=s.search().urgent,n.continueEdit=function(){e.close(),r.$broadcast("hide-edit-bar",{hide:!1}),i.location.href="#!/edit/get_started"},n.viewCampaign=function(){e.close(),r.$broadcast("hide-edit-bar",{hide:!1}),i.location.href="#!/"},n.submit=function(){n.liveBtn="Submitting...",r.$broadcast("submit-project-v2",{urgent:n.urgent})},n.$on("submitted-project-v2",function(e,t){n.liveBtn=n.liveLabel,n.review=t.review,n.live=t.live})}],resolve:{statusLabel:function(){return t.projectStatus}}})}}}]),e.directive("step2",["api","mvCountryLoader","$timeout","$log","$sentry","$rootScope","$window",function(u,d,p,m,g,f,h){return{restrict:"E",require:"^editManager",scope:{},templateUrl:"editStep2.html",link:function(r,e,t,n){var s,a;function o(){if(void 0!==r.data){var e,n,a=[],t=["street","city","zipCode"];for(e in t){var o=t[e];void 0!==r.data[o]&&0<r.data[o].length&&a.push(r.data[o])}void 0!==r.data.state&&0<r.data.state.length&&(n=!1,s&&void 0!==r.data.country&&angular.forEach(s,function(e){var t;e.Code==r.data.country&&void 0!==e.States&&(t=r.data.state.trim().toLowerCase(),angular.forEach(e.States,function(e){t!=e.Abbreviation.toLowerCase()&&t!=e.Name.toLowerCase()||(a.push(e.Name),n=!0)}))}),n||a.push(r.data.state)),void 0!==r.data.country&&0<r.data.country.length&&(s?angular.forEach(s,function(e){e.Code==r.data.country&&a.push(e.Name)}):a.push(r.data.country));var i=a.join(", ");0<i.length?r.data.currentAddress=i:r.data.currentAddress=void 0}}function i(e){r.data=e,angular.forEach(r.data.categories,function(e){e.selected&&(r.selectedCategory=e)}),o()}function c(t){a&&(p.cancel(a),a=void 0);var e=n.ProjectId();a=p(function(){u.projectAdmin.saveGettingStarted(e,r.data).then(function(e){i(e),r.$emit("saved-project-data"),f.$broadcast("load-project-bar-data"),t&&(window.location=e.URL+"#!/editv2/step_3")},function(e){alert("An error occurred: "+e)})},t?0:5e3)}function l(){u.projectAdmin.loadGettingStarted(n.ProjectId(),"US").then(function(e){i(e)},function(e){g.log("An error occurred "+e,"debug")})}f.nextBtnDisabled=!1,f.skip=!0,d.then(function(e){s=e,o()}),r.selectFundingType=function(t){angular.forEach(r.data.funding,function(e){e.selected=e.id==t.id}),r.changed("funding")},r.canSubmitCampaign=function(){var e=!1;return f.nextBtnDisabled=!0,r.selectedCategory&&(f.nextBtnDisabled=!(e=!0)),e},r.$on("can-create-project",function(e,t,n){n(r.canSubmitCampaign())}),r.locationChanged=function(){o(),r.changed("address")},r.changeAddress=function(){var e,t=["street","city","state","country","zipCode"];for(e in t)r.data[t[e]]="";o(),r.data.location=""},r.changed=function(t){var n=!0;m.info("Get Started field: "+t+" changed!"),"tagline"===t&&r.gettingStartedForm.$error&&r.gettingStartedForm.$error.required&&angular.forEach(r.gettingStartedForm.$error.required,function(e){e.$name==t&&(n=!1)}),n&&c(!1)},r.toggleCategory=function(){r.selectedCategory&&!r.selectedCategory.selected&&(angular.forEach(r.data.categories,function(e){e.selected=!1,e.id==r.selectedCategory.id&&(e.selected=!0)}),r.changed("category"))},n.Loaded()&&l(),r.$on("edit-project-id-changed",function(e,t){l()}),r.$on("save-panel",function(e,t){c(!0)}),r.$on("back-panel",function(e,t){f.backBtnDisabled=!1,f.nextBtnDisabled=!1,h.location.href="#!/editv2/step_1"})}}}]),e.directive("termsAndConditions",["api","$sentry","$window","$rootScope",function(o,i,r,s){return{restrict:"E",require:"^editManager",scope:{projectId:"=",disabled:"="},templateUrl:"terms-and-condition.html",link:function(n,e,t,a){s.skip=!1,n.data={urgent:!1,tnc_privacy_policy:!1,tnc_terms_of_use:!1,tnc_payment_policy:!1},n.load=function(){s.nextBtnDisabled=!0,o.projectAdmin.requirementsCheck(n.projectId).then(function(e){n.requirementCheck=e})},a.Loaded()&&(n.projectId=a.ProjectId(),n.load()),n.$on("save-panel",function(e,t){o.projectAdmin.saveConfirmCreation(a.ProjectId(),n.data).then(function(e){n.data=e,r.location.href="#!/editv2/building_campaign?urgent="+n.data.urgent},function(e){i.log("An error occurred:"+e,"debug")})}),n.$on("back-panel",function(e,t){s.backBtnDisabled=!1,s.nextBtnDisabled=!1,window.history.back()}),n.$on("edit-project-id-changed",function(e,t){n.projectId=t.id,n.load()}),n.canSubmit=function(){n.data.tnc_privacy_policy&&n.data.tnc_terms_of_use&&n.data.tnc_payment_policy?s.nextBtnDisabled=!1:s.nextBtnDisabled=!0},n.load()}}}]),e.directive("step3",["api","mvCountryLoader","$timeout","$uibModal","patronicityConfig","$sentry","$window","$rootScope",function(i,e,t,n,a,r,s,c){return{restrict:"E",require:"^editManager",scope:{projectId:"=",disabled:"="},templateUrl:"editStep3.html",link:function(a,e,t,o){function n(){s.scrollTo(0,0),i.projectAdmin.loadYourStory(o.ProjectId()).then(function(e){a.data=e,a.html=a.data.revisions[0].body},function(e){r.log("An error occurred:"+e,"debug")})}c.skip=!0,a.$on("save-panel",function(e,t){var n;n=o.ProjectId(),i.projectAdmin.saveYourStory(n,a.data).then(function(e){a.data=e,a.html=a.data.revisions[0].body,c.$broadcast("load-project-bar-data"),s.location.href="#!/editv2/terms_and_conditions"},function(e){r.log("An error occurred:"+e,"debug")})}),a.$watch("data.zakat",function(e){c.nextBtnDisabled=!1,"1"!=e||a.data&&(e=!1,e=a.data.zakat_category&&a.data.zakat_funds_explanation?("Other"==a.data.zakat_category&&a.data.zakat_category_other_text,!0):e)||(c.nextBtnDisabled=!0)}),a.$watch("data.zakat_category",function(e){c.nextBtnDisabled=!1,!a.data||"1"!=a.data.zakat||e&&("Other"!=e||a.data.zakat_category_other_text)&&a.data.zakat_funds_explanation||(c.nextBtnDisabled=!0)}),a.$watch("data.zakat_category_other_text",function(e){c.nextBtnDisabled=!1,!a.data||"1"!=a.data.zakat||("Other"!=a.data.zakat_category||e)&&a.data.zakat_funds_explanation||(c.nextBtnDisabled=!0)}),a.$watch("data.zakat_funds_explanation",function(e){c.nextBtnDisabled=!1,!a.data||"1"!=a.data.zakat||e&&a.data.zakat_category||(c.nextBtnDisabled=!0)}),a.$on("back-panel",function(e,t){c.backBtnDisabled=!1,c.nextBtnDisabled=!1,window.history.back()}),o.Loaded()&&n(),a.$on("edit-project-id-changed",function(e,t){n()})}}}]),e.directive("newMvInlineUploadButton",["api","$q","$http","$parse","$timeout","$rootScope","User",function(c,l,u,e,i,d,t){return{restrict:"A",scope:!1,link:function(g,t,f){i(function(){var e=f.imageDisabled||"";angular.element(document.querySelector("#fileupload")).prop(e,!0)},5e3),t.addClass("upload_button"),t.append('<input id="fileupload" type="file" accept="'+f.accept+'">');var r=null,h=null,a=null,s=null,n=null;function y(){var e=t.find("input[type=file]");e.wrap("<form>").closest("form").get(0).reset(),e.unwrap()}function o(e){n&&n.assign(g,e),g.$emit("new-mv-image-uploading",{uploading:e})}function v(t){var e=t.name,n=t.type;d.isImageUploading=!0,d.isImageUploadingCount++,u.post(f.endpointUrl,{verb:"upload-parameters",filename:e,id:f.identifier,type:f.type,group:f.group,uploadedToType:f.uploadedToType,uploadedToId:f.uploadedToId,mimeType:n}).then(function(e){var i;e.data.success?(r={postURL:e.data.result.url,uploadBucket:e.data.result.bucket,uploadParameters:e.data.result.params,uploadKey:e.data.result.params.key,mimeType:e.data.result.mimeType},o(!0),i=t,l(function(t,n){var e,a=new FormData;for(e in r.uploadParameters)a.append(e,r.uploadParameters[e]);a.append("success_action_status",201),a.append("file",i);var o=new XMLHttpRequest;o.upload.addEventListener("progress",function(e){var t;e.lengthComputable&&(t=Math.round(100*e.loaded/e.total),s&&t!=s(g)&&g.$apply(function(){s.assign(g,t)}))},!1),o.addEventListener("load",function(e){e&&201==e.currentTarget.status?g.$apply(function(){t()}):g.$apply(function(){n({reason:"loadFailed",evt:e.currentTarget})})},!1),o.addEventListener("error",function(e){g.$apply(function(){n({reason:"error",evt:e})})},!1),o.addEventListener("abort",function(e){g.$apply(function(){n({reason:"aborted"})})},!1),s&&s.assign(g,0),o.open("POST",r.postURL,!0),o.send(a)}).then(function(e){l(function(t,n){u.post(f.endpointUrl,{verb:"upload-complete",id:f.identifier,bucket:r.uploadBucket,key:r.uploadKey,type:f.type,group:f.group,uploadedToType:f.uploadedToType,uploadedToId:f.uploadedToId,mimeType:r.mimeType}).then(function(e){e.data.success?(g.uploadResponse=e.data.result.mediaID,d.fileUploadedResponse=e.data.result,d.$broadcast("file-uploaded",{category:f.fileCategory,fileId:e.data.result.id}),t(e.data),d.isImageUploadingCount--,0==d.isImageUploadingCount&&(d.isImageUploading=!1)):(d.isImageUploadingCount--,0==d.isImageUploadingCount&&(d.isImageUploading=!1),alert(e.data.message),n())},n)}).then(function(e){var t;void 0!==f.docType&&void 0!==f.accountId?(g.data.loading=!0,t={id:e.result.id,type:f.docType,number:g.docNumber},c.projectAdmin.account.saveDocument(f.accountId,t).then(function(e){g.accountDetail.internalDocumentList=e.documents,g.showNewSection=!1,g.state.previewImgSrc=!1,g.state.progress=0,o(!1),y()}).finally(function(){g.data.loading=!1})):(a&&a(g,e.result),g.$emit("new-mv-image-uploaded",{bucket:e.result.bucket,key:e.result.key,url:e.result.url,mediaID:e.result.mediaID,id:f.identifier,type:f.type,group:f.group}),o(!1),y())},function(e){o(!1),y()})},function(e){switch(e.reason){case"loadFailed":case"error":alert("There was an error attempting to upload the file."+e.evt.response);break;case"aborted":alert("The upload has been canceled by the user or the browser dropped the connection.")}o(!1),y()})):(alert(e.data.message),y())})}d.isImageUploadingCount=0,f.previewImageSrc&&(h=e(f.previewImageSrc)),f.onCompletion&&(a=e(f.onCompletion)),f.uploadProgress&&(s=e(f.uploadProgress)),f.uploading&&(n=e(f.uploading)),g.$on("upload-file-list-new",function(e,t){var a,o,i,r=t.files,t=(f.identifier,r[0].name),n=r[0].type,s=!1,c=[],l=(s=(f.accept.includes(",")?(c=f.accept.split(","))[0]:f.accept).split("/"),t.split(".")),u=n.split("/"),d=!0;if(s.length==u.length)for(var p=0;p<s.length;p++)s[p]!=u[p]&&"*"!=s[p]&&(d=!1);if(c.forEach(function(e){(e=e.replace(".",""))==l[1]&&(d=!0)}),d)window.FileReader?(t=new FileReader,a=f.maxUploadSize||0,/^image/.test(n)?(o=f.minImageWidth||0,i=f.minImageHeight||0,t.onloadend=function(e){var t=this.result,n=!0;a&&e.lengthComputable&&e.total>a&&(n=!1,g.$emit("upload-invalid-error",{error:"File is too big.  "+e.total+" exceeds "+a}),alert("File is too big.\n"+e.total+" exceeds "+a)),n?o||i?((e=new Image).onload=function(){var e;o&&this.width<o||i&&this.height<i?((e=[]).push("This image is too small."),o&&e.push("It must be at least "+o+" pixels wide (It is currently "+this.width+")"),i&&e.push("It must be at least "+i+" pixels tall (It is currently "+this.height+")"),g.$emit("upload-invalid-error",{error:e.join("\n")}),alert(e.join("\n")),y()):g.$apply(function(){h&&h.assign(g,t),v(r[0])})},e.src=t):(h&&g.$apply(function(){h.assign(g,t)}),v(r[0])):y()},t.readAsDataURL(r[0])):f.defaultPreviewImage?a?(t.onloadend=function(e){e.lengthComputable&&e.total>a?(g.$emit("upload-invalid-error",{error:"File is too big.  "+e.total+" exceeds "+a}),alert("File is too big.\n"+e.total+" exceeds "+a),y()):(h&&h.assign(g,f.defaultPreviewImage),v(r[0]))},t.readAsDataURL(r[0])):(h&&h.assign(g,f.defaultPreviewImage),v(r[0])):v(r[0])):v(r[0]);else{var m="Invalid file type!";if(s.length)switch(s[0]){case"video":m="The selected file is not a valid video file.";break;case"image":m="The selected file is not a valid image file.";break;case"audio":m="The selected file is not a valid audio file."}g.$emit("upload-invalid-error",{error:m}),alert(m),y()}}),t.find("input[type=file]").on("change",function(){var e;$(this).val()&&(e=this.files||[]).length&&g.$emit("upload-file-list-new",{files:e})})}}}])}(),function(){var e=angular.module("patronicity.project-admin.sections.giving-levels",["patronicity.api","user","ngSanitize","mv.utils"]);e.directive("editProjectGivingLevels",["api","$timeout",function(s,c){return{restrict:"E",require:"^editManager",scope:{},templateUrl:"editProjectGivingLevels.html",link:function(n,e,t,a){function o(){s.projectAdmin.loadRewards(a.ProjectId()).then(function(e){n.data=e},function(e){alert("An error occurred: "+e)})}var i;function r(e){i&&(c.cancel(i),i=void 0);var t=a.ProjectId();i=c(function(){s.projectAdmin.saveRewards(t,n.data).then(function(e){n.data=e,n.$emit("saved-project-data")},function(e){alert("An error occurred: "+e)})},e?0:5e3)}n.$on("field-lock-changed",function(e,t){s.projectAdmin.lockedField(a.ProjectId(),t.name,t.locked).then(function(e){o()},function(e){})}),a.Loaded()&&o(),n.$on("save-rewards",function(e,t){r(!0)}),n.$on("edit-project-id-changed",function(e,t){o()}),n.$on("save-panel",function(e,t){r(!0)})}}}]),e.directive("projectRewards",["Dialogs",function(r){return{restrict:"E",scope:{rewards:"=",currencyCode:"=",currencySymbol:"=",locked:"="},templateUrl:"projectRewards.html",controller:["$scope","$element","$timeout","$window",function(a,e,t,n){function o(e){a.editableItem=e}function i(e){var t,n={};for(t in e)0<=t.indexOf("$")||(n[t]=e[t]);return n}this.editReward=function(e){e.editingThisReward=!0,o(i(e))},this.duplicateReward=function(e){e=i(e);e.id="new",e.prize_awarded=0,e.editingThisReward=!0,a.rewards.push(e),o(e)},this.deleteReward=function(t){r.Confirm('Are you sure you want to remove "'+t.title+'"?',"Confirm Deletion").then(function(){var e=a.rewards.indexOf(t);0<=e&&a.rewards.splice(e,1),"new"!=t.id&&a.$emit("save-rewards")})},this.saveRewardEdit=function(e){var n;void 0!==a.editableItem&&"new"!==a.editableItem.id&&(angular.forEach(a.rewards,function(e,t){e.id==a.editableItem.id&&(n=t)}),void 0!==n?(a.editableItem.changed=!0,a.rewards.splice(n,1,a.editableItem)):a.rewards.push(a.editableItem)),e.editingThisReward=!1,a.editableItem=void 0,a.$emit("save-rewards")},this.cancelRewardEdit=function(e){for(var t=0;t<a.rewards.length;t++)if(a.rewards[t].id==e.id){a.rewards[t].editingThisReward=!1,"new"==e.id&&a.rewards.splice(t,1);break}a.editableItem=void 0},a.addReward=function(e){var t={id:"new",title:"",description:"",amount:10,limit:0,prize_awarded:0,require_shipping:!1,require_note:!1,include_note:!1,note_description:"",unlimited:1,allow_change_amount:!0,editingThisReward:!0,note_email:"",hide_reward:!1,require_email:!1,include_email_note:!1};e?a.rewards.unshift(t):a.rewards.push(t),o(t)}}]}}]).directive("projectReward",function(){return{require:"^projectRewards",restrict:"E",templateUrl:"projectReward.html",scope:{item:"=item",editable:"=",currencyCode:"@",currencySymbol:"@"},link:function(e,t,n,a){e.unlimitedAvailable=0===parseInt(e.item.Limit),e.delete=function(){a.deleteReward(e.item)},e.edit=function(){a.editReward(e.item)},e.duplicate=function(){a.duplicateReward(e.item)}}}}).directive("projectRewardEditable",function(){return{require:"^projectRewards",restrict:"E",templateUrl:"projectRewardEditable.html",scope:{item:"=item",currencyCode:"@",currencySymbol:"@"},link:function(e,t,n,a){e.save=function(){a.saveRewardEdit(e.item)},e.cancel=function(){a.cancelRewardEdit(e.item)}}}})}(),function(){var e=angular.module("patronicity.project-admin.sections.social",["patronicity.api","community","user"]);e.directive("editTeamList",["api",function(e){return{restrict:"E",templateUrl:"editTeamList.html",scope:{team:"=",invites:"=",messages:"="},link:function(t,e,n){t.addMember=function(){t.newMember={name:"",email:""}},t.cancel=function(){t.newMember=void 0},t.moveUp=function(e){e=t.team.indexOf(e);return-1!=e&&(t.team[e-1]?(t.team.splice(e-1,2,t.team[e],t.team[e-1]),void t.$emit("save-panel")):0)},t.moveDown=function(e){e=t.team.indexOf(e);return-1!=e&&(t.team[e+1]?(t.team.splice(e,2,t.team[e+1],t.team[e]),void t.$emit("save-panel")):0)},t.delete=function(e){"owner"==e.permission?alert("You cannot delete "+e.name+" because they are the project owner."):(e=t.team.indexOf(e),t.team.splice(e,1),t.$emit("save-panel"))},t.deleteInvite=function(e){e=t.invites.indexOf(e);t.invites.splice(e,1),t.$emit("save-panel")},t.save=function(){var e;t.editTeamForm.$valid&&(e={id:"new",name:"[Pending Invite]",email:t.newMember.email,permission:"full",status:"pending"},t.invites.push(e),t.newMember=null,t.$emit("save-panel"))}}}}]),e.directive("customProjectUrl",["api","$q",function(o,i){return{restrict:"A",require:"ngModel",link:function(e,t,n,a){if(!a)throw"Missing ngModel!";a.$parsers.push(function(e){var t=e?e.replace(/[^A-Za-z0-9_\-]/g,""):null;return t!=e&&(a.$setViewValue(t),a.$render()),t}),a.$asyncValidators.uniqueUrl=function(e,t){e=e||t;return e&&0<e.length&&""!==n.projectId?o.projectAdmin.validCustomUrl(n.projectId,e):i.resolve()}}}}]),e.directive("videoPreview",["$log","$sce",function(e,a){return{restrict:"E",scope:{videoUrl:"="},template:'<div class="form-group" ng-show="safeVideoUrl"><iframe width="100%" height="446" style="max-width:100%" ng-src="{{ safeVideoUrl }}" frameborder="0" allowfullscreen></iframe></div>',link:function(n,e,t){n.$watch("videoUrl",function(e){var t;e?((t=(t=e.match(/^(?:http(?:s)?:)?\/\/(?:www\.)?youtube.com\/watch\?v=([0-9a-z\-A-Z]*)/))||e.match(/^(?:http(?:s)?:)?\/\/(?:www\.)?youtu.be\/([0-9a-z\-A-Z_]*)/))&&(e="//www.youtube.com/embed/"+t[1]),n.safeVideoUrl=a.trustAsResourceUrl(e)):n.safeVideoUrl=e})}}}]),e.directive("videoLink",["$log",function(o){return{restrict:"A",require:"?ngModel",link:function(e,t,n,a){a?a.$validators.validVideoUrlFormat=function(e,t){e=(e=e||t||"").toLowerCase();return/^(http(s)?:)?\/\/player.vimeo.com\/video\/[0-9]+/.test(e)||/^(http(s)?:)?\/\/(www\.)?vimeo.com\/[0-9]+/.test(e)||/^(http(s)?:)?\/\/(www\.)?youtube.com\/watch\?v=[0-9a-z\-A-Z\_]+/.test(e)||/^(http(s)?:)?\/\/(www\.)?youtube.com\/embed\/[0-9a-z\-A-Z\_]+/.test(e)||/^(http(s)?:)?\/\/(www\.)?youtu.be\/[0-9a-z\-A-Z\_]+/.test(e)}:o.warning("No ngModel on video-link")}}}]),e.directive("editProjectSocial",["api","$timeout","User","patronicityConfig","$rootScope",function(s,c,l,u,d){return{restrict:"E",require:"^editManager",scope:{},templateUrl:"editProjectSocial.html",link:function(n,e,t,a){function o(){s.projectAdmin.loadSocial(a.ProjectId()).then(function(e){n.data=e,n.data.video=0<n.data.videos.length?{ID:n.data.videos[0].ID,URL:n.data.videos[0].URL}:{ID:"new",URL:""},n.data.zakat_category=void 0!==e.zakat_category&&""!==e.zakat_category?e.zakat_category:"Poor and Needy",l.get().then(function(){n.data.isAdmin=l.isAdmin()}),n.urlSaved=!0},function(e){alert("An error occurred: "+e)})}var i;function r(e){i&&(c.cancel(i),i=void 0);var t=a.ProjectId();i=c(function(){s.projectAdmin.saveSocial(t,n.data).then(function(e){n.data=e,n.data.video=0<n.data.videos.length?{ID:n.data.videos[0].ID,URL:n.data.videos[0].URL}:{ID:"new",URL:""},n.$emit("saved-project-data"),n.urlSaved=!0},function(e){alert("An error occurred: "+e)})},e?0:5e3)}n.application=u.applicationName,d.isZakatEligible=!1,d.invalidZakatSubmission=!1,n.urlSaved=!0,n.firstLoad=!0,n.urlCopied=!1,n.$on("field-lock-changed",function(e,t){s.projectAdmin.lockedField(a.ProjectId(),t.name,t.locked).then(function(e){o()},function(e){})}),n.selectNonprofitType=function(t){angular.forEach(n.data.non_profit,function(e){e.selected=e.id==t.id})},n.selectedNonprofitType=function(){var t="none";return n.data&&angular.forEach(n.data.non_profit,function(e){e.selected&&(t=e.id)}),"501c3"!=t&&"municipality"!=t||n.data.hasOwnProperty("company_address")||(n.data.company_address={Name:"",Address:"",Address2:"",City:"",State:"",Zip:"",Country:"US",ID:"new"}),t},a.Loaded()&&o(),n.delayedSave=function(){r(n.urlCopied=!1)},n.copyUrl=function(){n.urlCopied=!0},n.$on("edit-project-id-changed",function(e,t){o()}),n.$watch("data.zakat",function(e){d.isZakatEligible=!1,"1"==e&&(d.isZakatEligible=!0,n.data&&(e=!1,e=n.data.zakat_category&&n.data.zakat_funds_explanation?("Other"==n.data.zakat_category&&n.data.zakat_category_other_text,!0):e)||(d.invalidZakatSubmission=!0))}),n.$watch("data.zakat_category",function(e){d.invalidZakatSubmission=!1,!n.data||"1"!=n.data.zakat||e&&("Other"!=e||n.data.zakat_category_other_text)&&n.data.zakat_funds_explanation||(d.invalidZakatSubmission=!0)}),n.$watch("data.zakat_category_other_text",function(e){d.invalidZakatSubmission=!1,!n.data||"1"!=n.data.zakat||n.data.controls.zakat.locked||("Other"!=n.data.zakat_category||e)&&n.data.zakat_funds_explanation||(d.invalidZakatSubmission=!0)}),n.$watch("data.zakat_funds_explanation",function(e){d.invalidZakatSubmission=!1,!n.data||"1"!=n.data.zakat||n.data.controls.zakat.locked||e&&("Other"!=n.data.zakat_category||n.data.zakat_category_other_text)||(d.invalidZakatSubmission=!0)}),n.$on("save-panel",function(e,t){r(!0)}),n.$watch("data.custom_url",function(){n.firstLoad&&n.data&&n.data.custom_url?n.firstLoad=!1:n.urlSaved=!1})}}}]),e.directive("communityList",["$timeout","CommunityService","Dialogs","api","patronicityConfig",function(e,a,n,i,t){return{restrict:"E",scope:{communities:"=",disabled:"=?",project:"=",area:"@"},templateUrl:t.urlForTemplate("community-list.html"),link:function(o,e,t){o.removeCommunity=function(a){n.Confirm("Are you sure you want to remove "+a.name+" from this project?","Confirm Community Removal").then(function(e){var n=-1;angular.forEach(o.communities,function(e,t){e.id==a.id&&(n=t)}),0<=n&&o.communities.splice(n,1),i.community.saveMapCommunity(o.communities,o.project).then(function(e){},function(e){}),o.$emit("save-panel")})},o.editCommunity=function(e){a.Edit(e.id).then(function(e){console.log("edited community.")})},o.addCommunity=function(){var n=[];angular.forEach(o.communities,function(e,t){n.push(e.id)}),a.Add(n,o.project).then(function(t){"select"==t.verb?(o.communities.push({id:t.community.ID,imageSrc:t.community.ImageSrc,name:t.community.Name}),i.community.saveMapCommunity(o.communities,o.project).then(function(e){},function(e){}),o.$emit("save-panel")):"edit"==t.verb&&a.Edit(t.community).then(function(e){"save"==e.verb?(o.communities.push({id:t.community.ID,imageSrc:t.community.ImageSrc,name:t.community.Name}),o.$emit("save-panel")):e.verb})})}}}}]),e.directive("zakatEligibilityStatus",["api","$analytics","Dialogs",function(a,e,o){return{restrict:"E",scope:{projectId:"=?",status:"=",statusOptions:"="},templateUrl:"zakatStatusDropdown.html",link:function(n){n.menuOptions={isOpen:!1,isSaving:!1},n.textForStatus=function(){var t="";return n.menuOptions.isSaving?t="Saving...":angular.forEach(n.statusOptions,function(e){e.ID==n.status&&(t=e.label)}),t},n.changeStatus=function(t){n.menuOptions.isSaving=!0,void 0!==n.projectId&&("rejected"==t?o.SingleTextAreaEntry("Are you sure you want to reject this campaign from Zakat-verification? Please enter reason below. <b>NOTE: </b>This will send an email to the campaign creator.","Reject Zakat Status").then(function(e){n.saveNewStatus(t,e.textAreaEntry)},function(e){n.menuOptions.isSaving=!1}):"approved"==t?o.Confirm("Are you sure you want to approve this and mark as Zakat-verified? <b>NOTE: </b>This will send an email to the campaign creator.","Approve Zakat Status").then(function(e){n.saveNewStatus(t)},function(e){n.menuOptions.isSaving=!1}):n.saveNewStatus(t,""))},n.saveNewStatus=function(e,t){a.projectAdmin.zakatStatus(n.projectId,e,t).then(function(e){n.status=e.Status,n.menuOptions.isSaving=!1},function(e){o.Confirm(e,"Error",[{name:"OK",type:"ok"}]).then(function(){n.menuOptions.isSaving=!1})})}}}}])}(),angular.module("patronicity.project-admin.sections.sponsor",["patronicity.api","user"]).directive("sponsorForm",["api","Dialogs","$parse",function(o,r,s){return{restrict:"E",templateUrl:function(e,t){var n="sponsorFormDetails.html";return n=t.dashboard&&1==t.dashboard?"sponsorAdminFormDetails.html":n},scope:{projectId:"@"},link:function(i,e,t,n){i.forms=[],i.calcFields=[];var a=!(!t.dashboard||"1"!=t.dashboard);i.loadFormData=function(){o.sponsorForm(i.projectId,a).then(function(e){i.forms=e,angular.forEach(i.forms,function(t){t.definition&&(angular.forEach(t.definition.JSONFields,function(e){if("calc"===e.type&&i.calcFields.push(e),"select"===e.type&&"string"==typeof e.options){for(var t=e.options.split(",").map(function(e){return e.trim()}),n=[],a=0;a<t.length;a++){var o={};o.name=t[a],o.value=t[a],n.push(o)}e.options=n}}),o.projectByID(i.projectId).then(function(e){i.project=e,i.updateCalcField(t)}))})})},i.$watch("projectId",function(e){void 0!==e&&""!==e&&i.loadFormData()}),i.showFormAddon=function(e){var t=!1;if("undefined"!=e.calcPrefix&&1==e.calcPrefix||"calc"==e.type)return t=!0;if("undefined"==e.calcPrefix&&"hr"!==e.type&&"yesno"!==e.type)switch(e.name){case"region":case"square_feet":case"regionmap":case"source_private":case"source_city":case"source_state":case"source_federal":case"jobs_created":case"visitors":case"submit":case"jobs_created":case"project_type":case"contactname":case"contactphone":case"contactemail":case"mentions":case"mention_urls":t=!1;break;default:t=!0}return t},i.updateCalcField=function(n){n.project_goal=i.project.Goal,n.pledge_amount=i.project.PledgeAmount,angular.forEach(i.calcFields,function(e){var t=s(e.default);n.data[e.name]=t(n)}),delete n.project_goal},i.saveForms=function(){o.sponsorFormSave(i.projectId,i.forms).then(function(){r.Confirm("Form details saved!","Form Saved",[{name:"OK",type:"ok"}]).then(function(){})})}}}}]),function(){var e=angular.module("patronicity.project-admin.sections.your-story",["patronicity.api","user","ngSanitize","patronicity.configuration","patronicity.common.editor"]);e.directive("editProjectYourStory",["api","$sce","$timeout","$sentry","patronicityConfig","$rootScope",function(s,e,c,l,u,d){return{restrict:"E",require:"^editManager",scope:{version:"=?"},templateUrl:"editProjectYourStory.html",link:function(n,e,t,a){function o(){s.projectAdmin.loadYourStory(a.ProjectId()).then(function(e){n.data=e,n.data.body=n.data.revisions[0].body},function(e){l.log("An error occurred:"+e,"debug")})}var i;function r(e){i&&(c.cancel(i),i=void 0);var t=a.ProjectId();i=c(function(){s.projectAdmin.saveYourStory(t,n.data).then(function(e){o(),n.$emit("saved-project-data")},function(e){l.log("An error occurred:"+e,"debug")})},e?0:5e3),d.$broadcast("load-project-bar-data")}n.application=u.applicationName,n.$on("field-lock-changed",function(e,t){s.projectAdmin.lockedField(a.ProjectId(),t.name,t.locked).then(function(e){o()},function(e){})}),a.Loaded()&&o(),n.$on("pitch-edited",function(e,t){t.changed&&r(!0)}),n.$on("edit-project-id-changed",function(e,t){o()}),n.$on("save-panel",function(e,t){"1"==n.version&&r(!0)})}}}]),e.directive("projectDescription",["$uibModal","patronicityConfig",function(f,h){return{restrict:"E",scope:{isEditible:"=",html:"=",projectId:"=",disabled:"=",showCkeditor:"="},templateUrl:h.urlForTemplate("project-admin/project-description.html"),link:function(t,e,n){t.editing=!0;var g=document.getElementById("fc_frame");t.editPitch=function(e){g&&g.classList.add("lgx-shift-fc"),t.disabled||t.editing&&(f.open({templateUrl:"editPitchDialog.html",backdrop:"static",windowClass:"pitch-editor-modal",controller:["$scope","$uibModalInstance","html","imageUpload","projectID","disabled","showCkeditor","isEditible","$rootScope","$timeout",function(n,e,t,a,o,i,r,s,c,l){n.html=t,n.valid=m(t),n.projectId=o,n.showCkeditor=r,n.isEditible=s;var u=document.getElementsByClassName("ck-editor__top"),d=document.getElementsByClassName("ta-toolbar"),p=(l(function(){var e,t;n.isEditible||(e=document.getElementsByClassName("ck-editor__editable"),t=document.getElementsByClassName("ta-bind"),0<e.length&&(e[0].contentEditable="false"),0<t.length&&(t[0].contentEditable="false"),0<u.length&&(u[0].style.display="none"),0<d.length&&(d[0].style.display="none"))},200),n.application=h.applicationName,!1);function m(e){return!!angular.element(e).text().length}n.$on("editor-value-changed",function(){p=!0,n.valid=m(n.html)}),n.cancel=function(){e.dismiss(),g&&g.classList.remove("lgx-shift-fc")},n.save=function(){e.close({pitch:n.html,pitchChanged:p}),g&&g.classList.remove("lgx-shift-fc")},n.$watch("html",function(e,t){n.valid=m(e)}),n.showTips=function(){f.open({templateUrl:"pitchTips.html",size:"md",controller:["$scope","$uibModalInstance","User",function(e,t,n){e.application=n.getApplication(),e.cancel=function(){t.dismiss()}}]})},c.$on("editor-image-uploading-start",function(){n.valid=!1}),c.$on("editor-image-uploading-end",function(){n.valid=!0})}],resolve:{html:function(){return t.html},projectID:function(){return t.projectId},disabled:function(){return t.disabled},showCkeditor:function(){return t.showCkeditor},isEditible:function(){return t.isEditible}}}).result.then(function(e){t.html=e.pitch,t.$emit("pitch-edited",{pitch:e.pitch,changed:e.pitchChanged})},function(){}),e.preventDefault())}}}}])}(),angular.module("patronicity.project-admin.tabs.donors",["patronicity.api","ngTable","ui.bootstrap","user","patronicity.project-admin.edit-manager","patronicity.project-admin.donation-manager","patronicity.configuration"]).directive("projectDonorList",["$filter","api","NgTableParams","DonationManager","User","CampaignManager","$q",function(s,c,l,u,d,p,e){return{restrict:"E",require:"^editManager",templateUrl:"projectDonorList.html",link:function(n,e,t,a){function o(){n.loading=!0,n.downloadCSVURL="/api/projectreports/donors/"+a.ProjectId(),n.downloadVolunteerCSV="/api/projectreports/volunteers/"+a.ProjectId(),n.reports=[],c.projectAdmin.reports.campaignDonorReports(a.ProjectId()).then(function(e){n.reports=e}),c.projectAdmin.reports.donations(a.ProjectId()).then(function(e){var t;n.donations=e,angular.forEach(n.donations,function(e){e.Amount=parseFloat(e.Amount),e.AddedDate=new Date(e.AddedDate)}),t=[],angular.forEach(n.donations,function(e){t.push(e.ChargeError)}),e=t.filter(function(e,t,n){return t==n.indexOf(e)}),angular.forEach(e,function(e){e={name:e?e:"Only successful",value:e};n.chargeStatuses.push(e)}),n.loading=!1,n.tableParams.reload(),n.tableParams.page(1)})}function i(){c.projectAdmin.volunteers(a.ProjectId()).then(function(e){n.volunteerCount=e})}function r(){p.load("stats",a.Slug(),!0)}n.donations=[],n.chargeStatuses=[],n.chargeFilterOptions=[{name:"Only Successful",value:"success"},{name:"All Donations",value:"tableParams.filter({})"},{name:"Failed Donations",value:"failed"}],n.errorFilter="success",n.onlineFilterOptions=[{name:"All",value:"tableParams.filter({})"},{name:"Online",value:"online"},{name:"Offline",value:"offline"}],n.onlineFilter="tableParams.filter({})",n.anonymousFilterOptions=[{name:"All",value:"tableParams.filter({})"},{name:"Anonymous Donors",value:"yes"},{name:"Public Donors",value:"no"}],n.anonymousFilter="tableParams.filter({})",n.isAdmin=function(){return d.isAdmin()},n.application=function(){return d.getApplication()},n.$on("donation-changed",function(){r()}),n.changeErrorFilter=function(e){var t;"failed"===e?(t=[],angular.forEach(n.chargeStatuses,function(e){"Only successful"!==e.name&&t.push(e.value)}),n.tableParams.filter({$:t[0]})):"success"===e?n.tableParams.filter({$:null}):n.tableParams.filter({}),n.tableParams.reload(),n.tableParams.page(1)},n.changeOnlineFilter=function(e){"online"===e||"offline"===e?n.tableParams.filter({$:e}):n.tableParams.filter({}),n.tableParams.reload(),n.tableParams.page(1)},n.changeAnonymousFilter=function(e){"yes"===e?n.tableParams.filter({$:"Anonymous Donor"}):"no"===e?n.tableParams.filter({$:"Public Donor"}):n.tableParams.filter({}),n.tableParams.reload(),n.tableParams.page(1)},n.editDonation=function(e){u.edit(e.ID).then(function(e){r(),o()})},n.tableParams=new l({page:1,count:100,sorting:{AddedDate:"desc"}},{getData:function(e){var t=n.donations,t=e.filter()?s("filter")(t,e.filter()):t;return t=e.orderBy()?s("orderBy")(t,e.orderBy()):t,e.total(t.length),t=t.slice((e.page()-1)*e.count(),e.page()*e.count())}}),a.Loaded()&&(o(),i()),n.$on("reload-donations",function(){o()}),n.$on("edit-project-id-changed",function(e,t){o(),i()})}}}]),function(){var e=angular.module("patronicity.project-admin.tabs.edit",["ui.router"]);e.factory("ProjectTipsScrollBar",["$rootScope","$window","$timeout","patronicityConfig",function(e,t,n,a){var o,i=angular.element(t),r={projectTipsWrap:null,projectTipsBox:null,mainSectionForm:null};return"patronicity"===a.applicationName&&(e.$watchCollection(function(){return r},function(e,t){e&&e!==t&&n(function(){r.projectTipsWrap.css("height",r.mainSectionForm[0].offsetHeight-313),o=r.mainSectionForm[0].offsetHeight-313},2e3)}),i.on("scroll",function(e){550<=i.scrollTop()?r.projectTipsBox[0].classList.add("sticky-side-bar"):r.projectTipsBox[0].classList.remove("sticky-side-bar"),i.scrollTop()>=o+(550-r.projectTipsBox[0].offsetHeight)?(r.projectTipsBox[0].classList.remove("sticky-side-bar"),r.projectTipsBox[0].classList.add("max-scroll")):r.projectTipsBox[0].classList.remove("max-scroll")})),{registerProjectTipsWrap:function(e){r.projectTipsWrap=e},registerProjectTipsBox:function(e){r.projectTipsBox=e},registerMainForm:function(e){r.mainSectionForm=e}}}]),e.directive("editTab",["api","$state","$sce","$timeout","$window","patronicityConfig","$document","ProjectTipsScrollBar",function(e,s,c,l,u,n,d,p){return{restrict:"EA",require:"^editManager",templateUrl:"editTab.html",link:function(o,e,t,i){function a(n){var e,a;i.Loaded()&&(o.tabs=(e=i.Tabs(),a=[],angular.forEach(e,function(e){var t={id:e.id,status:e.status};switch(e.id){case"started":t.sref="campaign.edit.started",t.iconClass="glyphicon-star",t.title="Get Started";break;case"story":t.sref="campaign.edit.story",t.iconClass="glyphicon-sunglasses",t.title="Tell Your Story";break;case"levels":t.sref="campaign.edit.levels",t.iconClass="glyphicon-gift",t.title="Add Giving Levels",t.subtitle="patronicity"===o.application?"You can offer rewards for their support or simply show the impact of their donation.":"Add Giving Levels - Giving levels incentivize your supporters. You can offer rewards for their support or simply show the impact their donation has.";break;case"social":t.sref="campaign.edit.social",t.iconClass="glyphicon-equalizer",t.title="patronicity"===o.application?"Elevate":"Enhance";break;case"account":t.sref="campaign.edit.account",t.iconClass="glyphicon-download-alt",t.title="Payment Information",t.subtitle="";break;case"admin":t.sref="campaign.edit.admin",t.iconClass="glyphicon-equalizer",t.title="Admin";break;case"sponsor":t.sref="campaign.edit.sponsor",t.iconClass="glyphicon-equalizer",t.title="Sponsor Information"}a.push(t)}),a),angular.forEach(o.tabs,function(e,t){e.sref==n&&(o.currentTab={index:t,id:e.id,title:e.title,subtitle:c.trustAsHtml(e.subtitle),hasSaveAndNext:t!=o.tabs.length-1&&"admin"!==e.id&&"account"!==e.id&&"sponsor"!==e.id})}))}o.viewDetails={mobileView:"overview"},o.projectId=i.ProjectId(),o.application=n.applicationName,"patronicity"===o.application&&p.registerMainForm(angular.element(d[0].querySelector(".edit-detail")));var r=!1;o.saveAndNext=function(){r=!0,o.$broadcast("save-panel")},o.$on("saved-project-data",function(e,t){var n;i.validateTabs().then(function(e){a(s.current.name)}),r?((n=o.currentTab.index+1)<o.tabs.length&&(s.go(o.tabs[n].sref),u.scrollTo(0,0)),r=!1):(o.showSaved=!0,l(function(){o.showSaved=!1},2500))}),o.$on("$stateChangeSuccess",function(e,t){a(t.name)}),a(s.current.name),o.$on("edit-project-id-changed",function(e,t){a(s.current.name)}),o.setMobileView=function(e,t){o.viewDetails.mobileView=e,o.$broadcast("$stateChangeSuccess",{name:"edit."+t})}}}}]),e.directive("projectTipsBox",["$document","ProjectTipsScrollBar","$analytics",function(n,a,o){return{restrict:"E",templateUrl:"projectTipsBox.html",link:function(e,t){a.registerProjectTipsWrap(angular.element(n[0].querySelector("#project-tips-wrap"))),e.$watch(e.currentTab,function(){void 0===e.currentTab?a.registerProjectTipsBox(angular.element(n[0].querySelector(".project-tips-box-container.started"))):a.registerProjectTipsBox(angular.element(n[0].querySelector(".project-tips-box-container."+e.currentTab.id)))}),e.projectTipsOpenedEvent=function(){o.eventTrack("PEP Click",{category:"Getting Started Project Tips Open",label:e.currentTab.title})}}}}]),e.directive("editTabV2",["$rootScope",function(o){return{restrict:"EA",require:"^editManager",templateUrl:"editTab.html",link:function(t,e,n,a){o.$broadcast("hide-edit-bar",{hide:!0}),t.projectId=a.ProjectId(),o.backBtnDisabled=!1,o.nextBtnDisabled=!1,o.skip=!1,o.nextBtnLabel="Next",o.backBtnLabel="Back",o.btnPanel=!0,t.canSubmit=function(){return t.canSubmitForm="",t.$broadcast("can-create-project",{},function(e){t.canSubmitForm=e}),t.canSubmitForm},t.saveAndNext=function(){o.processing=!0,t.$broadcast("save-panel")},t.backToPrevious=function(){t.$broadcast("back-panel")},t.$on("cancel-save",function(e,t){o.processing=t.processing})}}}]),e.directive("projectEditVideoGuides",function(){return{restrict:"E",templateUrl:"pepSectionVideo.html"}})}(),function(){var e=angular.module("patronicity.project-admin.tabs.financial",["patronicity.api","ui.bootstrap","user","patronicity.project-admin.edit-manager","patronicity.project-admin.tabs.financial.bluesnap","patronicity.project-admin.tabs.financial.account"]);e.factory("stripeCheckoutScript",["$window","$q",function(e,t){var n="stripe-checkout-js-id",a="https://checkout.stripe.com/checkout.js",o=t.defer();return{load:function(){return document.getElementById(n)||((e=document.createElement("script")).id=n,e.src=a,e.addEventListener("load",function(e){o.resolve()}),document.body.appendChild(e)),o.promise;var e}}}]),e.directive("stripeCheckoutButton",["stripeCheckoutScript","User","$window","$parse",function(n,r,s,c){return{link:function(a,e,o){var t;function i(){var e={name:"launchgood"==r.getApplication()?"LaunchGood.com":"Patronicity.com",image:"https://stripe.com/img/documentation/checkout/marketplace.png",zipCode:!0,amount:1e3},t=a.$eval(o.amount);return e.amount=100*parseInt(t),e.currency=o.currencyCode,r.current()&&r.current().Email&&(e.email=r.current().Email),o.description&&(e.description=o.description),o.image&&(e.image=o.image),e}n.load().then(function(){t=StripeCheckout.configure({key:r.getPaymentProviderKey("stripe"),locale:"auto",token:function(e,t){var n=i();c(o.chargeComplete)({token:e,amount:n.amount/100,description:n.description},a)}})}),a.checkout=function(){return void 0!==t&&t.open(i()),!1},s.addEventListener("popstate",function(){void 0!==t&&t.close()})}}}]),e.directive("financialSelector",["patronicityConfig",function(e){return{restrict:"E",require:"^editManager",templateUrl:"financialSelector.html",scope:{},link:function(e,t,n,a){function o(){e.data.loading=!a.Loaded(),e.data.type=a.Loaded()?a.PaymentType():""}e.data={loading:!a.Loaded(),type:""},e.$on("edit-project-id-changed",function(e,t){o()}),o()}}}]),e.directive("projectFinancePage",["patronicityConfig",function(e){return{restrict:"E",require:"^editManager",templateUrl:"projectFinancePage.html",scope:{}}}]),e.directive("campaignStatusBlock",["api",function(e){return{restrict:"E",require:"^editManager",templateUrl:"campaignStatusBlock.html",scope:{},link:function(n,e,t,a){n.data={loading:!a.Loaded(),status:1},n.$on("edit-project-id-changed",function(e,t){n.data.loading=!a.Loaded(),n.data.type=a.PaymentType()})}}}]),e.directive("projectFinancialSummaryContainer",["api",function(e){return{restrict:"E",require:"^editManager",templateUrl:"projectFinancialSummaryContainer.html",scope:{},link:function(n,e,t,a){n.data={loading:!a.Loaded(),type:a.Loaded()?a.PaymentType():""},n.$on("edit-project-id-changed",function(e,t){n.data.loading=!a.Loaded(),n.data.type=a.PaymentType()})}}}]),e.directive("projectFinancialSummary",["api","Dialogs","$filter","patronicityConfig",function(c,l,a,u){return{restrict:"E",require:"^editManager",templateUrl:"projectFinancialSummary.html",scope:{},link:function(o,e,t,i){function n(){o.adjustment={Name:"",Amount:"",Type:"standard",ProjectId:i.ProjectId(),ID:"new"}}function r(){o.loading=!0,c.projectAdmin.reports.summary(i.ProjectId()).then(function(e){o.details=e;var e=a("number")(100*o.details.savings.cardProcessingPercent,1)+"%",t=(0<o.details.savings.cardProcessingUnit&&(e+=" + "+a("currency")(o.details.savings.cardProcessingUnit,o.details.general.currencySymbol)+" per transaction"),e+=" of total funds raised online",a("number")(100*o.details.savings.platformPercent,1)+"%");0<o.details.savings.platformUnit&&(t+=" + "+a("currency")(o.details.savings.platformUnit,o.details.general.currencySymbol)+" per transaction"),0<o.details.savings.offlinePlatformPercent||0<o.details.savings.offlinePlatformUnit?t+=" of total funds raised.":t+=" of online funds raised.",o.details.labels={cardFeeDescription:e,applicationFeeDescription:t},o.editingAdjustment=!1,n()},function(e){console.log("couldn't get financial summary details")}).finally(function(){o.loading=!1})}o.loading=!0,o.details={},o.editingAdjustment=!1,o.applicationName=u.applicationName,o.tip={ID:"new",Name:"Tip",Amount:0,Type:"tip",OtherAmount:""},o.saveFeeAdjustment=function(){c.projectAdmin.saveFeeAdjustment(o.adjustment.ProjectId,o.adjustment.Name,o.adjustment.Amount,o.adjustment.Type,o.adjustment.ID).then(function(e){r()},function(e){console.log("couldn't save fee adjustment")})};function s(e,t){return a("currency")(e,t)}o.editAdjustment=function(e){var t,n;o.adjustment={Name:e.name,Amount:(t=e.amount,n={amount:t,type:"charge"},t<0?(n.amount=Math.abs(t),n.type="charge"):(n.amount=-1*t,n.type="refund"),n.amount),Type:e.type,ProjectId:i.ProjectId(),ID:e.id},o.editingAdjustment=!0},o.canAddAdjustments=function(){return o.details&&o.details.canAddAdjustment},o.canAddTip=function(){return o.details&&o.details.canAddTip};o.deleteAdjustment=function(e){var t=null,n="adjustment",a=null,a=e.id?(t=e.id,e.amount):(t=e.ID,n="transfer",e.Amount);l.Confirm("Are you sure you want to delete this "+s(a,o.details.general.currencySymbol)+" "+n+"?","Delete "+((e=n).charAt(0).toUpperCase()+e.slice(1))).then(function(){c.projectAdmin.deleteFeeAdjustment(t,i.ProjectId()).then(function(){r()})})},o.cancelEdit=function(){o.editingAdjustment=!1,n()},o.rateCoach=function(){o.details.coachReview._reviewing||l.Confirm('Are you sure you want to give <b class="text-success">'+o.details.coachReview.Rating+' <i class="fa fa-fw fa-star"></i></b> rating to your coach?').then(function(){o.details.coachReview._reviewing=!0,c.projectAdmin.rateCoach(i.ProjectId(),o.details.coachReview.Rating,o.details.coachReview.Comments).then(function(e){o.details.coachReview=e},function(e){delete o.details.coachReview._reviewing,console.log("couldn't save rating")})})},o.addTip=function(){l.Confirm("Are you sure you want add a tip of "+s(o.tip.Amount,o.details.general.currencySymbol)+"?","Add Tip").then(function(){c.projectAdmin.saveFeeAdjustment(i.ProjectId(),o.tip.Name,o.tip.Amount,o.tip.Type,o.tip.ID).then(function(e){r()},function(e){console.log("couldn't save tip")})})},o.validTip=function(){var e=!1;return e=o.tip.Amount&&""!==o.tip.Amount&&0<o.tip.Amount?!0:e},o.tipOtherAmount=function(){o.setTipAmount(o.tip.OtherAmount)},o.setTipAmount=function(e){o.tip.Amount=e},o.tippedWithStripe=function(e,t,n){c.projectAdmin.tipCoach(i.ProjectId(),e,t).then(function(){r(),o.tip.Amount=0})},o.resetTip=function(){l.Confirm("Are you sure you want to reset the tip amount? You can enter another amount after resetting.","Reset Tip").then(function(){angular.forEach(o.details.tips.lines,function(e){c.projectAdmin.deleteFeeAdjustment(e.id,i.ProjectId(),"tip").then(function(){r()})})})},i.Loaded()&&r(),o.$on("reload-financial-data",function(e,t){r()}),o.$on("edit-project-id-changed",function(e,t){r()}),o.boostRowStyle=function(e){var t;return t=-1<e.toLowerCase().indexOf("earned")||-1<e.toLowerCase().indexOf("extra")?t:{"text-indent":"1em"}}}}}]),e.directive("givingBoostStats",["api",function(o){return{restrict:"E",require:"^editManager",templateUrl:"givingBoostStats.html",scope:{},link:function(n,e,t,a){n.data={loading:!a.Loaded(),type:a.Loaded()?a.PaymentType():"",open:!1,boosts:[]},o.projectAdmin.reports.givingBoost(a.ProjectId()).then(function(e){var t=[];angular.forEach(e,function(e){"9"==e.id&&t.push(e),"10"==e.id&&t.push(e)}),n.data.boosts=t}),n.boostRowStyle=function(e){var t;return t=-1<e.toLowerCase().indexOf("earned")||-1<e.toLowerCase().indexOf("extra")?t:{"text-indent":"1em"}}}}}]),e.directive("transferButton",["api","$uibModal","$filter","User",function(o,i,e,r){return{restrict:"E",require:"^editManager",template:'<button class="btn btn-default btn-xs" type="button" ng-click="showTransferModal()">{{label}}</button>',scope:{transfer:"="},link:function(t,e,n,a){t.label="Make Payment",t.transfer&&(t.label="Edit"),t.showTransferModal=function(){i.open({templateUrl:"transferButtonModal.html",controller:["$scope","$uibModalInstance","transfer",function(t,n,e){o.projectAdmin.loadAdjustmentList().then(function(e){t.PaymentMethods=e.transferPaymentMethods}),e?(console.log("Editing payment"),t.transfer=angular.copy(e)):(console.log("Creating new payment"),t.transfer={PaymentMethod:"bank",Name:"",Amount:null,Type:"transfer",ID:"new",ProcessedDate:new Date,AddedDate:new Date,ProjectID:a.ProjectId(),UserID:r.current().ID,Valid:!1}),t.error={message:null,duration:1e4,type:"error"},t.popupDate={opened:!1},t.dateOptions={formatYear:"yy",startingDay:1},t.openDate=function(e){e.preventDefault(),e.stopPropagation(),t.popupDate.opened=!0},t.format="MM/dd/yyyy",t.cancel=function(){n.dismiss()},t.ok=function(){n.close(!0)},t.saveTransfer=function(){o.projectAdmin.saveFeeAdjustment(t.transfer.ProjectID,t.transfer.Name,t.transfer.Amount,t.transfer.Type,t.transfer.ID,t.transfer.ProcessedDate,t.transfer.PaymentMethod).then(function(e){n.close(!0)},function(e){console.log("couldn't save transfer"),t.error.message="Transfer information could not be saved. Please ensure that the date and amounts are in the proper format, then try again."})}}],backdrop:"static",size:"md",resolve:{transfer:function(){return t.transfer}}}).result.then(function(e){t.$emit("reload-financial-data")})}}}}]),e.directive("paymentRequest",["api","$uibModal","$filter","User","Dialogs",function(i,a,e,t,r){return{restrict:"E",require:"^editManager",template:'<button class="btn btn-default btn-xs" type="button" ng-disabled="summary.requestButton" ng-click="showPaymentRequestModal()">{{label}}</button>',scope:{summary:"="},link:function(e,t,n,o){e.label="Request Payment",e.showPaymentRequestModal=function(){a.open({templateUrl:"paymentRequestModal.html",controller:["$scope","$uibModalInstance","summary",function(t,n,a){t.transferAmount=a.transfer.transferAmount,t.currencySymbol=a.general.currencySymbol,t.blueSnapID=a.BlueSnapAccountID,t.getPayPalInfo=function(){i.projectAdmin.paypalInfo.get({id:o.ProjectId()},function(e){t.paymentInfo=e})},t.getbankInfo=function(){i.projectAdmin.bankInfo.get({id:o.ProjectId()},function(e){t.bankInfo=e})},t.getbluesnapInfo=function(){i.projectAdmin.bluesnap.account.loadSection(t.blueSnapID,"bank").then(function(e){t.bluesnapInfo=e.bank})},"bluesnap"==a.PaymentType?t.getbluesnapInfo():(t.loading=!0,i.projectAdmin.accountOptions(a.countryCode,o.ProjectId()).then(function(e){t.options=e,"paypal"==t.options.selected?t.getPayPalInfo():"transfer"==t.options.selected&&t.getbankInfo()})),t.ok=function(){n.close(!0)},t.submitRequest=function(){var e={projectid:o.ProjectId(),requestNote:t.requestNote,totalAmount:a.transfer.transferAmount,coachEmail:a.manager.email,currencyCode:a.general.currencyCode};i.projectAdmin.sendPaymentRequest(e).then(function(e){n.close(!0),a.requestButton=!0,r.Confirm("Your request for payment has been submitted! We will be processing your payment request and someone from our team will reach out to you in 2-5 business days.","Request Payment",[{name:"Ok",type:"ok"}]).then(function(){},function(){})},function(e){})}}],size:"md",resolve:{summary:function(){return e.summary}}}).result.then(function(e){})}}}}]),e.directive("financialSavingsSummary",["patronicityConfig","$uibModal",function(n,a){return{restrict:"E",templateUrl:"financialSavingsSummary.html",scope:{savings:"=",currencyCode:"="},link:function(t){t.applicationName="patronicity"==n.applicationName?"Patronicity":"LaunchGood",t.showMoreInformation=function(e){e.preventDefault(),a.open({templateUrl:n.urlForTemplate("project-admin/tabs/financial/dialogs/savings-modal.html"),controller:["$scope","$uibModalInstance","data",function(e,t,n){e.savings=n.savings,e.currencyCode=n.currencyCode,e.applicationName=n.applicationName}],size:"md",resolve:{data:function(){return{savings:t.savings,applicationName:t.applicationName,currencyCode:t.currencyCode}}}}).result.then(function(e){})}}}}])}(),function(){var e=angular.module("patronicity.project-admin.tabs.financial.account",["patronicity.api","ui.bootstrap","user","patronicity.project-admin.edit-manager","patronicity.project-admin.tabs.financial.common"]);e.directive("accountFinanceCategoryBreakdown",function(){return{restrict:"E",scope:{data:"="},templateUrl:"accountFinanceCategoryBreakdown.html",link:function(e,t,n,a){e.boostRowStyle=function(e){var t;return t=-1<e.toLowerCase().indexOf("earned")||-1<e.toLowerCase().indexOf("extra")?t:{"text-indent":"1em"}}}}}),e.directive("accountFinancePayoutBreakdown",function(){return{restrict:"E",scope:{data:"="},templateUrl:"accountFinancePayoutBreakdown.html"}}),e.directive("accountFinancialReport",["api","patronicityConfig","$filter","User",function(o,e,i,r){return{restrict:"E",require:"^editManager",templateUrl:e.urlForTemplate("project-admin/tabs/financial/account.html"),scope:{},link:function(a,e,t,n){a.data={loading:!0,isAdmin:!1,accountId:n.AccountId(),projectId:n.ProjectId()},r.get().then(function(){a.data.isAdmin=r.isAdmin()}),a.data.loading=!0,o.projectAdmin.reports.summary(n.ProjectId()).then(function(e){var t,n;(a.data.details=e).savings?(t=i("number")(100*e.savings.cardProcessingPercent,1)+"%",0<e.savings.cardProcessingUnit&&(t+=" + "+i("moneyWithDecimal")(e.savings.cardProcessingUnit,a.data.details.currency)+" per transaction"),t+=" of total funds raised online",n=i("number")(100*e.savings.platformPercent,1)+"%",0<e.savings.platformUnit&&(n+=" + "+i("moneyWithDecimal")(e.savings.platformUnit,a.data.details.currency)+" per transaction"),0<e.savings.offlinePlatformPercent||0<e.savings.offlinePlatformUnit?n+=" of total funds raised.":n+=" of online funds raised.",a.data.labels={cardFeeDescription:t,applicationFeeDescription:n}):console.warn("Using new account version")},function(e){console.log("couldn't get financial summary details")}).finally(function(){a.data.loading=!1})}}}]),e.directive("accountTransfersSummary",["api","patronicityConfig","$timeout",function(o,e,i){return{restrict:"E",scope:{accountId:"@",projectId:"@?"},templateUrl:e.urlForTemplate("project-admin/tabs/financial/account-transfers-summary.html"),link:function(n){var a;n.data={loading:!0,title:"Loading"},n.$watch(function(){return n.accountId+"-"+n.projectId},function(e,t){e=(e||"").split("-");2==e.length&&0<parseInt(e[0])&&(a&&i.cancel(a),a=i(function(){n.data.loading=!0,n.data.title=n.projectId?"Payouts":"Transfers",o.projectAdmin.account.transfers(n.accountId,n.projectId).then(function(e){n.data.transfers=e.transfers},function(e){alert(e)}).finally(function(){n.data.loading=!1})},100))})}}}]),e.directive("accountDonationsSummary",["api","patronicityConfig",function(e,t){return{restrict:"E",scope:{accountId:"@",projectId:"@?"},templateUrl:t.urlForTemplate("project-admin/tabs/financial/account-donations-summary.html"),link:function(a){a.data=void 0,a.data=void 0,e.projectAdmin.account.donationSummary(a.accountId,a.projectId).then(function(e){var t,n;(a.data=e)&&e.reduced&&e.reduced.groups?(a.data.reduced.groups.forEach(function(e){"due_now"==e.type?t=e:"total_due"==e.type&&(n=e)}),t?a.data.outstanding=t:n&&(a.data.outstanding=n)):a.data.outstanding={settled_amount:0,approximate:!1,settled_currency:"USD"}},function(e){alert(e)})}}}])}(),function(){var e=angular.module("patronicity.project-admin.tabs.financial.bluesnap",["patronicity.api","ui.bootstrap","user","patronicity.project-admin.edit-manager","patronicity.project-admin.tabs.financial.common"]);e.directive("bluesnapCategoryBreakdown",function(){return{restrict:"E",scope:{data:"="},templateUrl:"bluesnapCategoryBreakdown.html"}}),e.directive("bluesnapPayoutBreakdown",function(){return{restrict:"E",scope:{data:"="},templateUrl:"bluesnapPayoutBreakdown.html"}}),e.directive("bluesnapFinancialReport",["api","patronicityConfig","$filter","User",function(o,e,i,r){return{restrict:"E",require:"^editManager",templateUrl:e.urlForTemplate("project-admin/tabs/financial/bluesnap.html"),scope:{},link:function(a,e,t,n){a.data={loading:!0,isAdmin:!1},r.get().then(function(){a.data.isAdmin=r.isAdmin()}),a.data.loading=!0,o.projectAdmin.reports.summary(n.ProjectId()).then(function(e){a.data.details=e;var t=i("number")(100*e.savings.cardProcessingPercent,1)+"%",n=(0<e.savings.cardProcessingUnit&&(t+=" + "+i("moneyWithDecimal")(e.savings.cardProcessingUnit,a.data.details.currency)+" per transaction"),t+=" of total funds raised online",i("number")(100*e.savings.platformPercent,1)+"%");0<e.savings.platformUnit&&(n+=" + "+i("moneyWithDecimal")(e.savings.platformUnit,a.data.details.currency)+" per transaction"),0<e.savings.offlinePlatformPercent||0<e.savings.offlinePlatformUnit?n+=" of total funds raised.":n+=" of online funds raised.",a.data.labels={cardFeeDescription:t,applicationFeeDescription:n}},function(e){console.log("couldn't get financial summary details")}).finally(function(){a.data.loading=!1})}}}])}(),function(){var e=angular.module("patronicity.project-admin.tabs.financial.common",["patronicity.api","ui.bootstrap","user","patronicity.project-admin.edit-manager"]);e.directive("amountInfo",function(){return{restrict:"E",scope:{isApproximate:"="},template:'<span ng-show="isApproximate" class="glyphicon glyphicon-exclamation-sign text-muted" uib-tooltip="This amount is approximate due to unsettled amounts and currency conversions."></span><span ng-hide="isApproximate" class="glyphicon glyphicon-exclamation-sign text-muted" style="color: transparent;"></span>'}}),e.filter("onlyNonZero",["$filter",function(e){return function(e){return Array.isArray(e)?e.filter(function(e){return 0<e.totals.count}):(console.log("Not an array!"),[])}}])}(),function(){var e=angular.module("patronicity.project-admin.tabs.insights",["ui.bootstrap","user","ngTable","googlechart"]);e.directive("insightsCustomMessage",["api",function(o){return{restrict:"E",require:"^editManager",templateUrl:"insightsCustomMessage.html",link:function(t,e,n,a){t.customMessage="",o.projectAdmin.getInsightsCustomMessage(a.ProjectId()).then(function(e){t.customMessage=e.InsightsCustomMessage},function(e){})}}}]),e.directive("insightsPage",["User",function(a){return{restrict:"E",templateUrl:"insightsPage.html",link:function(t,e,n){t.application=a.getApplication(),t.$on("user:login-change",function(e){t.application=a.getApplication()})}}}]),e.directive("insightsPageSourceStats",["api","NgTableParams","patronicityConfig","$filter",function(o,e,i,t){return{restrict:"E",require:"^editManager",scope:{},templateUrl:"insightsPageSourceStats.html",link:function(n,e,t,a){n.sourceStats=[],n.applicationName=i.applicationName,n.donationSourceStats=function(){o.projectAdmin.donationSourceStats(a.ProjectId()).then(function(e){n.total=e.total,n.data=e.stats,angular.forEach(n.data,function(e,t){0<e.details.length&&angular.forEach(e.details,function(e,t){e.referring_user_id?e.userStats=!0:e.userStats=!1,e.DonatedInCurrency&&(e.DonatedInCurrency=parseFloat(e.DonatedInCurrency),e.total_donations=parseInt(e.total_donations)),n.sourceStats.push(e)})})})},n.donationSourceStats()}}}]).directive("expand",function(){return{link:function(e,t,n){}}}),e.directive("insightsBoostStats",["api","patronicityConfig",function(a,e){return{restrict:"E",require:"^editManager",scope:{},templateUrl:"insightsPageBoostStats.html",link:function(s,e,t,n){s.boostDetails=[],a.projectAdmin.givingBoosts(n.ProjectId()).then(function(e){s.boosts=e.boosts,s.boostDetails=[],s.ramadanBoostTotalWithExtra=0;for(var t=s.dhulhijjaBoostTotalWithExtras=0;t<s.boosts.length;t++){s.boostDetails[t]=[];var n=s.boosts[t];if(n.name&&"Friday Givers"==n.name)s.boostDetails.push({name:"Friday Givers",amount:n.amount});else for(var a=Object.keys(n),o=0;o<a.length;o++)if(a[o].includes("_boosts")){for(var i=Object.keys(n[a[o]]),r=s.boosts[t].boostTotalWithExtra=0;r<i.length;r++)s.boosts[t].details=t,i[r].includes("Earned")&&i[r].includes("Boost")?(s.boosts[t].boostTotal=n[a[o]][i[r]],s.boosts[t].boostTotalWithExtra+=n[a[o]][i[r]]):i[r].includes("Extra")&&i[r].includes("Boost")?(s.boosts[t].boostTotalWithExtra+=n[a[o]][i[r]],s.boostDetails[t].push({name:"Extra Donations Boosts",amount:n[a[o]][i[r]]})):s.boostDetails[t].push({name:i[r],amount:n[a[o]][i[r]]});break}}console.log(s.boosts)}),s.getDetails=function(e){return s.boostDetails[e]}}}}]),e.directive("ngTableGroupDetail",["User","NgTableParams","$filter",function(e,a,o){return{restrict:"E",scope:{detail:"="},templateUrl:"ngTableGroupDetail.html",link:function(n,e,t){n.tableParams=new a({sorting:{DonatedInCurrency:"desc"}},{counts:[],getData:function(e){var t=n.detail,t=e.orderBy()?o("orderBy")(t,e.orderBy()):t;return n.list=t,n.list}})}}}]),e.directive("campaignDonationChart",["api",function(o){return{restrict:"E",require:"^editManager",scope:{},template:'<button ng-click="toggleOffline()" class="btn btn-primary"><span ng-if="showOffline">Hide Offline</span><span ng-if="!showOffline">Show Offline</span></button><div google-chart chart="newCampaignsChartObject" style="height:600px; width:100%;"></div><br>',link:function(t,e,n,a){t.showOffline=!0,t.dateRange={start:"2014-01-01",end:"2050-12-31"},t.newCampaignsChartObject={},t.newCampaignsChartObject.type="ColumnChart",t.newCampaignsChartObject.options={title:"Donations per month",displayAnnotations:!0,isStacked:!0},t.reloadData=function(){o.projectAdmin.donationChart(a.ProjectId(),t.showOffline,t.dateRange.start,t.dateRange.end).then(function(e){t.newCampaignsChartObject.data=e})},t.reloadData(),t.toggleOffline=function(){t.showOffline?t.showOffline=!1:t.showOffline=!0,t.reloadData()}}}}])}(),function(){var e=angular.module("patronicity.project-admin.tabs.resources",["patronicity.api","ui.bootstrap","user"]);e.directive("resourcePage",["api","User","$analytics","patronicityConfig","moment",function(o,i,r,s,c){return{restrict:"E",require:"^editManager",templateUrl:function(e,t){var n="resourcePage.html";return n=void 0!==t.templateUrl?t.templateUrl:n},link:function(t,e,n,a){"patronicity"==s.applicationName&&r.eventTrack("SPA Page View",{category:"PEP Tab View",label:"Resource Tab"}),t.sponsorResources=!1,t.teamLinkEditing=!1,t.challengeTeam={ID:"new",Name:"",ChallengeID:void 0,ProjectID:a.ProjectId(),UserID:void 0},t.shareData={subject:"",message:"",title:"",slug:""},t.referralProgramEnded=!1,i.get().then(function(){i.isLoggedIn()&&(t.challengeTeam.UserID=i.current().ID)}),o.projectAdmin.sponsorResources(a.ProjectId()).then(function(e){t.sections=e,t.sections&&(t.sponsorResources=!0)}),t.load=function(){o.projectAdmin.loadChallengeTeam(a.ProjectId(),t.friendApiLimit).then(function(e){e.challengeTeam&&e.challengeTeam.Slug&&null!=e.challengeTeam.Slug?(t.challengeTeam=e.challengeTeam,t.teamLinkEditing=!1):t.teamLinkEditing=!0,e.challenge&&(t.challengeTeam.ChallengeID=e.challenge.ID),t.shareData=e.shareData,t.shareData.teamName=e.challengeTeam.Name,t.CreateShareMessage(e.shareData)},function(e){})},t.load(),t.save=function(){o.projectAdmin.saveChallengeTeam(t.challengeTeam).then(function(e){t.teamLinkEditing=!1,t.load(!1)},function(e){console.log("Save failed: "+e),t.messageText=e})},t.CreateShareMessage=function(e){t.shareData.subject="We'll receive $100 USD per person that joins!",t.shareData.message="Salam! If you join the LaunchGood Ramadan Challenge by scheduling your giving through our team link, our campaign will receive $100 USD per person that joins by March 23rd:     "+e.teamLink+"   Yep. $100. And all you have to do is sign up to give during the best month of the year.  Can't make the March 23rd date? We will continue earning $50 for each sign-up between March 24th and April 8th so there's still time for you to schedule your giving after Ramadan starts!"},t.sendPDFViewEvent=function(e){"patronicity"==s.applicationName&&r.eventTrack("Resource Download",{category:"PEP Resource Page Link Click",label:e.currentTarget.innerText})};t.hasReferralProgramEnded=function(){"2022-07-06T00:00:00.000Z"<=(new c).toISOString()&&(t.referralProgramEnded=!0)},t.hasReferralProgramEnded()}}}]),e.directive("teamInviteFriends",["api","patronicityConfig","moment",function(o,e,t){return{restrict:"E",require:"^editManager",templateUrl:e.urlForTemplate("team-invite-friends.html"),scope:{startDate:"<",endDate:"<"},link:function(t,e,n,a){t.friendApiLimit=1e5,t.friendCounts=0,t.friendApiMore=1e3,t.load=function(e){t.friendCounts>t.friendApiLimit&&e&&(t.friendApiLimit=t.friendApiLimit+t.friendApiMore),console.log("load teamInviteFriends",a.ProjectId(),t.startDate,t.endDate),o.projectAdmin.teamInvited(a.ProjectId(),t.friendApiLimit,t.startDate,t.endDate).then(function(e){e.friends&&(t.friendCounts=e.friends.counts,t.friendEarned=e.friends.earned,t.friends=e.friends.list)},function(e){})},t.viewMore=function(){t.load(!0)},t.load(!1),t.friendList=!1,t.toggleFriendList=function(){t.friendList=!t.friendList}}}}]),e.directive("teamSignupLeaderboard",["api","patronicityConfig","moment",function(o,e,i){return{restrict:"E",templateUrl:e.urlForTemplate("team-signup-leaderboard.html"),scope:{startDate:"<",endDate:"<"},link:function(t,e,n){t.leaderboardApiLimit=5,t.leaderboardCounts=0,t.leaderboardApiMore=5;var a=new i(t.endDate);t.endMs=a.valueOf(),t.load=function(e){t.teamSignup=!0,t.leaderboardCounts>t.leaderboardApiLimit&&e&&(t.leaderboardApiLimit=t.leaderboardApiLimit+t.leaderboardApiMore),o.projectAdmin.teamSignupLeaderboard(t.startDate,t.endDate,t.leaderboardApiLimit).then(function(e){t.teams=e.list,t.currentUser=e.currentUser,t.leaderboardCounts=e.total,t.teamSignup=!1},function(e){})},t.viewMore=function(){t.load(!0)},t.load(!1),t.contestOver=function(){var e=i.utc();return a<e}}}}])}(),function(){var e=angular.module("patronicity.project-admin.tabs.view",["patronicity.api","user","patronicity.configuration"]);e.directive("projectCommunityView",["patronicityConfig",function(e){return{restrict:"E",scope:{community:"="},templateUrl:function(){return"launchgood"==e.applicationName?"projectCommunityLaunchgood.html":"projectCommunityPatronicity.html"}}}]),e.directive("projectRewardView",["$rootScope","patronicityConfig",function(t,e){return{restrict:"E",scope:{reward:"=",projectId:"@",currencySymbol:"@",currencyCode:"@"},templateUrl:function(){return"launchgood"==e.applicationName?"projectRewardLaunchgood.html":"projectRewardPatronicity.html"},link:function(e){e.selected=function(){t.$broadcast("project:reward-selected",{ProjectID:e.projectId,RewardID:e.reward.ID})}}}}]),e.directive("projectCarouselView",[function(){return{restrict:"E",scope:{carousel:"="},templateUrl:"projectCarouselView.html",link:function(e,t,n){e.params={active:0}}}}]),e.directive("projectDonor",["patronicityConfig",function(e){return{restrict:"E",scope:{donor:"="},templateUrl:"projectDonor.html"}}]),e.directive("projectTimeline",["api","User",function(n,e){return{restrict:"E",scope:{timeline:"=",projectId:"@",socialLinks:"="},templateUrl:"projectTimeline.html",link:function(o,e,t){o.data={story:[],updates:[],donors:{loaded:!1,loading:!1,total:0,donors:[]}},o.$watch("timeline",function(e){var t,n=[],a=[];void 0!==e&&(t=e.editable,angular.forEach(e.items,function(e){("pitch"==e.type?(e.editable=t,n):(e.editable=t,a)).push(e)})),o.data.story=n,o.data.updates=a}),o.selectedDonors=function(){o.data.donors.loaded||(o.data.donors.loading=!0,n.project.donors(o.projectId,0).then(function(e){o.data.donors.donors=e.donors,o.data.donors.total=e.count,o.data.donors.loading=!1}))},o.loadMore=function(){var e;o.data.donors.donors.length&&(e=o.data.donors.donors[o.data.donors.donors.length-1].ID,o.data.donors.loading=!0,n.project.donors(o.projectId,e).then(function(e){angular.forEach(e.donors,function(e){o.data.donors.donors.push(e)}),o.data.donors.loading=!1}))}}}}]),e.directive("projectUpdate",["$uibModal","patronicityConfig","api",function(t,n,o){return{restrict:"E",template:'<button ng-click="openEditModal()" class="btn btn-primary btn-sm">{{label}}</button>',$scope:{entry:"=",projectId:"="},link:function(e){e.label="Edit",e.openEditModal=function(){t.open({templateUrl:n.urlForTemplate("project/project-update.html"),controller:["$scope","$uibModalInstance","entry","projectId",function(t,n,e,a){console.log("Editing project update"),o.projectAdmin.loadUpdate(a,e.id).then(function(e){console.log("Loading project update"),t.editUpdate=angular.copy(e),t.checkbox={sendUpdate:!!(1&t.editUpdate.Flags)},t.typeDescription="Select Type...",console.log("Loading types..."),o.projectAdmin.types(a).then(function(e){console.log(e),t.possibleTypes=e,t.typeChanged()})}),t.typeChanged=function(){t.possibleTypes.forEach(function(e){e.id==t.editUpdate.Type&&(t.typeDescription=e.description)})},t.changeSendUpdate=function(){t.checkbox.sendUpdate?t.editUpdate.Flags|=1:t.editUpdate.Flags&=-2},t.save=function(){console.log("Saving project update"),o.projectAdmin.saveUpdate(a,t.editUpdate).then(function(e){angular.copy(e,t.editUpdate),console.log("update saved, requesting reload"),n.close({})})},t.cancel=function(){n.dismiss({})}}],size:"md",resolve:{entry:function(){return e.entry},projectId:function(){return e.projectId}}})}}}}]),e.directive("pressUpdate",["$uibModal","patronicityConfig","api","$window",function(t,o,i,r){return{restrict:"E",template:'<button ng-click="openEditModal()" class="btn btn-primary btn-sm">{{label}}</button>',scope:{id:"=",projectId:"="},link:function(e){e.label="Edit",e.openEditModal=function(){t.open({templateUrl:o.urlForTemplate("newadmin/press-edit.html"),controller:["$scope","$uibModalInstance","id","projectId",function(t,n,e,a){t.id=e,t.projectId=a,console.log("Editing press"),t.applicationName="launchgood"==o.applicationName?"Launchgood":"Patronicity","Patronicity"==t.applicationName?t.placeholders={url:"e.g. https://www.fastcompany.com/40404791/combining-crowdfunding-and-place-making-to-help-communities-improve-themselves",headline:"Combining Crowdfunding And Place-Making To Help Communities Improve Themselves",outlet_name:"Fast Company",description:"Our company was featured in Fast Company",image_url:"https://cdn.worldvectorlogo.com/logos/fast-company-1.svg"}:t.placeholders={url:"http://www.cnn.com/2015/07/08/us/muslims-help-southern-black-churches-irpt/index.html",headline:"Muslims raise funds to rebuild burned black churches",outlet_name:"CNN",description:"Our company was featured on CNN",image_url:"http://www.cnn.com/image.jpg"},t.adminEdit=!1,t.projectDetails={},t.FlagDetails=[],i.projectAdmin.getPress(t.id,t.projectId).then(function(e){console.log("Get Project"),t.press=e,t.editPress=angular.copy(t.press),console.log("ContentDate: "+t.editPress.ContentDate),1&t.editPress.Flags?t.FlagDetails.Active="1":t.FlagDetails.Active="0",2&t.editPress.Flags?t.FlagDetails.Featured="1":t.FlagDetails.Featured="0",t.editPress.ProjectId?(i.projectAdmin.getProjectImage(t.editPress.ProjectId).then(function(e){console.log("Get Project url"),t.projectDetails.projectImage=e.image}),i.projectAdmin.getProject(t.editPress.ProjectId).then(function(e){console.log("Get Project info"),t.projectDetails.project=e.project})):(console.log("ProjectId does not exist"),t.projectDetails.projectImage=null,t.projectDetails.project=null)}),t.preSave=function(){!function(){if(t.editPress.Url.startsWith("http://")||t.editPress.Url.startsWith("https://")){if(t.editPress.ImageUrl.startsWith("http://")||t.editPress.ImageUrl.startsWith("https://"))return console.log("Validation passed."),1;t.messageText="Image Url must start with - http:// or https://"}else t.messageText="URL must start with - http:// or https://";return console.log("Validation failed: "+t.messageText),0}()||(console.log("Saving..."),"1"==t.FlagDetails.Active?t.editPress.Flags|=1:t.editPress.Flags&=-2,"1"==t.FlagDetails.Featured?t.editPress.Flags|=2:t.editPress.Flags&=-3,"new"==t.editPress.ID&&(t.editPress.Type="press"),i.projectAdmin.savePress(t.editPress).then(function(e){console.log("Save complete."),angular.copy(e,t.editPress),console.log("new press so requesting reload"),n.close({})}))},t.displayProject=function(){r.open("/project/"+t.projectDetails.project.Slug,"_blank")},t.cancel=function(){n.dismiss({})}}],size:"md",resolve:{id:function(){return e.id},projectId:function(){return e.projectId}}})}}}}]),e.directive("projectView",["patronicityConfig","api","$sce","$stateParams",function(o,i,r,e){return{restrict:"E",require:"^editManager",scope:{},templateUrl:o.urlForTemplate("project/view.html"),link:function(n,e,t,a){n.slug=a.projectSlug(),n.isLaunchgood=function(){return"launchgood"==o.applicationName},n.loaded=!1,n.isPatronicity=function(){return"patronicity"==o.applicationName},i.project.view(n.slug).then(function(e){!0===n.isPatronicity()&&1<e.Sponsors.length&&(e.Sponsors=e.Sponsors.filter(function(e){return 11!=e.id})),n.project=e,n.loaded=!0,n.project.GoogleMapEmbedSrc=r.trustAsResourceUrl(n.project.GoogleMapEmbedSrc);for(var t=0;t<n.project.Carousel.length;t++)n.project.Carousel[t].IsImage||(n.project.Carousel[t].URL=r.trustAsResourceUrl(n.project.Carousel[t].URL));i.project.rewards(n.project.ID).then(function(e){n.project.Rewards=e})}),i.project.timeline(n.slug).then(function(e){n.timeline=e})}}}]),e.directive("projectStatsPanel",["api","patronicityConfig",function(a,e){return{restrict:"E",templateUrl:e.urlForTemplate("project-stats-panel.html"),scope:{projectId:"@"},link:function(t,e,n){t.loading=!0,t.stats={},t.$watch("projectId",function(e){void 0!==e&&""!==e&&a.project.statsPanel(e).then(function(e){t.stats=e,t.stats.sponsor&&""!=t.stats.sponsor.imageUrl&&(t.stats.sponsor.imageUrl=!(e=t.stats.sponsor.imageUrl)||-1===e.indexOf("https:")&&-1===e.indexOf("http:")?"//media.launchgood.com/06bc2411f7284f2a6f474e36ab2b263173b8c480/"+e:e),t.loading=!1},function(e){})})}}}]),e.directive("projectSupportBanner",["api","patronicityConfig",function(a,e){return{restrict:"E",templateUrl:e.urlForTemplate("project-support-banner.html"),scope:{projectId:"@",type:"@"},link:function(t,e,n){t.loading=!0,t.userSupportStats={},t.$watch("projectId",function(e){void 0!==e&&""!==e&&a.user.donationInfo(e).then(function(e){t.userSupportStats=e})})}}}]),e.directive("projectSupportBonusBanner",["patronicityConfig",function(e){return{restrict:"E",templateUrl:e.urlForTemplate("project-support-bonus-banner.html"),scope:{project:"=",currencySymbol:"@"},link:function(e,t,n){e.projectCurrencySymbol="$",e.project?e.projectCurrencySymbol=e.project.CurrencySymbol:e.projectCurrencySymbol=e.currencySymbol}}}]),e.directive("volunteerOptInForm",["$uibModal","patronicityConfig","api",function(t,n,a){return{restrict:"E",template:'<button ng-click="openFormModal()" style="width: 100%; margin-bottom: 25px;" class="btn btn-primary btn-lg">Volunteer</button>',scope:{projectId:"@"},link:function(e){console.log("link: "+e.projectId),e.openFormModal=function(){t.open({templateUrl:n.urlForTemplate("volunteer-opt-in-modal.html"),scope:e,controller:["$scope","$uibModalInstance",function(t,n){t.processing=!1,console.log("modal: "+t.projectId),t.cancel=function(){n.close()},t.ok=function(){!t.processing&&function(){var e=!1;0<t.volunteerInfo.name.length&&function(e){return/^(([^<>()[\]\\.,;:\s@\"]+(\.[^<>()[\]\\.,;:\s@\"]+)*)|(\".+\"))@((\[[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\])|(([a-zA-Z\-0-9]+\.)+[a-zA-Z]{2,}))$/.test(e)}(t.volunteerInfo.email)&&(e=!0);return e}()&&(t.processing=!0,a.project.volunteerOptIn(t.projectId,t.volunteerInfo.name,t.volunteerInfo.email).then(function(e){n.close()},function(e){t.processing=!1,alert(e)}))}}],resolve:{projectId:function(){return e.projectId}}})}}}}]),e.directive("googleTranslatePt",function(){return{link:function(e,t){var n;t=t,(n=angular.element(document.createElement("script"))).attr("src","//translate.google.com/translate_a/element.js?cb=googleTranslateElementInit"),t.append(n)}}})}(),function(){var e=angular.module("patronicity.project-admin.unified-payment-method",["patronicity.api","ui.bootstrap","user","mv.upload.button","mv.widgets","patronicity.configuration","patronicity.project-admin.account-providers.wepay-payment-method","patronicity.project-admin.account-providers.bluesnap-payment-method","patronicity.project-admin.account-providers.internal"]);e.directive("paymentProjectLoader",function(){return{restrict:"E",require:"^editManager",scope:!0,link:function(e,t,n,a){e.data={id:a.ProjectId(),type:"project"}}}}),e.directive("communityAccountLoader",["$stateParams","api",function(a,o){return{restrict:"E",scope:!0,link:function(t,e,n){n=a.slug||n.slug;o.communityPage.communityDetailBySlug(n).then(function(e){t.data={id:e.sponsor_id,type:"community"}},function(e){})}}}]),e.directive("unifiedPaymentMethod",["User","api","patronicityConfig","mvCountryLoader",function(e,r,t,s){return{restrict:"E",scope:{type:"@",projectOrCommunityId:"@"},templateUrl:t.urlForTemplate("project-admin/sections/unified-payment-method.html"),link:function(n){n.data={loading:!0,showPaymentForm:!0,isAdmin:!1,sponsorName:"",countryCode:"",paymentType:"",showCountrySelector:!0,lockCountryField:!1};var t=[];function a(){n.data.loading=!0,r.projectAdmin.projectInfoForPaymentPage(n.projectOrCommunityId,n.type).then(function(e){e.Country&&(n.data.countryCode=e.Country),n.data.showCountrySelector=!e.LockCountryField,n.data.lockCountryField=e.LockCountryField,n.data.showPaymentForm=e.ShowPaymentForm,n.data.sponsorName=e.SponsorName,n.data.CanEditAccount=e.CanEditAccount,n.data.ID=e.ID,n.data.ThisUserHasWepayAccount=e.ThisUserHasWepayAccount,n.data.sanctionedCountryCode=o(n.data.countryCode),i()},function(){console.log("failed loading project details")}).finally(function(){n.data.loading=!1})}function o(e){return 0<=t.indexOf(e)}function i(){""!=n.data.countryCode&&(n.data.loadingAccountInfo=!0,n.data.showPreviousAccountInvalid=!1,r.projectAdmin.decideTypeOfAccountPanelToShow(n.projectOrCommunityId,n.type,n.data.countryCode).then(function(e){n.data.loadingAccountInfo=!1,n.data.panel_to_show=e.panel,n.data.showPreviousAccountInvalid=e.showPreviousAccountInvalid}))}r.project.bannedCountryCodes().then(function(e){t=e,a()}).catch(function(){}),n.countries=[],s.then(function(e){var t=[];e.forEach(function(e){t.push(e)}),n.countries=t}),e.get().then(function(){n.data.isAdmin=e.isAdmin()}),n.changedCountry=function(){n.data.sanctionedCountryCode=o(n.data.countryCode),i()},n.$on("payment-info-saved",function(){console.log("payment info saved"),n.$emit("saved-project-data"),n.data.flashalert={type:"success",message:"Payment information saved!",duration:5e3},a()})}}}])}(),function(){var e=angular.module("patronicity.projectcards",["ui.bootstrap","patronicity.api","ksSwiper","user","patronicity.geo","patronicity.configuration"]);e.factory("searchApi",["$sce","$http","$q","api","User",function(e,c,t,l,u){var d=["discovery"];function n(i,r,s){return t(function(a,o){u.get().then(function(){var e=u.getApplication(),t=u.getEnvironment();if(!(0<=d.indexOf(i.type)))return l.Cards.query(i,a,o);var n="https://search."+e+".com/v2/"+(0<=["production","staging"].indexOf(t="staging"==t?"production":t)?"production":"development");i.src=e+"-"+t,i.docType&&(i.src+="-"+i.docType,delete i.docType),c.get(n,{params:i,responseType:"json"}).then(function(e){a(!r||s?e.data:e.data.projects)},function(e,t,n,a){o(e,t,n,a)})},o)})}return{searchLegacy:function(e,t){return n(e,!0,t)},search:function(e){return n(e,!1)},getTotalElasticSearchActiveDocuments:function(){return t(function(t,e){n({type:"discovery",limit:"1"}).then(function(e){e&&e.total_hits&&e.total_hits.value&&t(e.total_hits.value)})})}}}]),e.directive("homepageProjectCards",["api","User","ProjectCardManager","searchApi",function(a,r,s,c){return{restrict:"E",scope:{defaultType:"@",src:"@",listId:"=?"},templateUrl:"homepageProjectCards.html",link:function(o,e,t){o.cards={query:{type:void 0,listID:void 0,limit:21,offset:0,randomize:t.randomize||0},cards:[],slides:[],friends_available:r.loggedIn()},o.sponsors={},r.get().then(function(){o.application=r.getApplication(),"patronicity"==o.application&&a.sponsors().then(function(e){o.sponsors=e})}),o.states={},a.projectStates().then(function(e){o.states=e});var i=!1;function n(){o.cards.loading=!0,c.searchLegacy(o.cards.query).then(function(e){angular.forEach(e,function(e){o.cards.cards.push(e)});for(var t=[],n=0,a=0;a<o.cards.cards.length;a++)void 0===t[n]&&(t[n]=[]),t[n].push(o.cards.cards[a]),3==t[n].length&&n++;o.cards.slides=t,o.cards.loading=!1,o.showLoadMore=i&&e.length==o.cards.query.limit},function(e){console.log("Failure: "+e)})}o.$on("user:login-change",function(e,t){o.cards.friends_available=t.loggedIn}),s.setSource(o.src),o.setType=function(e,t){if(e!=o.cards.query.type||(t||null)!=o.cards.query.param1){switch(e){case"featured":o.cards.filterType="Featured";break;case"trending":o.cards.filterType="Trending";break;case"almost_funded":o.cards.filterType="Almost Funded";break;case"ending_soon":o.cards.filterType="Ending Soon";break;case"friends":o.cards.filterType="Friends";break;case"most_funded":o.cards.filterType="Most Fudned";break;case"sponsored_by":o.cards.filterType="Sponsored";break;case"live":o.cards.filterType="Live";break;case"customList":o.cards.filterType="customList",o.cards.query.listID=o.listId}o.cards.query.type=e,o.cards.query.offset=0,o.cards.query.param1=t||null,o.cards.cards=[],n()}},o.nearMe=function(e){console.log("near me in cards controller"),e.havePosition&&o.setType("near_me",e.coords.latitude+","+e.coords.longitude)},o.nextPage=function(){o.cards.query.offset+=o.cards.query.limit,n()},o.prevPage=function(){o.cards.query.offset-=o.cards.query.limit,o.cards.query.offset<0&&(o.cards.query.offset=0),n()},i=void 0!==t.showLoadMore&&"0"!==t.showLoadMore&&"false"!==t.showLoadMore,o.setType(t.defaultType||"featured")}}}]),e.directive("projectCardGridDisplay",["patronicityConfig",function(e){return{restrict:"E",scope:{cards:"=",actionButtonType:"@",display:"=?"},templateUrl:e.urlForTemplate("project-card-grid-display.html"),link:function(i){i.count=0,i.slide=function(e){var t,n,a=angular.element(document).find(".cc-grid_cards"),a=a?a.width():0,o=$(".cc-grid_cards > div")?$(".cc-grid_cards > div").outerWidth(!0):0;0<a&&0<o&&(a=Math.floor(a/o),o=i.cards.length,t=$(".cc-grid_cards").scrollLeft(),n=null,"right"==e?i.count<o-a?(i.count=i.count+a,n=$(".cc-grid_cards > div").eq(i.count),$(".cc-grid_cards").stop(!0,!0).animate({scrollLeft:n.position().left+t},500)):(i.count=0,$(".cc-grid_cards").stop(!0,!0).animate({scrollLeft:0},500)):0<i.count&&(i.count=i.count-a,n=$(".cc-grid_cards > div").eq(i.count),$(".cc-grid_cards").stop(!0,!0).animate({scrollLeft:n.position().left+t},500)))}}}}]),e.directive("projectCardGrid",["$compile","$stateParams","$window","api","User","patronicityConfig","ProjectCardManager","searchApi",function(r,s,c,l,u,d,p,m){return{restrict:"E",scope:{page:"@",userProfile:"=?",publicProfilePage:"=?",defaultType:"@",category:"=?",type:"=?",stateType:"=?",listId:"=?",param1:"=?",src:"@",display:"@",projectCardGridData:"=",discoverFilters:"=",q:"=",ignoredCampaigns:"=?"},link:function(o,e,t){var n;n="givelist"===o.page?d.urlForTemplate("project-wide-club-cards-grid.html"):d.urlForTemplate("project-card-grid.html"),e.append(r("<ng-include src=\"'"+n+"'\"></ng-include>")(o)),o.isDiscoverPage=-1<window.location.href.indexOf("/discover"),o.cards={query:{projectStatus:t.projectStatus,stateType:t.stateType,type:void 0,limit:t.maxPerLoad||200,offset:0,filter:t.filter||void 0,status:void 0,category:void 0,username:void 0,randomize:t.randomize||0,seed:void 0,campaignPoolSize:t.maxPerLoad&&"true"!=t.showLoadMore?t.maxPerLoad:void 0},cards:[],friends_available:u.loggedIn()},void 0!==s.username&&(e=s.username,o.username=e,n=o.username,l.user.loadUser(n).then(function(e){o.profileDetails=e})),o.cards.query.username=o.username;var i=!1;function a(a){var e,t;o.projectCardGridData&&(o.projectCardGridData.totalCampaigns=""),(a=void 0===a?!1:a)?o.cards.loadingMore=!0:o.cards.loading=!0,o.cards.query.type&&(e=o.cards.query,t=!0,t=!!("customList"!=e.type||e.listID||"number"==typeof e.listID&&"string"==typeof e.listID)&&t)&&m.searchLegacy(o.cards.query,!0).then(function(e){if(e&&e.projects&&(o.projectCardGridData&&(e.total_hits?o.projectCardGridData.totalCampaigns=e.total_hits.value:o.projectCardGridData.totalCampaigns=e.total_hits),e=e.projects),e&&0<e.length&&e[0].Seed&&(o.cards.query.seed=e[0].Seed),a&&o.cards.cards.length?angular.forEach(e,function(e){o.cards.cards.push(e)}):o.cards.cards=e,o.showLoadMore=i&&e.length==o.cards.query.limit,o.cards.loading=!1,o.cards.loadingMore=!1,window.heap)for(var t=0;t<e.length;t++){var n=e[t];window.heap.track("Featured Campaign",{"Project Name":n.Name,"Project ID":n.ID,"Project Position":t+1})}})}o.$on("sposnsor-filter-change",function(e,t){"Select"==t.a?delete o.cards.query.filter:o.cards.query.filter=t.a,a()}),o.$on("sposnsor-status-filter-change",function(e,t){"Select"==t.a?delete o.cards.query.status:o.cards.query.status=t.a,a()}),p.setSource(o.src),o.cards.query.param1=void 0===t.param1?null:t.param1,void 0!==o.category&&(o.cards.query.category=o.category),o.setType=function(e,t){switch(e){case"featured":o.cards.filterType="Featured";break;case"trending":o.cards.filterType="Trending";break;case"almost_funded":o.cards.filterType="Almost Funded";break;case"ending_soon":o.cards.filterType="Ending Soon";break;case"friends":o.cards.filterType="Friends";break;case"most_funded":o.cards.filterType="Most Fudned";break;case"sponsored_by":o.cards.filterType="Sponsored";break;case"live":o.cards.filterType="Live";break;case"community":o.cards.filterType="Community";break;case"all":o.cards.filterType="All";break;case"customList":o.cards.filterType="customList",o.cards.query.listID=o.listId}o.cards.query.type=e,o.cards.query.offset=0,o.cards.query.param1=t||null,a()},o.nextPage=function(e){o.cards.query.offset+=parseInt(o.cards.query.limit),a(e)},o.prevPage=function(){o.cards.query.offset-=o.cards.query.limit,o.cards.query.offset<0&&(o.cards.query.offset=0),a()},o.redirectToDiscoverPage=function(){c.location.href="/discover"},o.actionButtonType=t.actionButtonType||"project-card",i=void 0!==t.showLoadMore&&"0"!==t.showLoadMore&&"false"!==t.showLoadMore,o.type=t.defaultType||"featured",o.display||(o.display="default"),u.get().then(function(){o.$on("user:login-change",function(e,t){o.cards.friends_available=t.loggedIn,a(!1)}),o.$watch("category",function(e){e&&(o.cards.query.category=e.Slug,a())}),o.$watch("param1",function(e){e&&(o.cards.query.param1=e,a())}),o.$watch("q",function(e){o.cards.query.q=e,o.cards.query.offset=0,a()}),o.$watch("type",function(e){delete o.cards.query.listID,e&&o.setType(e,o.param1),"customList"==e&&(o.cards.query.type=e,o.cards.query.listID=o.listId)}),o.$watch("listId",function(e,t){e&&e!==t&&o.setType("customList")}),o.$watch("discoverFilters",function(e){e&&"discovery"==o.type&&(o.cards.query["f[]"]=e,o.cards.query.offset=0,a())})}),o.applicationName=d.applicationName}}}]),e.directive("projectWideClubCard",["api","patronicityConfig","$window",function(a,e,t){return{restrict:"EA",scope:{type:"@",card:"=?projectCardWithData",projectId:"=?",loadComplete:"&?"},templateUrl:e.urlForTemplate("project-wide-club-card.html"),link:function(t,e,n){void 0===n.card&&n.projectId&&t.$watch("projectId",function(e){e&&a.Cards.get({id:e},function(e){t.card=e})}),t.onImageLoad=function(e){t.loadComplete&&t.loadComplete()({type:t.type})},void 0===n.actionButtonType?t.actionButtonType="project-card":t.actionButtonType=n.actionButtonType,t.donationComplete=function(e){t.$emit("donation:completed",{amount:e.amount,donated:e.donated,feeAmount:e.feeAmount,id:e.id,projectId:e.projectId}),e.id&&e.projectId&&n.challengeId&&t.challengeDay&&a.challenges.adjustForDay(e.id,e.projectId,n.challengeId,t.challengeDay).then(function(e){t.$emit("challenge:donated",{id:n.challengeId,day:t.challengeDay,projectId:e.projectId,donationId:e.id})})}}}}]),e.directive("projectChallengeCard",["api","patronicityConfig",function(a,n){return{restrict:"EA",scope:{type:"@",card:"=?projectCardWithData",projectId:"=?",loadComplete:"&?",challengeDay:"=?"},templateUrl:function(e,t){return void 0===t.type||"main"==t.type||"mobile"==t.type?n.urlForTemplate("project-card-wide.html"):void 0},link:function(t,e,n){t.challengeId=n.challengeId,void 0===n.card&&n.projectId&&t.$watch("projectId",function(e){e&&a.Cards.get({id:e},function(e){t.card=e})}),t.onImageLoad=function(e){t.loadComplete&&t.loadComplete()({type:t.type})},void 0===n.actionButtonType?t.actionButtonType="project-card":t.actionButtonType=n.actionButtonType,t.donationComplete=function(e){t.$emit("donation:completed",{amount:e.amount,donated:e.donated,feeAmount:e.feeAmount,id:e.id,projectId:e.projectId}),e.id&&e.projectId&&n.challengeId&&t.challengeDay&&a.challenges.adjustForDay(e.id,e.projectId,n.challengeId,t.challengeDay).then(function(e){t.$emit("challenge:donated",{id:n.challengeId,day:t.challengeDay,projectId:e.projectId,donationId:e.id})})}}}}]),e.directive("projectGridMenu",["api",function(a){return{restrict:"E",scope:{type:"=",loadSponsors:"@?"},templateUrl:"projectGridMenu.html",link:function(t,e,n){t.cards={},t.setMenuType=function(e){t.type=e},t.loadSponsors&&(t.params={},t.params.sponsors={},a.sponsors().then(function(e){t.params.sponsors=e}),t.params.states={},a.projectStates().then(function(e){t.params.states=e}))}}}]),e.directive("campaignCardIcons",["patronicityConfig","supportInfo","api","User","ProjectCardManager","GivingSettingsManager",function(t,o,i,r,s,e){return{restrict:"E",scope:{projectId:"@",isZakat:"@"},templateUrl:t.urlForTemplate("cards/campaign-card-icons.html"),link:function(n,e){function a(e){n.data.is_favorited=e,n.data.add_tooltip=e?"Remove from Giving List":"Add to Giving List"}n.slug=e.slug||"dhul_hijjah_2022",n.data={loading:!0,updating:!1,add_tooltip:"Add to Giving List",is_favorited:!1,is_zakat:"true"==n.isZakat||"1"==n.isZakat,allow_favorite:!1,isLoggedin:!1,isMember:!1,showPromoPopup:!1},n.application=t.applicationName,r.get().then(function(){n.data.isLoggedIn=r.isLoggedIn()}),n.closePopover=function(e){for(var t=document.querySelectorAll("[uib-popover-template-popup]"),n=0;n<t.length;n++)t[n].contains(e.target)&&(t[n].style.cssText="display:none !important")},n.$watch("projectId",function(e){var t;void 0!==e&&(t=e,n.data.loading=!0,o.load(t).then(function(e){angular.forEach(e,function(e){e.id==t&&(n.data.allow_favorite=e.allowFavorite,a(e.favorited))}),n.data.loading=!1},function(){}))}),n.toggleFavorite=function(e){e.preventDefault(),n.updating||(e=n.data.is_favorited,n.updating=!0,a(!n.is_favorited),(e?i.user.favorites.remove(n.projectId):i.user.favorites.add(n.projectId,s.getSource())).then(function(e){a(e.favorited),n.$emit("favorite:status-changed",{id:n.projectId,favorite:e.favorited})},function(){}).finally(function(){n.updating=!1}))}}}}]),e.directive("projectCardWithData",["api","patronicityConfig","$rootScope","ProjectCardManager","User","CurrencyCodeProvider",function(o,n,i,t,r,s){return{restrict:"EA",scope:{type:"@",card:"=?projectCardWithData",projectId:"=?",loadComplete:"&?",challengeDay:"=?"},templateUrl:function(e,t){return void 0===t.type||"main"==t.type?n.urlForTemplate("project-card-v2-main.html"):"mobile"==t.type?n.urlForTemplate("project-card-v2-mobile.html"):"catchup-card"==t.type?n.urlForTemplate("project-card-catchup.html"):"community-card"==t.type?n.urlForTemplate("community-project-card-lgx.html"):void 0},link:function(n,e,a){n.mockup=!!a.mockup,n.challengeId=a.challengeId,void 0===a.card&&a.projectId&&n.$watch("projectId",function(e){e&&o.Cards.get({id:e},function(e){n.card=e})}),n.card&&n.card.URL&&n.card.URL==n.card.Slug&&(n.card.URL="/campaign/"+n.card.URL),r.get().then(function(){n.userCurrencyCode=r.getPreferredCurrency(),n.userCurrencySymbol=s.symbolFromCode(n.userCurrencyCode)}),n.kFormatter=function(e){return 999<Math.abs(e)?Math.sign(e)*(Math.abs(e)/1e3).toFixed(1)+"k":Math.sign(e)*Math.abs(e)},n.onImageLoad=function(e){n.loadComplete&&n.loadComplete()({type:n.type})},void 0===a.actionButtonType?n.actionButtonType="project-card":n.actionButtonType=a.actionButtonType,void 0!==a.afterComplete&&(n.afterComplete=a.afterComplete),n.srcForUrl=function(){var e="";return e=t.getSource()&&""!=t.getSource()?"?src="+t.getSource():e},n.donationComplete=function(t){i.$broadcast("donation:completed",{amount:t.amount,donated:t.donated,feeAmount:t.feeAmount,id:t.id,projectId:t.projectId}),t.id&&t.projectId&&a.challengeId&&void 0!==n.challengeDay&&null!=n.challengeDay&&o.challenges.adjustForDay(t.id,t.projectId,a.challengeId,n.challengeDay).then(function(e){i.$broadcast("challenge:donated",{id:a.challengeId,day:n.challengeDay,projectId:t.projectId,donationId:t.id})})},n.$on("currency-selected",function(e,t){n.userCurrencyCode!=t.currencyCode&&(n.userCurrencyCode=t.currencyCode,n.userCurrencySymbol=s.symbolFromCode(n.userCurrencyCode))})}}}]),e.directive("projectCardSingle",["api","User","patronicityConfig",function(a,e,n){return{restrict:"EA",scope:{type:"@",projectId:"=?",card:"=projectCardWithData"},templateUrl:function(e,t){return void 0===t.type||"main"==t.type?n.urlForTemplate("project-card-v2-main.html"):"mobile"==t.type?n.urlForTemplate("project-card-v2-mobile.html"):void 0},link:function(t,e,n){t.actionButtonType="widget-card",t.projectId&&a.Cards.get({id:t.projectId},function(e){t.card=e})}}}]),e.directive("categoryList",["api",function(a){return{restrict:"E",templateUrl:"categoryList.html",scope:{selectedCategory:"="},link:function(t,e,n){t.categoryData={},a.categories().then(function(e){t.categoryData.categories=e}),t.selectCategory=function(e){t.selectedCategory=e}}}}]),e.controller("discoverProjectsPageController",["$scope",function(t){t.category="all",t.type="customList",t.featuredListID=2,t.selectType=function(e){"customList"==(t.type=e)&&(t.featuredListID=2)}}]),e.directive("communityCard",function(){return{restrict:"A",scope:{community:"=communityCard"},templateUrl:"communityCard.html"}}),e.directive("communityGrid",["api","patronicityConfig",function(o,e){return{restrict:"E",scope:{communityId:"@",type:"@",param1:"="},templateUrl:e.urlForTemplate("community-grid.html"),link:function(t,e,n){var a;t.communities=[],t.loading=!0,a={offset:0,limit:20,type:t.type,param1:t.param1},o.Communities.query(a,function(e){t.communities=e,t.loading=!1})}}}]),e.controller("myProjectsPageController",["$scope",function(t){t.category="all",t.type="created",t.selectType=function(e){t.type=e}}]),e.controller("profileProjectsPageController",["$scope",function(n){n.category="all",n.type="created",n.cparam1=null,n.selectType=function(e,t){n.type=e,n.cparam1=t}}]),e.directive("homepageCommunities",["api",function(a){return{restrict:"E",scope:{},templateUrl:"homepageCommunities.html",link:function(o,e,t){var n;o.communities=[],o.slides=[],n={offset:0,limit:20},t.type&&(n.param2=t.type),t.communityIds&&(n.type="selected",n.param1=t.communityIds),a.Communities.query(n,function(e){o.communities=e;for(var t=[],n=0,a=0;a<e.length;a++)void 0===t[n]&&(t[n]=[]),t[n].push(e[a]),4==t[n].length&&n++;o.slides=t})}}}]),e.directive("searchPage",["api","patronicityConfig",function(e,t){return{restrict:"E",templateUrl:t.urlForTemplate("search-page.html"),scope:{searchTerm:"@"},link:function(t,e,n){t.loading=!0,t.params={},t.params.resultPage="projects",t.setPageType=function(e){t.params.resultPage=e}}}}]),e.directive("locateMe",["$uibModal","$timeout","patronicityConfig",function(a,e,o){return{restrict:"E",replace:!0,scope:{positionDetails:"=?",callback:"&?"},template:'<a class="btn btn-default" role="button" ng-click="showLocationModal()"><span class="glyphicon glyphicon-map-marker"></span> Near Me</a>',link:function(t,e,n){t.positionDetails=null,t.showLocationModal=function(){a.open({templateUrl:o.urlForTemplate("ask-location-modal.html"),controller:["$scope","$uibModalInstance","loadGoogleMapAPI",function(n,e,t){n.enableZip=!1,n.zip=null,n.locationDetails={havePosition:!1,coords:null,supportsGeo:!1,formattedAddress:null,usingGeocode:!1,usingLocation:!1},n.geocodeError=null,t.then(function(){n.enableZip=!0},function(){}),n.geocodeLocationString=function(){n.geocoder=new google.maps.Geocoder,n.geocoder.geocode({address:n.zip},function(e,t){t==google.maps.GeocoderStatus.OK?n.handleGeocodePosition(e):n.geocodeError="Unable to find a location. Try a different zip code"})},n.handleError=function(e){console.log("Error: "+e)},n.handleGeocodePosition=function(e){n.locationDetails.coords={latitude:e[0].geometry.location.lat(),longitude:e[0].geometry.location.lng()},n.locationDetails.formattedAddress=e[0].formatted_address,n.locationDetails.havePosition=!0,n.geocodeError=null,n.locationDetails.usingLocation=!1,n.locationDetails.usingGeocode=!0,n.$apply()},n.handlePosition=function(e){n.locationDetails.coords=e.coords,n.locationDetails.havePosition=!0,n.locationDetails.formattedAddress=null,n.geocodeError=null,n.locationDetails.usingLocation=!0,n.locationDetails.usingGeocode=!1,n.$apply()},n.getLocation=function(){navigator.geolocation?(n.locationDetails.supportsGeo=!0,navigator.geolocation.getCurrentPosition(n.handlePosition,n.handleError)):console.log("Geolocation is not supported by this browser.")},n.getLocation(),n.cancel=function(){e.close()},n.ok=function(){e.close(n.locationDetails)}}],resolve:{},backdrop:"static"}).result.then(function(e){e&&e.havePosition&&(t.positionDetails=e,t.callback&&t.callback()(e))})}}}}]),e.controller("locationTest",["$scope",function(e){e.posdeets=null,e.done=function(e){console.log(e)}}]),e.controller("FacebookHelper",["loadFacebookJavascript","$window","api",function(e,t,n){e.then(function(){window.FB.getLoginStatus(function(e){"connected"===e.status?window.FB.api("/me/friends?limit=5000",function(e){var t=null;e&&!e.error?t=e.data:console.log("Couldn't get friends list. Skipping."),t&&n.facebookFriendsSave({friends:t}).then(function(e){console.log(e)})}):"not_authorized"===e.status?console.log("User hasn't authorized us to log on yet"):console.log("User is not logged on to Facebook")},!0)})}]),e.directive("projectLeaderboard",["patronicityConfig","LeaderboardFactory","$window","$templateCache",function(e,i,r,s){return{restrict:"E",templateUrl:e.urlForTemplate("project-leaderboard.html"),scope:{startDate:"<",endDate:"<",type:"@",currencyCode:"@",perPage:"@?",templateType:"@",allowMore:"@",fresh:"@",sponsorIds:"=?",countryCode:"=?",sortType:"@",prizes:"=?",currentDay:"=?"},link:function(n,e,t){function a(){n.leaderboard=[],n.perPage=isNaN(parseInt(n.perPage))?10:parseInt(n.perPage),n.offset=0,n.loading=!0,n.allowLoadMore=!0,!n.allowMore||0!=n.allowMore&&"false"!=n.allowMore||(n.allowLoadMore=!1),n.templateType=n.templateType||"default",n.sortType=n.sortType||function(e){var t;switch(e){case"donors":case"challenge-donors":case"zakat-donors":case"top-fundraisers-donors":case"default-donors":case"sponsor-unfiltered-donors":case"country-donors":t="donors";break;case"challenge-donations":case"top-fundraisers":case"donations":case"top-teams-raising":case"default-donations":case"sponsor-unfiltered-donations":case"country-donations":t="donations"}return t}(n.type),n.preload=1e3,n.shownItemCount=n.perPage,n.loadPrizeLevels=!1,s.get("prizeLevel.html")&&(n.loadPrizeLevels=!0)}function o(){n.loading=!0,i.leaderboard(n.type,n.startDate,n.endDate,n.currencyCode,n.preload,n.offset,n.fresh,n.sponsorIds,n.countryCode).then(function(e){if(0==n.leaderboard.length)n.leaderboard=e;else if(e.length<=0)n.allowLoadMore=!1;else for(var t=0;t<e.length;t++)n.leaderboard.push(e[t]);n.offset=n.leaderboard.length,n.loading=!1})}a(),o(),n.loadMoreItems=function(){parseInt(n.shownItemCount)>=n.leaderboard.length&&o(),n.shownItemCount=parseInt(n.shownItemCount)+parseInt(n.perPage)},n.viewLessItems=function(){n.canViewLessItems&&(n.shownItemCount=parseInt(n.shownItemCount)-parseInt(n.perPage))},n.joinSponsor=function(e){r.open("/projects/start?sponsorId="+e,"_blank")},n.canViewLessItems=function(){return n.shownItemCount>n.perPage},i.subscribe(n,function(e,t){switch(t.eventName){case"refreshAll":case"refreshLeaderboards":a(),o()}}),n.getTypeHelp=function(e){var t="";return"top-fundraisers"==e?t="This leaderboard only counts donations through direct campaign page links or donor referral links.":"sponsor-unfiltered-donations"==e?t="This leaderboard counts all donations from all sources.":"top-fundraisers-donors"==e?t="This leaderboard only counts donors through direct campaign page links or donor referral links.":"sponsor-unfiltered-donors"==e&&(t="This leaderboard counts all donors from all sources."),t},n.$watch("startDate",function(e,t){e&&e!=t&&(a(),o())})}}}]),e.directive("leaderboardCounter",["patronicityConfig","LeaderboardFactory",function(e,i){return{restrict:"E",templateUrl:e.urlForTemplate("project-leaderboard-counter.html"),scope:{startDate:"<",endDate:"<",type:"@",currencyCode:"@",sponsorIds:"=?",returnType:"@?",countryCode:"=?"},link:function(t,e,n){function a(){t.loading=!0,t.stats={}}function o(){t.loading=!0,i.counters(t.type,t.startDate,t.endDate,t.currencyCode,t.sponsorIds,t.countryCode).then(function(e){t.stats=e,t.loading=!1})}t.$watch("startDate",function(e,t){e&&e!=t&&(a(),o())}),i.subscribe(t,function(e,t){switch(t.eventName){case"refreshAll":case"refreshCounters":a(),o()}}),a(),o()}}}]),e.directive("leaderboardPrizeLevel",[function(){return{restrict:"E",templateUrl:"prizeLevel.html",scope:{index:"=",type:"=",prizes:"=?",currentDay:"=?"},link:function(n,e,t){n.showOnDay=function(e){var t=!1;return t=-1!==e.indexOf(n.currentDay)?!0:t}}}}]),e.directive("leaderboardRefreshCountdown",["patronicityConfig","LeaderboardFactory",function(e,i){return{restrict:"E",templateUrl:e.urlForTemplate("project-leaderboard-refresh-countdown.html"),scope:{startDate:"<",endDate:"<",timeInterval:"=",timeUnit:"@"},link:function(n,e,t){function a(){var e,t;"hour"==n.timeUnit?(e=n.timeInterval,(t=new Date).setHours(t.getHours()+e),t.setMinutes(0),t.setSeconds(0),n.data.reloadDate=t.getTime(),t.setHours(t.getHours()-e),t.setMinutes(0),n.data.timerStart=t.getTime(),n.data.totalTime=n.data.reloadDate-n.data.timerStart,o()):"minute"==n.timeUnit&&(e=n.timeInterval,(t=new Date).setMinutes(t.getMinutes()+e),t.setSeconds(0),n.data.reloadDate=t.getTime(),t.setMinutes(t.getMinutes()-e),t.setSeconds(0),n.data.timerStart=t.getTime(),n.data.totalTime=n.data.reloadDate-n.data.timerStart,o())}function o(){var e=new Date;n.data.timerValue=1-(n.data.reloadDate-e.getTime())/n.data.totalTime}n.data={timerValue:0,reloadDate:void 0,timerStart:void 0,totalTime:0,showRefresh:!1},a(),n.$on("timer-tick",function(e,t){n.data.reloadDate&&o()}),n.timerFinished=function(){n.data.showRefresh=!0,n.data.timerValue=100},n.refresh=function(){i.notify({eventName:"refreshAll"}),a(),n.data.showRefresh=!1}}}}]),e.factory("LeaderboardFactory",["api","$rootScope",function(u,n){var d={};function t(){d={counters:{},leaderboards:{}}}function s(e){var t="";return e&&void 0!==e&&e.forEach(function(e){t+=e}),t}function c(e,t,n,a,o){return new Date(e).getTime().toString()+new Date(t).getTime().toString()+n+a+s(o)}function p(e,t,n,a,o,i,r){t=new Date(t).getTime().toString(),n=new Date(n).getTime().toString(),r=s(r);return t+n+a+o.toString()+i.toString()+e+r}return t(),{leaderboard:function(e,t,n,a,o,i,r,s,c,l){return void 0!==d.leaderboards[p(e,t,n,a,o,i,c)]&&!l||(d.leaderboards[p(e,t,n,a,o,i,c)]=u.project.leaderboard(e,t,n,a,o,i,r,s,c)),d.leaderboards[p(e,t,n,a,o,i,c)]},counters:function(e,t,n,a,o,i,r){return void 0!==d.counters[c(t,n,a,e,i)]&&!r||(d.counters[c(t,n,a,e,i)]=u.project.leaderboardCounter(e,t,n,a,o,i)),d.counters[c(t,n,a,e,i)]},subscribe:function(e,t){t=n.$on("leaderboard-service-event",t);e.$on("$destroy",t)},notify:function(e){switch(e.eventName){case"refreshAll":t();break;case"refreshCounters":d.counters={};break;case"refreshLeaderboards":d.leaderboards={}}n.$emit("leaderboard-service-event",e)}}}]),e.directive("adminProjectList",["api","NgTableParams",function(a,e){return{restrict:"E",scope:{},templateUrl:"adminProjectList.html",link:function(n){n.tableParams=new e({page:1,count:25,noPager:!0,filter:{},exact:{},sorting:{Created:"desc"}},{counts:[],getData:function(t){n.isLoading=!0;var e=jQuery.param(t.url());return n.sponsorCSV=e,a.admin.projectList.load.get(t.url()).$promise.then(function(e){return t.total(e.total),n.list=e.list,n.currentResultCount=e.total,n.isLoading=!1,e.result})}}),n.$on("load-Project-list",function(){n.tableParams.reload()})}}}]),e.directive("projectListEdit",["$uibModal","patronicityConfig","api","$window",function(t,n,o,e){return{restrict:"E",template:'<button ng-click="openEditModal()" class="btn btn-xs btn-primary">{{label}}</button>',scope:{list:"="},link:function(e){e.label="Edit",e.list||(e.label="Add Project List"),e.openEditModal=function(){t.open({templateUrl:n.urlForTemplate("newadmin/Project-list-edit.html"),controller:["$scope","$uibModalInstance","list",function(t,n,a){t.isNewSponsor=!1,a?t.editList=angular.copy(a):(t.editList={ID:"new",Color:"#7ECB91"},t.isNewSponsor=!0),t.save=function(){o.admin.projectList.save(t.editList).then(function(e){angular.copy(e,a),t.isNewSponsor&&console.log("new sponsor so requesting reload"+a),t.$root.$broadcast("load-Project-list","Project list"),n.close({})},function(e){t.messageText=e})},t.cancel=function(){n.dismiss({})}}],size:"md",resolve:{list:function(){return e.list}}})}}}}]),e.directive("adminProjectListItems",["api","$stateParams","Dialogs","$uibModal","patronicityConfig","$timeout",function(l,u,d,p,e,m){return{restrict:"E",scope:{},templateUrl:"adminProjectListItems.html",link:function(r){r.cards={cards:[]},r.currentItemIds=[],r.isDirty=!1,r.isSaving=!1;var e;r.loadingItems=!0;function n(){r.totalWebsiteFeaturePrice=0,r.totalWeight=0,r.sumPackagePrice=0,r.sumNewsletterFeaturePrice=0,r.sumZakatPrice=0}function o(e){n(),angular.forEach(e,function(e){r.totalWebsiteFeaturePrice+=parseFloat(e.WebsiteFeaturePrice),r.totalWeight+=parseFloat(e.Weight),r.sumPackagePrice+=parseFloat(e.TotalPackagePrice),r.sumNewsletterFeaturePrice+=parseFloat(e.NewsletterFeaturePrice),r.sumZakatPrice+=parseFloat(e.ZakatPrice)})}function t(){r.loadingItems=!0,l.admin.projectListItems.load(r.listID).then(function(e){n(),r.Items=e.items,r.Items.sort(function(e,t){return e.SortOrder-t.SortOrder});var t=[];o(r.Items),angular.forEach(r.Items,function(e){t.push(e.ProjectID)}),r.currentItemIds=t,r.loadingItems=!1})}function s(){r.isSaving?void 0===e&&(e=m(function(){e=void 0,s()},5e3)):r.saveItems()}function a(){for(var e in r.Items)r.Items[e].SortOrder=e}function i(){r.inputErrors.newsletterPrice=!1,r.inputErrors.zakatPrice=!1,r.inputErrors.websitePrice=!1}function c(){r.totalWebsiteFeaturePrice=r.Items.reduce(function(e,t){t=t.WebsiteFeaturePrice||0;return e+parseFloat(t)},0);for(var e=r.totalWeight=0;e<r.Items.length;e++){var t=0==r.totalWebsiteFeaturePrice?0:(parseFloat(r.Items[e].WebsiteFeaturePrice)/parseFloat(r.totalWebsiteFeaturePrice)).toFixed(4);r.Items[e].Weight=t,r.totalWeight+=parseFloat(t)}}r.listID=u.id,r.newProject={},r.selectedProject={},r.inputErrors={newsletterPrice:!1,zakatPrice:!1,websitePrice:!1},n(),t(),r.sortableOptions={update:function(e,t){},stop:function(e,t){a(),s()}},r.moveToTop=function(e){for(var t=0;t<r.Items.length;t++)if(r.Items[t].ID==e.ID){var n=r.Items.splice(t,1);r.Items.unshift(n[0]),a(),s();break}},r.moveToBottom=function(e){for(var t=0;t<r.Items.length;t++)if(r.Items[t].ID==e.ID){var n=r.Items.splice(t,1);r.Items.push(n[0]),a(),s();break}},r.$on("project-selected",function(e,t){var n=t.project.Name,a={type:"add",id:t.project.ID,listID:r.listID};p.open({templateUrl:"addProjectListItem.html",controller:["$scope","$uibModalInstance",function(o,i){o.projectName=n,o.params=a,o.save=function(){l.admin.projectListItems.addAndRemove(o.params).then(function(e){var t=o.newProject.NewsletterFeaturePrice,n=o.newProject.ZakatPrice,a=o.newProject.WebsiteFeaturePrice;e=e,r.$broadcast("added-campaign-to-list",e.item.ProjectID),r.Items.splice(0,0,e.item),r.currentItemIds.splice(0,0,e.ProjectID),r.moveToTop(e.item),e=t,t=n,n=a,r.Items[0].NewsletterFeaturePrice=e,r.Items[0].ZakatPrice=t,r.Items[0].WebsiteFeaturePrice=n,r.Items[0].TotalPackagePrice=parseFloat(e)+parseFloat(t)+parseFloat(n),c(),s(),i.close()},function(e){o.messageText=e})},o.cancel=function(){i.close()}}],size:"md"})}),r.loadTemplate=function(e){return e.ProjectID==r.selectedProject.ProjectID?"edit":"display"},r.editFields=function(e){r.selectedProject=angular.copy(e)},r.saveFields=function(e){var t=r.selectedProject.NewsletterFeaturePrice||"",n=r.selectedProject.ZakatPrice||"",a=r.selectedProject.WebsiteFeaturePrice||"";i(),""==t&&(r.inputErrors.newsletterPrice=!0),""==n&&(r.inputErrors.zakatPrice=!0),""==a&&(r.inputErrors.websitePrice=!0),r.inputErrors.newsletterPrice||r.inputErrors.zakatPrice||r.inputErrors.websitePrice||(r.Items[e]=r.selectedProject,r.Items[e].TotalPackagePrice=parseFloat(r.selectedProject.NewsletterFeaturePrice)+parseFloat(r.selectedProject.ZakatPrice)+parseFloat(r.selectedProject.WebsiteFeaturePrice),c(),s(),r.selectedProject={})},r.reset=function(){t(),r.selectedProject={},i()},r.removeItem=function(t){d.Confirm("Are you sure you want to remove "+t.Name+"?","Remove From Project List Items").then(function(){var e=r.Items.filter(function(e){return e.ProjectID!=t.ProjectID});e.length!=r.Items.length&&(r.Items=e,r.currentItemIds=r.currentItemIds.filter(function(e){return e!=t.ProjectID}),c(),s(),e={type:"remove",id:t.ID,listID:r.listID},l.admin.projectListItems.addAndRemove(e).then(function(e){r.$broadcast("removed-campaign-from-list",t.ProjectID)}),a())})},r.saveItems=function(){r.loadingItems=!0,r.isSaving=!0,l.admin.projectListItems.save(r.Items,r.listID).then(function(e){var a;r.isDirty=!1,r.isSaving=!1,a=e,angular.forEach(r.Items,function(e,t){for(var n=0;n<=a.length;n++)if(e.ProjectID!=a[n].ProjectID){r.Items[t]=a[n];break}r.loadingItems=!1}),o(r.Items)},function(e){alert(e),t()})}}}}])}(),angular.module("patronicity.projectcards.factory",["patronicity.configuration","ui.router"]).factory("ProjectCardManager",["api","$rootScope",function(e,t){var n={};return n={src:""},{setSource:function(e){return n.src=e,console.log("%cSource set to: "+n.src,"color:green; border:2px solid black"),n.src},getSource:function(){return n.src}}}]),function(){var e=angular.module("patronicity.projects",["ngSanitize","ngAnimate","ngResource","ngTable","ui.bootstrap","ui.sortable","textAngular","mv.utils","patronicity-upload","community","teammember","admin","user","patronicity.buttons","patronicity.notifications","patronicity.buttons.refund","patronicity.api","patronicity.projectcards","patronicity.countdown","angularMoment","mv.configuration","patronicity.sharing","patronicity.press","patronicity.project-admin","patronicity.configuration"]);e.directive("projectOwner",["patronicityConfig",function(e){return{restrict:"E",scope:{project:"="},templateUrl:e.urlForTemplate("project-owner.html")}}]),e.directive("taxStatus",["patronicityConfig",function(e){return{restrict:"E",scope:{project:"="},templateUrl:e.urlForTemplate("project-tax-status.html"),controller:["$scope",function(e){e.editingTaxStatus=null,e.init=function(){e.taxStatus={TaxDeductible:parseInt(e.project.TaxDeductible,10),Company:e.project.Company,TaxID:e.project.TaxID}},e.editTaxStatus=function(){e.init(),e.editingTaxStatus=!0,this.taxStatusForm.$setPristine()},e.cancelEditTaxStatus=function(){e.init(),e.editingTaxStatus=!1},e.saveTaxStatus=function(){e.project.TaxDeductible=parseInt(e.taxStatus.TaxDeductible,10),e.project.Company=e.taxStatus.Company,e.project.TaxID=e.taxStatus.TaxID,e.project.$save(),e.editingTaxStatus=!1},e.init()}]}}]),e.directive("giftAid",function(){return{restrict:"E",controller:["$scope",function(e){e.editingGiftAidStatus=null,e.init=function(){e.giftAidStatus={GiftAid:parseInt(e.project.GiftAid,10)}},e.editGiftAidStatus=function(){e.init(),e.editingGiftAidStatus=!0,this.giftAidStatusForm.$setPristine()},e.cancelEditGiftAidStatus=function(){e.init(),e.editingGiftAidStatus=!1},e.saveGiftAidStatus=function(){e.project.GiftAid=parseInt(e.giftAidStatus.GiftAid,10),e.project.$save(),e.editingGiftAidStatus=!1},e.init()}],scope:{project:"="},templateUrl:"projectGiftAid.html"}}),e.directive("socialMediaLinksEdit",["patronicityConfig",function(t){return{restrict:"E",scope:{project:"="},templateUrl:t.urlForTemplate("sm-link-list-edit.html"),controller:["$scope","$uibModal",function(a,e){a.addingLink=!1,a.addLink=function(){a.smlinks.push({ID:"new",LinkType:"facebook",Link:""})},a.delete=function(e){var t=a.smlinks.indexOf(e);0<=t&&a.smlinks.splice(t,1),"new"!=e.ID&&a.save()},a.$watchCollection("project.SocialMediaLinks",function(e,t){a.restorePristine()}),a.restorePristine=function(){a.smlinks=[];for(var e=0;e<a.project.SocialMediaLinks.length;e++){var t=a.project.SocialMediaLinks[e];a.smlinks.push(jQuery.extend({},t))}},a.save=function(){a.project.SocialMediaLinks=[];for(var e=0;e<a.smlinks.length;e++){var t=a.smlinks[e];a.project.SocialMediaLinks.push(jQuery.extend({},t))}a.project.$save()},a.addOrEditSocialLink=function(n){e.open({templateUrl:t.urlForTemplate("project-link-modal.html"),controller:["$scope","$uibModalInstance",function(e,t){e.params={ID:"new",Link:"",LinkType:""},n&&(e.params.ID=n.ID,e.params.Link=n.Link,e.params.LinkType=n.LinkType),e.ok=function(){t.close(e.params)},e.cancel=function(){t.dismiss("cancel")}}],size:"md",resolve:{}}).result.then(function(e){a.smlinks.push(e),a.save()})}}]}}]),e.controller("TeamMemberController",["$scope","$timeout","TeamMemberService","Dialogs","$http","patronicityConfig",function(o,e,t,n,i,r){o.removeTeamMember=function(a){n.Confirm("Are you sure you want to remove "+a.User.FullName+" from this project?","Confirm Team Member Removal").then(function(e){var t={ProjectID:o.project.ID,MemberID:a.Member.ID};i.post(r.databaseEndpointUrl("teammember/remove"),t).success(function(e){if(e.success){for(var t=-1,n=0;n<o.project.TeamMembers.length;n++)if(a.Member.ID==o.project.TeamMembers[n].Member.ID){t=n;break}0<=t&&o.project.TeamMembers.splice(t,1),o.project.$save()}else alert(e.message)}).error(function(e,t,n,a){alert("ERROR: "+t)})})},o.addTeamMember=function(){t.Add(o.project.ID).then(function(e){"save"==e.verb&&(o.project.TeamMembers.push(e.member),o.project.$save())})}}]).directive("teammembers",["patronicityConfig",function(e){return{restrict:"E",templateUrl:e.urlForTemplate("project-team-members.html"),controller:"TeamMemberController",scope:{isEditing:"=",project:"="}}}]),e.controller("SponsorFormController",["$scope","$timeout",function(e,t){}]),e.directive("fieldFormatter",["$compile",function(o){return{restrict:"A",terminal:!0,link:function(e,t,n){var a;n.directives&&(n=n.directives.split(","),a=t.clone(),angular.forEach(n,function(e){a.attr(e,"")}),a.removeAttr("directives"),a=o(a)(e),t.replaceWith(a))}}}]),e.directive("inlineEditable",["$timeout","$compile",function(i,r){return{restrict:"A",scope:{item:"=field",defaultText:"=prompt",allow:"=editable"},template:'<span ng-hide="editing" ng-click="startEdit()">{{ item || defaultText }}</span><input ng-show="editing" maxlength="{{ fieldMaxLength }}" type="text" ng-keydown="handleKey($event)" ng-blur="handleBlur($event)" style="border: none; outline: none; width: 100%; background-color: inherit; text-align: inherit;" ng-model="item" />',link:function(n,e,t){n.editingElement=e,n.editing=!1,n.fieldMaxLength=t.fieldMaxLength||32767;var a=!1;function o(e,t){e?(n.previousValue=n.item,n.editing=!0,i(function(){n.editingElement.find("input").focus()})):(t?(n.item=n.item.replace(/[^\x00-\x7F]/g,""),n.item=n.item.replace(";","")):n.item=n.previousValue,n.$emit("done-edit",n.item),n.editing=!1)}"1"===t.noblanks&&(a=!0),n.handleKey=function(e){13==e.keyCode?i(function(){a&&n.item.length<=0?o(!1,!1):o(!1,!0)},0):27==e.keyCode&&i(function(){o(!1,!1)},0)},n.handleBlur=function(e){i(function(){a&&n.item.length<=0?o(!1,!1):o(!1,!0)},0)},"1"===t.onlynumber&&((e=t.$$element.find("input").clone()).addClass("only-number"),e=r(e)(n),t.$$element.find("input").replaceWith(e)),"1"===t.thousandscomma&&((e=t.$$element.find("input").clone()).attr("thousands-comma",""),e=r(e)(n),t.$$element.find("input").replaceWith(e)),n.startEdit=function(){n.allow&&o(!0)}}}}]),e.controller("ProjectStartController",["$scope",function(t){t.Goal="",t.Title="",t.canSubmit=function(){var e=!1;return e=t.goalValid()&&""!==t.Title?!0:e},t.goalValid=function(){return""!==t.Goal&&void 0!==t.Goal}}]),e.controller("LoginPageController",["$scope","api","$window","User",function(a,e,o,i){a.facebookResult=function(e,n){switch(e){case"cancelled":a.panel.facebookLoginInProgress=!1;break;case"loadingError":alert("Unable to load Facebook.  Sorry."),a.panel.facebookLoginInProgress=!1;break;case"success":window.FB.api("/me/picture?height=500&width=500&redirect=false",function(e){var t=null;!e||e.error||e.data.is_silhouette||(t=e.data.url),i.facebookLoginOrRegister(n.email,n.first_name,n.last_name,n.name,n.id,t).then(function(e){a.panel.facebookLoginInProgress=!1,o.location.href=e.redirect_url},function(e){alert(e),a.panel.facebookLoginInProgress=!1})})}}}])}(),angular.module("patronicity.pulse.factory",["patronicity.api","user","patronicity.configuration","ui.router","patronicity.common.currency"]).factory("PulseManager",["api","$q","$rootScope",function(t,e,n){return console.log("pulse manager loading"),{load:function(e){return t.pulse.view()}}}]),function(){var e=angular.module("patronicity.pulse.main",["patronicity.api","user","patronicity.configuration","patronicity.lgx.dialogs"]);e.directive("pulseView",["patronicityConfig","PulseManager","User","GivingManager","GivingSettingsManager",function(o,i,r,s,c){return{restrict:"E",scope:{},templateUrl:o.urlForTemplate("pulse/view.html"),link:function(n,e,t){var a,t=void 0===t.slug?location.pathname.split("/").pop():t.slug;n.slug=t,n.isLoggedIn=r.isLoggedIn(),n.data={sections:{},isMember:!1},i.load("view").then(function(e){n.data.sections=e.sections}),n.isLaunchgood=function(){return"launchgood"==o.applicationName},n.isPatronicity=function(){return"patronicity"==o.applicationName},n.sectionVisible=function(e){var t=!1;return t=n.data.sections[e]&&0<n.data.sections[e].cards.length?!0:t},n.contentForSection=function(e){return n.data.sections[e].cards[0].content},a=a||!1,r.get().then(function(){n.data.user=r.current(),s.load("challenge","dhul_hijjah_2019",a).then(function(e){n.data.isOpen=e.chronology.isOpen,n.data.dayIndexUnbound=e.chronology.dayIndexUnbound}),r.isLoggedIn()&&c.load("challenge","dhul_hijjah_2019").then(function(e){e.state&&"active"==e.state&&(n.data.isMember=!0)})})}}}]),e.directive("pcChallengeStatus",["patronicityConfig","PulseManager","GivingManager","User","$dialog","GivingSettingsManager","$rootScope","$location","$analytics",function(e,t,c,l,u,d,p,n,m){return{restrict:"E",templateUrl:e.urlForTemplate("pulse/cards/challenge_status.html"),scope:{},link:function(o,e,t){var i="challenge",r="dhul_hijjah_2019";function n(a){a=a||!1,l.get().then(function(){var e,n,t=a;t=t||!1,c.load("challenge","dhul_hijjah_2019",t).then(function(e){o.data.startDate=e.startDate,o.data.nextCharge=e.nextCharge,o.data.memberGoal=e.memberGoal,o.data.signedUp=e.signedUp,o.data.isOpen=e.chronology.isOpen,o.data.referredUserCount=e.user?e.user.referredUsers.count:0,o.data.dayIndexUnbound=e.chronology.dayIndexUnbound}),o.data.user=l.current(),o.data.isLoggedIn=l.isLoggedIn(),o.data.environment=l.getEnvironment(),o.data.isLoggedIn&&(d.load(i,r).then(function(e){o.settings.type=i,e.goal&&(o.settings.goal=parseInt(e.goal)),o.settings.currencyCode=e.currencyCode,o.settings.currencySymbol=e.currencySymbol,o.settings.cardId=e.currentCardId,o.settings.state=e.state,o.settings.method=e.method,o.settings.name=e.name,o.settings.reminder=e.reminder,o.settings.emailReminder=e.emailReminder,o.settings.state=e.state,e.state&&"active"==e.state&&(o.data.isMember=!0)}),n=e||!1,c.userStats(i,r,n).then(function(e){var t=0;n&&(o.data.userStats.daysDonated=0),o.data.isMember?e.entries.forEach(function(e){e.Donated&&(t+=1)}):t=e.userStats.TotalDonorCount,o.data.userStats.daysDonated=t,o.data.userStats.daysToCatchUp=o.data.dayIndexUnbound+1-o.data.userStats.daysDonated}))})}function a(){m.eventTrack("autoDialogOpen",{category:i,label:r}),u.show({template:"<p-dlg-join-auto></p-dlg-join-auto>"}).then(function(e){1==e&&u.show({template:'<giving-welcome type="'+i+'" slug="'+r+'"></giving-welcome>'})})}function s(){m.eventTrack("manualDialogOpen",{category:i,label:r}),u.show({template:"<p-dlg-join-manual></p-dlg-join-manual>"}).then(function(e){1==e&&u.show({template:'<giving-welcome type="'+i+'" slug="'+r+'"></giving-welcome>'})})}o.loading=!0,o.data={isMember:!1,user:l.current(),isLoggedIn:!1,environment:"production",userStats:{daysDonated:0,daysToCatchUp:0}},o.settings={},n(),o.$on("user:login-change",function(e,t){n()}),p.$on("giving:membership:changed",function(e,t){n(!0)}),o.login=function(){l.isLoggedIn()||l.loginModal(!1).then(function(e){})},o.showAuto=function(){m.eventTrack("autoClickedJoin",{category:i,label:r}),l.isLoggedIn()?(m.eventTrack("autoAlreadyLoggedIn",{category:i,label:r}),a()):(m.eventTrack("autoNeedsToLogin",{category:i,label:r}),l.loginModal(!1).then(function(e){a()}))},o.showManual=function(){m.eventTrack("manualClickedJoin",{category:i,label:r}),l.isLoggedIn()?(m.eventTrack("manualAlreadyLoggedIn",{category:i,label:r}),s()):(m.eventTrack("manualNeedsToLogin",{category:i,label:r}),l.loginModal(!1).then(function(e){s()}))},o.showSettings=function(){},o.unjoin=function(){console.log("unjoin"),d.clear(i,r),p.$broadcast("giving:membership:changed")}}}}]),e.directive("givingMembers",["patronicityConfig","GivingManager",function(e,o){return{restrict:"E",templateUrl:e.urlForTemplate("pulse/components/giving-members.html"),scope:{},link:function(t,e,n){var a;t.loading=!0,t.data={isMember:!1},a=!1,o.load("challenge","dhul_hijjah_2019",a=a||!1).then(function(e){t.data.signedUp=e.signedUp,t.data.newMembers=e.stats.general.newMembers,t.data.newUserPeriodSuffix=e.stats.general.newUserPeriodSuffix})}}}]),e.directive("challengeLeaderboardHelper",["patronicityConfig","GivingManager","moment",function(e,r,s){return{restrict:"EA",templateUrl:e.urlForTemplate("challenge/components/challenge-leaderboard-helper.html"),transclude:!0,link:function(n,e,t){var a,o=void 0===t.slug?"ramadan_challenge_2023":t.slug;function i(e){"challenge"==n.type?(n.lbData.leaderboardStartDate=new Date(n.lbData.challengeStartDate),n.lbData.leaderboardStartDate.setDate(n.lbData.leaderboardStartDate.getDate()+e),n.lbData.leaderboardEndDate=new Date(n.lbData.leaderboardStartDate.getTime()+8634e4+59e3)):"generic_period"==n.type?(n.lbData.leaderboardStartDate=s(n.lbData.challengeStartDate).add(e,"days"),n.lbData.leaderboardEndDate=s(n.lbData.leaderboardStartDate).add(86399e3,"milliseconds")):"rasul"==n.type?(n.lbData.leaderboardStartDate=new Date(n.lbData.challengeStartDate),n.lbData.leaderboardStartDate.setDate(n.lbData.leaderboardStartDate.getDate()+e),n.lbData.leaderboardEndDate=new Date(n.lbData.leaderboardStartDate.getTime()+8634e4+59e3)):(n.lbData.leaderboardStartDate=new Date(n.lbData.challengeStartDate),n.lbData.leaderboardEndDate=new Date(n.lbData.leaderboardStartDate.setHours(e)),n.lbData.leaderboardStartDate=new Date(n.lbData.leaderboardStartDate.setSeconds(n.lbData.leaderboardStartDate.getSeconds()-n.countBy))),n.lbData.leaderboardStart=n.lbData.leaderboardStartDate.toISOString(),n.lbData.leaderboardEnd=n.lbData.leaderboardEndDate.toISOString()}"challenge"==t.type?(n.typeLabel="Dhul Hijjah Challenge",n.challengeName=t.challengeName||"Dhul Hijjah",n.type="challenge"):"generic_period"==t.type?(n.type="generic_period",n.periodStartDate=t.startDate,n.periodEndDate=t.endDate,n.refreshTime=t.refreshTime):"rasul"==t.type?(n.typeLabel="Rasul Leaderboard",n.type="rasul"):(n.typeLabel="Giving Tuesday",n.type="givingtuesday"),n.lbData={},n.prev=function(){n.lbData.leaderboardDayIndex<=n.lbData.currentChallengeDayIndex&&n.lbData.leaderboardDayIndex--},n.next=function(){n.lbData.leaderboardDayIndex<n.lbData.currentChallengeDayIndex&&n.lbData.leaderboardDayIndex++},n.$watch("lbData.leaderboardDayIndex",function(e,t){void 0!==e&&e!=t&&i(parseInt(e))}),n.setGTValues=function(){n.calStartDate=new Date(n.startDate),n.calEndDate=new Date(n.endDate);var e=n.calEndDate.getTime()-n.calStartDate.getTime(),e=parseInt(e/1e3/n.countBy);n.lbData.challengeStartDate=n.calStartDate,n.lbData.challengeEndDate=n.calEndDate,n.lbData.currentChallengeDayIndex=e,n.lbData.leaderboardDayIndex=e,i(n.lbData.leaderboardDayIndex)},n.setGenericPeriodDataOld=function(){n.periodStartDate=n.periodStartDate.replace(/['"]+/g,""),n.periodEndDate=n.periodEndDate.replace(/['"]+/g,""),n.periodStartDate=s.parseZone(n.periodStartDate),n.periodEndDate=s.parseZone(n.periodEndDate);var e=s.utc(),t=s.duration(s.utc(n.periodEndDate).diff(s.utc(n.periodStartDate))),t=parseInt(t.asMilliseconds()/1e3/n.refreshTime),e=s.duration(e.diff(n.periodStartDate)),e=parseInt(e.asMilliseconds()/1e3/n.refreshTime);n.lbData.challengeStartDate=n.periodStartDate,n.lbData.challengeEndDate=n.periodEndDate,n.lbData.currentChallengeDayIndex=e,n.lbData.leaderboardDayIndex=t,i(n.lbData.currentChallengeDayIndex)},n.setGenericPeriodData=function(){n.periodStartDate=n.periodStartDate.replace(/['"]+/g,""),n.periodEndDate=n.periodEndDate.replace(/['"]+/g,""),n.periodStartDate=s.parseZone(n.periodStartDate).utc(),n.periodEndDate=s.parseZone(n.periodEndDate).utc();var e=s().diff(n.periodStartDate,"days");n.lbData.challengeStartDate=n.periodStartDate,n.lbData.challengeEndDate=n.periodEndDate,n.lbData.currentChallengeDayIndex=e,n.lbData.leaderboardDayIndex=e,i(n.lbData.leaderboardDayIndex)},n.setRasulData=function(){n.calStartDate=new Date(n.startDate),n.calEndDate=new Date(n.endDate);var e=n.calEndDate.getTime()-n.calStartDate.getTime(),e=parseInt(e/1e3/n.countBy);n.lbData.challengeStartDate=n.calStartDate,n.lbData.challengeEndDate=n.calEndDate,n.lbData.currentChallengeDayIndex=e,n.lbData.leaderboardDayIndex=e,i(n.lbData.leaderboardDayIndex)},"challenge"==n.type?(a=!1,r.load(n.type,o,a=a||!1).then(function(e){n.lbData.challengeStartDate=e.startDate,n.lbData.challengeEndDate=e.endDate,n.lbData.currentChallengeDayIndex=e.chronology.dayIndexBound,n.lbData.leaderboardDayIndex=e.chronology.dayIndexBound,n.lbData.isOpen=e.chronology.isOpen,n.lbData.isPending=e.chronology.isPending,i(n.lbData.leaderboardDayIndex)})):"generic_period"==n.type?n.setGenericPeriodData():"rasul"==t.type?n.setRasulData():n.setGTValues()}}}]),e.directive("pulseChallengeFinal",["patronicityConfig","User","GivingManager","GivingSettingsManager",function(e,s,c,l){return{restrict:"E",scope:{},templateUrl:e.urlForTemplate("pulse/challenge-final.html"),link:function(a,e,t){var o,i="dhul_hijjah_2019",r="challenge";a.isLoggedIn=s.isLoggedIn(),a.data={isMember:!1,userStats:{daysDonated:0,DonatedAmount:0,CurrencyCode:"USD",ReferredUserCount:0,TotalRaisedBySupportedCampaigns:0}},o=o||!1,s.get().then(function(){var n;a.data.user=s.current(),c.load(r,i,o).then(function(e){a.data.isOpen=e.chronology.isOpen,a.data.dayIndexUnbound=e.chronology.dayIndexUnbound,a.data.userStats.ReferredUserCount=e.user&&e.user.referredUsers?e.user.referredUsers.count:0,a.data.signedUp=e.signedUp}),s.isLoggedIn()&&(n=o||!1,l.load(r,i).then(function(e){e.state&&"active"==e.state&&(a.data.isMember=!0),c.userStats(r,i,n).then(function(e){var t=0;n&&(a.data.userStats.daysDonated=0),a.data.isMember?e.entries.forEach(function(e){e.Donated&&(t+=1)}):t=e.userStats.TotalDonorCount,a.data.userStats.daysDonated=t,a.data.userStats.DonatedAmount=e.userStats.DonatedAmount||0,a.data.userStats.CurrencyCode=e.userStats.CurrencyCode||"USD",a.data.userStats.TotalRaisedBySupportedCampaigns=e.userStats.TotalRaisedBySupportedCampaigns||0,console.log(a.data)})}))})}}}]),e.directive("donationCategoryBreakdownChart",["api",function(o){return{restrict:"E",scope:{},template:'<div google-chart chart="chartObject" style="height:380px; width:100%;"></div>',link:function(n,e,t){n.dateRange={start:void 0===t.start?"2019-05-03 05:00:00":t.start,end:void 0===t.end?"2019-06-05 05:00:00":t.end},n.chartObject={},n.chartObject.type="PieChart";var a=void 0===t.type?"site_categories":t.type;n.chartObject.options={displayAnnotations:!0,pieHole:.4},n.reloadData=function(){o.project.donationCategoryChart(a,n.dateRange.start,n.dateRange.end).then(function(e){n.chartObject.data=e;for(var t=0;t<n.chartObject.data.rows.length;t++)n.chartObject.data.rows[t].c[1].v=Number(n.chartObject.data.rows[t].c[1].v)})},n.reloadData()}}}]),e.directive("givingTuesdayStats",["api","patronicityConfig",function(a,e){return{restrict:"E",templateUrl:e.urlForTemplate("pulse/giving-tuesday-stats.html"),scope:{projectId:"@"},link:function(t,e,n){t.loading=!0,t.data={},t.$watch("projectId",function(e){void 0!==e&&""!==e&&a.project.statsPanel(e).then(function(e){t.data.stats=e,t.loading=!1},function(e){alert("Unable to load project information: "+e+"!")})})}}}])}(),function(){var e=angular.module("patronicity.rasul",["patronicity.api","user","patronicity.configuration"]);e.directive("rasulSignup",["patronicityConfig","api",function(e,a){return{restrict:"E",scope:{signupType:"@?"},templateUrl:"rasul-signup.html",link:function(t,e,n){t.data={},t.resetFields=function(){var a;delete t.data.userFields,t.data={error:void 0,resultMessage:void 0,isError:!1,signupComplete:!1,previousMember:!1,preEnrolledComplete:!1,userFields:{rasul_src:(a={},window.location.href.replace(/[?&]+([^=&]+)=([^&]*)/gi,function(e,t,n){a[t]=n}),a.src)}}},t.resetFields(),t.create=function(){void 0!==t.signupType&&(t.data.userFields.type=t.signupType),a.giving.rasul.join(t.data.userFields).then(function(e){t.resetFields(),"preenrolled"==e.type?(t.data.resultMessage="You have successfully pre-enrolled for Rasul Week!",t.data.preEnrolledComplete=!0):(t.data.resultMessage="You have successfully joined Rasul Week! Check your inbox for confirmation.",t.data.signupComplete=!0),document.querySelector(".rasul--signup-form").style.height="0",document.querySelector(".rasul-temp-button").style.visibility="visible",document.querySelector(".rasul-temp-button").style.height="56px"},function(e){2==e?(t.data.resultMessage="Looks like you've already signed up for Rasul Week using this email!",t.data.previousMember=!0):4==e?(t.data.resultMessage="Looks like you've already pre-enrolled for Rasul Week!",t.data.previousMember=!0):(t.data.resultMessage="There was an error. Please try again!",t.data.isError=!0)})},t.$watch("signupType",function(e){void 0!==e&&(t.data.userFields.type=e)})}}}]),e.directive("rasulDaySection",["patronicityConfig","moment","$interval",function(e,r,s){return{restrict:"EA",link:function(t,e,n){t.loading=!0,t.topData={activeTab:"raised"},t.setActiveTab=function(e){t.topData.activeTab=e};var a=r.parseZone(n.startDate).utc(),o=r.parseZone(n.endDate).utc(),i="days";switch(n.unit){case"days":case"hours":case"minutes":case"seconds":i=n.unit}t.totalUnitCount=function(){return o.diff(a,i)},t.currentUnitValue=function(){return r().diff(a,i)+1},t.isInPeriod=function(){return r().utc().isBetween(a,o)},t.isAfter=function(){return r().utc().isAfter(o)},t.isBefore=function(){return r().utc().isBefore(a)},t.isShownForUnit=function(e){return t.isInPeriod()&&e==t.currentUnitValue()},s(function(){t.currentUnitValue()},1e3)}}}]),e.directive("rasulEventSection",["patronicityConfig","moment",function(e,o){return{restrict:"E",scope:{},templateUrl:"rasul-event-section.html",link:function(e,t,n){e.loading=!0,e.data={events:[{startDate:"2020-10-16T18:30:00.000Z",subtitle:"Friday Gems",title:"Preparing for Rabi ul-Awwal"},{startDate:"2020-10-17T20:00:00.000Z",subtitle:"Welcoming Rabi ul-Awwal",title:"Learning & Living the Sunnah"},{startDate:"2020-10-18T00:30:00.000Z",subtitle:"",title:"His Beauty & Humor"},{startDate:"2020-10-19T00:30:00.000Z",subtitle:"",title:"His Home & Lifestyle"}]};for(var a=0;a<e.data.events.length;a++)e.data.events[a].startMoment=o.parseZone(e.data.events[a].startDate).utc();console.log(e.data.events),e.sortMoment=function(e,t){return t.value.startMoment.isBefore(e.value.startMoment)?1:-1}}}}]),e.directive("rasulEventItem",["patronicityConfig","moment",function(e,a){return{restrict:"E",scope:{},templateUrl:"rasul-event-item.html",link:function(e,t,n){e.loading=!0,e.data={error:void 0,resultMessage:void 0,isError:!1,event:{}},e.data.event.startMoment=a.parseZone(n.startDate).utc(),e.data.title=n.title,e.data.subtitle=n.subtitle,console.log(e.data),e.sortMoment=function(e,t){return t.value.startMoment.isBefore(e.value.startMoment)?1:-1}}}}]),e.directive("rasulSalawatCounters",["patronicityConfig","api",function(e,a){return{restrict:"E",scope:{},templateUrl:"salawat-counters.html",link:function(t,e,n){t.getSalawatCounter=function(){a.giving.rasul.salawatCounter().then(function(e){t.data=e})},t.getSalawatCounter()}}}]),e.directive("communityRaisedStat",["patronicityConfig","api",function(e,a){return{restrict:"E",scope:{},template:"<span>{{cpsData.stats.stats.fundedAmount | money : 'USD'}}</span>",link:function(t,e,n){t.cpsData={stats:{}},t.getStat=function(){n.slug&&a.communityPage.statsBySlug(n.slug).then(function(e){t.cpsData.stats=e,console.log(t.cpsData)})},t.getStat()}}}])}(),angular.module("patronicity.buttons.refund",["ui.bootstrap","patronicity.configuration"]).directive("refundButton",["patronicityConfig",function(i){return{restrict:"E",scope:{donation:"="},template:'<a class="btn btn-primary btn-sm btn-block" ng-show="donation.CanRefund == \'1\'" ng-click="refund(donation)">{{ donation.RefundLabel }}</a>',controller:["$scope","$uibModal","$filter","api",function(n,e,a,t){n.refund=function(o){e.open({templateUrl:i.urlForTemplate("donation-refund-modal.html"),controller:["$scope","$uibModalInstance","title","api",function(t,e,n,a){t.params={reason:"duplicate"},t.title=n,t.loading=!0,t.error="",t.canRefund=!1,a.refund.info(o.ID).then(function(e){"warn"==e.status?(t.error="The account balance for this campaign is LESS than the refund amount. Are you sure that you want to issue a refund?",t.canRefund=!0):"forbid"==e.status?(t.error="Campaign is closed and balance is lower than the refund amount. You can't make the refund.",t.canRefund=!1):t.canRefund=!0}).catch(function(e){t.error=e}).finally(function(){t.loading=!1}),t.cancel=function(){e.dismiss("cancel")},t.ok=function(){t.params.logRefund=!t.canRefund,t.params.doRefund=!0,e.close(t.params)}}],resolve:{title:function(){var e=parseFloat(n.donation.SourceAmount)+parseFloat(n.donation.SourceDonatedFeeAmount),t=n.donation.SourceCurrency;return n.donation.RefundLabel+" from "+n.donation.FirstName+" "+n.donation.LastName+" ("+a("money")(e,t)+" "+t+")"}}}).result.then(function(e){e.doRefund&&t.refund.refund(n.donation.ID,e).then(function(e){e.Amount=parseFloat(e.Amount),e.AddedDate=new Date(e.AddedDate),n.donation=e,n.$emit("donation-changed",{id:e.ID,donation:e})},function(e){alert(e)})})}}]}}]),angular.module("patronicity.report.generator",["patronicity.configuration","patronicity.report.logstream"]).directive("reportButton",["api","patronicityConfig","$timeout","LogStream",function(i,n,r,s){return{restrict:"E",scope:{identifier:"@",format:"@?",label:"@?",type:"@?",buttonClass:"@?",templateUrl:"@?"},replace:!0,templateUrl:function(e,t){t=t.templateUrl||"report-button.html";return n.urlForTemplate("report/"+t)},link:function(a){a.data={label:"Loading...",disabled:!0,message:"",class:"",href:"",state:"loading",buttonClass:a.buttonClass||"btn btn-primary"};var n=a.label||"Report";function t(e){switch(a.data.state=e.state,e.state){case"none":a.data.label="Generate "+n+"...",a.data.disabled=!1;break;case"generating":a.data.label="Generating...",a.data.disabled=!0,t=e.identifier,s.open(t,a);break;case"done":a.data.label="Download "+n,a.data.disabled=!1,a.data.href=e.url,t=1e3*(e.link_ttl-20),r(function(){o()},t)}var t}function o(){i.reports.status(a.identifier,a.format).then(function(e){t(e)},function(e){alert(e)})}a.$on("complete",function(e,t){a.data.message="",o()}),a.$on("message",function(e,t){a.data.message=t.message;var n="normal",n=t.level<300?"":t.level<400?"text-warning":"text-danger";a.data.class=n}),a.click=function(e){"none"==a.data.state?(e.preventDefault(),i.reports.generate(a.identifier,a.format).then(function(e){t(e)},function(e){alert(e)})):a.data.state},o()}}}]),angular.module("patronicity.report.logstream",["patronicity.configuration","patronicity.api"]).factory("LogStream",["$timeout",function(i){return{open:function(e,t,n){return a=t,(o=new EventSource("/api/logStream/stream/"+e)).addEventListener("message",function(t){i(function(){var e=t.data.split("|");3==e.length?a.$emit("message",{level:e[0],message:e[1],context:e[2]}):a.$emit("message",{level:800,message:t.data,context:"[]"})},0)},!1),o.addEventListener("open",function(e){},!1),o.addEventListener("complete",function(e){i(function(){a.$emit("complete",{source:o}),o.close(),o=void 0},0)},!1),o.addEventListener("error",function(e){console.log("Connection error!"),e.readyState==EventSource.CLOSED&&console.log("Connection was closed!")},!1),o;var a,o},close:function(e){e.close()}}}]),function(){var e=angular.module("patronicity.sentry",["user"]);e.run(["SentryService","User","$rootScope",function(o,i,e){window.LGSentry={log:!1},i.get().then(function(){var e=i.getEnvironment(),t=i.isSentryEnabled(),n=i.sentryRelease(),a=i.isSentryTracking();t&&(o.init(e,t,a,n),i.loggedIn()?o.assignUser(i.current()):o.assignUser(null))}),e.$on("user:login-change",function(e,t){t.loggedIn?o.assignUser(t.user):o.assignUser(null)})}]),e.service("SentryService",["$window",function(o){var i=!1;return{assignUser:function(t){i&&(t?window.Sentry.configureScope(function(e){e.setUser({id:t.ID,name:t.Name,email:t.Email})}):window.Sentry.configureScope(function(e){e.setUser(null)}))},init:function(e,t,n,a){o.Sentry?(n={dsn:"https://36836f98dd614bb09435890db91261c6@o423510.ingest.sentry.io/5573276",autoSessionTracking:n,environment:e,integrations:[new o.Sentry.Integrations.Angular,new o.Sentry.Integrations.BrowserTracing({tracingOrigins:["localhost",/^\//]}),new o.Sentry.Integrations.GlobalHandlers({onerror:!0,onunhandledrejection:!0})],sessionTrackingIntervalMillis:1e4,tracesSampleRate:1},a&&(n.release=a),o.Sentry.init(n),i=!0,window.LGSentry.log=t,angular.module("patronicity.sentry").requires.push("ngSentry")):console.log("Sentry not initialize")}}}]),e.provider("$sentry",function(){this.$get=function(){return{log:function(e,t){window.LGSentry.log&&window.Sentry.captureMessage(e,t)},captureException:function(e){window.LGSentry.log&&window.Sentry.captureException(e)}}}}),e.config(["$provide",function(e){e.decorator("$exceptionHandler",["$delegate","$sentry",function(n,a){return function(e,t){n(e,t),a.captureException(e)}}])}]),e.directive("sentryTest",["$sentry",function(t){return{restrict:"E",scope:{},template:'<div><a class="btn btn-primary btn-block" ng-click="testException($event)">Test Exception</a><br/><a class="btn btn-primary btn-block" ng-click="testMessage($event)">Test Message</a></div>',link:function(e){e.testMessage=function(e){e.preventDefault(),t.log("Test message!",1)},e.testException=function(e){e.preventDefault();try{throw"Test Exception!"}catch(e){t.captureException(e)}}}}}])}(),angular.module("patronicity.sharing",["patronicity.api","patronicity.configuration"]).directive("shareProjectButtons",["$timeout","api","patronicityConfig","User","$analytics",function(e,n,t,a,s){return{restrict:"E",templateUrl:t.urlForTemplate("project-share-buttons.html"),scope:{projectId:"@"},link:function(o,e,t){o.visible=!1;var i=location.pathname.split("/").pop();function r(e){n.updateShareCounter(o.projectId,e).then(function(e){o.project.ShareCounter=e.shareCounter},function(e){alert(e)})}"thankyou"==t.usedOn?(o.topStyle={width:"auto"},o.shareCounterClass="impact",o.shareCounterStyle={}):(o.topStyle={},o.shareCounterClass="",o.shareCounterStyle={"font-size":"25px"}),o.$watch("projectId",function(){o.projectId?n.getShareInformationForProject(o.projectId).then(function(e){o.project=e,o.visible=!0},function(e){}):console.log("no project Id specified for share buttons")}),o.facebookPostResult=function(e,t){"success"==e&&r("fbshare"),s.eventTrack("facebook",{category:"share",label:i})},o.sendEmail=function(){return r("emailshare"),!0},o.likeProject=function(){n.toggleProjectLike(o.projectId).then(function(e){e.liked?(o.project.CurrentUserLikes=!0,r("like")):(o.project.CurrentUserLikes=!1,r("unlike"))},function(e){alert(e)})},o.tweet=function(e){var t=($(window).width()-575)/2,n=($(window).height()-400)/2,a=o.project.TwitterShareUrl;return window.open(a,"twitter","status=1,width=575,height=400,top="+n+",left="+t),r("twittershare"),e.preventDefault(),s.eventTrack("twitter",{category:"share",label:i}),!1},o.facebookLogin=function(e,t){"success"==e&&t.email.trim().length&&a.facebookLoginOrRegister(t.email,t.first_name,t.last_name,t.name,t.id).then(function(){},function(e){alert(e)})}}}}]),function(){var e=angular.module("patronicity.startproject",["ui.bootstrap","patronicity.api","user"]);e.directive("startProject",["patronicityConfig","api","$window","User","$analytics","$location","CurrencyCodeProvider",function(o,i,r,s,c,l,u){return{restrict:"E",templateUrl:o.urlForTemplate("start-project/start-project.html"),scope:{sponsorId:"@",defaultCampaign:"@?"},link:function(n,e,t){n.newProject={goal:"",title:"",location:"",campaign:"defaultCampaign",sponsors:[],currencycode:"USD",currencylabel:"$ USD",communities:[]},n.sponsorCurrency=!1,n.application=o.applicationName,n.user="",n.title_locked=!1,n.currencies=[],n.repeatCc=!1,n.repeatCcLevel1=!1,n.getSponsorId=function(){var e,t;return n.newProject.sponsors.length?e=n.newProject.sponsors[0]:(t=l.search()).sponsorId?e=t.sponsorId:n.sponsorId&&(e=n.sponsorId),e},n.getCommunityId=function(){var e,t=l.search();return e=t.communityId?t.communityId:e},s.get().then(function(){n.user=s.current(),n.user&&(n.repeatCc=n.user.RepeatCC,n.repeatCcLevel1=n.user.RepeatCCLevel1)});var a=!1;n.canSubmit=function(){var e=!1;return e=n.goalValid()&&""!==n.newProject.title&&!a?!0:e},n.goalValid=function(){return""!==n.newProject.goal&&void 0!==n.newProject.goal},n.buttonLabel=function(){return a?"Creating...":"Next"},n.createProject=function(){n.newProject.sponsors=[n.getSponsorId()],n.getCommunityId()&&(n.newProject.communities=[n.getCommunityId()]),a=!0,s.isLoggedIn()?i.projectAdmin.createProject(n.newProject).then(function(e){c.eventTrack("CreateCampaign",{category:"campaign",label:new Date,value:e.projectId.toString(),hitCallback:r.location.href=e.editUrl})},function(e){alert(e),a=!1}):s.loginModal(!1).then(function(e){i.projectAdmin.createProject(n.newProject).then(function(e){c.eventTrack("CreateCampaign",{category:"campaign",label:new Date,value:e.projectId.toString(),hitCallback:r.location.href=e.editUrl})},function(e){alert("There was an error creating your project.  Please try again."),a=!1})},function(e){alert(e),a=!1})},n.setCurrencyCode=function(t){angular.forEach(n.currencies,function(e){e.value==t&&(n.newProject.currencylabel=e.label)}),n.newProject.currencycode=t},u.supportedCodes("project").then(function(e){n.currencies=e.map(function(e){return{label:e.symbol+" "+e.code,value:e.code}})}).then(function(){var t=n.getSponsorId();t&&i.sponsor.createProjectFields(t).then(function(e){e.currency&&(n.setCurrencyCode(e.currency),n.sponsorCurrency=e.currency),e.title&&(n.newProject.title=e.title),e.title_locked&&(n.title_locked=e.title_locked),n.newProject.sponsors=[t]},function(e){console.error(e)})},function(e){console.error(e)})}}}]),e.directive("headerGreet",["patronicityConfig","User",function(e,a){return{restrict:"E",scope:{},templateUrl:e.urlForTemplate("start-project-v2/header.html"),link:function(n,e,t){n.user=void 0,a.loggedIn()&&(n.user=a.current()),n.$on("user:login-change",function(e,t){t.loggedIn?n.user=t.user:n.user=null})}}}]),e.directive("startProjectV2",["patronicityConfig","$rootScope",function(e,t){return{restrict:"E",templateUrl:e.urlForTemplate("start-project-v2/start-project.html"),scope:{sponsorId:"@",sponsorCurrency:"@?",defaultCampaign:"@?"},link:function(n,e,t){n.backBtnDisabled=!0,n.nextBtnDisabled=!1,n.processing=!1,n.buttonLabel=function(){var e="Next ";return e=n.processing?"Updating...":e},n.setupProject=function(){n.$broadcast("create-project")},n.canSubmit=function(){return n.canSubmitForm="",n.$broadcast("can-create-project",{},function(e){n.canSubmitForm=e}),n.canSubmitForm},n.backToPrevious=function(){n.$broadcast("back-panel"),n.backBtnDisabled=!0},n.$on("disableBackBtn",function(e,t){n.backBtnDisabled=!1})}}}]),e.directive("additionalForm",["patronicityConfig","api","$rootScope","$window",function(e,o,t,i){return{restrict:"E",scope:{accountId:"@?"},templateUrl:e.urlForTemplate("start-project-v2/additional_form.html"),link:function(t,e,n,a){t.nextBtnLabel="Submit",t.backBtnLabel="Cancel",t.form_submitted=!1,t.btnPanel=!0,t.data={},t.save=function(){o.projectAdmin.account.saveAdditionalForm(t.data,t.accountId).then(function(e){i.scrollTo(0,0),t.btnPanel=!1,t.form_submitted=!0},function(e){alert("An error occurred: "+e)})},t.backToPrevious=function(){i.history.back()}}}}]),e.directive("projectSponsorOptions",["patronicityConfig","mvCountryLoader","$location","$document",function(e,a,t,n){return{restrict:"E",templateUrl:e.urlForTemplate("start-project/project-sponsor-options.html"),link:function(o,e,t){var n;"patronicity"==o.application&&(o.sponsors=[{id:1,slug:"medc_mshda",program_name:"Public Spaces, Community Places",region_label:["michigan"],description:"Is the goal of your project to improve Michigan's public spaces and community places? If so, apply for a matching grant from Michigan Economic Development Corporation (MEDC).<a target='_blank' href='https://www.patronicity.com/puremichigan'> View program overview page here.</a>"},{id:4,slug:"creating_places",program_name:"CreatINg Places",region_label:["indiana"],description:"CreatINg Places is an innovative funding program created by the Indiana Housing and Community Development Authority (IHCDA) to activate Indianas underused public spaces. Through CreatINg Places, municipalities and nonprofits can apply to crowdfund for their placemaking projects; successful campaigns will receive a matching grant from IHCDA.<a target='_blank' href='https://www.patronicity.com/creatingplaces'> View program overview page here.</a>"},{id:22,slug:"mgcc2",program_name:"Biz-M-Power",region_label:["massachusetts"],description:"<p>YOU MUST BE CONDITIONALLY APPROVED BY MGCC PRIOR TO STARTING THE CROWDFUNDING CAMPAIGN. IF YOU HAVE NOT COMPLETED A SUBMITTABLE APPLICATION, PLEASE START THAT HERE FIRST - <a target='_blank' href='https://patronicity.com/bizmpower'>www.Patronicity.com/BizMPower</a></p><p>This program provides a matching grant to low and moderate income entrepreneurs and small business owners in Massachusetts who have been challenged to access financing to startup and grow their business.</p>"},{id:17,slug:"sustainable_ct",program_name:"Sustainable CT Community Match Fund",region_label:["connecticut"],description:"Sustainable CTs Community Match Fund is an innovative program that provides fast, flexible funding and support for engaging your community on wide-ranging sustainability projects. Anyone in a Sustainable CT registered municipality can participate and eligible projects will receive dollar-for-dollar matching funds from Sustainable CT.<a target='_blank' href='https://www.patronicity.com/sustainablect'> View program overview page here.</a><br/><b>Please note: before getting started you need to share your project idea with Sustainable CT.</b> If you have not already spoken with Sustainable CT about your project, please reach out to their Community Outreach Manager, Joseph Dickerson before submitting any further information. Contact Joseph to schedule a call <a href='https://outlook.office365.com/owa/calendar/SustainableCTCommunityMatchFund@myeasternct.onmicrosoft.com/bookings/'>HERE</a>."},{id:20,slug:"vermont",program_name:"Vermont Better Places",region_label:["vermont"],description:"Better Places is a community matching grant program empowering Vermonters to create inclusive and vibrant public places serving Vermont's designated downtowns, village centers, new town centers, or neighborhood development areas.<a target='_blank' href='https://www.patronicity.com/betterplacesvt'> View program overview page here.</a>"},{id:21,slug:"bwsf",program_name:"Black Wall Street Forward",region_label:["north carolina"],description:"The Black Wall Street Forward initiative is modeled on the pillars that made Durham's original Black Wall Street successful, and aims to continue the legacy of this vibrant work by supporting and catalyzing local leaders, Black business owners, and champions.<a target='_blank' href='https://www.patronicity.com/bwsf'> View program overview page here.</a>"}]),o.selectedState="",o.activeSponsors=[],o.activeDescription="",o.regions=[],a.then(function(e){void 0!==e&&angular.forEach(e,function(e){"CA"==e.Code&&o.regions.push(e.Name),"US"==e.Code&&void 0!==e.States&&angular.forEach(e.States,function(e){o.regions.push(e.Name)})})}),o.stateUpdate=function(e){o.activeSponsors=[],o.activeDescription="";var n=e.toLowerCase(),t=o.sponsors;o.newProject.location=e,t.forEach(function(t){var e=t.region_label;t.isActive=!1,angular.forEach(e,function(e){e.includes(n.toLowerCase())&&o.activeSponsors.push(t)})}),o.activeSponsors.push({id:null,slug:"no_program",program_name:"No Program? No Problem!",region_label:["no_program"],description:"Weve worked with awesome projects outside of Partnered Programs and helped them meet their goal and do great things in their communities, so fund on!"}),1==o.activeSponsors.length&&"no_program"==o.activeSponsors[0].slug&&(o.activeSponsors[0].isActive=!0,e=o.activeSponsors[0].description,o.activeDescription=e)},o.programSelect=function(t,n,a){n.forEach(function(e){e.slug==n[t].slug?(n[t].isActive=!n[t].isActive,n[t].isActive?(a&&(o.newProject.sponsors=[a]),o.activeDescription=n[t].description):(o.activeDescription="",o.newProject.sponsors=[])):e.isActive=!1})},o.getSponsorId()&&(n=o.getSponsorId(),o.sponsors.forEach(function(e){n==e.id&&(o.newProject.sponsors=[e.id],e.isActive=!0,o.activeSponsors.push(e),o.activeDescription=e.description)})),o.$watch("selectedState",function(e,t){console.log("Old value: "+t+" New Value: "+e),null==e&&(console.log("less than"),o.activeSponsors=[],o.activeDescription="")})}}}]),e.directive("sponsorCauseSelection",["$uibModal","patronicityConfig","api",function(o,i,r){return{restrict:"E",template:'<div ng-class="getItemClass()"><img class="img-responsive irusa-category-button" ng-src="{{currentCommunity.image}}" alt="IRUSA {{currentCommunity.label}} - {{currentCommunity.tooltip}}" ng-click="showSponsorSelectionModal()"><p class="lead text-center">{{currentCommunity.label}}</p></div>',scope:{communityId:"@",groupname:"@",itemClass:"@"},link:function(t,e,n){t.currentCommunity={},t.communities=[{id:1087,label:"Birthday",image:"//media.launchgood.com/06bc2411f7284f2a6f474e36ab2b263173b8c480/img/irusa/1.svg",tooltip:"Give the gift of charity"},{id:1088,label:"Wedding",image:"//media.launchgood.com/06bc2411f7284f2a6f474e36ab2b263173b8c480/img/irusa/3.svg",tooltip:"Celebrate your special day"},{id:1089,label:"Memorial",image:"//media.launchgood.com/06bc2411f7284f2a6f474e36ab2b263173b8c480/img/irusa/4.svg",tooltip:"Honor a loved one"},{id:1090,label:"General",image:"//media.launchgood.com/06bc2411f7284f2a6f474e36ab2b263173b8c480/img/irusa/2.svg",tooltip:"Show that you care"},{id:1999,label:"Challenges",image:"//media.launchgood.com/06bc2411f7284f2a6f474e36ab2b263173b8c480/img/irca/irca_challenges.jpg",tooltip:"Help make a difference in the world while also creating irreplaceable memories by participating in one of our national or international Challenges"},{id:1995,label:"Birthday",image:"//media.launchgood.com/06bc2411f7284f2a6f474e36ab2b263173b8c480/img/irca/irca_birthday.jpg",tooltip:"On your special day, in place of gifts, use your spotlight to shed light on a cause that's important to you."},{id:1998,label:"Wedding",image:"//media.launchgood.com/06bc2411f7284f2a6f474e36ab2b263173b8c480/img/irca/irca_wedding.jpg",tooltip:"In lieu of wedding gifts, ask your guests to donate to a cause that needs support."},{id:1996,label:"General",image:"//media.launchgood.com/06bc2411f7284f2a6f474e36ab2b263173b8c480/img/irca/irca_general.jpg",tooltip:"You have the power to help save lives. Do your part and make a difference."},{id:1997,label:"Memorial",image:"//media.launchgood.com/06bc2411f7284f2a6f474e36ab2b263173b8c480/img/irca/irca_memorial.jpg",tooltip:"Honour a loved one by supporting an ongoing humanitarian cause in their memory."},{id:2526,label:"Volunteer Abroad",image:"//media.launchgood.com/06bc2411f7284f2a6f474e36ab2b263173b8c480/img/irca/irca_volunteer.jpg",tooltip:"Volunteer Abroad with Islamic Relief on incredible journeys."}],t.loadSponsorCausesData=function(){r.projectAdmin.sponsorCauses.load({count:50,exact:{group:t.groupname},sorting:{SortOrder:"asc"}}).then(function(e){t.sponsors=e.items},function(e){})},t.loadSponsorCausesData(),t.getItemClass=function(){return t.itemClass||"col-sm-3 col-xs-6"};var a;t.currentCommunity=(angular.forEach(t.communities,function(e){t.communityId==e.id&&(a=e)}),a),t.showSponsorSelectionModal=function(){o.open({templateUrl:i.urlForTemplate("sponsorCauseSelectionModal.html"),controller:["$scope","$uibModalInstance","currentCommunity","sponsors","$window",function(e,t,n,a,o){e.currentCOmmunity=n,e.sponsors=a,e.cancel=function(){t.dismiss()},e.ok=function(){t.close()},e.selectSponsor=function(e){var t="/projects/start#!/",t=(t+="?sponsorId="+e.SponsorID)+("&communityId="+n.id);o.location.href=t}}],size:"lg",resolve:{currentCommunity:function(){return t.currentCommunity},sponsors:function(){return t.sponsors}}}).result.then(function(e){})}}}}])}(),angular.module("patronicity.streams",["patronicity.api","patronicity.configuration"]).directive("donationLogNewSupporter",["patronicityConfig","api","$timeout","GlobalStatsManager",function(e,r,s,t){return{restrict:"E",scope:{},templateUrl:e.urlForTemplate("donation-log-new-supporter.html"),link:function(n){function a(){var e,t;n.data.pending.length&&(e=n.data.pending.shift(),s(function(){n.data.lastOffset=t.Offset,"display"==t.Type?(o(t),a()):"load"==t.Type&&i(!1,t.LoadTime)},1e3*((t=e).Offset-n.data.lastOffset)))}function o(e){n.data.supporters.unshift(e),t.updateStat("total_funded",e.USDRunningTotal)}function i(e,t){console.log("Loading "+e+" Start Time: "+t),r.donationStream.load({initial:e,start:t}).then(function(e){parseInt((Date.now()-new Date(e.now).getTime())/1e3);angular.forEach(e.entries,function(e,t){e.Offset<0?o(e):n.data.pending.push(e)}),n.data.lastOffset=0,a()})}n.data={supporters:[],pending:[],lastOffset:0},i(!0)}}}]),function(){var e=angular.module("patronicity.buttons",["ui.bootstrap","ngSanitize","mv.billing","mv.widgets","mv.facebook","ng.deviceDetector","patronicity.configuration","patronicity.payment_providers","vcRecaptcha","patronicity.sentry","patronicity.payment_methods"]);e.factory("supportInfo",["api","User","$rootScope","$timeout","$q",function(o,e,t,i,r){var n=[],a=[];function s(e){var t=[e],n=r.defer(),a=!0;return this.addToLoadList=function(e){t.push(e)},this.getPromise=function(){return n.promise},this.isAvailable=function(){return a},i(function(){a=!1,o.cards.supportInfo(t).then(function(e){n.resolve(e)},function(e){n.reject(e)})},500),this}return t.$on("user:login-change",function(e,t){n=[]}),{clear:function(){n=[]},clearForProjectId:function(e){n[e]&&0==n[e].$$state.status&&n[e].reject(),delete n[e]},load:function(e){var t;return void 0===n[e]&&(0!==a.length&&a[a.length-1].isAvailable()?a[a.length-1].addToLoadList(e):a.push(new s(e)),t=a[a.length-1],n[e]=t.getPromise()),n[e]}}}]),e.directive("newSupportButton",["$uibModal","api","$window","detectUtils","$stateParams","supportInfo","ProjectCardManager","Thankyou","$timeout","ThankyouRedirectHelper",function(s,c,l,u,d,p,m,g,f,h){return{restrict:"EA",link:function(a,e,o){function i(n){p.load(n).then(function(e){var t=!1;angular.forEach(e,function(e){e.id==n&&(a.message=e.buttonText,a.allowDonation=e.enabled,a.userSupported=e.supported,a.allowDonation&&d.donate&&a.support(d.rewardID),t=!0)}),t||(a.message="Donation Error (Not Available)")},function(e){a.message="Donation Not Available"})}function r(t,e){var n=a.source;a.supporting||(a.supporting=!0,s.open({template:"<donation-manager></donation-manager>",controller:["$scope","$uibModalInstance","project","rewardID","Thankyou","source","ThankyouRedirectHelper",function(e,t,n,a,o,i,r){e.project=n,e.initialRewardID=a,e.isModal=!0,void 0!==i&&""!==i&&m.setSource(i),e.cancel=function(){t.dismiss("cancel")},e.closeDialog=function(e){t.close(e)},r.thankYouUrl(n).then(function(e){console.log("This is where we will go: "+e)})}],resolve:{project:function(){return t},rewardID:function(){return e},source:function(){return n}},backdrop:"static",windowClass:"modal-on-top"}).result.then(function(e){a.supporting=!1,window.heap&&window.heap.track("Completed Donation",{"Donation ID":e.id}),f(function(){e.donated&&(o.donationComplete?(a.donationComplete({donation:e}),g.showModal(e.id),p.clear(),i(t.ID)):h.thankYouUrl(t).then(function(e){console.log("going to "+e),l.location.href=e}))},1e3)},function(e){a.supporting=!1}).finally(function(e){window.heap&&window.heap.track("Completed Donation",{"Donation ID":e.id}),f(function(){e.donated&&(o.donationComplete?(a.donationComplete({donation:e}),g.showModal(e.id),p.clear(),i(t.ID)):h.getThankYouDestination(t).then(function(e){console.log("going to "+e),l.location.href=e}))},1e3)}))}a.message="Loading...",a.allowDonation=!1,a.userSupported=!1,void 0===a.handleEvents&&(a.handleEvents=!1),a.$watch("projectId",function(e){void 0!==e&&""!==e&&i(e)}),a.buttonMessage=function(){return a.forceLabel||a.message},a.buttonClass=function(){var e="btn btn-block btn-lg btn-warning";return e=a.forceClass?a.forceClass:e},a.$on("project:reward-selected",function(e,t){a.handleEvents&&t.ProjectID==a.projectId&&a.allowDonation&&a.support(t.RewardID)}),a.urlSrc=function(){var e;return e=m.getSource()&&""!=m.getSource()?"?src="+m.getSource():e},a.support=function(t){var e,n;a.projectId||alert("You must supply either the project ID or the project to the support button!"),a.allowDonation&&(u.isIOS()||1==l.useDonationPage?(e="/project/donate/"+a.projectId,t&&(e+="/"+t),n=!1,a.challengeId&&""!==a.challengeId&&(e+="?challengeId="+a.challengeId+"&aftercomplete="+encodeURIComponent(o.afterComplete),n=!0),""!=h.findSource()&&(e+=(n?"&":"?")+"src="+h.findSource()),l.location.href=encodeURI(e)):a.project?c.donate.minimumProjectInfo(a.project.ID).then(function(e){r(e,t)}):c.donate.minimumProjectInfo(a.projectId).then(function(e){r(e,t)}))}},scope:{projectId:"@",donationComplete:"&?",slug:"@?",forceLabel:"@?",forceClass:"@?",challengeId:"@?",handleEvents:"@?",disableButton:"@?",url:"@?",source:"@?"},template:function(e,t){var n="";switch(t.buttonType){case"project-card":n='<div class="btn-group btn-group-justified" role="group"><a class="btn btn-default btn-view" ng-href="{{ url }}{{ urlSrc() }}">View</a><a ng-if="userSupported" class="btn btn-default btn-supported" ng-click="support()" ng-disabled="!allowDonation"><span class="glyphicon glyphicon-heart"></span> Supported</a><a ng-if="!userSupported" class="btn btn-default btn-support" ng-click="support()" ng-disabled="!allowDonation"><span class="glyphicon glyphicon-flash"></span> {{ message }}</a></div>';break;case"only-support":n='<button class="support" ng-click="support()" ng-disabled="!allowDonation">SUPPORT</button>';break;case"catchup":n='<button class="lgx-c-campaigncard__support lgx-c-button--primary" ng-click="support()" ng-disabled="!allowDonation">Support<svg><use xlink:href="#catch-up"></use></svg></button>';break;case"lgx":n='<button class="lgx-c-button--rounded lgx-t-semibold" ng-click="support()" ng-disabled="!allowDonation">{{buttonMessage()}}</button>';break;case"lgx-mockup":n='<button class="lgx-c-button--rounded lgx-t-semibold" style="opacity: 0.5" ng-disabled="true">Support</button>';break;case"lgx-objective":n='<button class="lgx-c-campaign-content__support lgx-c-button--link lgx-t-footnote" ng-click="support()" ng-disabled="!allowDonation">Support</button>';break;case"give-directly":n='<button ng-class="buttonClass()" ng-click="support()" ng-disabled="!allowDonation || !disableButton"> <span class="lgx-u-vertically-center"> {{ buttonMessage() }} <svg id="icon-chevrons-right" viewBox="0 0 32 32" height="20" width="20"> <path d="M24.933 15.067l-6.667-6.667c-0.533-0.533-1.333-0.533-1.867 0s-0.533 1.333 0 1.867l5.733 5.733-5.733 5.733c-0.533 0.533-0.533 1.333 0 1.867 0.267 0.267 0.667 0.4 0.933 0.4s0.667-0.133 0.933-0.4l6.667-6.667c0.533-0.533 0.533-1.333 0-1.867z"> </path> <path d="M15.6 15.067l-6.667-6.667c-0.533-0.533-1.333-0.533-1.867 0s-0.533 1.333 0 1.867l5.733 5.733-5.733 5.733c-0.533 0.533-0.533 1.333 0 1.867 0.267 0.267 0.533 0.4 0.933 0.4s0.667-0.133 0.933-0.4l6.667-6.667c0.533-0.533 0.533-1.333 0-1.867z"> </path> </svg> </span> </button>';break;default:n='<div id="control-button"><a ng-class="buttonClass()" ng-click="support()" ng-disabled="!allowDonation"><span>{{ buttonMessage() }}</span></a></div>'}return n}}}]),e.directive("supportPage",["api","$compile","$window","ProjectCardManager","$timeout","ThankyouRedirectHelper",function(e,i,r,s,c,l){return{restrict:"E",scope:{projectId:"@",donationComplete:"&?",project:"@?",rewardId:"@?",challengeId:"@?",supportType:"@?",src:"@"},template:"<div></div>",link:function(n,a,o){function t(t,e){n.initialRewardID=e,n.isModal=!1,n.project=t,void 0!==o.afterComplete&&"undefined"!==o.afterComplete&&(n.afterComplete=o.afterComplete),n.src&&""!=n.src&&s.setSource(n.src),l.thankYouUrl(t).then(function(e){console.log("This is where we will go: "+e)}),n.cancel=function(){n.afterComplete?r.location.href=decodeURIComponent(n.afterComplete):n.challengeId?r.location.href="/challenge":r.location.href=t.URL},n.closeDialog=function(e){window.heap&&window.heap.track("Completed Donation",{"Donation ID":e.id}),c(function(){e.donated&&(o.donationComplete?n.donationComplete({donation:e}):n.afterComplete?r.location.href=decodeURIComponent(n.afterComplete):n.challengeId?r.location.href="/challenge":l.thankYouUrl(t).then(function(e){console.log("going to "+e),r.location.href=e}))},1e3)};e=i("<donation-manager></donation-manager>")(n);a.append(e)}void 0===n.project?e.donate.minimumProjectInfo(n.projectId).then(function(e){t(e,n.rewardId)}):t(n.project,n.rewardId)}}}]),e.filter("percentage",["$filter",function(n){return function(e,t){return n("number")(100*e,t)+"%"}}]),e.directive("stripePaymentRequestButton",["stripeElementsApi","stripePaymentRequest","User",function(r,s,c){return{restrict:"E",scope:{donation:"=",state:"=",currencyCode:"=",shippingRequired:"="},template:'<div ng-show="data.visible" id="stripe-payment-request-button" ng-click="clicked()"></div>',link:function(t,n,e){var a,o;function i(){a.update(s.paymentRequestOptionsFromDonation(t.donation,t.currencyCode,t.shippingRequired,!1))}t.data={visible:!1},t.clicked=function(e){t.state.processing=!0,i()},c.get().then(function(){0<=c.getPaymentProviderTypes().indexOf("stripe")&&r.loadElements().then(function(e){a=s.paymentRequest(),o=e.create("paymentRequestButton",{paymentRequest:a}),i(),a.canMakePayment().then(function(e){e?(o.mount(n),t.data.visible=!0):t.data.visible=!1},function(){t.data.visible=!1}),a.on("shippingaddresschange",function(e){}),a.on("token",function(e){t.$apply(function(){e.error?(t.state.errors=e.error.message,t.$emit("stripe-token-error",{error:e.error.message})):t.$emit("stripe-token-generated",{token:e.token})})})})})}}}]),e.directive("donationManager",["User","patronicityConfig","$analytics","ProjectCardManager","bluesnapApi","adyenApi","applePayFactory","googlePayFactory",function(C,e,D,I,S,k,j,P){return{restrict:"E",templateUrl:e.urlForTemplate("new-donation-modal.html"),controller:["$scope","$timeout","api","$filter","vcRecaptchaService","$sentry","CurrencyCodeProvider","$q",function(i,o,a,e,t,n,r,s){var c,l,u,d=this;function p(e,t){e?(i.donation.userID=parseInt(e.ID),i.donation.anonymous=!1,i.donation.name=e.Name,i.donation.location=e.DefaultCardBillingAddress,i.state.user.id=i.donation.userID,i.state.user.name=e.Name,i.state.user.email=e.Email,i.state.user.location=e.DefaultCardBillingAddress,i.state.user.defaultCardID=e.DefaultCardID,i.state.user.defaultShippingAddressID=e.DefaultShippingAddressID,i.state.profile.ID=e.ProfileID,i.state.profile.receiveUpdates=e.ProfileReceiveUpdates,i.state.original.receiveUpdates=e.ProfileReceiveUpdates,i.state.profile.countryCode=e.ProfileCountryCode,i.state.profile.isCountryEU=e.ProfileIsCountryEU):(i.donation.userID=void 0,i.donation.anonymous=!1,i.donation.name=void 0,i.donation.location=void 0,i.state.user.id=i.donation.userID,i.state.user.name="",i.state.user.email="",i.state.user.defaultCardID=void 0,i.state.user.defaultShippingAddressID=void 0,i.state.profile.ID=void 0,i.state.profile.receiveUpdates=void 0,i.state.original.receiveUpdates=void 0,i.state.profile.countryCode=void 0,i.state.profile.isCountryEU=void 0),i.state.panels.rewardemail.visible&&i.state.panels.rewardemail.required&&i.state.user.email&&(i.donation.rewardEmail=i.state.user.email),i.state.user.currency.code=C.getPreferredCurrency()||i.project.CurrencyCode,i.state.user.currency.symbol=r.symbolFromCode(i.state.user.currency.code),i.state.user.currency.minimumAmount=parseInt(i.project.MinimumDonationAmount),i.state.projectCurrencyToSelectedCurrencyFX=1,i.state.hadOneOrMoreInvalidCards=i.project.hadOneOrMoreInvalidCards,i.state.restrictedToCards=i.project.RestrictedToCardTypes,i.state.projectSettlementCurrency=i.project.SettlementCurrency,console.log("Project settlement currency: ",i.state.projectSettlementCurrency),i.displayNameEdit=!1,i.state.panels.payment.valid=!1,i.state.panels.shipping.valid=!1,i.state.panels.additional.valid=!1,i.state.panels.rewardemail.valid=!1,i.donation.cardID=void 0,i.donation.tokens=void 0,i.state.panels.shipping.visible=!1,i.state.panels.additional.visible=!1,i.state.panels.rewardemail.visible=!1,i.state.paymentMethodSynopsis="",i.state.shippingSynopsis="",i.state.panels.shipping.required&&d.clearShippingAddress(),i.state.selectedReward&&null!=i.state.selectedReward.ID&&(i.state.selectedReward.RequireNote||i.state.selectedReward.IncludeNote?i.state.panels.additional.visible=!0:i.state.panels.additional.visible=!1,i.state.selectedReward.RequireEmail||i.state.selectedReward.IncludeEmailNote?i.state.panels.rewardemail.visible=!0:i.state.panels.rewardemail.visible=!1,i.state.panels.shipping.visible&&!i.state.panels.shipping.required&&(i.state.panels.shipping.visible=!1),i.state.panels.rewardemail.visible&&i.state.rewardemailSynopsis?(i.state.panels.rewardemail.valid=!0,i.donation.rewardEmail=i.state.rewardemailSynopsis):i.state.panels.rewardemail.valid=!1),e?(a.user.cards.forProjectId(i.project.ID,i.state.user.currency.code).then(function(e){i.state.cardsOnFile=e.cards,i.state.paymentDefault=e.paymentDefault,i.DonationDefaults=e.DonationDefaults,0!==Object.keys(i.DonationDefaults).length&&(i.state.donorCoversFees=1==i.DonationDefaults.cover_fees,i.donation.giftAid=1==i.DonationDefaults.gift_aid,i.donation.receiveUpdates=1==i.DonationDefaults.subscribe_updates,null==i.DonationDefaults.custom_name&&null==i.DonationDefaults.location||(e=1==i.DonationDefaults.custom_name,i.displayNameEdit=!0,i.buttonLabel="Default",null!=i.DonationDefaults.custom_name?e?(i.donation.name=i.DonationDefaults.donation_name||i.state.user.name,i.toggleCustomOption("CustomName")):i.toggleCustomOption("Anonymous"):i.toggleCustomOption("CustomName"),null!=i.DonationDefaults.location&&(i.donation.location=(null!=i.DonationDefaults.location?i.DonationDefaults:i.state.user).location)))},function(e){alert(e),i.closeDialog()}),a.getAddresses().then(function(e){i.state.addressesOnFile=e}),i.state.user.state=t):(i.state.user.state="no-user",i.state.cardsOnFile=[]),i.state.application=C.getApplication(),i.state.isCountryEU=C.isCountryEU(),i.state.countryCode=C.countryCode(),i.state.profile.countryCode?(i.countryCode=i.state.profile.countryCode,i.isEU=i.state.profile.isCountryEU):(i.countryCode=i.state.countryCode,i.isEU=i.state.isCountryEU),i.isEU||(i.donation.receiveUpdates=!0),i.$broadcast("user-for-donation-loaded")}i.displayNameEdit=!1,i.editCustomName=!1,i.buttonLabel="Edit",i.DonationDefaults={},i.recaptchaBoolean=!1,C.get().then(function(){i.recaptchaBoolean=C.isRecaptchaActive(),console.log("Recaptcha Active:",i.recaptchaBoolean),0<=C.getPaymentProviderTypes().indexOf("bluesnap")&&S.getFraudId().then(function(e){c=e}),0<=C.getPaymentProviderTypes().indexOf("adyen")&&k.calculateFingerprint().then(function(e){l=e})}),i.firstTime=!0,D.eventTrack("SupportClicked",{category:"support",label:i.project.Slug}),i.state={panels:{},original:{},profile:{},user:{currency:{code:"USD",symbol:"$"},state:"already-logged-in"},cardsOnFile:[],restrictedToCards:!1,hadOneOrMoreInvalidCards:!1,application:"",showFullyClaimedError:void 0,donorCoversFees:!0,selectedReward:null,processing:!1,paymentMethod:"stripe",paymentMethodSynopsis:"",shippingSynopsis:"",additionalSynopsis:void 0,rewardemailSynopsis:void 0,error:{type:"error",message:void 0,duration:3e4},projectCurrencyToSelectedCurrencyFX:null},i.donation={userID:void 0,rewardID:0,amount:10,tipAmount:0,anonymous:!1,name:void 0,card:{save:!0},paymentRequest:!1,shipping:{},receiveUpdates:!1,giftAid:!1,zakah:!1,guest:{isGuest:!1,id:!1,hash:!1,name:void 0,location:void 0}};var m,g,f={card:!0,apple:!(d.reloadValidCardsForCurrency=function(e){C.current()&&a.user.cards.forProjectId(i.project.ID,e).then(function(e){i.state.cardsOnFile=e.cards,i.state.paymentDefault=e.paymentDefault,i.state.restrictedToCards=e.restrictedToCards,i.state.hadOneOrMoreInvalidCards=e.hadOneOrMoreInvalidCards})}),google:!1},h=(d.setPaymentTypeAvailable=function(e,t){f[e]=t},d.isPaymentTypeAvailable=function(e){return f[e]||!1},i.$on("user:login-change",function(e,t){p(t.user,"already-logged-in")}),d.loadUser=function(e){p(C.current(),e)},i.toggleEdit=function(){i.displayNameEdit?(i.displayNameEdit=!1,i.editCustomName=!1,i.donation.anonymous=!1,i.donation.name=i.DonationDefaults.donation_name||i.state.user.name,i.donation.location=i.state.user.location,i.buttonLabel="Edit",i.donation.guest.isGuest&&(i.donation.name=i.donation.guest.name,i.donation.location=i.donation.guest.location)):(i.displayNameEdit=!0,i.buttonLabel="Default",i.toggleCustomOption("CustomName"))},i.toggleCustomOption=function(e){"CustomName"==e?(i.editCustomName=!0,i.donation.anonymous=!1):"Anonymous"==e&&(i.editCustomName=!1,i.donation.anonymous=!0)},i.state.fees={transaction:i.project.Fees.TransactionRate,platform:i.project.Fees.ApplicationRate,transaction_unit:i.project.Fees.TransactionUnit,version:i.project.Fees.Version,zero_fees:i.project.Fees.ApplicationRate+i.project.Fees.ApplicationUnit==0},"There is a "+e("percentage")(i.state.fees.platform)+" project fee and a "+e("percentage")(i.state.fees.transaction));0<i.state.fees.transaction_unit&&(h+=" + "+e("currency")(i.state.fees.transaction_unit,i.state.user.currency.symbol)+" per transaction"),i.state.fees.description=h+=" credit card fee applied.",i.state.panels.givinglevel={visible:!!(i.project.Rewards&&0<i.project.Rewards.length),valid:!1,collapsed:!(i.project.Rewards&&0<i.project.Rewards.length),required:!!(i.project.Rewards&&0<i.project.Rewards.length)},i.state.panels.amount={visible:!(i.project.Rewards&&0<i.project.Rewards.length),valid:!1,collapsed:!!(i.project.Rewards&&0<i.project.Rewards.length),required:!0},i.state.panels.payment={visible:!1,valid:!1,collapsed:!0,required:!0},i.state.panels.shipping={visible:!1,valid:!1,collapsed:!0,required:!1},i.state.panels.additional={visible:!1,valid:!1,collapsed:!0,required:!1},i.state.panels.rewardemail={visible:!1,valid:!1,collapsed:!0,required:!1},d.isSelectedCardValid=function(){var e=!0;return i.state.paymentMethodSynopsis&&i.state.paymentMethodSynopsis.toLowerCase().includes("amex")&&-1==i.state.restrictedToCards.indexOf("American Express")&&(i.state.hadOneOrMoreInvalidCards=!0,d.setPanelValid("payment",!1),e=!1),e},d.selectCard=function(e){"new"==e?(i.state.paymentMethodSynopsis=function(){var e;switch(i.donation.card.type){case"visa":e="Visa ";break;case"amex":e="American Express ";break;case"mastercard":e="Mastercard ";break;case"discover":e="Discover "}return i.donation.card.number&&(e+=i.donation.card.number.substr(-4)),e}(),i.donation.cardID=void 0,i.donation.paymentRequest=!1):"google"==e?(i.state.paymentMethodSynopsis="Google Pay",i.donation.cardID=void 0,i.donation.paymentRequest="google"):"apple"==e?(i.state.paymentMethodSynopsis="Apple Pay",i.donation.cardID=void 0,i.donation.paymentRequest="apple"):(i.state.paymentMethodSynopsis=e.SimpleDescription,i.donation.cardID=e.ID,i.DonationDefaults.gift_aid||(i.donation.giftAid=e.GiftAid),i.donation.paymentRequest=!1)},d.selectShippingAddress=function(e){i.state.shippingSynopsis=e.Address,d.clearShippingAddress(),i.donation.shipping.id=e.ID},d.selectNextPanel=function(e){var t,n;"amount"==e?i.state.panels.rewardemail.visible?d.gotoPanel("rewardemail",!0):(d.hidePanel("amount"),d.selectNextPanel("rewardemail")):"rewardemail"==e?i.state.user.defaultCardID&&(t=!1,d.isPaymentTypeAvailable(i.state.paymentDefault)||(i.state.paymentDefault="card"),"card"==i.state.paymentDefault?angular.forEach(i.state.cardsOnFile,function(e){e.ID==i.state.user.defaultCardID&&(i.state.panels.payment.visible=!0,d.selectCard(e),d.isSelectedCardValid()&&d.setPanelValid("payment",!0),t=!0)}):"google"!=i.state.paymentDefault&&"apple"!=i.state.paymentDefault||(i.state.panels.payment.visible=!0,d.selectCard(i.state.paymentDefault),d.isSelectedCardValid()&&d.setPanelValid("payment",!0),t=!0),t)?i.state.panels.shipping.required&&"google"!=i.state.paymentDefault&&"apple"!=i.state.paymentDefault?(n=!1,i.state.user.defaultShippingAddressID&&angular.forEach(i.state.addressesOnFile,function(e){e.ID==i.state.user.defaultShippingAddressID&&(i.state.panels.shipping.visible=!0,d.selectShippingAddress(e),d.setPanelValid("shipping",!0),n=!0)}),n?(d.hidePanel("rewardemail"),d.selectNextPanel("shipping")):d.gotoPanel("shipping",!0)):(d.hidePanel("rewardemail"),d.selectNextPanel("payment")):d.gotoPanel("payment",!0):"payment"==e?i.state.panels.shipping.required?i.donation.paymentRequest?(i.state.panels.shipping.visible=!1,d.setPanelValid("shipping",!0),i.state.panels.additional.required?d.gotoPanel("additional",!0):d.hidePanel("payment")):d.gotoPanel("shipping",!0):i.state.panels.additional.required?d.gotoPanel("additional",!0):d.hidePanel("payment"):"shipping"==e&&(i.state.panels.additional.required?d.gotoPanel("additional",!0):d.hidePanel("shipping"))},d.gotoPanel=function(n,a){void 0===a&&(a=!0),angular.forEach(i.state.panels,function(e,t){t==n?e.visible?d.showPanel(t):(e.visible=!0,o(function(){d.showPanel(t)},10)):a&&d.hidePanel(t)})},d.showPanel=function(e){i.state.panels[e].collapsed=!1},d.hidePanel=function(e){i.state.panels[e].collapsed=!0},d.togglePanel=function(e){i.state.panels[e]&&(i.state.panels[e].collapsed?d.showPanel(e):d.hidePanel(e))},d.setPanelValid=function(n,a){angular.forEach(i.state.panels,function(e,t){t==n&&(e.valid=a)})},d.rewardByID=function(t){var n=null;return angular.forEach(i.project.Rewards,function(e){e.ID==t&&(n=e)}),n},d.clearShippingAddress=function(){angular.forEach(["id","name","line1","line2","city","state","zip","country"],function(e){i.donation.shipping[e]=void 0})},i.canPledge=function(){var n=!0;return angular.forEach(i.state.panels,function(e,t){e.required&&!e.valid&&(n=!1)}),n&&i.firstTime&&(i.firstTime=!1,D.eventTrack("ConfirmationDisplayed",{category:"support",label:i.project.Slug}),null==i.donation.name&&(i.donation.name=i.donation.card.name,i.state.user.name=i.donation.card.name)),n},i.$watch("donation.rewardID",function(e){var e=d.rewardByID(e);e?(i.state.panels.shipping.required=e.RequireShipping,i.state.panels.additional.required=e.RequireNote,i.state.panels.rewardemail.required=e.RequireEmail,e.RequireNote||e.IncludeNote?i.state.panels.additional.visible=!0:i.state.panels.additional.visible=!1,e.RequireEmail||e.IncludeEmailNote?i.state.panels.rewardemail.visible=!0:i.state.panels.rewardemail.visible=!1,i.state.panels.shipping.visible&&!i.state.panels.shipping.required&&(i.state.panels.shipping.visible=!1),i.state.selectedReward=e,(e=Math.ceil(e.ChallengeAmount*i.state.projectCurrencyToSelectedCurrencyFX))>parseFloat(i.donation.amount)&&(i.donation.amount=e)):(i.state.panels.shipping.required=!1,i.state.panels.additional.required=!1,i.state.panels.rewardemail.required=!1,i.state.panels.shipping.visible=!1,i.state.panels.additional.visible=!1,i.state.panels.rewardemail.visible=!1,i.state.selectedReward=null)}),i.$watch("state.panels",function(e,t){if(angular.forEach(e,function(e,t){e.visible&&!e.collapsed&&(m=t)}),m&&m!==g){var n="Panel_NF";switch(g=m){case"givinglevel":n="GivingLevelDisplayed";break;case"amount":n="PledgeAmountDisplayed";break;case"additional":n="AdditionalDisplayed";break;case"rewardemail":n="EmailRequireDisplayed";break;case"payment":n="PaymentDisplayed";break;case"shipping":n="ShippingDisplayed"}"GivingLevelDisplayed"!=n&&"PledgeAmountDisplayed"!=n&&"PaymentDisplayed"!=n||D.eventTrack(n,{category:"support",label:i.project.Slug})}},!0),d.validateAmount=function(e){var t,n=!1;void 0!==e&&(e=parseInt(e),t=e,(i.project.HideHelping?parseFloat(t)>=i.state.selectedReward.ChallengeAmount*i.state.projectCurrencyToSelectedCurrencyFX:parseFloat(t)>=i.state.user.currency.minimumAmount)&&(n=!0,!i.state.selectedReward||i.state.selectedReward&&e>=i.state.projectCurrencyToSelectedCurrencyFX*parseInt(i.state.selectedReward.ChallengeAmount)?d.setPanelValid("givinglevel",!0):d.setPanelValid("givinglevel",!1))),d.setPanelValid("amount",n)},i.$watch("donation.amount",function(e){d.validateAmount(e)}),i.$watch(function(){return i.state.donorCoversFees+"-"+i.donation.amount+"-"+i.donation.tipAmount+"-"+i.state.application},function(){var e;i.state.donorCoversFees&&!i.state.fees.zero_fees?i.state.feeAmount=(e=i.donation.amount,+(e=1==i.state.fees.version?(i.state.fees.transaction+i.state.fees.platform)*e:((i.state.fees.transaction+i.state.fees.platform)*e+i.state.fees.transaction_unit)/(1-i.state.fees.transaction)).toFixed(2)):i.state.feeAmount=0,i.donation.totalAmount=i.state.feeAmount+parseFloat(i.donation.tipAmount)+parseFloat(i.donation.amount)});var y,v=!(i.reloadPage=function(){window.location.reload()});function b(e){var t,n;v||(i.state.processing=!0,v=!0,i.state.error.message=void 0,i.donation.location==i.state.user.location&&(i.donation.location=void 0),i.editCustomName&&!i.donation.anonymous?i.donation.CustomName=!0:i.donation.anonymous&&!i.editCustomName&&(i.donation.CustomName=!1),t=i.donation,"stripe"==i.state.paymentMethod?void 0!==t.cardID||"google"==t.paymentRequest||"apple"==t.paymentRequest?(t=e,e=!i.donation.paymentRequest&&i.donation.card.save,n={rewardID:i.donation.rewardID,saveCard:e,paymentMethod:i.state.paymentMethod,note:i.donation.note,anonymous:i.donation.anonymous,name:i.donation.name,amount:i.donation.amount,feeAmount:parseFloat(i.donation.totalAmount)-parseFloat(i.donation.amount),receiveUpdates:i.donation.receiveUpdates,shareAddress:i.donation.shareAddress,giftAid:i.donation.giftAid,zakah:i.donation.zakah,rewardEmail:i.donation.rewardEmail,referredDonor:I.getSource(),providerSpecific:{},reCaptcha:t,location:i.donation.location,CustomName:i.donation.CustomName},i.donation.paymentRequest?"google"==i.donation.paymentRequest?(e=P.getTokenFromPaymenResult(i.donation.paymentRequestGoogleData),n.tokens=[e],(t=P.getShippingFromPaymentResult(i.donation.paymentRequestGoogleData))&&(i.donation.shipping=t)):"apple"==i.donation.paymentRequest&&(e=j.getTokenFromPaymenResult(i.donation.paymentRequestAppleData),n.tokens=[e],(t=j.getShippingFromPaymentResult(i.donation.paymentRequestAppleData))&&(i.donation.shipping=t)):i.donation.cardID?n.cardID=i.donation.cardID:n.tokens=i.donation.tokens,n.anonymous&&(n.name=null),i.donation.guest.isGuest&&(n.guest={id:i.donation.guest.id,type:i.donation.guest.type,hash:i.donation.guest.hash}),c&&(n.providerSpecific.bluesnap={fraudId:c}),l&&(n.providerSpecific.adyen={fingerprint:l}),i.state.panels.shipping.required&&(n.shippingAddress={ID:i.donation.shipping.id,Name:i.donation.shipping.name,Address:i.donation.shipping.line1,Address2:i.donation.shipping.line2,City:i.donation.shipping.city,State:i.donation.shipping.state,Zip:i.donation.shipping.zip,Country:i.donation.shipping.country,Save:i.donation.shipping.save}),i.state.original.receiveUpdates!==i.state.profile.receiveUpdates&&(n.profileReceiveUpdates=i.state.profile.receiveUpdates),i.state.user.currency.code!=i.project.CurrencyCode&&(n.currency=i.state.user.currency.code),void 0!==n.guest&&void 0!==n.guest.id&&window.heap&&!window.heap.identity&&window.heap.identify(n.guest.id),a.donate.donate(i.project.ID,n).then(function(e){"apple"==i.donation.paymentRequest&&j.completeTransaction(i.donation.paymentRequestAppleData.session,!0),D.eventTrack("Purchase",{value:n.amount,label:i.project.Name,currency:i.project.CurrencyCode}),D.eventTrack("PledgeClicked",{category:"support",label:i.project.Slug}),D.eventTrack("Complete: "+e.user_type,{category:"support",label:i.project.Slug}),0<n.feeAmount&&D.eventTrack("SubmitTipAmount",{value:n.feeAmount,category:"support",label:i.project.Name,currency:i.project.CurrencyCode}),D.transactionTrack({event:"transaction",id:e.id,affiliation:C.getApplication(),revenue:n.amount,shipping:n.feeAmount,currency:i.project.CurrencyCode,tax:0,productID:e.id,product:i.project.Name,products:[{name:"Donation: "+i.project.Name,id:i.project.ID,price:n.amount,quantity:1}]}),o(function(){i.closeDialog({donated:!0,amount:n.amount,feeAmount:n.feeAmount,name:i.state.user.name,projectId:i.project.ID,id:e.id,userState:i.state.user.state})},600)},function(e,t,n,a,o){"apple"==i.donation.paymentRequest&&j.completeTransaction(i.donation.paymentRequestAppleData.session,!1),i.state.error.message=e,i.state.processing=!1,o&&o.result&&"reload"==o.result.reason&&(i.state.reloadError=!0)}).finally(function(){v=!1})):alert("SOMETHING WENT WRONG!"):alert("Unknown payment Method: "+i.state.paymentMethod))}d.loadUser("already-logged-in"),d.rewardAvailable=function(e){var t=!1;return t=e&&(0===parseInt(e.Limit)||parseInt(e.PrizeAwarded)<parseInt(e.Limit))?!0:t},d.getProjectSlug=function(){return i.project.Slug},d.selectReward=function(e){e?d.rewardAvailable(e)&&(i.donation.rewardID=parseInt(e.ID),i.donation.rewardChallengeAmount=parseInt(e.ChallengeAmount),i.donation.amount=Math.round(i.state.projectCurrencyToSelectedCurrencyFX*parseInt(e.ChallengeAmount),2)):(i.donation.rewardID=0,i.donation.rewardChallengeAmount=null,i.donation.amount=10),i.state.showFullyClaimedError=!1,d.setPanelValid("givinglevel",!0),d.gotoPanel("amount")},d.submitGoogle=function(e,t){i.donation.paymentRequestGoogleData=e,b(t)},d.submitApple=function(e,t){i.donation.paymentRequestAppleData=e,b(t)},d.getAppleAndGoogleTransactionParameters=function(){var e=i.project.CurrencyCode;return{country:"US",currency:e=i.state.user.currency.code!=i.project.CurrencyCode?i.state.user.currency.code:e,amount:""+i.donation.totalAmount,requireShipping:i.state.panels.shipping.required,requireEmail:i.donation.guest.isGuest,acceptedCards:i.state.restrictedToCards,settlementCurrency:i.state.projectSettlementCurrency}},i.initialRewardID&&(e=d.rewardByID(i.initialRewardID))&&(d.rewardAvailable(e)?d.selectReward(e):i.state.showFullyClaimedError=!0);var w=!1;d.performRecaptcha=function(){return y=s.defer(),i.recaptchaBoolean?(w&&t.reload(u),t.execute(u),w=!0):y.resolve(),y.promise},i.recaptcha_setResponse=function(e){i.$apply(function(){y.resolve(e)})},i.recaptcha_error=function(){i.$apply(function(){n.log("Recaptcha error!","debug"),y.reject(),t.reload(u)})},i.recaptcha_setWidgetId=function(e){u=e},i.recaptcha_expires=function(){t.reload(u)},i.submitPledge=function(){d.performRecaptcha().then(function(e){b(e)})}}]}}]),e.directive("givingLevelPanel",["api","$analytics",function(e,o){return{restrict:"E",require:"^donationManager",scope:{state:"=",donation:"=",project:"="},link:function(e,t,n,a){e.toggle=function(){a.togglePanel("givinglevel")},e.rewardRemaining=function(e){var t,n=parseInt(e.Limit);return t=0!==n?n<=(e=parseInt(e.PrizeAwarded))?"Sold Out":n-e+" left":t},e.availableReward=function(){return function(e){var t=!0;return t=0!==parseInt(e.Limit)&&parseInt(e.PrizeAwarded)>=parseInt(e.Limit)?!1:t}},e.selectReward=function(e){o.eventTrack("LevelClicked",{category:"support",label:a.getProjectSlug()}),a.selectReward(e)},e.roundUp=Math.ceil},templateUrl:"givingLevelPanel.html"}}]),e.directive("donationAmountPanel",["$timeout","api","$analytics",function(i,r,s){return{restrict:"E",require:"^donationManager",scope:{state:"=",donation:"=",project:"="},templateUrl:"donationAmountPanel.html",link:function(n,e,t,a){n.selectedCurrency=n.state.user.currency,n.loading=!0,r.donate.minimumForCurrencies().then(function(e){n.minDonation=e,n.loading=!1}),n.toggle=function(){a.togglePanel("amount")},n.$watch("state.panels.amount.collapsed",function(e,t){e||1==n.donation.amount&&i(function(){var e=$("donation-amount-panel input[type=text]").get(0);$("donation-amount-panel input[type=text]").focus(),e.setSelectionRange(0,e.value.length)},50)}),n.$watch("selectedCurrency",function(){n.state.user.currency.code=n.selectedCurrency.code,n.state.user.currency.symbol=n.selectedCurrency.symbol,function(e,t){null==o[e][t]&&(o[e][t]=r.exchangeRate(n.project.CurrencyCode,n.state.user.currency.code));return o[e][t]}(n.project.CurrencyCode,n.state.user.currency.code).then(function(e){var t=n.state.projectCurrencyToSelectedCurrencyFX,t=Math.floor(parseFloat(n.donation.amount/t));n.state.projectCurrencyToSelectedCurrencyFX=e.rate,n.donation.rewardChallengeAmount?n.donation.amount=Math.ceil(parseFloat(n.donation.rewardChallengeAmount)*n.state.projectCurrencyToSelectedCurrencyFX):n.donation.amount=Math.ceil(parseFloat(t)*n.state.projectCurrencyToSelectedCurrencyFX),n.state.user.currency.code in n.minDonation?n.state.user.currency.minimumAmount=n.minDonation[n.state.user.currency.code]:(console.log("Currency is not supported"),n.error=!0)}),a.reloadValidCardsForCurrency(n.state.user.currency.code),a.validateAmount(n.donation.amount),a.isSelectedCardValid()}),n.continue=function(){s.eventTrack("PledgeAmountSubmitted",{category:"support",label:a.getProjectSlug()}),a.validateAmount(n.donation.amount),a.selectNextPanel("amount")},n.parseInt=parseInt;var o={USD:{},GBP:{},MYR:{},SGD:{},EUR:{},AUD:{},CAD:{},NZD:{}}}}}]),e.directive("paymentMethodPanel",["api","User","$analytics","stripePaymentRequest","googlePayFactory","applePayFactory",function(l,u,d,e,p,m){return{restrict:"E",require:"^donationManager",scope:{state:"=",donation:"=",currencyCode:"="},link:function(a,e,t,o){function n(){a.state.processing=!0;var e=o.getAppleAndGoogleTransactionParameters();p.handleTransaction(e).then(function(n){o.performRecaptcha().then(function(t){e.requireEmail?l.user.guest.create(n.email,n.email).then(function(e){a.donation.guest.id=e.id,a.donation.guest.hash=e.hash,a.donation.guest.type=e.type,o.submitGoogle(n,t)},function(e){console.error(e),a.state.processing=!1}):o.submitGoogle(n,t)},function(){a.state.processing=!1})}).catch(function(e){console.error(e),a.state.processing=!1})}function i(){var e=o.getAppleAndGoogleTransactionParameters(),t=m.preflightTransaction(e);o.performRecaptcha().then(function(n){a.state.processing=!0,m.handleTransaction(t).then(function(t){e.requireEmail?l.user.guest.create(t.email,t.email).then(function(e){a.donation.guest.id=e.id,a.donation.guest.hash=e.hash,a.donation.guest.type=e.type,o.submitApple(t,n)},function(e){console.error(e),a.state.processing=!1}):o.submitApple(t,n)}).catch(function(e){console.log("Failure"),console.error(e),a.state.processing=!1})},function(){})}a.panel={showSignInForm:!0,facebookLoginInProgress:!1,state:void 0===a.state.user.id?"login":"card",paymentRequest:{google:!1,apple:!1},guest:{isGuest:!u.isLoggedIn(),email:""},restrictedCards:!1,signInFormVisible:!1,registerFormVisible:!1,showRegisterButton:!0},"patronicity"==a.state.application&&(a.panel.showRegisterButton=!1),a.$watch(function(){return(void 0===a.state.restrictedToCards?"":a.state.restrictedToCards.join("-"))+a.state.hadOneOrMoreInvalidCards},function(){if(void 0!==a.state.restrictedToCards){var e=!1;if(a.state.restrictedToCards.length<4){for(var t="",n=0;n<a.state.restrictedToCards.length;n++)0<n&&n<a.state.restrictedToCards.length-1?t+=", ":n==a.state.restrictedToCards.length-1&&(t+=" and "),t+=a.state.restrictedToCards[n];e=t}a.state.hadOneOrMoreInvalidCards?a.panel.restrictedCards=e:a.panel.restrictedCards=!1}}),u.get().then(function(){p.supported().then(function(e){a.panel.paymentRequest.google=e,o.setPaymentTypeAvailable("google",e),e&&p.getButton(n).then(function(e){document.getElementById("google-pay-button").appendChild(e)},function(e){console.error(e)})},function(){}),m.supported().then(function(e){a.panel.paymentRequest.apple=e,o.setPaymentTypeAvailable("apple",e),e&&m.getButton(i).then(function(e){document.getElementById("apple-pay-button").appendChild(e)},function(e){console.error(e)})},function(){})}),a.toggleRegisterForm=function(){a.panel.registerFormVisible=!a.panel.registerFormVisible,a.panel.signInFormVisible=!1};a.toggleSigninForm=function(){a.panel.signInFormVisible=!a.panel.signInFormVisible,a.panel.registerFormVisible=!1};var r=!1,s=(void 0===a.state.user.id&&d.eventTrack("NotLoggedIn",{category:"support",label:o.getProjectSlug()}),a.toggle=function(){o.togglePanel("payment")},a.continueAsGuest=function(){a.panel.state="card",a.panel.signInFormVisible=!1,r=!0,a.donation.card.save=!1,a.panel.guest.email=a.donation.rewardEmail,d.eventTrack("GuestCardStarted",{category:"support",label:o.getProjectSlug()})},a.setFacebookSigninProcessStarted=function(){a.panel.signInFormVisible=!1,a.panel.facebookLoginInProgress=!0},a.facebookResult=function(e,n){switch(e){case"cancelled":a.panel.facebookLoginInProgress=!1;break;case"loadingError":alert("Unable to load Facebook. Sorry."),a.panel.facebookLoginInProgress=!1;break;case"success":window.FB.api("/me/picture?height=500&width=500&redirect=false",function(e){var t=null;!e||e.error||e.data.is_silhouette||(t=e.data.url),u.facebookLoginOrRegister(n.email,n.first_name,n.last_name,n.name,n.id,t).then(function(){d.eventTrack("FBLoginOrRegister",{category:"support",label:o.getProjectSlug()}),o.loadUser("facebook-login"),a.panel.facebookLoginInProgress=!1},function(e){alert(e),a.panel.facebookLoginInProgress=!1})})}},!(a.toggleLoginPanel=function(){u.isLoggedIn()?u.logout(!1):(a.panel.state="login",r=!1)}));function c(){a.donation.guest.isGuest=a.panel.guest.isGuest,o.setPanelValid("payment",!0),o.selectNextPanel("payment")}a.showLoginPanel=function(){var e=void 0===a.state.user.id||!1;return!s&&e&&(s=!0,d.eventTrack("NotLoggedIn",{category:"support",label:o.getProjectSlug()})),e},a.$on("user-for-donation-loaded",function(e,t){a.state.user.id?(a.panel.state="card",r=!1,a.donation.card.save=!0,a.panel.guest.isGuest=!1,a.panel.guest.email=""):a.panel.state="login"}),a.showNewPaymentForm=function(){r=!0},a.newPaymentFormFieldsVisible=function(){return a.state.cardsOnFile&&0===a.state.cardsOnFile.length||r},a.usePaymentRequest=function(e){a.panel.guest.isGuest?(d.eventTrack("PaymentRequestGuestStarted",{category:"support",label:o.getProjectSlug()}),a.donation.anonymous=!0):d.eventTrack("PaymentRequest",{category:"support",type:e,label:o.getProjectSlug()}),o.selectCard(e),c()},a.selectCard=function(e){d.eventTrack("PaymentSelected",{category:"support",label:o.getProjectSlug()}),o.selectCard(e),o.isSelectedCardValid()&&c()},a.continueWithNewCard=function(e,t,n){d.eventTrack("CardAdded",{category:"support",label:o.getProjectSlug()}),a.state.cardsOnFile.push(e),o.selectCard(e),n&&n.isGuest?(a.donation.guest.isGuest=!0,a.donation.guest.id=t,a.donation.guest.hash=n.hash,a.donation.guest.type=n.type,a.donation.name=n.name,a.donation.guest.name=n.name,a.donation.location=n.location,a.donation.guest.location=n.location):(a.donation.guest.isGuest=!1,a.donation.guest.id=!1),r=!1,o.isSelectedCardValid()&&c()}},templateUrl:"paymentMethodPanel.html"}}]),e.directive("donationSignUpForm",["api","User","$analytics","vcRecaptchaService","$sentry",function(e,s,c,l,u){return{restrict:"E",require:"^donationManager",scope:{application:"@"},link:function(t,e,n,a){function o(){t.register={email:"",password:"",firstName:"",lastName:"",agree:!1,euMember:!1,countryCode:""},t.register.euMember,t.register.receiveUpdates=!1,t.signupForm.$setPristine(),t.signupForm.$setUntouched()}var i;function r(e){t.displayPasswordReset=!1,s.register(t.register,e).then(function(e){a.loadUser("registered-new"),o(),c.eventTrack("StandardRegister",{category:"support",label:a.getProjectSlug()})},function(e){"You created this account by donating as a guest.  Please click Forgotten Password to reset the password."===(t.registerError.message=e)&&(t.displayPasswordReset=!0),t.recaptchaBoolean&&t.recaptcha_expires()}).finally(function(){t.recaptchaBoolean&&l.reload(i)})}t.registerError={type:"error",message:void 0},o(),t.register.countryCode=s.ipCountryCode(),t.register.euMember=s.isCountryEU(),t.updates=function(e){t.register.receiveUpdates=e},t.recaptcha_setWidgetId=function(e){i=e},t.userRegister=function(){t.recaptchaBoolean?l.execute(i):r(null)},t.recaptcha_setResponse=function(e){r(e)},t.recaptcha_expires=function(){l.reload(i)},t.recaptcha_error=function(){u.log("Recaptcha error!","debug"),l.reload(i)},t.recaptchaBoolean=s.isRecaptchaActive()},templateUrl:"donationSignUpForm.html"}}]),e.directive("donationSignInForm",["api","User","$analytics","vcRecaptchaService","$sentry",function(e,s,c,l,u){return{restrict:"E",require:"^donationManager",scope:{},link:function(t,e,n,a){function o(){t.login={email:"",password:""},t.signinForm.$setPristine(),t.signinForm.$setUntouched()}function i(e){s.login(t.login.email,t.login.password,e).then(function(){c.eventTrack("StandardLogin",{category:"support",label:a.getProjectSlug()}),a.loadUser("logged-in"),o()},function(e){t.loginError.message=e,$("form[name=signinForm] input[type=password]").focus()}).finally(function(){t.recaptchaBoolean&&l.reload(r)})}var r;t.loginError={message:void 0,type:"error"},o(),t.recaptchaBoolean=s.isRecaptchaActive(),t.recaptcha_setWidgetId=function(e){r=e},t.userLogin=function(){t.recaptchaBoolean?l.execute(r):i(null)},t.recaptcha_setResponse=function(e){i(e)},t.recaptcha_expires=function(){l.reload(r)},t.recaptcha_error=function(){u.log("Recaptcha error!","debug"),l.reload(r)}},templateUrl:"donationSignInForm.html"}}]),e.directive("shippingAddressPanel",["api",function(s){return{restrict:"E",require:"^donationManager",scope:{state:"=",donation:"="},link:function(a,e,t,n){var o=!(a.showStreet2=!0),i=!1;function r(){a.donation.shipping.name="",a.donation.shipping.line1="",a.donation.shipping.line2="",a.donation.shipping.city="",a.donation.shipping.state="",a.donation.shipping.zip=""}a.showProfileAddressForm=!1,a.toggle=function(){n.togglePanel("shipping")},a.load=function(){s.user.loadShippingAddress(a.donation.userID).then(function(e){a.profileAddress=e.shippingAddress,e.shippingAddress&&void 0!==e.shippingAddress.ID&&(a.showProfileAddressForm=!0)},function(){})},a.load(),a.$watch("shippingAddressChoosed",function(e){void 0!==e&&("newAddress"==e?r():"profileSaved"==e?(a.profileAddress&&(a.donation.shipping.id=a.profileAddress.ID,a.donation.shipping.name=a.profileAddress.Name,a.donation.shipping.line1=a.profileAddress.Address,a.donation.shipping.line2=a.profileAddress.Address2,a.donation.shipping.city=a.profileAddress.City,a.donation.shipping.state=a.profileAddress.State,a.donation.shipping.zip=a.profileAddress.Zip,a.donation.shipping.country=a.profileAddress.Country,a.donation.shipping.save=a.profileAddress.Save,a.shippingAddressChoosed="profileSaved"),0):"billingAddress"==e?(a.donation.cardID&&angular.forEach(a.state.cardsOnFile,function(e){e.ID==a.donation.cardID&&e.Address&&(a.donation.shipping.id=void 0,a.donation.shipping.name=e.Address.Name,a.donation.shipping.line1=e.Address.Address,a.donation.shipping.line2=e.Address.Address2,a.donation.shipping.city=e.Address.City,a.donation.shipping.state=e.Address.State,a.donation.shipping.zip=e.Address.Zip,a.donation.shipping.country=e.Address.Country,a.donation.shipping.save=e.Address.Save)}),0):r())}),a.showNewAddressForm=function(){o=!0,a.shippingAddressChoosed="newAddress"},a.newAddressFormFieldsVisible=function(){return a.state.addressesOnFile&&0===a.state.addressesOnFile.length||o},a.continue=function(){a.donation.shipping.id=void 0,a.state.shippingSynopsis=a.donation.shipping.line1,n.setPanelValid("shipping",!0),n.selectNextPanel("shipping")},a.selectAddress=function(e){n.selectShippingAddress(e),n.setPanelValid("shipping",!0),n.selectNextPanel("shipping"),o=!1},a.addressFieldChanged=function(e,t,n){a.sameAsBilling=!1},a.$watch(function(){return a.state.panels.shipping.collapsed+"_"+a.state.panels.shipping.visible},function(e,t){a.state.panels.shipping.collapsed||!a.state.panels.shipping.visible||i||(a.sameAsBilling=!0,i=!0)})},templateUrl:"shippingAddressPanel.html"}}]),e.directive("rewardAdditionalInformationPanel",function(){return{restrict:"E",require:"^donationManager",scope:{state:"=",donation:"="},link:function(e,t,n,a){e.toggle=function(){a.togglePanel("additional")},e.continue=function(){e.state.additionalSynopsis=e.donation.note,a.setPanelValid("additional",!0),a.hidePanel("additional")}},templateUrl:"rewardAdditionalInformationPanel.html"}}),e.directive("rewardEmailRequirePanel",function(){return{restrict:"E",require:"^donationManager",scope:{state:"=",donation:"="},link:function(e,t,n,a){e.toggle=function(){a.togglePanel("rewardemail")},e.continue=function(){e.state.rewardemailSynopsis=e.donation.rewardEmail,a.setPanelValid("rewardemail",!0),a.hidePanel("rewardemail"),a.selectNextPanel("rewardemail")}},templateUrl:"rewardEmailRequirePanel.html"}}),e.directive("campaignTipSection",["patronicityConfig","$filter","CurrencyCodeProvider","api",function(a,u,d,o){return{restrict:"E",scope:{donationAmount:"=",tipAmount:"=",currencyCode:"="},templateUrl:"campaignTipSection.html",link:function(l,e,t){function n(e){return{amount:e,label:"Other ("+u("moneyWithDecimal")(e,l.currencyCode)+")"}}l.data={options:[],selected:{},show_other:!1,custom_amount:"",suggested_amount:"",applicationName:"",currencySymbol:d.symbolFromCode(l.currencyCode),configuration:[]},"launchgood"==a.applicationName?l.data.applicationName="LaunchGood":"patronicity"==a.applicationName&&(l.data.applicationname="Patronicity"),l.showOtherTipAmount=function(){l.data.show_other=!0,l.data.selected=n(l.data.custom_amount),l.tipAmount=parseFloat(l.data.selected.amount)},l.setTipAmount=function(e){l.data.selected=e,l.data.show_other=!1,l.tipAmount=parseFloat(l.data.selected.amount)},l.changeCustomTipAmount=function(){l.data.selected=n(l.data.custom_amount),l.tipAmount=parseFloat(l.data.selected.amount)},o.donate.tipParameters(l.currencyCode).then(function(e){l.data.configuration=e,l.$watch("donationAmount",function(e){for(var t=e,n=[],a={},o=0;o<l.data.configuration.length;o++){var i=l.data.configuration[o];if(t<i.max_amount||-1===i.max_amount){for(var r=0;r<i.rates.length;r++){var s,c=i.rates[r];"fixed"==c.type?n.push({amount:c.value.toFixed(2),label:u("moneyWithDecimal")(c.value,l.currencyCode)}):"percent"==c.type&&(s=(t*c.value/100).toFixed(2),n.push({amount:s,label:c.value+"% ("+u("moneyWithDecimal")(s,l.currencyCode)+")"})),c.default&&(a=n[n.length-1])}break}}l.data.custom_amount=a.amount,l.data.suggested_amount=Math.max(a.amount,1).toFixed(2),l.data.currencySymbol=d.symbolFromCode(l.currencyCode),l.data.options=n,l.data.selected=a,l.tipAmount=parseFloat(l.data.selected.amount)})})}}}])}(),function(r,s){"use strict";var e=r.module("ksSwiper",[]);e.directive("ksSwiperContainer",["$log","$timeout",function(e,i){return{restrict:"E",require:"ksSwiperContainer",transclude:!0,scope:{onReady:"&",slidesPerView:"=",slidesPerColumn:"=",spaceBetween:"=",parallax:"=",parallaxTransition:"@",paginationIsActive:"=",paginationClickable:"=",showNavButtons:"=",loop:"=",autoplay:"=",initialSlide:"=",containerCls:"@",paginationCls:"@",slideCls:"@",direction:"@",swiper:"=",overrideParameters:"="},controller:["$scope","$element",function(t,n){var e,a,o=this;o.rebuildSwiper=function(){e===s&&i(function(){o.buildSwiper(),e=s},0)},o.buildSwiper=function(){a!==s&&a.destroy(!0,!0);var e={slidesPerView:t.slidesPerView||1,slidesPerColumn:t.slidesPerColumn||1,spaceBetween:t.spaceBetween||0,direction:t.direction||"horizontal",loop:t.loop||!1,initialSlide:t.initialSlide||0,showNavButtons:!1};t.autoplay!==s&&(e=r.extend({},e,{autoplay:t.autoplay})),!0===t.paginationIsActive&&(e=r.extend({},e,{paginationClickable:t.paginationClickable||!0,pagination:"#paginator-"+t.swiper_uuid})),!0===t.showNavButtons&&(e.nextButton="#nextButton-"+t.swiper_uuid,e.prevButton="#prevButton-"+t.swiper_uuid),t.overrideParameters&&(e=r.extend({},e,t.overrideParameters)),t.containerCls;a=r.isObject(t.swiper)?(t.swiper=new Swiper(n[0].firstChild,e),t.swiper):new Swiper(n[0].firstChild,e),t.onReady!==s&&t.onReady({swiper:a})}}],link:function(e,t,n,a){var o=function(){for(var e=[],t="0123456789abcdef",n=0;n<36;n++)e[n]=t.substr(Math.floor(16*Math.random()),1);return e[14]="4",e[19]=t.substr(3&e[19]|8,1),e[8]=e[13]=e[18]=e[23]="-",e.join("")}(),e="paginator-"+(e.swiper_uuid=o),i="prevButton-"+o,o="nextButton-"+o;r.element(t[0].querySelector(".swiper-pagination")).attr("id",e),r.element(t[0].querySelector(".swiper-button-next")).attr("id",o),r.element(t[0].querySelector(".swiper-button-prev")).attr("id",i),a.rebuildSwiper()},template:'<div class="swiper-container {{containerCls}}"><div class="parallax-bg" data-swiper-parallax="{{parallaxTransition}}" ng-show="parallax"></div><div class="swiper-wrapper" ng-transclude></div><div class="swiper-pagination {{paginationCls}}"></div><div class="swiper-button-next" ng-show="showNavButtons"></div><div class="swiper-button-prev" ng-show="showNavButtons"></div></div>'}}]),e.directive("ksSwiperSlide",function(){return{restrict:"E",require:"^ksSwiperContainer",transclude:!0,template:"<div ng-transclude></div>",replace:!0,link:function(e,t,n,a){!0===e.$last&&a.rebuildSwiper()}}})}((window,angular),void 0),angular.module("teammember",["mv.forms","ui.bootstrap","patronicity.configuration"]).service("TeamMemberService",["$uibModal","patronicityConfig",function(t,n){this.Add=function(e){return t.open({controller:"AddTeamMemberDialogController as ctrl",templateUrl:n.urlForTemplate("add-teammember-modal.html"),resolve:{projectID:function(){return e}}}).result}}]).controller("AddTeamMemberDialogController",["$scope","$uibModalInstance","$http","projectID","patronicityConfig",function(t,n,a,e,o){var i=this;t.canAdd=!1,this.projectID=e,i.cancel=function(){n.dismiss("cancel")},i.create=function(){var e={ProjectID:this.projectID,Email:t.email};a.post(o.databaseEndpointUrl("teammember/add"),e).success(function(e){e.success?n.close({verb:"save",message:e.message,member:e.result.member}):i.error=e.message}).error(function(e,t,n,a){alert("ERROR: "+t)})}}]),function(){var e=angular.module("patronicity.thankyou",["ui.bootstrap","patronicity.api","user","patronicity.configuration"]);e.directive("thankYouShare",["$location","api",function(r,s){return{restrict:"E",templateUrl:"thankYouShare.html",link:function(t,e,n){r.absUrl(),a="",o=r.absUrl().split("/"),i=o.indexOf("thank_you"),(0<=(o=(a=o[i+1]).indexOf("#!"))||0<=(o=a.indexOf("#")))&&(a=a.substr(0,o)),console.log("slugFromURL - Slug: "+a);var a,o,i=a;s.project.shareInfoBySlug(i).then(function(e){t.donationDetails=e})}}}]),e.directive("thankYou",["User","Thankyou","patronicityConfig","GivingManager","$window","$state",function(i,r,s,c,l,u){return{restrict:"E",templateUrl:function(e,t){return"lgx"==t.type?s.urlForTemplate("lgx-thankyou.html"):void 0===t.type||"default"==t.type?s.urlForTemplate("thankyou.html"):void 0},scope:{donationId:"@",type:"@"},link:function(a,e,t){a.application=s.applicationName,a.donationDetails={},a.sponsorInfo="",a.data={userStats:{},currentChallenge:{}},a.hideThankYouPopUp=!0,a.userEmailAddress="",a.userFirstName="",a.showShareModal=!1;var o="dhul_hijjah_2020",n="";i.get().then(function(){n=i.current().UserName}),a.donationId&&r.donationDetails(a.donationId).then(function(e){var t,n;a.zakat=e.Donation.Zakat,a.calculatorProfiles=e.Donation.ZakatProfiles.length,a.donationDetails=e,a.userEmailAddress=e.User.Email,a.userFirstName=e.User.FirstName,a.donationDetails.Sponsors=a.donationDetails.Sponsors.filter(function(e){return"17"===e.ID}),a.donationDetails.Sponsors&&0<a.donationDetails.Sponsors.length?a.sponsorInfo=a.donationDetails.Sponsors[0].Name:a.sponsorInfo="",n=t||!1,c.userStats("challenge",o,n).then(function(e){var t=0;n&&(a.data.userStats.daysDonated=0),a.isChallengeMember(9)?e.entries.forEach(function(e){e.Donated&&(t+=1)}):t=e.userStats.TotalDonorCount,a.data.userStats.daysDonated=t}),c.load("challenge",o).then(function(e){a.data.currentChallenge=e})}),a.toggleShareModal=function(){a.showShareModal=!a.showShareModal},a.closePopupActionOnClick=function(){a.hideThankYouPopUp=!0},a.goToProfile=function(){var e="/user/newprofile"+u.href("user-profile.zakat",{username:n});l.location.href=e},a.isChallengeMember=function(e){return r.isChallengeMember(e)},a.isChallengeOpen=function(e){return r.isChallengeOpen(e)},a.isChallengeOver=function(e){return r.isChallengeOver(e)}}}}]),e.directive("thankYouModal",["Thankyou",function(a){return{restrict:"E",scope:{donationId:"@"},link:function(e,t,n){a.showModal(e.donationId)}}}]),e.factory("Thankyou",["$rootScope","$uibModal","api","User","$q","patronicityConfig",function(e,n,o,t,a,s){var i={},r=s.applicationName;var c=[],l=[];function u(e){return a(function(a,t){o.donate.thankYou(e).then(function(e){if(i=e,c=[],l=[],"launchgood"==r&&i.ChallengeMember)for(var t=0;t<i.ChallengeMember.length;t++){var n=i.ChallengeMember[t];l[n.id]=!0,n.currentUserSignedUp&&(c[n.id]=!0)}a(i)},function(e){t(e)})})}function d(e){return c[e]||!1}function p(e){return l[e]||!1}function m(e){return!1}return{showModal:function(e){var t;u(t=e).then(function(e){n.open({templateUrl:s.urlForTemplate("thankyou-modal.html"),controller:["$scope","donationId","User","isOpen","isMember","donationData","isOver",function(e,t,n,a,o,i,r){e.donationId=t,e.donationDetails=i,e.application=s.applicationName,e.cancel=function(){e.$close()},e.ok=function(){e.$close()},e.challengeDay=function(e){return parseInt(e,10)+1},e.isChallengeMember=function(e){return o(e)},e.isChallengeOpen=function(e){return a(e)},e.isChallengeOver=function(e){return r(e)}}],resolve:{donationId:function(){return t},isOpen:function(){return p},isMember:function(){return d},donationData:function(){return e},isOver:function(){return m}},size:"sm"})})},donationDetails:u,isChallengeMember:d,isChallengeOpen:p,isChallengeOver:function(e){return!1}}}]),e.factory("ThankyouRedirectHelper",["User","patronicityConfig","ProjectCardManager","queryParamsService","$http","$q","$rootScope",function(s,n,t,a,c,l,u){var o;function d(){return l(function(e,t){var n={};s.get().then(function(){"production"==s.getEnvironment()||"staging"==s.getEnvironment()?(n.backend="https://give-with-be.launchgood.com",n.frontend="https://givewith.launchgood.com"):(n.backend="https://stg-give-with-be.launchgood.com",n.frontend="https://stg-give-with.launchgood.com"),e(n)})})}function p(){var e="";return a.getQueryParamInCurrentRoute("src")&&""!=a.getQueryParamInCurrentRoute("src")&&(e=a.getQueryParamInCurrentRoute("src")),a.getQueryParamInUrl("src")&&""!=a.getQueryParamInUrl("src")&&(e=a.getQueryParamInUrl("src")),e=t.getSource()&&""!=t.getSource()?t.getSource():e}function m(e,t){var r;return void 0!==o&&!t||(r=e,o=l(function(i,e){d().then(function(a){var o="/project/thank_you_lgx/"+r.Slug;"launchgood"==n.applicationName?s.get().then(function(){var t,n;u.$on("user:login-change",function(e,t){m(r,!0)}),console.log("got user"),s.isLoggedIn()?(t=s.current().ID,n=t,l(function(t,e){d().then(function(e){c.get(e.backend+"/give-with/exists/influencer-id/"+n).then(function(e){!e.data.data.hasError&&e.data.data.exist?t(!0):t(!1)},function(e){console.log("Failed follower lookup"),t(!1)})})}).then(function(e){e?(console.log("yes followers"),i(a.frontend+"/confirmation/"+t+"/"+r.ID)):(console.log("no followers"),e=p(),isNaN(parseInt(e))?i(o):(console.log("yes user source"),i(a.frontend+"/thank-you/"+t+"/"+p()+"/"+r.ID)))})):i(o)},function(e){i(o)}):i("/project/thank_you/"+r.Slug)})})),o}return{thankYouUrl:function(e){return m(e)},findSource:p}}])}(),function(){var e=angular.module("user",["ui.bootstrap","patronicity-upload","patronicity.api","patronicity.configuration","vcRecaptcha","patronicity.payment_methods"]);e.factory("User",["$q","$rootScope","$log","api","$uibModal","$window","patronicityConfig","$analytics","$timeout","vcRecaptchaService","googleService","queryParamsService",function(p,e,t,m,i,r,s,g,f,n,d,a){var o,c,l,u,h,y,v,b,w,C,D,I=null,S=!1,k=!1,j=null,P=!1;function A(){I=null,C=void 0}function $(){return null!=I}function T(){t.info("Broadcast user:login-change: LoggedIn: "+($()?"true":"false")),e.$broadcast("user:login-change",{loggedIn:$(),user:I}),r.isLoggedIn=$(),r.username=$()?I.UserName:null}function E(e){return C=void 0!==C&&!e?C:m.userForDonation().then(function(e){if(void 0!==e["user-id"])if((I={}).ID=e["user-id"],I.DefaultCardID=e["default-card-id"],I.DefaultShippingAddressID=e["default-shipping-address-id"],I.FirstName=e["first-name"],I.LastName=e["last-name"],I.Name=e["user-name"],I.Email=e.email,I.ChallengeIDs=e.challenge_id,I.ThumbnailURL=e["user-thumbnail-url"],I.IsAdmin=e["is-admin"],I.UserName=e.username,I.FacebookLinked=e["facebook-linked"],I.ProfileID=e["profile-id"],I.ProfileURL=e["profile-url"],I.Mobile=e.mobile,I.ProfileCountryCode=e["profile-country-code"],I.ProfileReceiveUpdates=e["profile-receive-updates"],I.ProfileIsCountryEU=e["profile-is-country-eu"],I.DefaultCardBillingAddress=e["default-card-billing-address"],I.IsBlacklisted=e["is-blacklisted"],I.DisplaySupportedCampaign=e.DisplaySupportedCampaign,I.DisplayCreatedCampaign=e.DisplayCreatedCampaign,I.DisplayCommunities=e.DisplayCommunities,I.RepeatCC=e["repeat-cc"],I.RepeatCCLevel1=e["repeat-cc-level1"],I.MFAAuthenticated=e.mfa.authenticated,I.MFAConfigured=e.mfa.configured,e["user-currency"])I.UserPreferredCurrency=e["user-currency"];else{try{I.UserPreferredCurrency=localStorage.userPreferredCurrency}catch(e){console.log("Error trying to read local storage: ",e)}I.userPreferredCurrency||(I.UserPreferredCurrency=U[_()])}else I=null;if(o=e.application,S=e["recaptcha-boolean"],l=e["payment-provider-keys"],u=e["payment-provider-modes"],h=e["payment-provider-types"],e["user-currency"])v=e["user-currency"];else{try{v=localStorage.userPreferredCurrency}catch(e){console.log("Error trying to read local storage: ",e)}v=v||U[_()]}y=e["user-currency-symbol"],c=e.environment,b=e["country-code"],w=e["is-country-eu"],k=e["sentry-enabled"],j=e["sentry-release"]||null,P=e["sentry-tracking"]||!1,T()},function(e){})}function _(){var e;return Intl&&(console.log("%cIntl.NumberFormat().resolvedOptions().locale: ","color: green; border: 1px solid blue",Intl.NumberFormat().resolvedOptions().locale),e=Intl.NumberFormat().resolvedOptions().locale),e||(console.log("%cwindow.navigator.language: ","color: green; border: 1px solid blue",window.navigator.language),console.log("%cwindow.navigator.userLanguage: ","color: green; border: 1px solid blue",window.navigator.userLanguage),console.log("%cwindow.navigator.browserLanguage: ","color: green; border: 1px solid blue",window.navigator.browserLanguage),e=window.navigator.language||window.navigator.userLanguage||window.navigator.browserLanguage||window.navigator.systemLanguage||"en-us"),e.toLowerCase()}var U={en:"USD","en-us":"USD","es-ec":"USD","es-sv":"USD","es-pa":"USD","en-ca":"CAD","fr-ca":"CAD","en-sg":"SGD","zh-sg":"SGD","en-au":"AUD","en-nz":"NZD","ms-my":"MYR","en-gb":"GBP","lv-lv":"EUR",lv:"EUR","de-at":"EUR","nl-be":"EUR","fr-be":"EUR","el-cy":"EUR","et-ee":"EUR",et:"EUR","fi-fi":"EUR","fr-fr":"EUR",fr:"EUR","de-de":"EUR","el-gr":"EUR","en-ie":"EUR","it-it":"EUR","lt-lt":"EUR","de-lu":"EUR","sr-me":"EUR","nl-nl":"EUR","pt-pt":"EUR","sk-sk":"EUR","sl-sl":"EUR","es-es":"EUR","de-sh":"EUR"};function M(e,o,u){return p(function(t,n){var a=void 0===e||e;i.open({templateUrl:function(){var e=o&&"lgx"==o?"lgx-loginModal.html":"loginModal.html";return s.urlForTemplate(e)},controller:["$scope","$uibModalInstance","User","facebookDetails","vcRecaptchaService",function(a,o,i,r,n){function t(){a.login={email:"",password:"",error:!1,message:""}}function s(e){i.login(a.login.email,a.login.password,e).then(function(e){window.heap&&!window.heap.identity&&window.heap.identify(e.id.toString()),t(),o.close(!0)},function(e){a.recaptchaBoolean&&a.recaptcha_expires("login"),a.login.error=!0,a.login.message=e})}function c(e){a.userFields.processing=!0,a.displayPasswordReset=!1,i.register(a.userFields,e).then(function(){a.userFields.processing=!1,o.close(!0)},function(e){console.log("register failed"),a.userFields.processing=!1,a.recaptchaBoolean&&a.recaptcha_expires("register"),a.register.error=!0,"You created this account by donating as a guest.  Please click Forgotten Password to reset the password."===(a.register.message=e)&&(a.displayPasswordReset=!0)})}t(),a.userFields={email:"",firstName:"",lastName:"",password:"",confirmPassword:"",confirmEmail:"",phone:"",terms:!1,processing:!1,euMember:!1,countryCode:""},a.register={error:!1,message:""},a.userFields.euMember?a.userFields.receiveUpdates=!1:a.userFields.receiveUpdates=!0,a.userFields.countryCode=i.ipCountryCode(),a.userFields.euMember=i.isCountryEU(),a.application=i.getApplication(),a.recaptchaBoolean=i.isRecaptchaActive(),d.loadScript(),a.googleAuthError={},a.updates=function(e){a.userFields.receiveUpdates=e},a.showSignupForm=!1,"signup"==u&&(a.showSignupForm=!0),a.signupToggle=function(){a.showSignupForm=!0},a.loginToggle=function(){a.showSignupForm=!1},a.panel={facebookLoginInProgress:!1},a.cancel=function(){o.dismiss()},a.ok=function(){o.close()},a.confirmFieldsValid=function(){var e=!1;return e=a.userFields.email.toUpperCase()===a.userFields.confirmEmail.toUpperCase()&&a.userFields.password==a.userFields.confirmPassword?!0:e},a.onSignIn=function(){a.googleAuthError={},d.login().then(function(e){var n;n=e,p(function(e,t){g.eventTrack("googleregister/login",{category:"user",label:""}),f(function(){a.googleProfile={id:n.id,email:n.email,firstName:n.firstName,lastName:n.lastName,name:n.name,profileImage:n.profileImage,token:n.token},m.googleLoginOrRegister(a.googleProfile.email,a.googleProfile.firstName,a.googleProfile.lastName,a.googleProfile.name,a.googleProfile.id,a.googleProfile.profileImage,a.googleProfile.token).then(function(){A(),T(),E(!0),o.close(!0),console.log("google registered and loaded the user!"),e()},function(e){console.error("could not register: ",e),t(e)})},500)})}).catch(function(e){e&&e.error&&e?(console.error("Google Auth Error: "+e.error),"idpiframe_initialization_failed"===e.error?a.googleAuthError={error:!0,message:"Could not continue with Google. Please enable third-party cookies in your browser settings."}:"popup_closed_by_user"===e.error&&(a.googleAuthError={error:!0,message:"Could not continue with Google due to popup being closed. Please refresh your browser and try again."})):console.error("Failed: "+e)})},a.facebookResult=function(e,t){switch(e){case"cancelled":a.panel.facebookLoginInProgress=!1;break;case"loadingError":alert("Unable to load Facebook.  Sorry."),a.panel.facebookLoginInProgress=!1;break;case"success":var n=null;r.getPhoto(500,500).then(function(e){n=e},function(e){console.log("error getting fb photo: "+e)}).finally(function(e){i.facebookLoginOrRegister(t.email,t.first_name,t.last_name,t.name,t.id,n).then(function(){a.panel.facebookLoginInProgress=!1,o.close(!0)},function(e){alert(e),a.panel.facebookLoginInProgress=!1})})}};var l={};a.recaptcha_setWidgetId=function(e,t){l[t]=e},a.recaptcha_setResponse=function(e,t){"login"==t?s(e):"register"==t&&c(e)},a.recaptcha_expires=function(e){n.reload(l[e])},a.recaptcha_error=function(e){n.reload(l[e])},a.startRecaptcha=function(e,t){e.preventDefault(),a.recaptchaBoolean?n.execute(l[t]):"login"==t?s(null):"register"==t&&c(null)}}],windowClass:"lgx-modal"}).result.then(function(e){e?(t(e),a&&r.location.reload()):n(e)},function(e){n(e)})})}return A(),E(!1),e.$on("user:login-change",function(e,n){window.fcWidget&&window.fcWidget.user.get(function(e){var t=e&&e.status;e&&e.data;200!==t&&n.loggedIn&&window.fcWidget.user.setProperties({externalId:n.user.Email,firstName:n.user.FirstName,lastName:n.user.LastName,email:n.user.Email,phone:n.user.Mobile}).then(function(e){window.fcWidget.on("user:created",function(e){var t=e&&e.status,e=e&&e.data;200===t&&e.restoreId&&console.log("user restoreId",e.restoreId)})})})}),{loggedIn:$,isLoggedIn:$,login:function(e,t,n){return a=e,o=t,i=n,p(function(t,n){g.eventTrack("login",{category:"user",label:""}),f(function(){m.user.login(a,o,i).then(function(e){I&&I.ID!==e.id&&(A(),T()),E(!0),t(e)},function(e){n(e)})},500)});var a,o,i},logout:function(e){var t;t=void 0===(e=e)||e,m.logout().then(function(){A(),E(!0).then(function(){}).finally(function(){t&&(r.location.href="/")})})},onBehalfOfUser:function(e){var a;a=e,p(function(t,n){f(function(){m.onBehalfOfUser(a).then(function(e){I&&I.ID!==e.id&&(A(),T()),E(!0),t(e)},function(e){n(e)})},500)})},reloadUser:function(){E(!1)},current:function(){return I},get:function(){return E()},getApplication:function(){return o},isRecaptchaActive:function(){return S},isCountryEU:function(){return w},getPaymentProviderTypes:function(){return h},getPaymentProviderKey:function(e){return void 0===l[e]&&console.log("No key for "+e),l[e]},getPaymentProviderMode:function(e){return void 0===u[e]&&console.log("No key for "+e),u[e]},getPreferredCurrency:function(){return v},setPreferredCurrency:function(e){v=e},currencySymbol:function(){return y},countryCode:function(){return"US"},getEnvironment:function(){return c},isSentryEnabled:function(){return k},isSentryTracking:function(){return P},sentryRelease:function(){return j},register:function(e,t){return n=e,a=t,p(function(e,t){g.eventTrack("register",{category:"user",label:""}),f(function(){m.user.register(n,a).then(function(){A(),T(),E(!0),console.log("registered and loaded the user!"),e()},function(e){console.log("could not register"),t(e)})},500)});var n,a},facebookLoginOrRegister:function(e,t,n,a,o,i){return r=e,s=t,c=n,l=a,u=o,d=i,p(function(e,t){g.eventTrack("fbregister/login",{category:"user",label:""}),f(function(){m.facebookLoginOrRegister(r,s,c,l,u,d).then(function(){A(),T(),E(!0),console.log("registered and loaded the user!"),e()},function(e){console.log("could not register"),t(e)})},500)});var r,s,c,l,u,d},isAdmin:function(){return $()&&I.IsAdmin},loginModal:M,isFacebookLinked:function(){return $()&&I.FacebookLinked},ipCountryCode:function(){return b},isBlacklisted:function(){return $()&&I.IsBlacklisted},enforceMFA:function(){return p(function(e,t){E().then(function(){I?I.MFAConfigured?m.user.mfa.valid(!0).then(function(){e()},function(){i.open({templateUrl:s.urlForTemplate("user/mfa/authenticate-modal.html"),controller:["$scope","$uibModalInstance","api",function(t,n,e){t.data={code:"",processing:!1,error_message:void 0},t.cancel=function(){n.dismiss()},t.ok=function(){t.data.processing=!0,e.user.mfa.authenticate(t.data.code).then(function(e){n.close({})},function(e){t.data.error_message=e}).finally(function(){t.data.processing=!1})}}],backdrop:"static"}).result.then(function(){E(!0).then(e,t)},t)}):(alert("You must setup MFA before you will be allowed to do this."),t("Not setup")):t("Not logged in.")},t)})},setupMFA:function(){return p(function(e,t){E().then(function(){I?I.MFAConfigured?(alert("You cannot reset MFA once it's setup."),t("Not setup")):i.open({templateUrl:s.urlForTemplate("user/mfa/setup-modal.html"),controller:["$scope","$uibModalInstance","api",function(t,n,e){t.data={code:"",src:"",processing:!1,loading:!1,error_message:void 0},t.cancel=function(){n.dismiss()},t.ok=function(){t.data.processing=!0,e.user.mfa.setup("confirm",t.data.code).then(function(e){n.close({})},function(e){t.data.error_message=e}).finally(function(){t.data.processing=!1})},t.data.loading=!0,e.user.mfa.setup("load").then(function(e){t.data.src=e.src},function(e){t.data.error_message=e}).finally(function(){t.data.loading=!1})}],backdrop:"static"}).result.then(function(){E(!0).then(e,t)},t):t("Not logged in.")},t)})},isMFAConfigured:function(){return $()&&I.MFAConfigured},permittedCountries:function(){return D=void 0===D?m.project.permittedCountryCodes():D},prioritizedCountries:function(){return["US","GB","CA","MY","AU","NZ"]}}}]),e.controller("UserImageController",["$scope","api","imageUpload",function(t,e,n){t.fullName="",t.imageSrc=null,t.canEdit=!1,t.thumbnail=!0,e.UserImage.get({id:t.userId},function(e){e.valid?(t.fullName=e.fullName,t.canEdit=e.canEdit,t.imageSrc=e.imageSrc,t.thumbnail=!0):(t.fullName=null,t.canEdit=!1,t.imageSrc=null,t.thumbnail=!1)}),t.changeImage=function(){n.selectImage("user",t.userId,!1).result.then(function(e){t.imageSrc=e.url,t.fullname=e.caption,t.thumbnail=!1})}}]).directive("userImage",function(){return{controller:"UserImageController",restrict:"E",scope:{userId:"="},template:'<div style="width: 180px;" class="text-center"><div ng-if="imageSrc"><img ng-src="{{ imageSrc }}" alt="{{ fullName }}" ng-class="{ \'img-circle\': thumbnail }" style="max-width: 180px;"></img></div><div ng-if="canEdit" style="margin-top: 10px;"><a class="btn btn-sm btn-primary" ng-click="changeImage()">Change Image</a><p class="help-block">Your image will be cropped square, 180 by 180 pixels or larger</p></div></div>'}}),e.directive("loginButton",["User",function(o){return{restrict:"E",scope:{},template:'<a ng-click="showLoginModal()" class="lgx-t-black lgx-t-caption">Login or Sign Up</a>',link:function(e,t,n){var a=n.modalType||"bs";e.showLoginModal=function(){o.loginModal(void 0,a)}}}}]),e.directive("contactUser",["$uibModal","api","Dialogs","patronicityConfig","User","$location",function(a,p,m,g,f,o){return{restrict:"A",scope:{userId:"=",showLocation:"=?"},link:function(e,t,n){var l=n.mode||"ask-anything",u=n.projectId||null,d=o.absUrl();t.on("click",function(){a.open({templateUrl:g.urlForTemplate("user/contact-user-modal.html"),controller:["$scope","$uibModalInstance","userId","showLocation","vcRecaptchaService","$sentry",function(a,o,i,e,r,t){var s;function n(){u&&p.project.getProject(u).then(function(e){a.messageDetails.projectName=e.Project.Name,a.messageDetails.projectUrl=e.Project.URL,console.log("ProjectName: "+e.Project.Name)})}function c(e){var t,n;!a.processing&&(n=!1,n=!!(0<a.messageDetails.name.length&&0<a.messageDetails.message.length&&(t=a.messageDetails.email,/^(([^<>()[\]\\.,;:\s@\"]+(\.[^<>()[\]\\.,;:\s@\"]+)*)|(\".+\"))@((\[[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\])|(([a-zA-Z\-0-9]+\.)+[a-zA-Z]{2,}))$/.test(t)))||n)&&(a.processing=!0,p.user.contact(i,a.messageDetails,a.template,e).then(function(e){m.Confirm("Message sent successfully","Sent",[{name:"Ok",type:"ok"}]).then(function(){o.close()})},function(e){a.processing=!1,alert(e)}).finally(function(){a.recaptchaBoolean&&r.reload(s)}))}a.contactUs=!1,a.isPTProgramsPage=!1,a.sendMessage=!1,a.isPTProgramsPage=-1<d.indexOf("partner"),a.showLocation=e,a.processing=!1,a.displayEmail=!0,a.messageDetails={name:"",email:"",message:"",phone:"",location:"",subject:"",projectName:"",projectUrl:"",mode:l},a.recaptchaBoolean=f.isRecaptchaActive(),a.application=g.applicationName,"contact-us"==l?(!1===a.isPTProgramsPage&&p.user.getSubjectList(i).then(function(e){console.log("Build email subject list"),a.listDetails=[],a.listDetails.subjectList=e}),a.template="contact",a.contactUs=!0):"send-email"==l?(f.isLoggedIn()?(console.log("User is logged in"),e=f.current(),a.messageDetails.name=e.UserName,a.messageDetails.email=e.Email,a.template="user-contact",a.contactUs=!1,a.sendMessage=!0,n()):(console.log("User is not logged in"),a.displayEmail=!1),f.isBlacklisted()&&(console.log("User is Black listed"),a.displayEmail=!1)):(a.template="user-contact",a.contactUs=!1,n()),a.cancel=function(){o.close()},a.recaptcha_setWidgetId=function(e){s=e},a.recaptcha_setResponse=function(e){c(e)},a.recaptcha_expires=function(){r.reload(s)},a.recaptcha_error=function(){t.log("Recaptcha error!","debug"),r.reload(s)},a.startRecaptcha=function(){a.recaptchaBoolean?r.execute(s):c(null)}}],resolve:{userId:function(){return e.userId},showLocation:function(){return e.showLocation}},backdrop:"static"})})}}}]),e.directive("requestDeactivation",["api","Dialogs","User",function(a,o,i){return{restrict:"A",scope:{userId:"="},link:function(t,e){t.processing=!1;var n=i.current();e.on("click",function(){t.processing||void 0===t.userId||o.Confirm("Deleting your account will permanently remove all information and activity associated with "+n.Email+" on LaunchGood. You will not be able to access your profile after deletion","Are you sure?",[{name:"Delete",type:"ok"},{name:"Cancel",type:"cancel"}]).then(function(e){"ok"!=e.type||t.processing||void 0===t.userId||(t.processing=!0,a.user.deleteRequest(t.userId).then(function(e){o.Confirm("We've received the request to delete your account. You will receive an email from our team once it has been completed.","Delete request received",[{name:"Ok",type:"ok"}])},function(e){t.processing=!1,alert(e)}))})})}}}]),e.directive("toggleSubscribeToNewsletter",["api",function(n){return{restrict:"A",scope:{userId:"="},link:function(e,t){t.on("click",function(){void 0!==e.userId&&n.user.toggleSubscribeToNewsletter(e.userId)})}}}]),e.directive("sendEmailConfirmation",["api","patronicityConfig","$uibModal",function(a,n,o){return{restrict:"A",scope:{userId:"="},link:function(e,t){t.on("click",function(){e.userId?o.open({templateUrl:n.urlForTemplate("user-profile/dialogs/cards/success-ok.html"),controller:["$scope","$uibModalInstance","userId",function(e,t,n){e.cancel=function(){t.close()},e.successMessage="Please check your email inbox for a new verification email.",a.user.sendEmailConfirmation(n)}],resolve:{userId:function(){return e.userId}},backdrop:"static"}):o.open({templateUrl:n.urlForTemplate("user-profile/dialogs/cards/failure-ok.html"),controller:["$scope","$uibModalInstance",function(e,t){e.cancel=function(){t.close()},e.failureMessage="Could not find the current user, please refresh the page or retry."}],resolve:{},backdrop:"static"})})}}}]),e.directive("myCards",["api","patronicityConfig","addCardsFactory","Dialogs","$stateParams","$uibModal",function(i,r,s,c,l,u){return{restrict:"E",templateUrl:r.urlForTemplate("user/cards.html"),link:function(a,e,t){a.cards=[];var n=l.username;function o(){i.user.cards.list(n).then(function(e){a.cards=e.cards,a.userId=e.userId})}o(),a.addCardsModal=function(){s.showAddCardsModal().result.then(function(e){o()})},a.removeCard=function(n){i.user.cards.pendingUsage(n.ID,a.userId).then(function(e){var t;e.subscriptions.length||e.donations.length?(t=e,u.open({templateUrl:r.urlForTemplate("user/card-delete-error.html"),controller:["$scope","$uibModalInstance","data",function(e,t,n){e.subscriptions=n.subscriptions,e.donations=n.donations,e.cancel=function(){t.dismiss()}}],size:"sm",resolve:{data:function(){return t}}})):c.Confirm("Are you sure you wish to remove the saved <strong>"+n.Description+"</strong>? Note that this will not cancel any pending or completed donations.","Remove Card",[{name:"Ok",type:"ok"},{name:"Cancel",type:"cancel"}]).then(function(){i.user.cards.remove(n.ID,a.userId).then(function(e){o()})})})},a.setDefaultCard=function(e){i.user.cards.setDefault(e.ID,a.userId).then(function(e){c.Confirm("Default credit card set","Default Credit Card Set Successfully",[{name:"Ok",type:"ok"}]).then(function(){o()})})}}}}]),e.directive("addCardModalContents",["patronicityConfig","api",function(n,e){return{restrict:"E",scope:{},templateUrl:function(e,t){t=t.templateUrl||"user/addCards.html";return n.urlForTemplate(t)},link:function(a,e,t){a.data={isGuest:!1,cardRequired:!0},a.continueWithNewCard=function(e,t,n){a.$emit("add-card:added",e)},a.cancel=function(){a.$emit("add-card:cancel")}}}}]),e.factory("addCardsFactory",["$uibModal","patronicityConfig","User","$sce","api","$analytics","$rootScope",function(e,t,n,a,o,i,r){return{showAddCardsModal:function(){return e.open({template:"<add-card-modal-contents></add-card-modal-contents>",controller:["$scope","$uibModalInstance",function(e,n){e.$on("add-card:cancel",function(){n.dismiss()}),e.$on("add-card:added",function(e,t){i.eventTrack("AddCard",{}),n.close(t)})}],windowClass:"addCardsModal"})}}}]),e.directive("conditionalScripts",["patronicityConfig","$rootScope","User",function(e,t,a){return{templateUrl:e.urlForTemplate("scripts.html"),link:function(e,t,n){e.ChallengeIDs=[],e.loaded=!1,a.get().then(function(){a.isLoggedIn()?(e.loaded=!0,e.ChallengeIDs=a.current().ChallengeIDs):e.loaded=!0})}}}]),e.directive("userPoints",["api","patronicityConfig","$rootScope","User",function(o,e,t,n){return{templateUrl:e.urlForTemplate("user/user-points.html"),scope:{},link:function(n,e,t){function a(t){(t=void 0===t?!1:t)?n.points.loadingMore=!0:n.points.loading=!0,n.loading=!0,o.user.points.recentWithFilter(n.points.query).then(function(e){t&&n.points.query.data.length?angular.forEach(e,function(e){n.points.query.data.push(e)}):n.points.query.data=e,n.showLoadMore=n.points.canShowLoadMore&&e.length==n.points.query.limit,n.points.loading=!1,n.points.loadingMore=!1})}n.points={query:{userId:void 0,source:t.source||void 0,limit:t.maxPerLoad||5,offset:0},data:[],loading:!1,loadingMore:!1,canShowLoadMore:!1},a(),void 0===t.showLoadMore||"0"===t.showLoadMore||"false"===t.showLoadMore?n.points.canShowLoadMore=!1:n.points.canShowLoadMore=!0,n.showMore=function(e){n.points.query.offset+=parseInt(n.points.query.limit),a(e)}}}}]),e.directive("userProfileCreditCardsLgx",["User","addCardsFactory","patronicityConfig","$stateParams","api","$uibModal","googlePayFactory","applePayFactory",function(o,i,l,u,d,p,m,g){return{restrict:"E",templateUrl:l.urlForTemplate("giving/components/payment-method.html"),scope:{settings:"=?"},link:function(t,e,n){t.settings={selectedCard:[],cardListShown:!1,cardFormShown:!1,cards:[],processing:!1,type:n.type,username:u.username,allow_google_pay:!1,allow_apple_pay:!1};var a,s=u.username;function c(e){t.isLoading=!0,d.user.cards.list(e).then(function(e){t.settings.cards=e.cards,t.settings.paymentDefault=e.paymentDefault},function(e){t.hasError=!0}).finally(function(){t.isLoading=!1})}function r(n){p.open({templateUrl:l.urlForTemplate("user-profile/dialogs/cards/success-ok.html"),controller:["$scope","$uibModalInstance",function(e,t){e.successMessage=n?"Your chosen payment method has been marked as default and your enrollments have been updated.":"Your chosen payment method has been marked as default.",e.cancel=function(){t.close()}}],resolve:{},backdrop:"static"})}a=s,d.user.loadUser(a).then(function(e){t.userId=e.user.ID,c(a)}),o.get().then(function(){m.supported().then(function(e){t.settings.allow_google_pay=e},function(){}),g.supported().then(function(e){t.settings.allow_apple_pay=e},function(){})}),t.addCardsModal=function(){i.showAddCardsModal(!0).result.then(function(e){c(s)})},t.toggleCardList=function(){t.settings.cardListShown=!t.settings.cardListShown},t.toggleCardForm=function(){t.settings.cardFormShown=!t.settings.cardFormShown,t.toggleCardList()},t.setDefaultCard=function(a){var o,i=t.userId;"google"==a.ID||"apple"==a.ID?d.user.cards.setDefault(a.ID,i).then(function(e){c(s),r(!1)}):p.open({templateUrl:l.urlForTemplate("user-profile/dialogs/cards/default-card/are-you-sure.html"),controller:["$scope","$uibModalInstance",function(t,n){t.card=a,t.confirm=function(){d.user.cards.setDefault(t.card.ID,i).then(function(e){c(s),d.user.updateEnrollments(t.subscriptions,t.card.ID,i,"active-giving").then(function(e){(o=e.subscriptions)&&0<o.length?(p.open({templateUrl:l.urlForTemplate("user-profile/dialogs/cards/default-card/update-auto-giving.html"),controller:["$scope","$uibModalInstance",function(e,t){e.card=a,e.subscriptions=o,e.update=function(){d.user.updateEnrollments(e.subscriptions,e.card.ID,i,"enroll").then(function(e){t.close(),r(!0)})},e.useCurrentSettings=function(){t.close(),r(!0)},e.cancel=function(){t.close()}}],resolve:{},backdrop:"static"}),n.close()):(n.close(),r(!1))})})},t.cancel=function(){n.close()}}],resolve:{},backdrop:"static"})},t.removeCard=function(a){var o,i=t.userId,r=[];t.settings&&t.settings.cards&&(r=t.settings.cards),d.user.cards.pendingUsage(a.ID,i).then(function(e){(o=e.subscriptions)&&0<o.length?p.open({templateUrl:l.urlForTemplate("user-profile/dialogs/cards/remove-card/update-enrollment-or-remove-card.html"),controller:["$scope","$uibModalInstance",function(e,t){e.cards=r,e.card=a,e.totalCards=r.length,e.subscriptions=o,e.updateEnrollments=function(){p.open({templateUrl:l.urlForTemplate("user-profile/dialogs/cards/update-subscription/update-enrollments.html"),controller:["$scope","$uibModalInstance",function(e,t){e.subscriptions=o,e.cards=r,e.originalCard=a,e.availableCards=[];for(var n=0;n<e.cards.length;n++)e.cards[n]!=e.originalCard&&e.availableCards.push(e.cards[n]);e.selectedCard=e.availableCards[0],e.update=function(){d.user.updateEnrollments(e.subscriptions,e.selectedCard.ID,i,"enroll").then(function(e){p.open({templateUrl:l.urlForTemplate("user-profile/dialogs/cards/success-next.html"),controller:["$scope","$uibModalInstance",function(e,t){e.successMessage="Your linked enrollments have been updated.",e.next=function(){p.open({templateUrl:l.urlForTemplate("user-profile/dialogs/cards/remove-card/are-you-sure.html"),controller:["$scope","$uibModalInstance",function(e,t){e.card=a,e.remove=function(){d.user.cards.remove(a.ID,i).then(function(e){c(s),p.open({templateUrl:l.urlForTemplate("user-profile/dialogs/cards/success-ok.html"),controller:["$scope","$uibModalInstance",function(e,t){e.successMessage="Your saved payment method has been successfully removed from the system.",e.cancel=function(){t.close()}}],resolve:{},backdrop:"static"}),t.close()})},e.cancel=function(){t.close()}}],resolve:{},backdrop:"static"}),t.close()},e.cancel=function(){t.close()}}],resolve:{},backdrop:"static"}),t.close()})},e.cancel=function(){t.close()}}],resolve:{},backdrop:"static"}),t.close()},e.removeUnenroll=function(){d.user.updateEnrollments(e.subscriptions,a.ID,i,"unenroll").then(function(e){d.user.cards.remove(a.ID,i).then(function(e){c(s),p.open({templateUrl:l.urlForTemplate("user-profile/dialogs/cards/success-ok.html"),controller:["$scope","$uibModalInstance",function(e,t){e.successMessage="Your saved payment method has been successfully removed from the system and you have been unenrolled from challenges.",e.cancel=function(){t.close()}}],resolve:{},backdrop:"static"}),t.close()})})},e.cancel=function(){t.close()}}],resolve:{},backdrop:"static"}):p.open({templateUrl:l.urlForTemplate("user-profile/dialogs/cards/remove-card/are-you-sure.html"),controller:["$scope","$uibModalInstance",function(e,t){e.card=a,e.remove=function(){d.user.cards.remove(a.ID,i).then(function(e){c(s),p.open({templateUrl:l.urlForTemplate("user-profile/dialogs/cards/success-ok.html"),controller:["$scope","$uibModalInstance",function(e,t){e.successMessage="Your saved payment method has been successfully removed from the system.",e.cancel=function(){t.close()}}],resolve:{},backdrop:"static"}),t.close()})},e.cancel=function(){t.close()}}],resolve:{},backdrop:"static"})})}}}}])}(),function(){var e=angular.module("patronicity.user.newprofile",["patronicity.api","user","ngTable","ui.bootstrap","ui.router","patronicity.configuration"]),d="/user-profile/profile-sidebar/{username}/{section}",n="/user-profile/profile/{username}",a="/{tab}",o="/{tab}",i="/{tab}",r="/user-profile/notifications/{username}",s="/user-profile/donations/{username}",c="/user-profile/auto-giving-and-challenges/{username}",l="/user-profile/give-list/{username}",u="/user-profile/zakat/{username}",p="/user-profile/zakat/{username}/{profile}",m="/user-profile/zakat/{username}/offline-donation",g="/user-profile/zakat/{username}/{profile}/zakat-calculator",f="/user-profile/campaigns/{username}",h="/active-campaigns",y="/closed-campaigns",v="/draft-campaigns",b="/team-campaigns",w="/user-profile/communities/{username}",C="/user-profile/reports/{username}",D="/user-profile/edit-settings/{username}",I="/user-profile/edit-profile/{username}",S="/user-profile/cards-and-payment-methods/{username}",k="/user-profile/fundraising-and-bank/{username}",j="/user-profile/auto-giving-and-challenges/{username}/{givingType}/{slug}/{template}",P="/user-profile/youre-in/{username}/{givingType}/{slug}",A="/give-with/{type}/{name}";e.config(["patronicityConfigProvider","$stateProvider",function(e,t){e=e.options.templateBasePath;t.state("user-profile",{url:"",abstract:!0}).state("user-profile.profile-sidebar",{url:d,template:"<profile-sidebar></profile-sidebar>"}).state("user-profile.profile",{url:n,template:"<profile-public></profile-public>"}).state("user-profile.notifications",{url:r,templateUrl:e+"user-profile/pages/notifications.html"}).state("user-profile.donations",{url:s,template:"<profile-donations></profile-donations>"}).state("user-profile.youre-in",{url:P,template:"<profile-youre-in></profile-youre-in>"}).state("user-profile.give-list",{url:l,template:'<profile-give-list-page page="profile"></profile-give-list-page>'}).state("user-profile.zakat",{url:u,template:"<profile-zakat></profile-zakat>"}).state("user-profile.offline-donation",{url:m,template:"<profile-offline-donation></profile-offline-donation>"}).state("user-profile.zakat-profile",{url:p,template:"<profile-zakat></profile-zakat>"}).state("user-profile.zakat-calculator",{url:g,template:"<zakat-calculator></zakat-calculator>"}).state("user-profile.campaigns",{url:f,template:"<profile-campaigns></profile-campaigns>",redirectTo:"user-profile.campaigns.active-campaigns"}).state("user-profile.communities",{url:w,template:"<profile-communities></profile-communities>"}).state("user-profile.reports",{url:C,template:"<profile-reports></profile-reports>"}).state("user-profile.edit-settings",{url:D,template:"<profile-account-settings></profile-account-settings>"}).state("user-profile.edit-profile",{url:I,template:"<profile-edit></profile-edit>"}).state("user-profile.cards-and-payment-methods",{url:S,template:"<profile-payment-methods></profile-payment-methods>"}).state("user-profile.fundraising-and-bank",{url:k,templateUrl:e+"user-profile/pages/my-fundraising/payout-details.html"}).state("user-profile.campaigns.active-campaigns",{url:h,views:{"":{template:"<profile></profile>"},"campaignSection@user-profile.campaigns":{template:'<project-card-grid project-status="active" public-profile-page=true id="campaigns" default-type="created" type="created" display="lgx-hybrid" max-per-load="6" show-load-more="true"></project-card-grid>'}}}).state("user-profile.campaigns.closed-campaigns",{url:y,views:{"":{template:"<profile></profile>"},"campaignSection@user-profile.campaigns":{template:'<project-card-grid project-status="closed" public-profile-page=true id="campaigns" default-type="created" type="created" display="lgx-hybrid" max-per-load="6" show-load-more="true"></project-card-grid>'}}}).state("user-profile.campaigns.draft-campaigns",{url:v,views:{"":{template:"<profile></profile>"},"campaignSection@user-profile.campaigns":{template:'<project-card-grid project-status="draft" public-profile-page=true id="campaigns" default-type="created" type="created" display="lgx-hybrid" max-per-load="6" show-load-more="true"></project-card-grid>'}}}).state("user-profile.campaigns.team-campaigns",{url:b,views:{"":{template:"<profile></profile>"},"campaignSection@user-profile.campaigns":{template:'<project-card-grid project-status="team-member" default-type="assigned" max-per-load="6" category="all" type="assigned" show-load-more="true" display="lgx-hybrid" param1="profileDetails.user.ID"></project-card-grid>'}}}).state("user-profile.auto-giving-and-challenges",{url:c,template:"<profile-auto-giving-and-challenges></profile-auto-giving-and-challenges>"}).state("user-profile.challenge-or-club",{url:j,template:"<profile-join></profile-join>"}).state("user-profile.profile.created-campaigns",{url:a,views:{"":{template:"<profile></profile>"},"campaignSection@user-profile.profile":{template:'<project-card-grid public-profile-page=true id="campaigns" default-type="created" type="created" display="lgx-hybrid" max-per-load="6" show-load-more="true"></project-card-grid>'}}}).state("user-profile.profile.supported-campaigns",{url:o,views:{"":{template:"<profile></profile>"},"campaignSection@user-profile.profile":{template:'<project-card-grid public-profile-page=true id="campaigns" default-type="supported" type="supported" display="lgx-hybrid" max-per-load="6" show-load-more="true"></project-card-grid>'}}}).state("user-profile.profile.communities",{url:i,views:{"":{template:"<profile></profile>"},"campaignSection@user-profile.profile":{template:'<profile-communities page="publicProfilePage"></profile-communities>'}}}).state("user-profile.give-with",{url:A,template:"<give-with></give-with>"})}]),e.directive("userProfile",["api","$state","$stateParams","User","patronicityConfig","$location","$window","$transitions",function(i,r,s,e,t,c,l,u){return{restrict:"E",templateUrl:t.urlForTemplate("user-profile/user-profile.html"),scope:{},link:function(t){var n=800,a=(t.isMobileView=!1,t.isLoading=!1,"");function e(e){t.isLoading=!0,t.visibility="public",i.user.loadUser(e).then(function(e){t.profileData=e,t.visibility=e.user.Visibility,"public"===t.visibility&&(s.tab?(a="user-profile.profile."+s.tab,r.go(a,{username:s.username,tab:s.tab})):(a="user-profile.profile",r.go(a,{username:s.username}))),l.innerWidth<n&&o(),(t.isMobileView||c.url()!==d)&&""!==c.url()||r.go("user-profile.donations",{username:s.username}),angular.element(l).on("resize",function(){var e=t.isMobileView;l.innerWidth<n?o():(t.isMobileView=!1,c.url()==d&&r.go("user-profile.donations",{username:s.username})),e!=t.isMobileView&&t.$apply()}),t.$on("$destroy",function(){angular.element(l).off("resize")}),u.onSuccess({},function(){switch(l.scrollTo({top:0,behavior:"smooth"}),t.isCampaignPage=!1,t.isCommunityPage=!1,c.url()){case f:t.isCampaignPage=!0;break;case w:t.isCommunityPage=!0;break;case"":case"/":r.go("user-profile.donations",{username:s.username})}})},function(e){window.location.href.includes("give-with")||(l.location.href="/discover")}).finally(function(){t.isLoading=!1})}function o(){t.isMobileView=!0}e(s.username),t.$watchCollection(function(){return r.params},function(){1!=t.isLoading&&e(s.username)})}}}]),e.directive("changePasswordLgx",["$uibModal","patronicityConfig","api",function(t,n,o){return{restrict:"E",template:'<button class="lgx-button--default lgx-button--default__cta lgx-button--default__cta-highest-value lgx-text-sm lgx-u-w-full" ng-click="openEditModal()">{{label}}</button>',scope:{user:"=",admin:"="},link:function(e){e.label="Change Password",e.openEditModal=function(){t.open({templateUrl:n.urlForTemplate("user/change-password.html"),controller:["$scope","$uibModalInstance","user","admin",function(t,n,e,a){t.admin=a,t.user=angular.copy(e),t.passwordDetails={},t.save=function(){t.messageText="",(t.passwordDetails.currentPassword||t.admin)&&t.passwordDetails.newPassword&&t.passwordDetails.confirmPassword?t.passwordDetails.newPassword==t.passwordDetails.confirmPassword?o.user.changePassword(t.passwordDetails.currentPassword,t.passwordDetails.newPassword,t.user.ID).then(function(e){n.close({})},function(e){t.messageText="Password validation failed: "+e}):t.messageText="Password validation failed: New and Confirm Password are not equal":t.messageText="Password validation failed: Must enter Old, New and Confirm Password"},t.cancel=function(){n.dismiss({})}}],size:"md",resolve:{user:function(){return e.user},admin:function(){return e.admin}}})}}}}]),e.directive("profileSidebar",["$state","api","patronicityConfig","$window","$stateParams",function(a,o,e,i,r){return{restrict:"E",templateUrl:e.urlForTemplate("user-profile/sidebar.html"),scope:{profile:"="},link:function(t){t.date=new Date,t.username=r.username;var e=document.querySelectorAll("details");if(800<i.innerWidth)for(var n=0;n<e.length;n++)e[n].open=!0;t.myGiving=!1,t.myFundraising=!1,t.mySettings=!1,1==r.section?t.myGiving=!0:2==r.section?t.myFundraising=!0:(3!=r.section&&(t.myGiving=!0,t.myFundraising=!0),t.mySettings=!0),t.$watchCollection(function(){return a.params},function(){var e;t.username=r.username,1!=t.isLoading&&(e=t.username,t.isLoading=!0,o.user.loadUser(e).then(function(e){t.displayName=e.profile.DisplayName,t.email=e.user.Email,t.thumbnail=e.user.thumbNailUrl}).finally(function(){t.isLoading=!1}))})}}}]),e.directive("profileDonations",["api","patronicityConfig","User","$stateParams","$uibModal","$state","moment","$filter",function(i,r,e,s,c,l,u,d){return{restrict:"E",templateUrl:r.urlForTemplate("user-profile/pages/my-giving/donations.html"),scope:{slug:"@"},link:function(n){var e,t=4,a=(n.processing=!1,n.filterDateOption="all-time",n.dropDownSelection="most-recent",n.reportFor="all time",n.filter={StartDate:null,EndDate:null},0);function o(){n.profileDetails&&n.profileDetails.user&&(n.processing=!0,i.user.loadDonations(n.profileDetails.user.ID,a,t,n.filter).then(function(e){n.totalChargedDonationsOnServer=e.totalCharged,n.totalDonationsOnServer=e.total,n.totalDonationsAllTime=e.totalAllTime,n.report_urls=e.report_urls,n.donationArray=n.donationArray.concat(e.items)},function(e){alert(e)}).finally(function(){n.processing=!1}))}n.username=s.username,e=n.username,i.user.loadUser(e).then(function(e){n.profileDetails=e,o()}),n.subscribeStatusChanged=function(e,t){n.processing=!0,i.project.toggleSubscribe(e).then(function(e){n.donationArray[t].project.receivedUpdates=e.receivedUpdates,c.open({templateUrl:r.urlForTemplate("user-profile/dialogs/delete-account/subscribe-success.html"),controller:["$scope","$uibModalInstance",function(e,t){e.cancel=function(){t.close()}}],resolve:{},backdrop:"static"})}).finally(function(){n.processing=!1})},n.shareAddressChanged=function(e,t){n.processing=!0,i.project.toggleShareAddress(e).then(function(e){n.donationArray[t].project.shareAddress=e.shareAddress,c.open({templateUrl:r.urlForTemplate("user-profile/dialogs/share-address.html"),controller:["$scope","$uibModalInstance",function(e,t){e.cancel=function(){t.close()}}],resolve:{},backdrop:"static"})}).finally(function(){n.processing=!1})},n.zakatStatusChanged=function(e,t){n.processing=!0,i.project.toggleZakat(e).then(function(e){n.donationArray[t].zakat.zakat="1"==e.Zakah},function(e){alert(e)}).finally(function(){n.processing=!1})},n.profileDetails={},n.anonymousLabel="launchgood"==n.applicationName?"an Anonymous Kind Soul":"Anonymous",n.resendReceipt=function(e){n.processing=!0,i.user.resendReceipt(e).then(function(e){c.open({templateUrl:r.urlForTemplate("user-profile/dialogs/email/success.html"),controller:["$scope","$uibModalInstance",function(e,t){e.cancel=function(){t.close()}}],resolve:{},backdrop:"static"})},function(e){c.open({templateUrl:r.urlForTemplate("user-profile/dialogs/email/failure-to-send.html"),controller:["$scope","$uibModalInstance",function(e,t){e.cancel=function(){t.close()}}],resolve:{},backdrop:"static"})}).finally(function(){n.processing=!1})},n.donationArray=[],n.sortDropDown=function(e){n.filter.sortBy=e,a=0,n.donationArray=[],o()},n.viewMore=function(){a+=4,o()},n.subscribeAll=function(){n.processing=!0,i.user.subscribeAll(n.profileDetails.user.ID).then(function(e){l.reload()}).finally(function(){n.processing=!1})},n.unsubscribeAll=function(){n.processing=!0,i.user.unsubscribeAll(n.profileDetails.user.ID).then(function(e){l.reload()}).finally(function(){n.processing=!1})},n.sortDateDropDown=function(e){n.filterDateOption=e},n.$watch("filterDateOption",function(e){switch(n.customRange=!1,n.reportFor="",e){case"all-time":n.filter.StartDate=null,n.filter.EndDate=null,n.reportFor="all time",n.reportCSVURL="";break;case"last-30-days":n.filter.StartDate=u().utc().subtract(1,"month").startOf("day").toDate(),n.filter.EndDate=u().utc().endOf("day").toDate(),n.reportFor="last 30 days";break;case"last-90-days":n.filter.StartDate=u().utc().subtract(3,"month").startOf("day").toDate(),n.filter.EndDate=u().utc().endOf("day").toDate(),n.reportFor="last 90 days";break;case"last-year":n.filter.StartDate=u().utc().subtract(12,"month").startOf("day").toDate(),n.filter.EndDate=u().utc().endOf("day").toDate(),n.reportFor="last year";break;case"custom-dates":n.filter.StartDate&&null!=n.filter.StartDate&&n.filter.EndDate&&null!=n.filter.EndDate?(n.filter.StartDate=u(n.filter.StartDate).startOf("day").toDate(),n.filter.EndDate=u(n.filter.EndDate).startOf("day").toDate()):(n.filter.StartDate=u().startOf("day").toDate(),n.filter.EndDate=u().add(1,"day").startOf("day").toDate()),n.customRange=!0}}),n.$watchCollection("filter",function(e,t){e.StartDate==t.StartDate&&e.EndDate==t.EndDate||("all-time"===n.filterDateOption?n.reportFor="all-time":n.reportFor=d("date")(u(n.filter.StartDate).format("YYYY-MM-DD"),"longDate")+" - "+d("date")(u(n.filter.EndDate).format("YYYY-MM-DD"),"longDate"),n.startDateText=u(n.filter.StartDate).format("YYYY-MM-DD"),n.endDateText=u(n.filter.EndDate).format("YYYY-MM-DD"),0==u(n.filter.EndDate).diff(u(n.filter.StartDate),"days")&&(null==e.StartDate?e.StartDate=t.StartDate:e.EndDate=t.EndDate),n.reportCSVURL="/"+u(n.filter.StartDate).format("YYYY-MM-DD HH:mm:ss")+"/"+u(n.filter.EndDate).format("YYYY-MM-DD HH:mm:ss"),a=0,n.donationArray=[],o())})}}}]),e.directive("profileReports",["api","patronicityConfig","User","$stateParams","$uibModal","$state","moment","$filter",function(e,t,n,a,o,i,r,s){return{restrict:"E",templateUrl:t.urlForTemplate("user-profile/pages/my-fundraising/reports.html"),scope:{},link:function(t){t.data={accountsLoaded:!1,accounts:[],selectedAccount:void 0},t.username=a.username,n.get().then(function(){e.user.getAccounts(n.current().ID).then(function(e){e.forEach(function(e){t.data.accounts.push(e)}),0<t.data.accounts.length&&(t.data.selectedAccount=t.data.accounts[0]),t.data.accountsLoaded=!0})})}}}]),e.directive("profileEdit",["imageUpload","$stateParams","api","patronicityConfig","$window",function(e,a,o,t,i){return{restrict:"E",templateUrl:t.urlForTemplate("user-profile/pages/settings/edit-profile.html"),scope:{},link:function(t){function n(e){o.user.loadUser(e).then(function(e){t.profileDetails=e})}t.profileDetails={},t.username=a.username,n(t.username),t.toggleDisplaySupportedCampaigns=function(){o.user.toggleDisplaySupportedCampaigns(t.profileDetails.user.ID)},t.toggleDisplayCreatedCampaigns=function(){o.user.toggleDisplayCreatedCampaigns(t.profileDetails.user.ID)},t.toggleDisplayCommunities=function(){o.user.toggleDisplayCommunities(t.profileDetails.user.ID)},t.changeImage=function(){e.selectImage("user",t.profileDetails.user.ID,!1).result.then(function(e){t.profileDetails.user.thumbNailUrl=e.url})},t.clearImage=function(){confirm("Are you sure you want to remove this image?")&&(t.profileDetails.user.ID,o.user.clearProfilePicture(t.profileDetails.user.ID).then(function(e){i.location.reload()}).catch(function(e){alert("No image to clear!")}))},t.save=function(){t.processing=!0,o.user.saveProfile(t.profileDetails.profile,t.profileDetails.user).then(function(e){n(t.username)},function(e){t.messageText="Save failed: "+e}).finally(function(){t.processing=!1})}}}}]),e.directive("profileAccountSettings",["$uibModal","$stateParams","api","patronicityConfig","Dialogs","$timeout","User",function(i,e,r,s,t,n,c){return{restrict:"E",templateUrl:s.urlForTemplate("user-profile/pages/settings/edit-settings.html"),scope:{},link:function(a){function o(e){r.user.loadUser(e).then(function(e){a.profileDetails=e,a.dropDownSelection=a.profileDetails.profile.CountryCode,a.isShippingAddress=e.user.isShippingAddress,a.originalProfile=e,a.originalEmail=a.profileDetails.user.Email,a.profileDetails.profile&&a.profileDetails.profile.smsReminder?a.profileDetails.profile.smsReminderPhone=function(e){if(a.sortedCountries)for(var t=0;t<a.sortedCountries.length;t++){var n=new RegExp("^\\+"+a.sortedCountries[t].value+"(.+)$");if(e.match(n))return a.profileDetails.profile.countryCode=a.sortedCountries[t].value,e.replace(n,"$1")}}(a.profileDetails.profile.smsReminder):a.profileDetails.profile.countryCode="1",0==a.profileDetails.user.defaultSetting.length&&(a.profileDetails.user.defaultSetting={}),a.profileDetails.user.defaultSetting.defaultDisplayName=null!=a.profileDetails.user.defaultSetting.custom_name,a.profileDetails.user.defaultSetting.defaultDisplayLocation=!!a.profileDetails.user.defaultSetting.location,null!=a.profileDetails.user.defaultSetting.custom_name&&1==a.profileDetails.user.defaultSetting.custom_name?a.selectCustomType({id:1}):a.selectCustomType({id:2}),a.profileDetails.user.isShippingAddress&&(a.userShippingAddress=a.profileDetails.user.shippingAddress),a.userId=a.profileDetails.user.ID,n(function(){a.loading=!1},1e3)})}a.isAdmin=!1,c.get().then(function(){a.isAdmin=c.isAdmin()}),a.customType=[{id:1,name:"Custom Name"},{id:2,name:"An anonymous kind soul"}],a.isAnonymous=!0,a.user={},a.profileDetails={},a.isBillingAddress=!1,a.shippingForm=!1,a.username=e.username,a.loading=!0,o(a.username),a.loadShippingAddress=function(){a.profileDetails.user&&r.user.loadShippingAddress(a.userId).then(function(e){a.profileAddress=e.shippingAddress,a.billingAddress=e.billingAddress,a.profileAddress&&(a.user.shipping=angular.copy(a.profileAddress)),a.billingAddress&&(a.isBillingAddress=!0),a.isBillingAndProfileAddressAreSame()})},a.loadShippingAddress(),a.toggleSubscribeToNewsletter=function(){r.user.toggleSubscribeToNewsletter(a.userId)},a.toggleDisplayNameOnRecentDonations=function(){r.user.toggleDisplayNameOnRecentDonations(a.userId)},a.toggleDisplayLocationOnRecentDonations=function(){r.user.toggleDisplayLocationOnRecentDonations(a.userId)},a.selectDropDownPhone=function(e){a.profileDetails.profile.CountryCode=e},a.selectDropDownShippingAddress=function(e){a.profileDetails.profile.CountryCode=e},a.dropDownValues=[{value:"1",label:" (+1)"},{value:"44",label:" (+44)"},{value:"65",label:" (+65)"},{value:"60",label:" (+60)"},{value:"61",label:" (+61)"},{value:"64",label:" (+64)"},{value:"213",label:" (+213)"},{value:"376",label:" (+376)"},{value:"244",label:" (+244)"},{value:"1264",label:" (+1264)"},{value:"1268",label:" (+1268)"},{value:"54",label:" (+54)"},{value:"374",label:" (+374)"},{value:"297",label:" (+297)"},{value:"43",label:" (+43)"},{value:"994",label:" (+994)"},{value:"1242",label:" (+1242)"},{value:"973",label:" (+973)"},{value:"880",label:" (+880)"},{value:"1246",label:" (+1246)"},{value:"375",label:" (+375)"},{value:"32",label:" (+32)"},{value:"501",label:" (+501)"},{value:"229",label:" (+229)"},{value:"1441",label:" (+1441)"},{value:"975",label:" (+975)"},{value:"591",label:" (+591)"},{value:"387",label:" (+387)"},{value:"267",label:" (+267)"},{value:"55",label:" (+55)"},{value:"673",label:" (+673)"},{value:"359",label:" (+359)"},{value:"226",label:" (+226)"},{value:"257",label:" (+257)"},{value:"855",label:" (+855)"},{value:"237",label:" (+237)"},{value:"238",label:" (+238)"},{value:"1345",label:" (+1345)"},{value:"236",label:" (+236)"},{value:"56",label:" (+56)"},{value:"86",label:" (+86)"},{value:"57",label:" (+57)"},{value:"269",label:" (+269)"},{value:"242",label:" (+242)"},{value:"682",label:" (+682)"},{value:"506",label:" (+506)"},{value:"385",label:" (+385)"},{value:"53",label:" (+53)"},{value:"90392",label:" (+90392)"},{value:"357",label:" (+357)"},{value:"420",label:" (+420)"},{value:"45",label:" (+45)"},{value:"253",label:" (+253)"},{value:"1767",label:" (+1767)"},{value:"1809",label:" (+1809)"},{value:"593",label:" (+593)"},{value:"20",label:" (+20)"},{value:"503",label:" (+503)"},{value:"240",label:" (+240)"},{value:"291",label:" (+291)"},{value:"372",label:" (+372)"},{value:"251",label:" (+251)"},{value:"500",label:" (+500)"},{value:"298",label:" (+298)"},{value:"679",label:" (+679)"},{value:"358",label:" (+358)"},{value:"33",label:" (+33)"},{value:"594",label:" (+594)"},{value:"689",label:" (+689)"},{value:"241",label:" (+241)"},{value:"220",label:" (+220)"},{value:"995",label:" (+995)"},{value:"49",label:" (+49)"},{value:"233",label:" (+233)"},{value:"350",label:" (+350)"},{value:"30",label:" (+30)"},{value:"299",label:" (+299)"},{value:"1473",label:" (+1473)"},{value:"590",label:" (+590)"},{value:"1671",label:" (+1671)"},{value:"502",label:" (+502)"},{value:"224",label:" (+224)"},{value:"245",label:" (+245)"},{value:"592",label:" (+592)"},{value:"509",label:" (+509)"},{value:"504",label:" (+504)"},{value:"852",label:" (+852)"},{value:"36",label:" (+36)"},{value:"354",label:" (+354)"},{value:"91",label:" (+91)"},{value:"62",label:" (+62)"},{value:"98",label:" (+98)"},{value:"964",label:" (+964)"},{value:"353",label:" (+353)"},{value:"972",label:" (+972)"},{value:"39",label:" (+39)"},{value:"1876",label:" (+1876)"},{value:"81",label:" (+81)"},{value:"962",label:" (+962)"},{value:"7",label:" (+7)"},{value:"254",label:" (+254)"},{value:"686",label:" (+686)"},{value:"850",label:" (+850)"},{value:"82",label:" (+82)"},{value:"965",label:" (+965)"},{value:"996",label:" (+996)"},{value:"856",label:" (+856)"},{value:"371",label:" (+371)"},{value:"961",label:" (+961)"},{value:"266",label:" (+266)"},{value:"231",label:" (+231)"},{value:"218",label:" (+218)"},{value:"423",label:" (+423)"},{value:"370",label:" (+370)"},{value:"352",label:" (+352)"},{value:"853",label:" (+853)"},{value:"389",label:" (+389)"},{value:"261",label:" (+261)"},{value:"265",label:" (+265)"},{value:"960",label:" (+960)"},{value:"223",label:" (+223)"},{value:"356",label:" (+356)"},{value:"692",label:" (+692)"},{value:"596",label:" (+596)"},{value:"222",label:" (+222)"},{value:"269",label:" (+269)"},{value:"52",label:" (+52)"},{value:"691",label:" (+691)"},{value:"373",label:" (+373)"},{value:"377",label:" (+377)"},{value:"976",label:" (+976)"},{value:"1664",label:" (+1664)"},{value:"212",label:" (+212)"},{value:"258",label:" (+258)"},{value:"95",label:" (+95)"},{value:"264",label:" (+264)"},{value:"674",label:" (+674)"},{value:"977",label:" (+977)"},{value:"31",label:" (+31)"},{value:"687",label:" (+687)"},{value:"505",label:" (+505)"},{value:"227",label:" (+227)"},{value:"234",label:" (+234)"},{value:"683",label:" (+683)"},{value:"672",label:" (+672)"},{value:"1670",label:" (+1670)"},{value:"47",label:" (+47)"},{value:"968",label:" (+968)"},{value:"92",label:" (+92)"},{value:"680",label:" (+680)"},{value:"507",label:" (+507)"},{value:"675",label:" (+675)"},{value:"595",label:" (+595)"},{value:"51",label:" (+51)"},{value:"63",label:" (+63)"},{value:"48",label:" (+48)"},{value:"351",label:" (+351)"},{value:"1787",label:" (+1787)"},{value:"974",label:" (+974)"},{value:"262",label:" (+262)"},{value:"40",label:" (+40)"},{value:"7",label:" (+7)"},{value:"250",label:" (+250)"},{value:"378",label:" (+378)"},{value:"239",label:" (+239)"},{value:"966",label:" (+966)"},{value:"221",label:" (+221)"},{value:"381",label:" (+381)"},{value:"248",label:" (+248)"},{value:"232",label:" (+232)"},{value:"421",label:" (+421)"},{value:"386",label:" (+386)"},{value:"677",label:" (+677)"},{value:"252",label:" (+252)"},{value:"27",label:" (+27)"},{value:"34",label:" (+34)"},{value:"94",label:" (+94)"},{value:"290",label:" (+290)"},{value:"1869",label:" (+1869)"},{value:"1758",label:" (+1758)"},{value:"249",label:" (+249)"},{value:"597",label:" (+597)"},{value:"268",label:"Swaziland (+268)"},{value:"46",label:" (+46)"},{value:"41",label:" (+41)"},{value:"963",label:" (+963)"},{value:"886",label:" (+886)"},{value:"992",label:" (+992)"},{value:"66",label:" (+66)"},{value:"228",label:" (+228)"},{value:"676",label:" (+676)"},{value:"1868",label:" (+1868)"},{value:"216",label:" (+216)"},{value:"90",label:" (+90)"},{value:"993",label:" (+993)"},{value:"1649",label:" (+1649)"},{value:"688",label:" (+688)"},{value:"256",label:" (+256)"},{value:"380",label:" (+380)"},{value:"971",label:" (+971)"},{value:"598",label:" (+598)"},{value:"998",label:" (+998)"},{value:"678",label:" (+678)"},{value:"379",label:" (+379)"},{value:"58",label:" (+58)"},{value:"84",label:" (+84)"},{value:"84",label:" (+1284)"},{value:"84",label:" (+1340)"},{value:"681",label:" (+681)"},{value:"969",label:" (+969)"},{value:"967",label:" (+967)"},{value:"260",label:" (+260)"},{value:"263",label:" (+263)"}],a.findObjectByKey=function(e,t){for(var n=0;n<e.length;n++)if(e[n].value===t)return e[n].label;return null},a.save=function(){var t=a.processing=!0;a.originalEmail!=a.profileDetails.user.Email&&r.user.saveUser(a.profileDetails.user).then(function(e){},function(e){t=!1,a.messageText="Email change save failed: "+e}),t&&(a.profileDetails.profile.smsReminderPhone&&(a.profileDetails.profile.smsReminder="+"+a.profileDetails.profile.countryCode+a.profileDetails.profile.smsReminderPhone),r.user.saveProfile(a.profileDetails.profile,a.profileDetails.user).then(function(){o(a.username)},function(e){a.messageText="Save failed: "+e}).finally(function(){a.processing=!1}))},a.deactivateAccount=function(n){i.open({templateUrl:s.urlForTemplate("user-profile/dialogs/delete-account/are-you-sure.html"),controller:["$scope","$uibModalInstance",function(t,e){t.processing=!1,t.email=n.Email,t.cancel=function(){e.close()},t.delete=function(){t.processing||void 0===n.ID||(t.processing||void 0===n.ID||(t.processing=!0,r.user.deleteRequest(n.ID).then(function(e){t.processing=!1}),e.close()),i.open({templateUrl:s.urlForTemplate("user-profile/dialogs/delete-account/success.html"),controller:["$scope","$uibModalInstance",function(e,t){e.cancel=function(){t.close()}}],resolve:{},backdrop:"static"}),e.close())}}],resolve:{},backdrop:"static"})},a.disconnectGoogle=function(n){i.open({templateUrl:s.urlForTemplate("user-profile/dialogs/disconnect-google/are-you-sure.html"),controller:["$scope","$uibModalInstance",function(e,t){e.processing=!1,e.email=n.Email,e.cancel=function(){t.close()},e.disconnect=function(){e.processing||void 0===n.ID||(console.log("disconnect google"),i.open({templateUrl:s.urlForTemplate("user-profile/dialogs/disconnect-google/success.html"),controller:["$scope","$uibModalInstance",function(e,t){e.cancel=function(){t.close()}}],resolve:{},backdrop:"static"}),t.close())}}],resolve:{},backdrop:"static"})},a.disconnectFb=function(n){i.open({templateUrl:s.urlForTemplate("user-profile/dialogs/disconnect-facebook/are-you-sure.html"),controller:["$scope","$uibModalInstance",function(e,t){e.processing=!1,e.email=n.Email,e.cancel=function(){t.close()},e.disconnect=function(){e.processing||void 0===n.ID||i.open({templateUrl:s.urlForTemplate("user-profile/dialogs/disconnect-facebook/new-details.html"),controller:["$scope","$uibModalInstance","user",function(t,n,e){t.user=angular.copy(e),t.applicationName="launchgood"==s.applicationName?"Launchgood":"Patronicity",t.passwordDetails={},t.cancel=function(){n.dismiss({})},t.save=function(){t.messageText="",t.passwordDetails.newPassword&&t.passwordDetails.confirmPassword?t.passwordDetails.newPassword==t.passwordDetails.confirmPassword?r.user.facebookDisconnect(t.passwordDetails.sureDisconnected,t.passwordDetails.newPassword,t.user.ID).then(function(e){n.dismiss({}),o(t.username)},function(e){t.messageText="Password validation failed: "+e}):t.messageText="Password validation failed: New and Confirm Password are not equal":t.messageText="Please set a new password before disconnect your Facebook."}}],size:"md",resolve:{user:function(){return n}}}),t.close()}}],resolve:{},backdrop:"static"})},a.toggleShippingForm=function(){a.shippingForm=!a.shippingForm},a.resetAllfields=function(){delete a.user.shipping.ID,a.user.shipping.Name="",a.user.shipping.Country="US",a.user.shipping.State="",a.user.shipping.Address="",a.user.shipping.City="",a.user.shipping.Zip=""},a.saveShippingAddress=function(){a.makeSureAllFieldsFilled()&&(r.user.saveShippingAddress(a.userId,a.user.shipping).then(function(){o(a.username),a.loadShippingAddress(),a.toggleShippingForm()},function(e){a.errorText=e}),n(function(){a.errorText=""},1e4))},a.clearShippingAddress=function(){t.Confirm("Are you sure you want to delete shipping address ?","Delete Shipping Address",[{name:"OK",type:"ok"},{name:"Cancel",type:"cancel"}]).then(function(){r.user.clearShippingAddress(a.userId,a.user.shipping).then(function(e){o(a.username),a.resetAllfields(),a.sameAsBilling=!1,a.messageText="Shipping address has been cleared successfully"},function(e){a.errorText=e})}),n(function(){a.messageText="",a.errorText=""},1e4)},a.makeSureAllFieldsFilled=function(){var e=!0;return a.user.shipping.Name?a.user.shipping.Country||(e=!(a.errorText="Please make sure you have select a Country field")):e=!(a.errorText="Please make sure name field filled in correctly"),n(function(){a.errorText=""},5e3),e},a.setBillingAddress=function(){a.user.shipping=angular.copy(a.billingAddress)},a.setProfileAddress=function(){a.user.shipping=angular.copy(a.profileAddress)},a.$watch("sameAsBilling",function(e){e?a.setBillingAddress():a.setProfileAddress()}),a.$watch("profileDetails.user.ID",function(e,t){e&&void 0!==e&&a.loadShippingAddress()}),a.isBillingAndProfileAddressAreSame=function(){a.billingAndProfileAreSame=!1,a.profileAddress&&a.sameAsBillingAddress&&a.profileAddress.ID==a.billingAddress.ID&&(a.billingAndProfileAreSame=!0),a.billingAndProfileAreSame&&(a.sameAsBilling=!0)},n(function(){a.isBillingAndProfileAddressAreSame()},5e3),a.toggleDefaultName=function(){a.DisplayName=!a.DisplayName},a.toggleDefaultLocation=function(){a.DisplayLocation=!a.DisplayLocation},a.saveDefaultSetting=function(){a.profileDetails.user&&null!=a.profileDetails.user.ID&&(r.user.saveDefaultSetting(a.profileDetails.user.ID,a.profileDetails.user.defaultSetting).then(function(e){a.loading||(a.defaultInfoText="Setting saved successfully")},function(e){a.defaultErrorText=e}),n(function(){a.defaultInfoText=!1,a.defaultErrorText=!1},5e3))},a.$watch("profileDetails.user.defaultSetting.defaultDisplayName",function(e){!e||null!=a.profileDetails.user.defaultSetting.donation_name&&""!=a.profileDetails.user.defaultSetting.donation_name||a.toggleDefaultName(),a.saveDefaultSetting()}),a.$watch("profileDetails.user.defaultSetting.defaultDisplayLocation",function(e){e&&null==a.profileDetails.user.defaultSetting.location&&a.toggleDefaultLocation(),a.saveDefaultSetting()}),a.selectCustomType=function(t){angular.forEach(a.customType,function(e){e.selected=e.id==t.id,1==t.id?a.profileDetails.user.defaultSetting.custom_name=!0:a.profileDetails.user.defaultSetting.custom_name=!1}),a.saveDefaultSetting()}}}}]),e.directive("profilePaymentMethods",["patronicityConfig","$stateParams",function(e,t){return{restrict:"E",templateUrl:e.urlForTemplate("user-profile/pages/settings/payment-methods/cards.html"),link:function(e){e.username=t.username}}}]),e.directive("profileCampaigns",["api","patronicityConfig","$stateParams","imageUpload","$window","$uibModal","$state",function(n,e,a,t,o,i,r){return{restrict:"E",templateUrl:e.urlForTemplate("user-profile/pages/my-fundraising/campaigns.html"),scope:{slug:"@"},link:function(t){var e;t.data={},t.profileDetails={},t.activeTab="activeCampaigns",t.setActiveTab=function(e){t.activeTab=e},t.username=a.username,e=t.username,n.user.loadUser(e).then(function(e){t.profileDetails=e}).then(function(e){n.cards.countQueryItems(t.profileDetails.user.ID).then(function(e){t.campaignItems=e[0].active.total+e[1].inactive.total+e[2].draft.total+e[3].team.total,t.campaignHeader=e})})}}}]),e.directive("profilePublic",["User","$window","$state","$stateParams","api","patronicityConfig",function(i,r,s,c,l,e){return{restrict:"E",templateUrl:e.urlForTemplate("user-profile/pages/my-profile.html"),scope:{},link:function(t){t.username=c.username,t.activeTab=c.tab;var e,n=r.location.href.split("/").pop();function a(e){e?s.go("user-profile.profile."+e,{username:t.username,tab:e}):s.go("user-profile.profile",{username:t.username})}function o(e){e.profile.DisplayCreatedCampaign||t.isAdmin?a("created-campaigns"):e.profile.DisplaySupportedCampaign||t.isAdmin?a("supported-campaigns"):e.profile.DisplayCommunities||t.isAdmin?a("communities"):a()}i.get().then(function(){t.isAdmin=i.isAdmin()}),e=t.username,t.isLoading=!0,t.visibility="public",l.user.loadUser(e).then(function(e){if("user-profile.profile"===s.current.name)a();else switch(n){case"created-campaigns":e.profile.DisplayCreatedCampaign||t.isAdmin?a(n):o(e);break;case"supported-campaigns":e.profile.DisplaySupportedCampaign||t.isAdmin?a(n):o(e);break;case"communities":e.profile.DisplayCommunities||t.isAdmin?a(n):o(e)}t.profileDetails=e,t.visibility=e.user.Visibility}).finally(function(){t.isLoading=!1}),t.setActiveTab=function(e){a(e)}}}}]),e.directive("profileCommunities",["$stateParams","api","patronicityConfig",function(r,s,e){return{restrict:"E",templateUrl:e.urlForTemplate("user-profile/pages/my-fundraising/communities.html"),scope:{page:"@"},link:function(t){var n,e,a=0,o=4;function i(){s.user.loadCommunityData(n,a,o).then(function(e){t.communityData=e,t.communityItems=t.communityItems.concat(e.items),t.communityStats=t.communityStats.concat(e.stats),t.communityMetaData=t.communityMetaData.concat(e.metaData),t.communityProject=t.communityProject.concat(e.projectCount)})}t.username=r.username,t.communityData={total:0},t.communityItems=[],t.communityStats=[],t.communityMetaData=[],t.communityProject=[],e=t.username,t.visibility="public",s.user.loadUser(e).then(function(e){n=e.user.ID,t.fullName=e.profile.FirstName+" "+e.profile.LastName,t.visibility=e.user.Visibility,i()}),t.viewMore=function(){a+=4,i()}}}}]),e.directive("profileAutoGivingAndChallenges",["api","User","GivingManager","$state","$stateParams","patronicityConfig","GivingSettingsManager",function(a,o,r,s,c,e,l){return{restrict:"E",templateUrl:e.urlForTemplate("user-profile/pages/my-giving/auto-giving-and-challenges.html"),scope:{},link:function(i){var e,t,n;for(n in i.upcomingChargeSlug=null,i.autoGivingRoutes={friday_givers:{givingType:"club",slug:"friday-givers",slugApi:"friday-givers",loadData:{},startDateDelta:0,dayString:"days",members:"1k",isOpen:!1},ramadan_challenge:{givingType:"challenge",slug:"ramadan-challenge-2023",slugApi:"ramadan_challenge_2023",loadData:{},startDateDelta:0,dayString:"days",members:"1k",isOpen:!1},dhul_hijjah:{givingType:"challenge",slug:"dhul-hijjah-2022",slugApi:"dhul_hijjah_2022",loadData:{},startDateDelta:0,dayString:"days",members:"1k",isOpen:!1}},i.enrollment={friday_givers:{isMember:!1,template:"join"},ramadan_challenge:{isMember:!1,template:"join"},dhul_hijjah:{isMember:!1,template:"join"},total_enrollment:0,total_notEnrollment:0},i.username=c.username,e=i.username,i.currentUserBoolean=!1,i.isLoading=!0,o.get().then(function(){t=o.current().ID,a.user.loadUser(e).then(function(e){t==e.user.ID&&(i.currentUserBoolean=!0)})}).finally(function(){i.isLoading=!1}),i.autogivingRoutesHandler=function(e){e==i.autoGivingRoutes.friday_givers.slug?s.go("user-profile.challenge-or-club",{username:i.username,givingType:i.autoGivingRoutes.friday_givers.givingType,slug:e,template:i.enrollment.friday_givers.template}):e==i.autoGivingRoutes.ramadan_challenge.slug?s.go("user-profile.challenge-or-club",{username:i.username,givingType:i.autoGivingRoutes.ramadan_challenge.givingType,slug:e,template:i.enrollment.ramadan_challenge.template}):e==i.autoGivingRoutes.dhul_hijjah.slug&&s.go("user-profile.challenge-or-club",{username:i.username,givingType:i.autoGivingRoutes.dhul_hijjah.givingType,slug:e,template:i.enrollment.dhul_hijjah.template})},i.upcomingChargeTime=null,i.autoGivingRoutes)!function(o){r.load(i.autoGivingRoutes[o].givingType,i.autoGivingRoutes[o].slugApi,!0).then(function(n){i.autoGivingRoutes[o].isOpen=n.chronology.isOpen,i.autoGivingRoutes[o].loadData=n;var a=new Date(n.nextCharge);l.load(i.autoGivingRoutes[o].givingType,i.autoGivingRoutes[o].slugApi).then(function(e){e.state&&"active"==e.state&&(i.enrollment[o].isMember=!0,i.autoGivingRoutes[o].loadData.settings=e,i.autoGivingRoutes[o].loadData.totalGoal=parseFloat(e.goal)+parseFloat(e.tip),e.lastTen&&e.lastTen,(null===i.upcomingChargeTime||a>i.upcomingChargeTime)&&(i.upcomingChargeSlug=i.autoGivingRoutes[o].slug,i.upcomingChargeGivingType=i.autoGivingRoutes[o].givingType,i.upcomingChargeTime=a));var e=new Date(n.startDate),t=new Date,e=Math.round((e-t)/864e5);i.autoGivingRoutes[o].startDateDelta=e,i.autoGivingRoutes[o].dayString=1===e?"day":"days",i.autoGivingRoutes[o].members=n.signedUp,1==i.enrollment[o].isMember?(i.enrollment.total_enrollment+=1,i.enrollment[o].template="settings"):(i.enrollment.total_notEnrollment+=1,i.enrollment[o].template="join")})})}(n);i.showLastTen=function(){var e=!1;return e=i.autoGivingRoutes.ramadan_challenge.loadData&&i.autoGivingRoutes.ramadan_challenge.loadData.settings&&1==i.autoGivingRoutes.ramadan_challenge.loadData.settings.lastTen?!0:e},i.parseFloat=parseFloat}}}]),e.directive("profileJoin",["$analytics","patronicityConfig","$rootScope","$stateParams","GivingSettingsManager","givingDialogs","$state","api",function(b,e,w,C,D,I,S,k){return{restrict:"E",templateUrl:e.urlForTemplate("user-profile/pages/enrolments/join.html"),scope:{},link:function(n){var e="friday-givers",t="ramadan-challenge-2023",a="dhul-hijjah-2022";n.currentTemplates={title:"Ramadan Challenge settings",subTitle:"30 days of giving",donationString:"Edit your daily giving amount",totalDonationString:"every day",statusString:"Challenge"};var o={title:"Join Friday Givers",subTitle:"Give automatically every Friday",donationString:"Your weekly giving amount",totalDonationString:"every Friday",statusString:"Club"},i={title:"Join Ramadan Challenge",subTitle:"30 days of giving",donationString:"Your daily giving amount",totalDonationString:"every day",statusString:"Challenge"},r={title:"Join Dhul Hijjah Challenge",subTitle:"10 days of giving",donationString:"Your daily giving amount",totalDonationString:"every day",statusString:"Challenge"},s={title:"Friday Givers settings",subTitle:"Give automatically every Friday",donationString:"Edit your weekly giving amount",totalDonationString:"every Friday",statusString:"Club"},c={title:"Ramadan Challenge settings",subTitle:"30 days of giving",donationString:"Edit your daily giving amount",totalDonationString:"every day",statusString:"Challenge"},l={title:"Dhul Hijjah Challenge settings",subTitle:"10 days of giving",donationString:"Edit your daily giving amount",totalDonationString:"every day",statusString:"Challenge"},u="/ramadanhome/#!/ramadan/pulse",d="/club#!/giving_club/friday-givers",p="/ramadanhome/#!/dhc/pulse",m=(n.slug=C.slug,n.username=C.username,n.template=C.template,n.intData={processing:!1,isPaused:!1,isDirty:!1,canJoin:!1,enrollmentsDirty:!1},{}),g=C.givingType,f="friday-givers"!==n.slug?n.slug.replace(/-/g,"_"):n.slug,h=C.src||D.getSrc()||"user-profile";function y(e){var t=!1;e&&e.currencyCode&&e.currentCardId&&0<parseFloat(e.goal)&&!n.invalidCardCurrencyPair&&(t=!0),n.intData.canJoin=t}n.slug==e?n.currentChallengePage=d:n.slug==t?n.currentChallengePage=u:n.slug==a&&(n.currentChallengePage=p),k.user.getGivingEnrollment().then(function(e){angular.forEach(e,function(e){1==e.value&&(v[e.type]=!0)})}),D.load(g,f).then(function(e){"automatic"==(m=e).method||null==e.method?n.intData.isPaused=!1:n.intData.isPaused=!0,y(e)}),"join"==n.template?n.slug==e?n.currentTemplates=o:n.slug==t?n.currentTemplates=i:n.slug==a&&(n.currentTemplates=r):n.slug==e?n.currentTemplates=s:n.slug==t?n.currentTemplates=c:n.slug==a&&(n.currentTemplates=l),n.save=function(){void 0!==m&&0==m.onboard_complete?(n.intData.processing=!0,D.storeSettings(g,f,void 0,void 0,void 0,"automatic",void 0,void 0,void 0),D.join(g,f,h).then(function(e){D.saveStoredSettings(g,f).then(function(e){b.eventTrack("Join",{category:g,label:f,value:e.goal}),D.load(g,f).then(function(e){b.eventTrack("ObGivingGoal",{category:g,label:f}),S.go("user-profile.youre-in",{username:n.username,givingType:g,slug:n.slug})})},function(e){alert(e)})},function(e){alert(e)}).finally(function(){n.intData.processing=!1})):(n.$broadcast("save-settings"),n.intData.processing=!0,null==n.enrollments?k.user.saveGivingEnrollment(void 0,v.ramadan,v.dhul_hijjah,v.friday_givers).then(function(e){n.settingsSaved=!0,D.saveStoredSettings(g,f).then(function(e){m=e},function(e){}).finally(function(){n.intData.processing=!1})}):k.user.saveGivingEnrollment(void 0,n.enrollments.ramadan,n.enrollments.dhul_hijjah,n.enrollments.friday_givers).then(function(e){n.settingsSaved=!0,D.saveStoredSettings(g,f).then(function(e){m=e},function(e){}).finally(function(){n.intData.processing=!1})}))},n.goToQuit=function(){I.profileShowQuit(C)};var v={ramadan:!(n.togglePause=function(){"automatic"==m.method?I.profileChangeChallengeStatus(C,!1):"manual"==m.method?I.profileChangeChallengeStatus(C,!0):alert("You are not enrolled yet")}),dhul_hijjah:!1,friday_givers:!1};n.showLastTen=function(){return n.slug==t},n.$watch("enrollments",function(e,t){e&&e!=t&&(JSON.stringify(v)!==JSON.stringify(e)?n.intData.enrollmentsDirty=!0:n.intData.enrollmentsDirty=!1),w.$broadcast("load:new-selected-card")},!0),D.subscribe(n,function(e,t){"settingsChanged"===t.eventName&&("amex"==t.settings.giving_credit_card_type&&"USD"!=t.settings.challenge_currency?n.invalidCardCurrencyPair=!0:n.invalidCardCurrencyPair=!1,"settings"===n.template?(n.intData.isDirty=0<Object.keys(t.deltas).length,1==Object.keys(t.deltas).length&&t.deltas.hasOwnProperty("emailReminder")&&(n.intData.isDirty=!1)):y(t.local))})}}}]),e.directive("profileGivingTemplate",["patronicityConfig","$stateParams","GivingSettingsManager","CurrencyCodeProvider","User",function(e,u,d,p,m){return{restrict:"E",scope:{donation:"=?",page:"@",currentTemplate:"@template"},templateUrl:e.urlForTemplate("giving/components/giving-goal.html"),link:function(n,e,t){var a=u.givingType||t.givingType||"challenge",o=u.name||u.slug||t.slug||"dhul_hijjah_2022",i="friday-givers"!==o?o.replace(/-/g,"_"):o,r=p.defaultCurrencyCode(),s={code:r,symbol:p.symbolFromCode(r),emoji:p.emojiFromCode(r),label:"Loading.."};function c(){p.minimumDonationForCode(n.settings.currencyCode.code,a).then(function(e){n.settings.minimum=e}),p.suggestedGivingAmountsForCode(n.settings.currencyCode.code,a).then(function(e){n.settings.suggestedAmounts=e})}function l(t){var e=p.supportedCodes("challenge");return e.then(function(e){n.settings.currencyCodes=e.map(function(e){return e.emoji=p.emojiFromCode(e.code),e.label=e.emoji+" "+e.code,e.code==t&&(n.settings.currencyCode=e),e}),c()}),e}n.challengeType=function(){var e=o.includes("ramadan")?"ramadan":"dhul_hijjah";return e},n.template=u.template,n.settings={userSettings:{},currencyCode:s,currencyCodes:[s],suggestedAmounts:[],minimum:1,processing:!0,coverFees:!1,givingGoal:10,display:t.display||"challenge",lastTen:!1},n.updateAutoDonationAmount=function(){var e;n.settings.givingGoal=void 0===n.settings.givingGoal?parseInt(n.settings.minimum):n.settings.givingGoal,n.settings.autoDonationAmount=parseFloat(n.settings.givingGoal),n.settings.coverFees&&(n.settings.autoDonationAmount+=(e=n.settings.givingGoal,((n.fees.transaction+n.fees.platform)*e+n.fees.transaction_unit)/(1-n.fees.transaction)),n.settings.autoDonationAmount=n.settings.autoDonationAmount.toFixed(2)),0<parseFloat(n.settings.userSettings.tip)&&(n.settings.autoDonationAmount=n.settings.autoDonationAmount+parseFloat(n.settings.userSettings.tip)),n.donation={donationAmount:n.settings.autoDonationAmount,donationCurrency:n.settings.currencyCode},n.settingChanged()},n.updateTotalDonationAmount=function(e){n.settings.autoDonationAmount=parseFloat(n.settings.givingGoal),0<e.tip_amount&&(n.settings.autoDonationAmount=n.settings.autoDonationAmount+parseFloat(e.tip_amount))},n.fees={transaction_unit:.3,transaction:.029,platform:.05},n.setGivingGoal=function(e){n.settings.givingGoal=e,n.activeButton=e,n.updateAutoDonationAmount()},n.settingChanged=function(){c(),n.settings.givingGoal=n.settings.givingGoal>=parseInt(n.settings.minimum)?parseInt(n.settings.givingGoal):parseInt(n.settings.minimum),d.storeSettings(a,i,n.settings.givingGoal,n.settings.currencyCode.code,void 0,void 0,void 0,void 0,n.settings.coverFees)},n.settings.processing=!0,m.get().then(function(){m.isLoggedIn()?d.load(a,i).then(function(e){(n.settings.userSettings=e).coverFees&&(n.settings.coverFees=1==e.coverFees),e.goal&&(n.settings.givingGoal=parseFloat(e.goal)),e.lastTen&&(n.settings.lastTen=1==e.lastTen),n.updateAutoDonationAmount(),l(e.currencyCode||r).then(function(){n.settingChanged()}).finally(function(){n.settings.processing=!1})}):l(r).then(function(){n.settingChanged()}).finally(function(){n.settings.processing=!1})}),n.incAmount=function(){n.settings.givingGoal+=1,n.settingChanged()},n.decAmount=function(){n.settings.givingGoal=n.settings.givingGoal>n.settings.minimum?--n.settings.givingGoal:parseInt(n.settings.minimum),n.settingChanged()},d.subscribe(n,function(e,t){"settingsChanged"===t.eventName&&(n.updateTotalDonationAmount(t.settings),t.settings.last_ten&&(n.settings.lastTen=1==t.settings.last_ten))})}}}]),e.directive("profileGivingPaymentMethod",["patronicityConfig","$stateParams","GivingSettingsManager","api","$q","GivingManager",function(e,l,u,d,p,m){return{restrict:"E",scope:{settings:"=?"},templateUrl:e.urlForTemplate("giving/components/payment-method.html"),link:function(a,e,t){var n=l.givingType||"challenge",o=l.name||l.slug||t.slug||"dhul_hijjah_2022",i="friday-givers"!==o?o.replace(/-/g,"_"):o,r=p.defer(),s=null;function c(){u.load(n,i).then(function(t){r.promise.then(function(){if(t.currentCardId)for(var e=0;e<a.settings.cards.length;e++){if(a.settings.cards[e].ID==t.currentCardId){a.selectCard(a.settings.cards[e]);break}a.selectedCardStale=!0}})})}a.settings={selectedCard:{},cardListShown:!1,cardFormShown:!1,cards:[],chronology:{},processing:!1,type:t.type||"3",page:t.page||"onboarding"},d.user.cards.forGivingType(i,n).then(function(e){if(a.settings.cards=e.cards,e.cards&&0<e.cards.length){for(var t=0;t<e.cards.length;t++){if(e.cards[t].Default){a.selectCard(e.cards[t]);break}a.selectCard(e.cards[0])}r.resolve(),c()}},function(){r.reject()}),a.cardSavedCallback=function(e,t,n){a.settings.cards.push(e),a.selectCard(e)},a.hasSelectedCard=function(){return!angular.equals({},a.settings.selectedCard)},a.selectCard=function(e){a.settings.selectedCard=e,a.settings.cardListShown=!1,a.settings.cardFormShown=!1,a.selectedCardStale=!1,a.settingChanged()},a.settingChanged=function(){u.storeSettings(n,i,void 0,void 0,a.settings.selectedCard.ID,void 0,void 0,void 0,a.settings.coverFees,void 0,void 0,void 0,a.settings.selectedCard.TypeEnum)},a.toggleCardList=function(){a.settings.cardListShown=!a.settings.cardListShown},a.toggleCardForm=function(){a.settings.cardFormShown=!a.settings.cardFormShown,a.toggleCardList()},a.excludeCurrentCard=function(e){return!a.settings.selectedCard||a.settings.selectedCard.ID!=e.ID},c(),m.load(n,i).then(function(e){s=e.id,a.settings.shortName=e.strings.shortName,a.settings.name="challenge"==n?e.strings.shortName+" Challenge":e.name,a.settings.nextCharge=e.nextCharge,a.settings.chronology=e.chronology}),a.$on("load:new-selected-card",function(e,t){d.giving.user.settings.load(n,s).then(function(t){t.settings.giving_credit_card_id&&angular.forEach(a.settings.cards,function(e){e.ID==t.settings.giving_credit_card_id&&a.selectCard(e)})})}),a.invalidCardCurrencyPair=!1,u.subscribe(a,function(e,t){"settingsChanged"===t.eventName&&("amex"==t.settings.giving_credit_card_type&&"USD"!=t.settings.challenge_currency?a.invalidCardCurrencyPair=!0:a.invalidCardCurrencyPair=!1)})}}}]),e.directive("profileYoureIn",["patronicityConfig","$stateParams","$state",function(e,t,n){return{restrict:"E",scope:{template:"=?"},templateUrl:e.urlForTemplate("user-profile/pages/enrolments/youre-in.html"),link:function(e){e.type=t.givingType,e.slug="friday-givers"!==t.slug?t.slug.replace(/-/g,"_"):t.slug,e.template={friday_givers:{slugString:"Friday Givers"},ramadan_challenge:{slugString:"Ramadan Challenge"},dhul_hijjah:{slugString:"Dhul Hijjah Challenge"}},e.currentTemplate="friday-givers"==e.slug?e.template.friday_givers:"ramadan_challenge_2023"==e.slug?e.template.ramadan_challenge:e.template.dhul_hijjah,e.goBack=function(){n.go("user-profile.auto-giving-and-challenges",{username:t.username})}}}}]),e.directive("smsPhoneNumberVerify",["api","patronicityConfig",function(r,e){return{restrict:"E",scope:{data:"="},templateUrl:e.urlForTemplate("user-profile/pages/settings/sms-phone-number-verify.html"),link:function(a,e,t){function n(){a.errorMsg="",a.msg=""}function o(e){null!=e.verificationExpiry&&null==e.verifiedPhoneNumber&&null!=e.defaultUserPhone&&null!=e.unverifiedPhoneNumber||null!=e.verificationExpiry&&null==e.verifiedPhoneNumber&&null==e.defaultUserPhone&&null!=e.unverifiedPhoneNumber?(a.phone=i(e.unverifiedPhoneNumber),a.verifyWaiting=!0,a.phonenumber=!0,a.disabledme=!0):null==e.verificationExpiry&&null==e.verifiedPhoneNumber&&null==e.defaultUserPhone&&null!=e.unverifiedPhoneNumber?(a.phone=i(e.unverifiedPhoneNumber),a.verifyWaiting=!0,a.phonenumber=!0,a.disabledme=!0,a.connectme=!1):null==e.verifiedPhoneNumber&&null!=e.defaultUserPhone&&(a.phone=i(e.defaultUserPhone),a.verifyWaiting=!1,a.phonenumber=!0,a.disabledme=!1),null!=e.verificationExpiry&&null==e.verifiedPhoneNumber&&(e.expiration?(a.verifyWaiting=!1,a.disabledme=!1,a.connectme=!0):(a.verifyWaiting=!0,a.disabledme=!0,a.connectme=!1)),null==e.verifiedPhoneNumber&&null==e.defaultUserPhone&&null==e.unverifiedPhoneNumber&&a.cancel(),e&&null!=e.verifiedPhoneNumber&&(a.phone=i(e.verifiedPhoneNumber),a.disabledme=!0)}function i(e){if(a.sortedCountries)for(var t=0;t<a.sortedCountries.length;t++){var n=new RegExp("^\\+"+a.sortedCountries[t].value+"(.+)$");if(e.match(n))return a.countryCode=a.sortedCountries[t].value,e.replace(n,"$1")}}a.verifyWaiting=!1,a.saveButtonText="Verify Number",a.regEx="d+((-d+)+)?",a.countryCode="1",a.phonenumber=!1,a.disabledme=!1,a.connectme=!0,a.dropDownValues=[{value:"1",label:" (+1)"},{value:"44",label:" (+44)"},{value:"65",label:" (+65)"},{value:"60",label:" (+60)"},{value:"61",label:" (+61)"},{value:"64",label:" (+64)"},{value:"213",label:" (+213)"},{value:"376",label:" (+376)"},{value:"244",label:" (+244)"},{value:"1264",label:" (+1264)"},{value:"1268",label:" (+1268)"},{value:"54",label:" (+54)"},{value:"374",label:" (+374)"},{value:"297",label:" (+297)"},{value:"43",label:" (+43)"},{value:"994",label:" (+994)"},{value:"1242",label:" (+1242)"},{value:"973",label:" (+973)"},{value:"880",label:" (+880)"},{value:"1246",label:" (+1246)"},{value:"375",label:" (+375)"},{value:"32",label:" (+32)"},{value:"501",label:" (+501)"},{value:"229",label:" (+229)"},{value:"1441",label:" (+1441)"},{value:"975",label:" (+975)"},{value:"591",label:" (+591)"},{value:"387",label:" (+387)"},{value:"267",label:" (+267)"},{value:"55",label:" (+55)"},{value:"673",label:" (+673)"},{value:"359",label:" (+359)"},{value:"226",label:" (+226)"},{value:"257",label:" (+257)"},{value:"855",label:" (+855)"},{value:"237",label:" (+237)"},{value:"238",label:" (+238)"},{value:"1345",label:" (+1345)"},{value:"236",label:" (+236)"},{value:"56",label:" (+56)"},{value:"86",label:" (+86)"},{value:"57",label:" (+57)"},{value:"269",label:" (+269)"},{value:"242",label:" (+242)"},{value:"682",label:" (+682)"},{value:"506",label:" (+506)"},{value:"385",label:" (+385)"},{value:"53",label:" (+53)"},{value:"90392",label:" (+90392)"},{value:"357",label:" (+357)"},{value:"420",label:" (+420)"},{value:"45",label:" (+45)"},{value:"253",label:" (+253)"},{value:"1767",label:" (+1767)"},{value:"1809",label:" (+1809)"},{value:"593",label:" (+593)"},{value:"20",label:" (+20)"},{value:"503",label:" (+503)"},{value:"240",label:" (+240)"},{value:"291",label:" (+291)"},{value:"372",label:" (+372)"},{value:"251",label:" (+251)"},{value:"500",label:" (+500)"},{value:"298",label:" (+298)"},{value:"679",label:" (+679)"},{value:"358",label:" (+358)"},{value:"33",label:" (+33)"},{value:"594",label:" (+594)"},{value:"689",label:" (+689)"},{value:"241",label:" (+241)"},{value:"220",label:" (+220)"},{value:"995",label:" (+995)"},{value:"49",label:" (+49)"},{value:"233",label:" (+233)"},{value:"350",label:" (+350)"},{value:"30",label:" (+30)"},{value:"299",label:" (+299)"},{value:"1473",label:" (+1473)"},{value:"590",label:" (+590)"},{value:"1671",label:" (+1671)"},{value:"502",label:" (+502)"},{value:"224",label:" (+224)"},{value:"245",label:" (+245)"},{value:"592",label:" (+592)"},{value:"509",label:" (+509)"},{value:"504",label:" (+504)"},{value:"852",label:" (+852)"},{value:"36",label:" (+36)"},{value:"354",label:" (+354)"},{value:"91",label:" (+91)"},{value:"62",label:" (+62)"},{value:"98",label:" (+98)"},{value:"964",label:" (+964)"},{value:"353",label:" (+353)"},{value:"972",label:" (+972)"},{value:"39",label:" (+39)"},{value:"1876",label:" (+1876)"},{value:"81",label:" (+81)"},{value:"962",label:" (+962)"},{value:"7",label:" (+7)"},{value:"254",label:" (+254)"},{value:"686",label:" (+686)"},{value:"850",label:" (+850)"},{value:"82",label:" (+82)"},{value:"965",label:" (+965)"},{value:"996",label:" (+996)"},{value:"856",label:" (+856)"},{value:"371",label:" (+371)"},{value:"961",label:" (+961)"},{value:"266",label:" (+266)"},{value:"231",label:" (+231)"},{value:"218",label:" (+218)"},{value:"423",label:" (+423)"},{value:"370",label:" (+370)"},{value:"352",label:" (+352)"},{value:"853",label:" (+853)"},{value:"389",label:" (+389)"},{value:"261",label:" (+261)"},{value:"265",label:" (+265)"},{value:"960",label:" (+960)"},{value:"223",label:" (+223)"},{value:"356",label:" (+356)"},{value:"692",label:" (+692)"},{value:"596",label:" (+596)"},{value:"222",label:" (+222)"},{value:"269",label:" (+269)"},{value:"52",label:" (+52)"},{value:"691",label:" (+691)"},{value:"373",label:" (+373)"},{value:"377",label:" (+377)"},{value:"976",label:" (+976)"},{value:"1664",label:" (+1664)"},{value:"212",label:" (+212)"},{value:"258",label:" (+258)"},{value:"95",label:" (+95)"},{value:"264",label:" (+264)"},{value:"674",label:" (+674)"},{value:"977",label:" (+977)"},{value:"31",label:" (+31)"},{value:"687",label:" (+687)"},{value:"505",label:" (+505)"},{value:"227",label:" (+227)"},{value:"234",label:" (+234)"},{value:"683",label:" (+683)"},{value:"672",label:" (+672)"},{value:"1670",label:" (+1670)"},{value:"47",label:" (+47)"},{value:"968",label:" (+968)"},{value:"92",label:" (+92)"},{value:"680",label:" (+680)"},{value:"507",label:" (+507)"},{value:"675",label:" (+675)"},{value:"595",label:" (+595)"},{value:"51",label:" (+51)"},{value:"63",label:" (+63)"},{value:"48",label:" (+48)"},{value:"351",label:" (+351)"},{value:"1787",label:" (+1787)"},{value:"974",label:" (+974)"},{value:"262",label:" (+262)"},{value:"40",label:" (+40)"},{value:"7",label:" (+7)"},{value:"250",label:" (+250)"},{value:"378",label:" (+378)"},{value:"239",label:" (+239)"},{value:"966",label:" (+966)"},{value:"221",label:" (+221)"},{value:"381",label:" (+381)"},{value:"248",label:" (+248)"},{value:"232",label:" (+232)"},{value:"421",label:" (+421)"},{value:"386",label:" (+386)"},{value:"677",label:" (+677)"},{value:"252",label:" (+252)"},{value:"27",label:" (+27)"},{value:"34",label:" (+34)"},{value:"94",label:" (+94)"},{value:"290",label:" (+290)"},{value:"1869",label:" (+1869)"},{value:"1758",label:" (+1758)"},{value:"249",label:" (+249)"},{value:"597",label:" (+597)"},{value:"268",label:"Swaziland (+268)"},{value:"46",label:" (+46)"},{value:"41",label:" (+41)"},{value:"963",label:" (+963)"},{value:"886",label:" (+886)"},{value:"992",label:" (+992)"},{value:"66",label:" (+66)"},{value:"228",label:" (+228)"},{value:"676",label:" (+676)"},{value:"1868",label:" (+1868)"},{value:"216",label:" (+216)"},{value:"90",label:" (+90)"},{value:"993",label:" (+993)"},{value:"1649",label:" (+1649)"},{value:"688",label:" (+688)"},{value:"256",label:" (+256)"},{value:"380",label:" (+380)"},{value:"971",label:" (+971)"},{value:"598",label:" (+598)"},{value:"998",label:" (+998)"},{value:"678",label:" (+678)"},{value:"379",label:" (+379)"},{value:"58",label:" (+58)"},{value:"84",label:" (+84)"},{value:"84",label:" (+1284)"},{value:"84",label:" (+1340)"},{value:"681",label:" (+681)"},{value:"969",label:" (+969)"},{value:"967",label:" (+967)"},{value:"260",label:" (+260)"},{value:"263",label:" (+263)"}],n(),a.findObjectByKey=function(e,t){for(var n=0;n<e.length;n++)if(e[n].value===t)return e[n].label;return null},a.changeNumber=function(){n(),a.cancel(),a.phone=i(a.data.smsData.verifiedPhoneNumber),a.data.smsData.verifiedPhoneNumber=null},a.cancel=function(){n(),a.phonenumber=!0,a.verifyWaiting=!1,a.disabledme=!1,a.connectme=!0,r.user.clearSMSData(a.data.ID,a.data.smsData).then(function(e){},function(e){a.errorMsg=e})},a.connect=function(){n(),a.getphonenumberform.phone.$valid&&(a.completePhone="+"+a.countryCode+a.phone,r.user.sendVerification(a.completePhone,a.data.ID,a.data.smsData).then(function(e){a.verifyWaiting=!0,a.phonenumber=!0,a.connectme=!1,a.disabledme=!0,a.msg="Please check your phone for verification code."},function(e){a.errorMsg=e}))},a.verify=function(){n(),r.user.smsVerifyCode(a.verifyCode,a.data.ID,a.data.smsData).then(function(e){a.msg=e.response,a.verifyWaiting=!1,a.verifyCode=null,a.phonenumber=!1,a.data.smsData.verifiedPhoneNumber=a.completePhone},function(e){a.errorMsg="Invalid code"})},r.projectAdmin.phoneCountries().then(function(e){a.phoneCountries=e,a.sortedCountries=a.phoneCountries.slice().sort(function(e,t){return t.value-e.value}),a.data&&a.data.smsData&&o(a.data.smsData)}),a.$watch("data.smsData",function(e){null!=e&&(a.data.smsData.UIPhoneNumber=!0,o(e))}),a.$watch("phone",function(){a.data&&void 0!==a.data.smsData&&(null==a.phone?a.data.smsData.UIPhoneNumber=!1:a.data.smsData.UIPhoneNumber=!0)})}}}]),e.directive("profileZakat",["$uibModal","$q","api","patronicityConfig","$stateParams","$state",function(c,e,l,u,d,p){return{restrict:"E",templateUrl:u.urlForTemplate("user-profile/pages/my-giving/zakat.html"),scope:{},link:function(n){var t,a=0,o=(n.processing=!1,{}),i=(n.filter={StartDate:null,EndDate:null,Type:"zakat"},n.dropDownSelection="most-recent",0);function r(e){l.zakat.getAllProfiles(e).then(function(e){if(n.zakatProfilesArray=e,null===n.zakatProfileSlug)0<n.zakatProfilesArray.length?n.currentZakatProfile=n.zakatProfilesArray[0]:n.currentZakatProfile=null;else for(var t in n.zakatProfilesArray)n.zakatProfileSlug===n.zakatProfilesArray[t].profile&&(n.currentZakatProfile=n.zakatProfilesArray[t]);null!==n.currentZakatProfile&&(n.currentZakatProfile.zakatAnniversary=new Date(n.currentZakatProfile.zakatAnniversary),n.currentZakatProfile.zakatStartDate=new Date(n.currentZakatProfile.zakatStartDate),n.filter.EndDate=new Date(n.currentZakatProfile.zakatAnniversary.getFullYear(),n.currentZakatProfile.zakatAnniversary.getMonth(),n.currentZakatProfile.zakatAnniversary.getDate(),0,0,0),n.filter.StartDate=new Date(n.currentZakatProfile.zakatStartDate.getFullYear(),n.currentZakatProfile.zakatStartDate.getMonth(),n.currentZakatProfile.zakatStartDate.getDate(),0,0,0),n.filter.Currency=n.currentZakatProfile.code,l.zakat.getOffLineDonations(o.user.ID,n.filter).then(function(e){a=e.totalOfflineDonations},function(e){alert(e)}).finally(function(){s()}))},function(e){alert(e)})}function s(){o&&o.user&&(n.processing=!0,n.totalZakatDonationAmount=0,l.user.loadZakatDonations(o.user.ID,i,4,n.filter).then(function(e){n.donationCountFromServer=e.total,n.report_urls=e.report_urls,n.totalZakatDonationAmount=a+e.totalZakatDonationAmount,n.donationArray=n.donationArray.concat(e.items)},function(e){alert(e)}).finally(function(){n.processing=!1}))}n.zakatDatesToggle=!0,n.zakatDatesToggleOnClick=function(){n.zakatDatesToggle=!1===n.zakatDatesToggle},void 0===d.profile?n.zakatProfileSlug=null:n.zakatProfileSlug=d.profile,n.zakatRoutesHandler=function(e){p.go("user-profile.zakat-profile",{username:d.username,profile:e})},n.username=d.username,t=n.username,l.user.loadUser(t).then(function(e){o=e,r(t)},function(e){alert(e)}),n.zakatProfilesArray=[],n.deleteZakatCalculatorProfile=function(e){l.zakat.deleteZakatCalculatorProfile(n.username,e).then(function(e){r()},function(e){alert(e)})},n.save=function(){n.processing=!0,l.zakat.editCalculatorData(n.username,n.currentZakatProfile.period,n.currentZakatProfile).then(function(e){n.filter.StartDate=new Date(n.currentZakatProfile.zakatStartDate.getFullYear(),n.currentZakatProfile.zakatStartDate.getMonth(),n.currentZakatProfile.zakatStartDate.getDate(),0,0,0),n.filter.EndDate=new Date(n.currentZakatProfile.zakatAnniversary.getFullYear(),n.currentZakatProfile.zakatAnniversary.getMonth(),n.currentZakatProfile.zakatAnniversary.getDate(),0,0,0),s()},function(e){alert(e)}).finally(function(){n.processing=!1})},n.donationArray=[],n.viewMore=function(){i+=4,s()},n.subscribeStatusChanged=function(e,t){n.processing=!0,l.project.toggleSubscribe(e).then(function(e){n.donationArray[t].project.receivedUpdates=e.receivedUpdates,c.open({templateUrl:u.urlForTemplate("user-profile/dialogs/delete-account/subscribe-success.html"),controller:["$scope","$uibModalInstance",function(e,t){e.cancel=function(){t.close()}}],resolve:{},backdrop:"static"})}).finally(function(){n.processing=!1})},n.zakatStatusChanged=function(e,t){n.processing=!0,l.project.toggleZakat(e).then(function(e){n.donationArray[t].zakat.zakat="1"==e.Zakah,!0===n.donationArray[t].zakat.zakat?n.totalZakatDonationAmount=n.totalZakatDonationAmount+n.donationArray[t].zakat_eligible_amount:n.totalZakatDonationAmount=n.totalZakatDonationAmount-n.donationArray[t].zakat_eligible_amount},function(e){alert(e)}).finally(function(){n.processing=!1})},n.resendReceipt=function(e){n.processing=!0,l.user.resendReceipt(e).then(function(e){alert("Receipt was re-sent!")},function(e){alert(e)}).finally(function(){n.processing=!1})},n.sortDropDown=function(e){n.filter.sortBy=e,i=0,n.donationArray=[],s()},n.$watch("totalZakatDonationAmount",function(){0<n.zakatProfilesArray.length&&(n.totalZakatGoal=n.currentZakatProfile.zakatDue,n.totalZakatRatio=n.totalZakatDonationAmount/n.totalZakatGoal,n.totalZakatRatioBar=100*n.totalZakatRatio)})}}}]),e.directive("profileOfflineDonation",["api","patronicityConfig","$stateParams","$state",function(n,e,a,o){return{restrict:"E",templateUrl:e.urlForTemplate("user-profile/pages/my-giving/offline-donation.html"),scope:{},link:function(t){t.processing=!1,t.entries={cash:0,code:"USD",date:new Date,title:"",notes:"",donationType:"",location:""},t.donation={},t.selection=function(e){t.entries.donationType=e},t.username=a.username,t.save=function(e){t.processing=!0,t.entries.cash=e.donationAmount,t.entries.code=e.donationCurrency.code,n.zakat.saveOfflineDonation(t.username,t.entries).then(function(e){o.go("user-profile.zakat",{username:a.username})},function(e){alert(e),t.errorMessage=e}).finally(function(){t.processing=!1})}}}}]),e.directive("profileGiveListPage",["User","api","$stateParams","patronicityConfig",function(o,i,r,e){return{restrict:"E",templateUrl:e.urlForTemplate("user-profile/pages/my-giving/profile-give-list.html"),scope:{},link:function(t){var e,n,a=r.username;e=a,t.currentUserBoolean=!1,t.isLoading=!0,o.get().then(function(){n=o.current().ID,i.user.loadUser(e).then(function(e){n==e.user.ID&&(t.currentUserBoolean=!0)})}).finally(function(){t.isLoading=!1})}}}]),e.directive("giveWith",["api","patronicityConfig","$stateParams","$rootScope","$sce","$window","User","$dialog","$compile",function(e,o,i,t,n,a,r,s,c){return{restrict:"E",link:function(t,e,n){t.slug=i.name,t.givingType=i.type;var a=o.urlForTemplate("giving/clubs/giving_with_chris/view-detail.html");e.append(c("<ng-include src=\"'"+a+"'\"></ng-include>")(t)),t.openAutoDialog=function(){r.isLoggedIn()?s.show({template:'<p-dlg-join-auto slug="'+t.slug+'" type="'+t.givingType+'"></p-dlg-join-auto>'}).then(function(e){1==e&&s.show({template:'<giving-welcome type="'+t.givingType+'" slug="'+t.slug+'"></giving-welcome>'})}):r.loginModal(!1).then(function(e){s.show({template:'<p-dlg-join-auto slug="'+t.slug+'" type="'+t.givingType+'"></p-dlg-join-auto>'}).then(function(e){1==e&&s.show({template:'<giving-welcome type="'+t.givingType+'" slug="'+t.slug+'"></giving-welcome>'})})})}}}}])}(),function(){var e=angular.module("patronicity.user.profiles",["patronicity.api","user","ngTable","ui.bootstrap"]);e.factory("UserProfileEditor",["$q","User","api",function(t,o,i){return{canEdit:function(e){return t(function(t,n){var a;i.user.loadUser(e).then(function(e){a=e,console.log("User ID loaded: "+a.user.ID),o.current()&&a&&a.user?o.current().ID==a.user.ID||o.current().IsAdmin?(console.log("resolve"),t()):(console.log("reject"),n("User lacks the required authority to display profile information.")):(console.log("reject"),n("User profile not found, user is not logged in or lacks the required authority to display profile information."))})})}}}]),e.directive("profile",["api","patronicityConfig","User","$stateParams","imageUpload","$window","Dialogs","$uibModal","$state",function(r,s,c,e,l,u,d,p,m){return{restrict:"E",scope:{},templateUrl:s.urlForTemplate("user/profile.html"),link:function(a){function n(){a.isEditable=!1,a.hideFromAdmin=!0,c.current()&&a.profileDetails&&a.profileDetails.user&&(c.current().ID!=a.profileDetails.user.ID&&!c.current().IsAdmin||(a.isEditable=!0),c.current().ID==a.profileDetails.user.ID&&(a.hideFromAdmin=!1))}function o(){a.profileDetails.currentPassword="",a.profileDetails.newPassword="",a.profileDetails.confirmPassword="",null==e.username||""==e.username?a.notFound=!0:(a.notFound=!1,r.user.loadUser(e.username).then(function(e){console.log("Get user profile"),a.profileDetails=e,a.originalEmail=a.profileDetails.user.Email,a.profileDetails.profile&&a.profileDetails.profile.smsReminder?a.profileDetails.profile.smsReminderPhone=t(a.profileDetails.profile.smsReminder):a.profileDetails.profile.countryCode="1",n(),console.log("ID: "+a.profileDetails.user.ID),r.user.loadDonations(a.profileDetails.user.ID).then(function(e){a.profileDetails.displayDonations=e.items,a.profileDetails.reports=e.report_urls;for(var t=0;t<e.items.length;t++)a.subscribeStatusses[e.items[t].id]=e.items[t].receive_update;a.application=c.getApplication()})}))}function t(e){if(a.sortedCountries)for(var t=0;t<a.sortedCountries.length;t++){var n=new RegExp("^\\+"+a.sortedCountries[t].value+"(.+)$");if(e.match(n))return a.profileDetails.profile.countryCode=a.sortedCountries[t].value,e.replace(n,"$1")}}function i(){console.log("Saving profile");var t=!0;a.originalEmail!=a.profileDetails.user.Email&&r.user.saveUser(a.profileDetails.user).then(function(e){console.log("Email change save complete")},function(e){t=!1,a.messageText="Email change save failed: "+e,console.log(a.messageText),d.Confirm(a.messageText,"Email change save Failed",[{name:"OK",type:"ok"}]).then(function(){})}),t&&(a.profileDetails.profile.smsReminderPhone&&(a.profileDetails.profile.smsReminder="+"+a.profileDetails.profile.countryCode+a.profileDetails.profile.smsReminderPhone),r.user.saveProfile(a.profileDetails.profile,a.profileDetails.user).then(function(e){console.log("Save complete"),o(),u.history.back()},function(e){a.messageText="Save failed: "+e,console.log(a.messageText),d.Confirm(a.messageText,"Profile Save Failed",[{name:"OK",type:"ok"}]).then(function(){})}))}a.subscribeStatusses={},c.get().then(function(){a.isAdmin=c.isAdmin()}),a.subscribeStatusChanged=function(t,e){r.project.toggleSubscribe(t).then(function(e){a.subscribeStatusses[t]=e.receivedUpdates})},a.zakatStatusChanged=function(e){console.log("zakatStatusChanged",e),r.project.toggleZakat(e).then(function(e){})},a.profileDetails={},a.applicationName="launchgood"==s.applicationName?"Launchgood":"Patronicity",a.editDisplay=function(){},a.resetPassword=function(){console.log("Sending password reset email"),a.profileDetails.user.Email?r.user.resetPassword(a.profileDetails.user.Email,a.profileDetails.user.ID).then(function(e){d.Confirm(a.messageText,"Password reset email has been sent.",[{name:"OK",type:"ok"}]).then(function(){})},function(e){d.Confirm(a.messageText,"Password reset email failed to send.",[{name:"OK",type:"ok"}]).then(function(){})}):console.log("Invalid email")},a.resendReceipt=function(e){console.log("Resending receipt"),console.log("DonationID: "+e),e?r.user.resendReceipt(e).then(function(e){d.Confirm("The receipt for this donation is being resent to your email address. Please check your inbox in a few minutes.","Resend Receipt",[{name:"OK",type:"ok"}]).then(function(){})}):console.log("Invalid email")},a.subscribeAll=function(){d.Confirm("Are you sure you want to subscribe to all campaigns updates?","Confirm Subscribe All",[{name:"OK",type:"ok"},{name:"Cancel",type:"cancel"}]).then(function(){r.user.subscribeAll(a.profileDetails.user.ID).then(function(e){m.reload()})},function(){})},a.unsubscribeAll=function(){d.Confirm("Are you sure you want to unsubscribe from all campaign updates?","Confirm Unsubscribe All",[{name:"OK",type:"ok"},{name:"Cancel",type:"cancel"}]).then(function(){r.user.unsubscribeAll(a.profileDetails.user.ID).then(function(e){m.reload()})},function(){})},a.changeImage=function(){l.selectImage("user",a.profileDetails.user.ID,!1).result.then(function(e){a.profileDetails.user.thumbNailUrl=e.url})},a.clearImage=function(){a.profileDetails.user.ID,r.user.clearProfilePicture(a.profileDetails.user.ID).then(function(e){u.location.reload()}).catch(function(e){alert("No image to clear!")})},a.presave=function(){console.log("Presave"),function(){console.log("Validate");var e=!1;a.profileDetails.profile.Website?(console.log("Website must be validated."),a.profileDetails.profile.Website.startsWith("http://")||a.profileDetails.profile.Website.startsWith("https://")?console.log("Website format is OK."):(a.messageText="Website must start with - http:// or https://",a.messageTitle="Website validation failed",console.log("Validation failed: "+a.messageText),e=!0)):console.log("Website is blank.");a.profileDetails.profile.Facebook&&!e?(console.log("Facebook must be validated."),a.profileDetails.profile.Facebook.startsWith("http://")||a.profileDetails.profile.Facebook.startsWith("https://")?console.log("Facebook format is OK."):(a.messageText="Facebook must start with - http:// or https://",a.messageTitle="Facebook validation failed",console.log("Validation failed: "+a.messageText),e=!0)):console.log("Facebook is blank or website has error.");{if(!e)return 1;d.Confirm(a.messageText,a.messageTitle,[{name:"OK",type:"ok"}]).then(function(){})}}()&&(a.originalEmail!=a.profileDetails.user.Email?r.user.validateEmail(a.profileDetails.user).then(function(e){console.log("Validation OK."),i()},function(e){console.log("Validation failed."),a.messageText=e,d.Confirm(a.messageText,"Email change failed",[{name:"OK",type:"ok"}]).then(function(){})}):(console.log("Validation not required."),i()))},r.projectAdmin.phoneCountries().then(function(e){a.phoneCountries=e,a.sortedCountries=a.phoneCountries.slice().sort(function(e,t){return t.value-e.value}),a.profileDetails&&a.profileDetails.profile.smsReminder&&(a.profileDetails.profile.smsReminderPhone=t(a.profileDetails.profile.smsReminder))}),a.clearSmsReminder=function(){d.Confirm("Are you sure you want to delete campaign SMS phone number"," Delete Campaign SMS Phone Number").then(function(){r.user.clearSmsReminder(a.profileDetails.user).then(function(e){o()})})},a.fbDisconnect=function(t){d.Confirm("Are you sure you want to disconnect your Facebook account from your "+a.applicationName+" account? You must choose a new password when disconnecting your account.","Disconnect Facebook Account").then(function(e){"ok"==e.type&&a.openFbDisconnectModal(t)})},a.openFbDisconnectModal=function(e){p.open({templateUrl:s.urlForTemplate("user/fb-disconnected.html"),controller:["$scope","$uibModalInstance","user",function(t,n,e){t.user=angular.copy(e),t.applicationName="launchgood"==s.applicationName?"Launchgood":"Patronicity",t.passwordDetails={},t.save=function(){t.messageText="",t.passwordDetails.newPassword&&t.passwordDetails.confirmPassword?t.passwordDetails.newPassword==t.passwordDetails.confirmPassword?r.user.facebookDisconnect(t.passwordDetails.sureDisconnected,t.passwordDetails.newPassword,t.user.ID).then(function(e){n.dismiss({}),d.Confirm("Facebook account has been disconnected from your account. You can no longer log in using Facebook, but you can use the password you just created.","Successfully Disconnected").then(function(){o()})},function(e){t.messageText="Password validation failed: "+e}):t.messageText="Password validation failed: New and Confirm Password are not equal":t.messageText="Please set a new password before disconnect your Facebook."},t.cancel=function(){n.dismiss({})}}],size:"md",resolve:{user:function(){return e}}})},a.$on("load-profile",function(){console.log("reload requested"),o()}),a.$on("user:login-change",function(e,t){n()}),o()}}}]),e.directive("changePassword",["$uibModal","patronicityConfig","api",function(t,n,o){return{restrict:"E",template:'<button ng-click="openEditModal()" class="btn btn-primary">{{label}}</button>',scope:{user:"=",admin:"="},link:function(e){e.label="Change Password",e.openEditModal=function(){t.open({templateUrl:n.urlForTemplate("user/change-password.html"),controller:["$scope","$uibModalInstance","user","admin",function(t,n,e,a){console.log("Change Password"),t.admin=a,t.user=angular.copy(e),console.log("ID: "+t.user.ID),t.passwordDetails={},t.save=function(){t.messageText="",console.log("Validate password"),(t.passwordDetails.currentPassword||t.admin)&&t.passwordDetails.newPassword&&t.passwordDetails.confirmPassword?t.passwordDetails.newPassword==t.passwordDetails.confirmPassword?(console.log("Call Password change"),o.user.changePassword(t.passwordDetails.currentPassword,t.passwordDetails.newPassword,t.user.ID).then(function(e){console.log("Password changed"),n.close({})},function(e){t.messageText="Password validation failed: "+e,console.log(t.messageText)})):(t.messageText="Password validation failed: New and Confirm Password are not equal",console.log(t.messageText)):(t.messageText="Password validation failed: Must enter Old, New and Confirm Password",console.log(t.messageText))},t.cancel=function(){n.dismiss({})}}],size:"md",resolve:{user:function(){return e.user},admin:function(){return e.admin}}})}}}}]),e.directive("editDisplay",["$uibModal","patronicityConfig","api",function(t,n,o){return{restrict:"E",template:'<p ng-class="buttonClass" style="cursor: pointer;" ng-click="openEditModal()">{{ label }}</p>',scope:{display:"="},link:function(e){e.label="patronicity"==n.applicationName?"Edit Display":"Edit",e.buttonClass="patronicity"==n.applicationName?"btn btn-primary btn-xs":"lgx-text-sm lgx-t-green lgx-t-underline",e.openEditModal=function(){t.open({templateUrl:n.urlForTemplate("user/edit-display.html"),controller:["$scope","$uibModalInstance","display",function(t,n,a){console.log("Edit Donation Display Options"),t.editDisplay=angular.copy(a),t.save=function(){console.log("Save Donation Display Options..."),o.user.updateDonationDisplay(t.editDisplay.id,t.editDisplay.name,t.editDisplay.location,t.editDisplay.isAnonymous,t.editDisplay.isAmountPrivate).then(function(e){console.log("Save complete"),angular.copy(e,a),t.$root.$broadcast("load-profile","display"),n.close({})})},t.cancel=function(){n.dismiss({})}}],size:"md",resolve:{display:function(){return e.display}}})}}}}]),e.directive("userShippingAddress",["$uibModal","patronicityConfig","api",function(e,t,r){return{restrict:"E",template:'<button ng-click="openEditModal()" class="btn btn-primary btn-xs">{{label}}</button>',scope:{userId:"=",isShippingAddress:"="},link:function(t){t.label="Add Shipping Address",t.isShippingAddress&&(t.label="Edit Shipping Address"),t.$watch("isShippingAddress",function(e){t.label=e?"Edit Shipping Address":"Add Shipping Address"}),t.openEditModal=function(){e.open({templateUrl:"userShippingAddress.html",controller:["$scope","$uibModalInstance","userId","isShippingAddress","$timeout","Dialogs",function(t,n,e,a,o,i){t.user={},t.title="Add Shipping Address",t.buttonLabel="Add Address",t.isBillingAddress=!1,a&&(t.title="Edit Shipping Address",t.buttonLabel="Save Address"),t.load=function(){r.user.loadShippingAddress(e).then(function(e){t.profileAddress=e.shippingAddress,t.billingAddress=e.billingAddress,t.profileAddress&&(t.user.shipping=angular.copy(t.profileAddress)),t.billingAddress&&(t.isBillingAddress=!0)})},t.load(),t.save=function(){t.makeSureAllFieldsFilled()&&(r.user.saveShippingAddress(e,t.user.shipping).then(function(e){t.$root.$broadcast("load-profile","Save Shipping Address"),n.close({})},function(e){t.errorText=e}),o(function(){t.errorText=""},1e4))},t.clearShippingAddress=function(){i.Confirm("Are you sure you want to delete shipping address ?","Delete Shipping Address",[{name:"OK",type:"ok"},{name:"Cancel",type:"cancel"}]).then(function(){r.user.clearShippingAddress(e,t.user.shipping).then(function(e){t.load(),t.$root.$broadcast("load-profile","Delete Shipping Address"),t.resetAllfields(),t.messageText="Shipping address has been cleared successfully"},function(e){t.errorText=e})}),o(function(){t.messageText="",t.errorText=""},1e4)},t.cancel=function(){n.dismiss({})},t.setBillingAddress=function(){t.user.shipping=angular.copy(t.billingAddress)},t.setProfileAddress=function(){t.user.shipping=angular.copy(t.profileAddress)},t.$watch("sameAsBilling",function(e){e?t.setBillingAddress():t.setProfileAddress()}),t.makeSureAllFieldsFilled=function(){var e=!0;return t.user.shipping.Name?t.user.shipping.Country||(e=!(t.errorText="Please make sure you have select a Country field")):e=!(t.errorText="Please make sure name field filled in correctly"),o(function(){t.errorText=""},5e3),e},t.resetAllfields=function(){delete t.user.shipping.ID,t.user.shipping.Name="",t.user.shipping.Country="US",t.user.shipping.State="",t.user.shipping.Address="",t.user.shipping.City="",t.user.shipping.Zip=""},t.isBillingAndProfileAddressAreSame=function(){t.billingAndProfileAreSame=!1,t.profileAddress&&t.isBillingAddress&&t.profileAddress.ID==t.billingAddress.ID&&(t.billingAndProfileAreSame=!0),t.billingAndProfileAreSame&&(t.sameAsBilling=!0)},o(function(){t.isBillingAndProfileAddressAreSame()},5e3)}],size:"md",resolve:{userId:function(){return t.userId},isShippingAddress:function(){return t.isShippingAddress}}})}}}}])}(),function(){var e=angular.module("patronicity.user.userutils",["patronicity.api","user","ngTable","ui.bootstrap"]);e.directive("resetPassword",["$uibModal","patronicityConfig","api","Dialogs",function(t,n,a,o){return{restrict:"E",template:'<a ng-click="openEditModal()"><small class = "lgx-t-link lgx-t-green_new" >Forgotten Password?</small></a>',scope:{},link:function(e){e.openEditModal=function(){t.open({templateUrl:n.urlForTemplate("user/reset-password.html"),windowClass:"resetpassword",controller:["$scope","$uibModalInstance",function(e,t){console.log("Reset Password"),e.details={},e.send=function(){e.messageText="",console.log("Call Password reset: "+e.details.email),a.user.sendPasswordReset(e.details.email).then(function(e){console.log("Password reset email sent"),t.close(),o.Confirm("If your account was registered and activated using the email supplied, we've e-mailed you instructions for resetting your password to the e-mail address you submitted.","Reset Email Sent",[{name:"Ok",type:"ok"}]).then(function(){t.close()})},function(){t.close(),o.Confirm("If your account was registered and activated using the email supplied, we've e-mailed you instructions for resetting your password to the e-mail address you submitted.","Reset Email Sent",[{name:"Ok",type:"ok"}]).then(function(){t.close()})})},e.cancel=function(){t.dismiss({})}}],size:"md",resolve:{}})}}}}]),e.directive("setPassword",["api","patronicityConfig","User","$stateParams","$window",function(e,t,n,a,o){return{restrict:"E",scope:{},templateUrl:t.urlForTemplate("user/set-password.html"),link:function(t){console.log("Password Reset code: "+a.code),t.details={code:a.code,password:""},t.change=function(){console.log("Changing password"),e.user.setPassword(t.details.code,t.details.password).then(function(e){console.log("Password changed"),o.location.href="/"},function(e){t.messageText="Password change failed: "+e,console.log(t.messageText)})},e.user.getByCode(t.details.code).then(function(e){t.user=e},function(e){t.messageText="Failed to load user from reset code: "+e,console.log(t.messageText)})}}}])}(),function(){var e=angular.module("patronicity.utility",["ui.bootstrap","patronicity.configuration"]);e.directive("joinNewsletter",["patronicityConfig",function(e){return{restrict:"E",templateUrl:e.urlForTemplate("join-newsletter.html"),scope:{btnClass:"@"},link:function(e,t,n){e.enteringAddress=!1,e.emailInput=function(){e.enteringAddress?e.enteringAddress=!1:e.enteringAddress=!0}}}}]),e.directive("joinNewsletterLgx",["patronicityConfig","api","Dialogs",function(e,t,n){return{restrict:"E",templateUrl:e.urlForTemplate("join-newsletter-lgx.html"),link:function(e){e.submit=function(){e.userEmailAddress?t.countMeIn(e.userEmailAddress).then(function(e){n.Confirm("Thanks! You have been added to our newsletter.","Thank you",[{name:"OK",type:"ok"}]).then(function(){})}):n.Confirm("You must enter a valid email address.","Email invalid!",[{name:"OK",type:"ok"}]).then(function(){})}}}}]),e.directive("countMeIn",["patronicityConfig","api","Dialogs",function(e,t,n){return{restrict:"E",templateUrl:e.urlForTemplate("count-me-in.html"),scope:{type:"@"},link:function(e){e.useForm=!1,"mailerlite"==e.type&&(e.useForm=!0),e.type||(e.type="default"),e.details={email:void 0},e.submit=function(){e.details.email?t.countMeIn(e.details.email,e.type).then(function(e){n.Confirm("Thanks! You have been added to our newsletter.","Thank you",[{name:"OK",type:"ok"}]).then(function(){})}):n.Confirm("You must enter a valid email address.","Email invalid!",[{name:"OK",type:"ok"}]).then(function(){})}}}}]),e.directive("imageOnLoad",function(){return{restrict:"A",scope:{callback:"&"},link:function(e,t,n){t.bind("load",function(){e.callback&&e.callback()({success:!0})}),t.bind("error",function(){e.callback&&e.callback()({success:!1})})}}}),e.directive("backgroundImage",function(){return{restrict:"A",scope:{callback:"&",imagePath:"="},link:function(n,e,t){var a=new Image;n.$watch("imagePath",function(e,t){e&&(a.src=n.imagePath)}),a.onload=function(){n.$apply(function(){e.css({backgroundImage:"url("+n.imagePath+")"}),n.callback()({success:!0})})}}}}),e.directive("videoPopup",["$uibModal","$sce","$http","$q","patronicityConfig",function(r,s,c,l,u){return{restrict:"EA",template:function(e,t){return"1"==t.onlyClick?"<div ng-click='openModal()' ng-transclude></div>":"<div ng-class='divWrapClass()' ng-click='openModal()'><img ng-src='{{videoDetails.thumbnailUrl}}' ng-class='imgClassGetter()' /><span class='glyphicon glyphicon-play-circle' ng-if='showOverlayPlayButton()'></span>"},transclude:!0,scope:{videoUrl:"@",thumbnailUrl:"@",wrapClass:"@",imgClass:"@",overlayPlayButton:"@"},link:function(t,e,n){var a;if(t.videoDetails={type:"none",id:"",thumbnailUrl:""},t.videoUrl){var o=function(e){var t,e=e.match(/^.*(youtu\.be\/|v\/|u\/\w\/|embed\/|watch\?v=|\&v=)([^#\&\?]*).*/);e&&11==e[2].length&&(t=e[2]);return t}(t.videoUrl);if(o?a="youtube":(o=function(e){var t,e=e.match(/https?:\/\/(?:www\.|player\.)?vimeo.com\/(?:channels\/(?:\w+\/)?|groups\/([^\/]*)\/videos\/|album\/(\d+)\/video\/|video\/|)(\d+)(?:$|\/|\?)/);e&&e[3].length&&(t=e[3]);return t}(t.videoUrl))?a="vimeo":console.log("Error: Could not parse the provided URL"),o){t.videoDetails.type=a,t.videoDetails.id=o;var i=t.videoDetails;if(t.thumbnailUrl)i.thumbnailUrl=t.thumbnailUrl;else switch(i.type){case"youtube":i.thumbnailUrl="https://img.youtube.com/vi/"+o+"/hqdefault.jpg";break;case"vimeo":!function(e){var t=l.defer();return c.jsonp("http://vimeo.com/api/v2/video/"+e+".json?callback=JSON_CALLBACK").success(function(e){e=e[0].thumbnail_large;t.resolve(e)}).error(function(){t.reject()}),t.promise}(o).then(function(e){i.thumbnailUrl=e})}}}t.divWrapClass=function(){var e="icon-overlay-wrapper";return e=t.wrapClass?t.wrapClass:e},t.imgClassGetter=function(){var e="img-responsive";return e=t.imgClass?t.imgClass:e},t.showOverlayPlayButton=function(){var e=!0;return e=t.overlayPlayButton&&"false"==t.overlayPlayButton?!1:e},t.openModal=function(){r.open({templateUrl:u.urlForTemplate("video-modal.html"),controller:["$scope","$uibModalInstance","videoDetails",function(e,t,n){var a;switch(n.type){case"youtube":a="https://www.youtube.com/embed/"+n.id+"?autoplay=1&rel=0";break;case"vimeo":a="https://player.vimeo.com/video/"+n.id+"?autoplay=1"}e.iframeUrl=s.trustAsResourceUrl(a),e.cancel=function(){t.dismiss()},e.ok=function(){t.close()}}],size:"lg",resolve:{videoDetails:function(){return t.videoDetails}}}).result.then(function(e){})}}}}]),e.filter("urlencode",function(){return window.encodeURIComponent}),e.filter("ordinal",function(){return function(e){var t=e%10,n=e%100;return 1==t&&11!=n?e+"st":2==t&&12!=n?e+"nd":3==t&&13!=n?e+"rd":e+"th"}}),e.filter("fullOrdinal",function(){return function(e){var t=["zeroth","First","Second","Third","Fourth","Fifth","Sixth","Seventh","Eighth","Ninth","Tenth","Eleventh","Twelfth","Thirteenth","Fourteenth","Fifteenth","Sixteenth","Seventeenth","Eighteenth","Nineteenth"],n=["Twent","Thirt","Fort","Fift","Sixt","Sevent","Eight","Ninet"];return e<20?t[e]:e%10==0?n[Math.floor(e/10)-2]+"ieth":n[Math.floor(e/10)-2]+"y-"+t[e%10]}}),e.directive("cHref",["$location","$anchorScroll","$timeout",function(e,a,t){return{restrict:"A",scope:!1,link:function(e,t,n){t.on("click",function(){n.type&&"tab"==n.type&&n.cHref.match("^#.+")?(angular.element(n.cHref).siblings().removeClass("in active"),angular.element(n.cHref).addClass("in active"),t.parent().siblings().removeClass("active"),t.parent().addClass("active")):a(n.cHref)})}}}]),e.directive("datepicker",["patronicityConfig",function(e){return{restrict:"E",templateUrl:e.urlForTemplate("datepicker.html"),scope:{name:"@",view:"@?",date:"=ngModel"},link:function(e,t,n){e.view||(e.view="day"),e.pickerId=Math.random().toString(36).replace(/[^a-z0-9A-Z]+/g,""),e.reset=function(){e.date=null}}}}]),e.directive("onlyOrdinal",[function(){return{restrict:"E",template:"{{ordinal_suffix()}}",scope:{number:"="},link:function(n,e,t){n.ordinal_suffix=function(){var e=n.number,t=e%10,e=e%100;return 1==t&&11!=e?"st":2==t&&12!=e?"nd":3==t&&13!=e?"rd":"th"}}}}]),e.filter("numberSuffix",function(){return function(e,t){for(var n=t||1,a=1,o=0;1e3*a<=e;)a*=1e3,o++;for(var t=Math.floor(e/a),i=""+Math.floor((e/a-t)*Math.pow(10,n));i.length<n;)i="0"+i;return(t+"."+i).replace("."+"0".repeat(n),"")+["","K","M","B"][o]}}),e.filter("hijrah",function(){return function(e,t){var n=(e=new window.HijrahDate(e)).format("MMMM d, yyyy","en");return"gregorianAnniversary"==t?n=(e=e.plusYears(1)).toGregorian():"currentHijrah"==t&&(n=e.format("d MMMM yyyy G","en")),n}}),e.filter("cardDescription",function(){return function(e,t){if("lgx"==t)return(t=e.split(" "))[0]+"  "+t[1]}}),e.directive("equals",function(){return{restrict:"A",require:"?ngModel",link:function(e,t,n,a){e.$watch(n.ngModel,function(){o()}),n.$observe("equals",function(e){o()});var o=function(){var e=a.$viewValue,t=n.equals;a.$setValidity("equals",!e||!t||e===t)}}}}),e.directive("isolateForm",[function(){return{restrict:"A",require:"?form",link:function(e,t,n,a){var o;a&&(o={},angular.copy(a,o),t.parent().controller("form").$removeControl(a))}}}]),e.directive("bindHtmlCompile",["$compile",function(o){return{restrict:"A",link:function(t,n,a){t.$watch(function(){return t.$eval(a.bindHtmlCompile)},function(e){n.html(e&&e.toString());e=t;a.bindHtmlScope&&(e=t.$eval(a.bindHtmlScope)),o(n.contents())(e)})}}}]),e.service("googleService",["$http","$rootScope","$q",function(e,t,n){var a="646522442205-876360o26d51knp4nb8tr4d5fv24jaji.apps.googleusercontent.com",o="profile email openid",i=n.defer();this.loadScript=function(){var e=document.createElement("script"),t=(e.type="text/javascript",e.src="https://apis.google.com/js/client.js",document.createElement("script"));t.type="text/javapcript",t.async=!0,t.src="https://apis.google.com/js/platform.js",document.body.appendChild(e),document.body.appendChild(t)},this.login=function(){return gapi.auth.authorize({client_id:a,scope:o,immediate:!1,hd:""},this.handleAuthResult),i.promise},this.checkAuth=function(){gapi.auth.authorize({client_id:a,scope:o,immediate:!0,hd:""},this.handleAuthResult)},this.handleAuthResult=function(t){var n,a;t&&!t.error?(n={},a={},gapi.client.load("oauth2","v2",function(){gapi.client.oauth2.userinfo.get().execute(function(e){n.email=e.email,n.id=e.id,n.name=e.name,n.firstName=e.given_name,n.lastName=e.family_name,n.profileImage=e.picture,a.access_token=t.access_token,a.expires=t.expires_at,a.issued=t.issued_at,n.token=a,i.resolve(n)})})):t&&t.error?i.reject(t):i.reject("error")},this.handleAuthClick=function(e){return gapi.auth.authorize({client_id:a,scope:o,immediate:!1,hd:""},this.handleAuthResult),!1}}]),e.service("queryParamsService",["$location",function(n){this.isQueryParamInCurrentRoute=function(e){var t=n.search();return Boolean("string"==typeof e&&t.hasOwnProperty(e)&&"true"===t[e])},this.getQueryParamInCurrentRoute=function(e){var t=n.search();return!("string"!=typeof e||!t.hasOwnProperty(e))&&t[e]},this.getQueryParamInUrl=function(e){var t=function(){var e,t,n=window.location.search.substring(1).split("&"),a={};for(t in n)""!==n[t]&&(e=n[t].split("="),a[decodeURIComponent(e[0])]=decodeURIComponent(e[1]));return a}(window.location.search);return!("string"!=typeof e||!t.hasOwnProperty(e))&&t[e]}}]),e.directive("showHideFieldText",["$compile",function(o){return function(e,t,n){t.attr("type","password"),e.inputType="password",e.showHideClass="glyphicon glyphicon-eye-open";var a=angular.element('<span class="form-control-feedback {{showHideClass}}" ng-click="showFieldText()" style="cursor:pointer; margin:0 30px; pointer-events:visible;"></span> ');a.insertAfter(t),o(a)(e),e.showFieldText=function(){"password"==e.inputType?(t.attr("type","text"),e.inputType="text",e.showHideClass="glyphicon glyphicon-eye-close"):(t.attr("type","password"),e.inputType="password",e.showHideClass="glyphicon glyphicon-eye-open")}}}]),e.directive("ckeditor",["imageUpload","$compile","$q","$upload","patronicityConfig","$rootScope",function(e,t,i,r,s,c){function o(e,t){for(var n=0;n<t.length;n++){var a=t[n];a.enumerable=a.enumerable||!1,a.configurable=!0,"value"in a&&(a.writable=!0),Object.defineProperty(e,a.key,a)}}var l=function(){function a(e,t,n){if(!(this instanceof a))throw new TypeError("Cannot call a class as a function");this.loader=e,this.type=t,this.id=n}var e,t,n;return e=a,(t=[{key:"upload",value:function(){var n=i.defer(),t=this.loader,a=this.type,o=this.id;return this.loader.file.then(function(e){c.$emit("editor-image-uploading-start"),r.upload({url:s.apiEndpointURL("media/legacyUpload"),data:{type:a,id:o},file:e}).then(function(e){var t;200==e.status?e.data.success?(t=e.data.result,n.resolve({default:t.url})):alert(e.data.message):alert("Error on upload: "+e.statusText),c.$emit("editor-image-uploading-end")},function(e){alert("Error on upload: "+e.statusText),c.$emit("editor-image-uploading-end")},function(e){t.uploadTotal=e.total,t.uploaded=e.loaded})}),n.promise}}])&&o(e.prototype,t),n&&o(e,n),a}();return{restrict:"A",scope:{imageType:"@",imageTypeData:"@"},require:"?ngModel",link:function(t,e,n,a){a&&(window.ClassicEditor.defaultConfig={toolbar:{viewportTopOffset:0,items:["heading","|","bold","italic","link","|","bulletedList","numberedList","|","insertTable","|","imageUpload","mediaEmbed","|","undo","redo"]},image:{toolbar:["imageUpload","mediaEmbed"]},table:{contentToolbar:["tableColumn","tableRow","mergeTableCells"]},mediaEmbed:{previewsInData:!0},allowedContent:!0,link:{addTargetToExternalLinks:!0},language:"en"},window.ClassicEditor.create(e[0]).then(function(e){e.model.document.on("change:data",function(){t.$emit("editor-value-changed"),a.$setViewValue(e.getData()),e.getData()!==a.$modelValue&&t.$apply()}),a.$render=function(){e.setData(a.$viewValue)},t.$on("$destroy",function(){e.destroy()}),e.plugins.get("FileRepository").createUploadAdapter=function(e){return new l(e,t.imageType,t.imageTypeData)},angular.element(document.querySelector(".ck-sticky-panel")).removeClass("ck-sticky-panel").addClass("ck-newSticky-panel")}))}}}]),e.directive("showHideSensitiveAccFieldText",["$compile","api",function(r,s){return function(t,e,n){t.changeId=!1,t.sensitiveFieldChange=[],e.attr("type","password"),t.inputType="password",t.showHideClass="glyphicon glyphicon-eye-close";var a=angular.element('<span class="form-control-feedback {{showHideClass}}" ng-click="showFieldText()" style="cursor:pointer; margin:0 30px; pointer-events:visible;"></span> '),o=(a.insertAfter(e),r(a)(t),n.accountId),i=n.kycFieldType;t.changeSensitiveValue=function(){t[i].value=t[i].value},t.showFieldText=function(){t[i].initialDisabled&&(t.value="",s.projectAdmin.account.getSensitiveData(o,i).then(function(e){t[i].oldValue=e.value,t[i].value=e.value,t[i].initialDisabled=!1},function(e){console.log(e),t.errorMessage=e})),"password"==t.inputType?(e.attr("type","text"),t.inputType="text",t.showHideClass="glyphicon glyphicon-eye-open"):(e.attr("type","password"),t.inputType="password",t.showHideClass="glyphicon glyphicon-eye-close")}}}]),e.directive("aDisabled",function(){return{compile:function(e,t,n){return t.ngClick="!("+t.aDisabled+") && ("+t.ngClick+")",function(t,n,a){t.$watch(a.aDisabled,function(e){void 0!==e&&n.toggleClass("disabled",e)}),n.on("click",function(e){t.$eval(a.aDisabled)&&e.preventDefault()}),n.bind("click",function(e){t.$eval(a.aDisabled)&&e.preventDefault()})}}}})}(),function(){var e=angular.module("patronicity.zakat",["ui.bootstrap","ngResource","ngSanitize","patronicity.api","user","patronicity.configuration","ui.router","patronicity.common.currency"]);e.directive("zakatCalculator",["CurrencyCodeProvider","api","patronicityConfig","User","$stateParams","$window","$state","$filter","$analytics",function(c,l,e,u,d,p,m,g,f){return{restrict:"E",templateUrl:e.urlForTemplate("user-profile/pages/my-giving/zakat-calculator.html"),scope:{},link:function(i){null!=d.profile?(i.profileView=!0,i.zakatProfileSlug=d.profile):i.profileView=!1,i.entries={cash:null,code:"USD",goldGrams:null,goldCash:null,goldValue:0,silverGrams:null,silverCash:null,silverValue:0,activeInvestmentCash:null,passiveInvestment:[{passiveInvestmentStockName:null,passiveInvestmentStockValue:null}],dividendInvestment:[{dividendInvestmentStockName:null,dividendInvestmentPerShare:null,dividendInvestmentStockAmount:null,dividendInvestmentValue:null}],cryptoCurrencyInvestmentCash:null,pensionInvestmentCash:null,propertyInvestmentCash:null,propertyRentalIncome:null,propertyRentalExpenses:null,debtCash:null,otherAssetCash:null,expense:[{expenseName:null,expenseCash:null,expenseFrequency:null}],profile:"My Zakat",totalAssets:0,totalDebts:0,zakatStartDate:new Date,zakatAnniversary:g("hijrah")(new Date,"gregorianAnniversary"),zakatDelta:0,zakatDue:0};var a;function t(){null!=d.username?(i.username=d.username,n(i.username)):u.get().then(function(){var e=u.current();null!==e&&(i.username=e.UserName,i.userId=e.ID,n(i.username))})}function n(e){var t;null!=d.profile&&(t=d.profile,l.zakat.getProfile(e,t).then(function(e){i.period=e.period,i.code={code:e.code,symbol:c.symbolFromCode(e.code),emoji:c.emojiFromCode(e.code),label:"Loading.."},i.entries={cash:e.cash,code:e.code,goldGrams:e.goldGrams,goldCash:e.goldCash,goldValue:e.goldValue,silverGrams:e.silverGrams,silverCash:e.silverCash,silverValue:e.silverValue,activeInvestmentCash:e.activeInvestmentCash,passiveInvestment:e.passiveInvestment,dividendInvestment:e.dividendInvestment,expense:e.expense,cryptoCurrencyInvestmentCash:e.cryptoCurrencyInvestmentCash,pensionInvestmentCash:e.pensionInvestmentCash,propertyInvestmentCash:e.propertyInvestmentCash,propertyRentalIncome:e.propertyRentalIncome,propertyRentalExpenses:e.propertyRentalExpenses,debtCash:e.debtCash,otherAssetCash:e.otherAssetCash,profile:e.profile,totalAssets:e.totalAssets,totalDebts:e.totalDebts,zakatAnniversary:new Date(e.zakatAnniversary),zakatStartDate:new Date(e.zakatStartDate),zakatDelta:e.zakatDelta,zakatDue:e.zakatDue}},function(e){alert(e)}))}l.zakat.fetchMetalPrices().then(function(e){i.goldPrice=e.GoldPrice,i.silverPrice=e.SilverPrice,i.nisabValue=595*i.silverPrice},function(e){alert(e)}),t();var o,r,e=!1;i.getSettingsUrl=function(){return"/user/newprofile"+m.href("user-profile.zakat",{username:i.username})},i.save=function(){i.username?i.profileView?l.zakat.editCalculatorData(d.username,i.period,i.entries).then(function(){p.location.href=i.getSettingsUrl()},function(e){alert(e)}):i.entries.zakatStartDate<new Date||!0===e?l.zakat.saveCalculatorData(i.username,i.entries).then(function(){f.eventTrack("Save",{value:!0,category:i.userId,label:s}),s=Math.random().toString(36).substring(2,15)+Math.random().toString(36).substring(2,15),i.closeSavePopup(),i.duplicateNameBoolean=!1,i.invalidZakatDate=!1,p.location.href=i.getSettingsUrl()},function(e){i.duplicateNameBoolean=!0}):i.invalidZakatDate=!0:u.loginModal(!1).then(function(e){t()})},i.toggleOverwrite=function(){e=!0,i.invalidZakatDate=!1,i.save()},i.$watch("code",function(e){var t,n;null!=e&&(t=i.entries.code,n=e.code,l.exchangeRate(t,n).then(function(e){a=e.rate,i.goldPrice=i.goldPrice*a,i.silverPrice=i.silverPrice*a,i.nisabValue=i.nisabValue*a},function(e){alert(e)}),i.entries.code=e.code)});var s=Math.random().toString(36).substring(2,15)+Math.random().toString(36).substring(2,15);i.addEvent=function(e,t){r=(o=(null!=o&&o!=e&&f.eventTrack(o,{value:r,category:i.userId,label:s}),e),t)},i.$watch("entries",function(e,t){var n=0,a=(i.entries.expense.forEach(function(e){n+=Number(e.expenseCash)||0}),0),o=(i.entries.passiveInvestment.forEach(function(e){a+=Number(e.passiveInvestmentStockValue)||0}),0);i.entries.dividendInvestment.forEach(function(e){e.dividendInvestmentValue=(Number(e.dividendInvestmentPerShare)||0)*(Number(e.dividendInvestmentStockAmount)||0),o+=e.dividendInvestmentValue}),i.entries.goldValue=(Number(i.entries.goldGrams)||0)*(Number(i.goldPrice)||0)+(Number(i.entries.goldCash)||0),i.entries.silverValue=(Number(i.entries.silverGrams)||0)*(Number(i.silverPrice)||0)+(Number(i.entries.silverCash)||0),i.entries.totalAssets=(Number(i.entries.debtCash)||0)+(Number(i.entries.cash)||0)+(Number(i.entries.goldValue)||0)+(Number(i.entries.silverValue)||0)+(Number(i.entries.activeInvestmentCash)||0)+a+o+(Number(i.entries.cryptoCurrencyInvestmentCash)||0)+(Number(i.entries.pensionInvestmentCash)||0)+(Number(i.entries.propertyInvestmentCash)||0)+(Number(i.entries.propertyRentalIncome)||0)+(Number(i.entries.otherAssetCash)||0),i.entries.totalDebts=(Number(i.entries.propertyRentalExpenses)||0)+n,i.entries.zakatDelta=i.entries.totalAssets-i.entries.totalDebts,i.entries.zakatDue=.025*i.entries.zakatDelta},!0),i.addExpense=function(){i.entries.expense.push({expenseName:null,expenseCash:null,expenseFrequency:null})},i.addPassiveInvestment=function(){i.entries.passiveInvestment.push({passiveInvestmentStockName:null,passiveInvestmentStockValue:null})},i.addDividendInvestment=function(){i.entries.dividendInvestment.push({dividendInvestmentStockName:null,dividendInvestmentPerShare:null,dividendInvestmentStockAmount:null,dividendInvestmentValue:null})},i.removeExpense=function(t){i.entries.expense=i.entries.expense.filter(function(e){return e!==i.entries.expense[t]})},i.removePassiveInvestment=function(t){i.entries.passiveInvestment=i.entries.passiveInvestment.filter(function(e){return e!==i.entries.passiveInvestment[t]})},i.removeDividendInvestment=function(t){i.entries.dividendInvestment=i.entries.dividendInvestment.filter(function(e){return e!==i.entries.dividendInvestment[t]})},i.openPopup=function(e){$(".lgx-dialog_container").each(function(){$(this).css("display","none")}),i.popup=$(".lgx-dialog_container["+e+"]"),i.popup.fadeIn(),i.popup.find(".lgx-dialog--header svg").click(function(){i.popup.fadeOut()}),$(".lgx-dialog_container").click(function(){i.popup.fadeOut()}),$(".lgx-dialog_container *").click(function(e){e.stopPropagation()}),i.popup.find(".lgx-cancel-button").click(function(){i.popup.fadeOut()})},i.closeSavePopup=function(){i.popup.find(".lgx-save-button"),i.popup.fadeOut()},i.selectedValues={gold:!1,silver:!1,investments:!1,shares:!1,crypto:!1,pension:!1,fixedAssets:!1,dividend:!1,property:!1,reselling:!1,renting:!1,owe:!1,expect:!1,expenses:!1}}}}]),e.directive("zakatLanding",["api",function(n){return{restrict:"EA",link:function(t){n.home.footerStats().then(function(e){t.stats=e,n.zakat.fetchMetalPrices().then(function(e){t.silverPrice=e.SilverPrice,t.nisabValue=595*t.silverPrice},function(e){alert(e)})},function(e){alert(e)})}}}])}(),function(){var e=angular.module("mv.banking.kyc",["mv.widgets","mv.configuration"]);e.factory("kycPersonalIdProvider",["$q",function(e){return{forCountryCode:function(e,t){var n;switch(e){case"US":n="internal"==t?{pattern:"\\d{9}",label:"Social Security Number (9 Digits)",maxLength:9,placeholder:"123-45-6789",digitsOnly:!0}:{pattern:"\\d{4}",label:"Social Security Number (Last 4 Digits)",maxLength:4,placeholder:"1234",digitsOnly:!0};break;case"MY":n={pattern:".*",label:"Income Tax Number (ITN)",maxLength:20,placeholder:""};break;case"NZ":n={pattern:".*",label:"Inland Revenue Department (IRD) Number",maxLength:20,placeholder:""};break;case"AU":n={pattern:".*",label:"Tax File Number (TFN)",maxLength:20,placeholder:""};break;case"TR":case"PS":n={pattern:".*",label:"Tax Identification Number (TIN)",maxLength:20,placeholder:""};break;case"ID":n={pattern:".*",label:"Nomor Pokok Wajib Pajak (NPWP)",maxLength:20,placeholder:""};break;case"SG":n={pattern:".*",label:"UEN",maxLength:20,placeholder:""};break;case"CA":n={pattern:"\\d{9}",label:"Social Insurance Number (SIN)",maxLength:9,placeholder:"123-456-789",digitsOnly:!0};break;case"GB":n={pattern:"[A-Za-z]{2}\\d{6}[A-Za-z0-9]{1}",label:"National Insurance Number (NIN)",description:"This should be a combination of 2 letters, 6 digits, and 1 letter.",maxLength:9,placeholder:"AB123456C"};break;default:n={pattern:".*",label:"Personal ID Number",maxLength:20,placeholder:"123456789"}}return void 0===n.digitsOnly&&(n.digitsOnly=!1),n}}}]),e.directive("kycPersonalIdLabel",["kycPersonalIdProvider",function(o){return{restrict:"E",scope:{countryCode:"="},replace:!0,template:"<span>{{ data.label }}</span>",link:function(t,e,n){var a=n.kycType||"external";t.data={label:"Personal ID Number"},t.$watch("countryCode",function(e){e&&(e=o.forCountryCode(e,a),t.data.label=e.label)})}}}]),e.directive("kycPersonalIdForCountry",["kycPersonalIdProvider",function(u){return{restrict:"A",require:"ngModel",link:function(e,i,t,r){var s=t.kycType||"external",c=null;function l(e){var t;if(e)return(t=e.replace(/[^0-9]/g,""))!==e&&(r.$setViewValue(t),r.$render()),t}t.kycPersonalIdForCountry?(r.$validators.kycPersonalIdForCountry=function(e,t){var n;return!c||(n=!1,(t=t||"").length<=c.maxLength&&t.match(c.pattern)&&(n=!0),!i.prop("required")||n)},e.$watch(t.kycPersonalIdForCountry,function(e){var t,n,a,o;e&&(c=u.forCountryCode(e,s))&&(i.attr("placeholder",c.placeholder),i.attr("maxlength",c.maxLength),i.attr("pattern",c.pattern),e=r,t=l,n=c.digitsOnly,a=e.$parsers.indexOf(t),o=!1,n&&a<0?(e.$parsers.unshift(t),o=!0):!n&&0<=a&&(e.$parsers.splice(a,1),o=!0),o&&e.$validate(),r.$validate())})):console.log("Country code required")}}}]),e.directive("kycPersonalIdHelpBlockText",["kycPersonalIdProvider",function(o){return{restrict:"E",scope:{countryCode:"="},replace:!0,template:"<span>{{ data.description }}</span>",link:function(t,e,n){var a=n.kycType||"external";t.data={description:""},t.$watch("countryCode",function(e){e&&(e=o.forCountryCode(e,a))&&(e.description?t.data.description=e.description:t.data.description="")})}}}])}(),angular.module("mv.banking",["mv.widgets","mv.configuration","mv.banking.numbers.iban","mv.banking.numbers.account","mv.banking.numbers.routing","mv.banking.kyc"]),function(){var e=angular.module("mv.banking.numbers.account",[]);e.factory("bankAccountNumberProvider",["$q",function(e){return{forCountryCode:function(e){var t;switch(e){case"US":t={pattern:"(\\d){3,}",label:"Account Number",maxLength:34,placeholder:"123456789",description:"This should be 3 or more digits and is found on the front of your check.",digitsOnly:!0};break;case"GB":t={pattern:"(\\d){8}",label:"Account Number",maxLength:8,placeholder:"12345678",description:"This should be 8 digits.",digitsOnly:!0};break;case"CA":t={pattern:"(\\d){7,12}",label:"Account Number",maxLength:12,placeholder:"1234567",description:"This should be 7-12 digits.",digitsOnly:!0};break;default:t={pattern:"(.){3,}",label:"Account Number",maxLength:34,placeholder:"12345678",description:"This should be 3 or more letters or digits.",digitsOnly:!1}}return t}}}]),e.directive("bankAccountNumberLabel",["bankAccountNumberProvider",function(a){return{restrict:"E",scope:{countryCode:"="},replace:!0,template:"<span>{{ data.label }}</span>",link:function(t,e,n){t.data={label:"Account Number"},t.$watch("countryCode",function(e){e&&(e=a.forCountryCode(e),t.data.label=e.label)})}}}]),e.directive("bankAccountNumberForCountry",["bankAccountNumberProvider",function(l){return{restrict:"A",require:"ngModel",link:function(e,i,t,r){var s=null;function c(e){var t;if(e)return(t=e.replace(/[^0-9]/g,""))!==e&&(r.$setViewValue(t),r.$render()),t}t.bankAccountNumberForCountry?(r.$validators.bankAccountNumberForCountry=function(e,t){var n;return!!s&&(n=!1,(t=t||"").length<=s.maxLength&&t.match(s.pattern)&&(n=!0),!i.prop("required")||n)},e.$watch(t.bankAccountNumberForCountry,function(e){var t,n,a,o;e&&(s=l.forCountryCode(e))&&(i.attr("placeholder",s.placeholder),i.attr("maxlength",s.maxLength),i.attr("pattern",s.pattern),e=r,t=c,n=s.digitsOnly,a=e.$parsers.indexOf(t),o=!1,n&&a<0?(e.$parsers.unshift(t),o=!0):!n&&0<=a&&(e.$parsers.splice(a,1),o=!0),o&&e.$validate(),r.$validate())})):console.log("Country code required")}}}]),e.directive("bankAccountNumberHelpBlockText",["bankAccountNumberProvider",function(a){return{restrict:"E",scope:{countryCode:"="},replace:!0,template:"<span>{{ data.description }}</span>",link:function(t,e,n){t.data={description:""},t.$watch("countryCode",function(e){e&&(e=a.forCountryCode(e))&&(e.description?t.data.description=e.description:t.data.description="")})}}}])}(),function(){var e=angular.module("mv.banking.numbers.iban",[]);e.factory("ibanProvider",["$q",function(e){function t(e){var t;switch(e){case"AL":t={pattern:"[A-Za-z]{2}\\d{2}\\d{8}[A-Za-z0-9]{16}",description:"This is the IBAN account number.  It should be a two letter country prefix followed by 10 digits, and then 16 numbers or characters.",maxLength:28,placeholder:"AL47212110090000000235698741"};break;case"AD":t={pattern:"[A-Za-z]{2}\\d{2}\\d{8}[A-Za-z0-9]{12}",description:"This is the IBAN account number.  It should be a two letter country prefix followed by 10 digits and then 12 numbers or characters.",maxLength:24,placeholder:"AD1200012030200359100100"};break;case"AT":t={pattern:"[A-Za-z]{2}\\d{18}",description:"This is the IBAN account number.  It should be a two letter country prefix followed by 18 digits.",maxLength:20,placeholder:"AT611904300234573201"};break;case"AZ":t={pattern:"[A-Za-z]{2}\\d{2}[A-Za-z0-9]{4}\\d{20}",description:"This is the IBAN account number.  It should be a two letter country prefix followed by 2 digits, then 4 characters, and finally 20 digits.",maxLength:28,placeholder:"AZ21NABZ00000000137010001944"};break;case"BH":t={pattern:"[A-Za-z]{2}\\d{2}[A-Za-z]{4}[A-Za-z0-9]{14}",description:"This is the IBAN account number.  It should be a two letter country prefix followed by 2 digits, then 4 characters, and finally 14 numbers or characters.",maxLength:22,placeholder:"BH67BMAG00001299123456"};break;case"BE":t={pattern:"[A-Za-z]{2}\\d{14}",description:"This is the IBAN account number.  It should be a two letter country prefix followed by 14 digits.",maxLength:16,placeholder:"BE68539007547034"};break;case"BA":t={pattern:"[A-Za-z]{2}\\d{18}",description:"This is the IBAN account number.  It should be a two letter country prefix followed by 18 digits.",maxLength:20,placeholder:"BA391290079401028494"};break;case"BR":t={pattern:"[A-Za-z]{2}\\d{2}\\d{23}[A-Za-z]{1}[A-Za-z0-9]{1}",description:"This is the IBAN account number.  It should be a two letter country prefix followed by 25 digits, a letter and then a number or letter.",maxLength:29,placeholder:"BR9700360305000010009795493P1"};break;case"BG":t={pattern:"[A-Za-z]{2}\\d{2}[A-Za-z]{4}\\d{6}[A-Za-z0-9]{8}",description:"This is the IBAN account number.  It should be a two letter country prefix followed by 18 digits.",maxLength:22,placeholder:"BG80BNBG96611020345678"};break;case"CR":t={pattern:"[A-Za-z]{2}\\d{20}",description:"This is the IBAN account number.  It should be a two letter country prefix followed by 20 digits.",maxLength:22,placeholder:"CR05015202001026284066"};break;case"HR":t={pattern:"[A-Za-z]{2}\\d{19}",description:"This is the IBAN account number.  It should be a two letter country prefix followed by 19 digits.",maxLength:21,placeholder:"HR1210010051863000160"};break;case"CY":t={pattern:"[A-Za-z]{2}\\d{2}\\d{8}[A-Za-z0-9]{16}",description:"This is the IBAN account number.  It should be a two letter country prefix followed by 10 digits, then 16 letters or digits.",maxLength:28,placeholder:"CY17002001280000001200527600"};break;case"CZ":t={pattern:"[A-Za-z]{2}\\d{22}",description:"This is the IBAN account number.  It should be a two letter country prefix followed by 22 digits.",maxLength:24,placeholder:"CZ6508000000192000145399"};break;case"DK":t={pattern:"[A-Za-z]{2}\\d{16}",description:"This is the IBAN account number.  It should be a two letter country prefix followed by 16 digits.",maxLength:18,placeholder:"DK5000400440116243"};break;case"DO":t={pattern:"[A-Za-z]{2}\\d{2}[A-Za-z]{4}\\d{20}",description:"This is the IBAN account number.  It should be a two letter country prefix followed by 2 digits, then 4 letters and finally 20 letters or numbers.",maxLength:28,placeholder:"DO28BAGR00000001212453611324"};break;case"EE":t={pattern:"[A-Za-z]{2}\\d{18}",description:"This is the IBAN account number.  It should be a two letter country prefix followed by 18 digits.",maxLength:20,placeholder:"EE382200221020145685"};break;case"FO":t={pattern:"[A-Za-z]{2}\\d{16}",description:"This is the IBAN account number.  It should be a two letter country prefix followed by 16 digits.",maxLength:18,placeholder:"FO6264600001631634"};break;case"FI":t={pattern:"[A-Za-z]{2}\\d{16}",description:"This is the IBAN account number.  It should be a two letter country prefix followed by 16 digits.",maxLength:18,placeholder:"FI2112345600000785"};break;case"FR":t={pattern:"[A-Za-z]{2}\\d{12}[A-Za-z0-9]{11}\\d{2}",description:"This is the IBAN account number.  It should be a two letter country prefix followed by 12 digits, then 11 letters or digits and finally 2 digits.",maxLength:27,placeholder:"FR1420041010050500013M02606"};break;case"GE":t={pattern:"[A-Za-z]{2}\\d{2}[A-Za-z0-9]{2}\\d{16}",description:"This is the IBAN account number.  It should be a two letter country prefix followed by 2 digits, then 2 letters or digits and finally 16 digits.",maxLength:22,placeholder:"GE29NB0000000101904917"};break;case"DE":t={pattern:"[A-Za-z]{2}\\d{20}",description:"This is the IBAN account number.  It should be a two letter country prefix followed by 20 digits.",maxLength:22,placeholder:"DE89370400440532013000"};break;case"GI":t={pattern:"[A-Za-z]{2}\\d{2}[A-Za-z]{4}[A-Za-z0-9]{15}",description:"This is the IBAN account number.  It should be a two letter country prefix followed by 2 digits, then 4 letters and then 15 numbers or letters.",maxLength:23,placeholder:"GI75NWBK000000007099453"};break;case"GR":t={pattern:"[A-Za-z]{2}\\d{9}[A-Za-z0-9]{16}",description:"This is the IBAN account number.  It should be a two letter country prefix followed by 9 digits, then 16 letters or digits.",maxLength:27,placeholder:"GR1601101250000000012300695"};break;case"GL":t={pattern:"[A-Za-z]{2}\\d{16}",description:"This is the IBAN account number.  It should be a two letter country prefix followed by 16 digits.",maxLength:18,placeholder:"GL8964710001000206"};break;case"GT":t={pattern:"[A-Za-z]{2}\\d{2}[A-Za-z0-9]{20}",description:"This is the IBAN account number.  It should be a two letter country prefix followed by 2 digits, then 24 letters or numbers.",maxLength:28,placeholder:"GT82TRAJ01020000001210029690"};break;case"HU":t={pattern:"[A-Za-z]{2}\\d{26}",description:"This is the IBAN account number.  It should be a two letter country prefix followed by 26 digits.",maxLength:28,placeholder:"HU42117730161111101800000000"};break;case"IS":t={pattern:"[A-Za-z]{2}\\d{24}",description:"This is the IBAN account number.  It should be a two letter country prefix followed by 24 digits.",maxLength:26,placeholder:"IS140159260076545510730339"};break;case"IE":t={pattern:"[A-Za-z]{2}\\d{2}[A-Za-z0-9]{4}\\d{14}",description:"This is the IBAN account number.  It should be a two letter country prefix followed by 2 digits, then 4 letters or numbers, and finally 14 digits.",maxLength:22,placeholder:"IE29AIBK93115212345678"};break;case"IL":t={pattern:"[A-Za-z]{2}\\d{21}",description:"This is the IBAN account number.  It should be a two letter country prefix followed by 21 digits.",maxLength:23,placeholder:"IL620108000000099999999"};break;case"IT":t={pattern:"[A-Za-z]{2}\\d{2}[A-Za-z]{1}\\d{10}[A-Za-z0-9]{12}",description:"This is the IBAN account number.  It should be a two letter country prefix followed by 2 digits, then a letter, then 10 digits, and finally 12 letters or numbers.",maxLength:27,placeholder:"IT60X0542811101000000123456"};break;case"KZ":t={pattern:"[A-Za-z]{2}\\d{5}[A-Za-z0-9]{13}",description:"This is the IBAN account number.  It should be a two letter country prefix followed by 5 digits, and then 13 letters or numbers.",maxLength:20,placeholder:"KZ86125KZT5004100100"};break;case"KW":t={pattern:"[A-Za-z]{2}\\d{2}[A-Za-z]{4}[A-Za-z0-9]{22}",description:"This is the IBAN account number.  It should be a two letter country prefix followed by 2 digits, and then 4 letters and finally 22 letters or digits.",maxLength:30,placeholder:"KW81CBKU0000000000001234560101"};break;case"LV":t={pattern:"[A-Za-z]{2}\\d{2}[A-Za-z]{4}[A-Za-z0-9]{13}",description:"This is the IBAN account number.  It should be a two letter country prefix followed by 2 digits, and then 4 letters and finally 13 letters or digits.",maxLength:21,placeholder:"LV80BANK0000435195001"};break;case"LB":t={pattern:"[A-Za-z]{2}\\d{6}[A-Za-z0-9]{20}",description:"This is the IBAN account number.  It should be a two letter country prefix followed by 6 digits, and then 20 letters or digits.",maxLength:28,placeholder:"LB62099900000001001901229114"};break;case"LI":t={pattern:"[A-Za-z]{2}\\d{7}[A-Za-z0-9]{12}",description:"This is the IBAN account number.  It should be a two letter country prefix followed by 7 digits, and then 12 letters or digits.",maxLength:21,placeholder:"LI21088100002324013AA"};break;case"LT":t={pattern:"[A-Za-z]{2}\\d{18}",description:"This is the IBAN account number.  It should be a two letter country prefix followed by 18 digits.",maxLength:20,placeholder:"LT121000011101001000"};break;case"LU":t={pattern:"[A-Za-z]{2}\\d{5}[A-Za-z0-9]{13}",description:"This is the IBAN account number.  It should be a two letter country prefix followed by 5 digits and then 13 numbers or letters.",maxLength:20,placeholder:"LU280019400644750000"};break;case"MK":t={pattern:"[A-Za-z]{2}\\d{5}[A-Za-z0-9]{10}\\d{2}",description:"This is the IBAN account number.  It should be a two letter country prefix followed by 5 digits and then 10 numbers or letters, and finally two digits.",maxLength:19,placeholder:"MK07250120000058984"};break;case"MT":t={pattern:"[A-Za-z]{2}\\d{2}[A-Za-z]{4}\\d{5}[A-Za-z0-9]{18}",description:"This is the IBAN account number.  It should be a two letter country prefix followed by 2 digits, then 4 letters,  then 5 digits, and finally 18 numbers or letters.",maxLength:31,placeholder:"MT84MALT011000012345MTLCAST001S"};break;case"MR":t={pattern:"[A-Za-z]{2}\\d{25}",description:"This is the IBAN account number.  It should be a two letter country prefix followed by 25 digits.",maxLength:27,placeholder:"MR1300020001010000123456753"};break;case"MU":t={pattern:"[A-Za-z]{2}\\d{2}[A-Za-z]{4}\\d{19}[A-Za-z]{3}",description:"This is the IBAN account number.  It should be a two letter country prefix followed by 2 digits, then 4 letters, 19 numbers, and finally 3 letters.",maxLength:30,placeholder:"MU17BOMM0101101030300200000MUR"};break;case"MC":t={pattern:"[A-Za-z]{2}\\d{12}[A-Za-z0-9]{11}\\d{2}",description:"This is the IBAN account number.  It should be a two letter country prefix followed by 12 digits, then 11 letters or numbers and finally 2 digits.",maxLength:27,placeholder:"MC5811222000010123456789030"};break;case"MD":t={pattern:"[A-Za-z]{2}\\d{2}[A-Za-z0-9]{2}\\d{18}",description:"This is the IBAN account number.  It should be a two letter country prefix followed by 2 digits, then 2 letters or numbers and finally 18 digits.",maxLength:24,placeholder:"MD24AG000225100013104168"};break;case"ME":t={pattern:"[A-Za-z]{2}\\d{20}",description:"This is the IBAN account number.  It should be a two letter country prefix followed by 20 digits.",maxLength:22,placeholder:"ME25505000012345678951"};break;case"NL":t={pattern:"[A-Za-z]{2}\\d{2}[A-Za-z]{4}\\d{10}",description:"This is the IBAN account number.  It should be a two letter country prefix followed by 2 digits, then 4 letters, and finally 10 digits.",maxLength:18,placeholder:"NL91ABNA0417164300"};break;case"NO":t={pattern:"[A-Za-z]{2}\\d{13}",description:"This is the IBAN account number.  It should be a two letter country prefix followed by 13 digits.",maxLength:15,placeholder:"NO9386011117947"};break;case"PK":t={pattern:"[A-Za-z]{2}\\d{2}[A-Za-z0-9]{4}\\d{16}",description:"This is the IBAN account number.  It should be a two letter country prefix followed by 2 digits, then 4 letters or numbers, and finally 16 digits.",maxLength:24,placeholder:"PK36SCBL0000001123456702"};break;case"PS":t={pattern:"[A-Za-z]{2}\\d{2}[A-Za-z0-9]{4}\\d{21}",description:"This is the IBAN account number.  It should be a two letter country prefix followed by 2 digits, then 4 letters or numbers, and finally 21 digits.",maxLength:29,placeholder:"PS92PALS000000000400123456702"};break;case"PL":t={pattern:"[A-Za-z]{2}\\d{26}",description:"This is the IBAN account number.  It should be a two letter country prefix followed by 26 digits.",maxLength:28,placeholder:"PL61109010140000071219812874"};break;case"PT":t={pattern:"[A-Za-z]{2}\\d{23}",description:"This is the IBAN account number.  It should be a two letter country prefix followed by 23 digits.",maxLength:25,placeholder:"PT50000201231234567890154"};break;case"RO":t={pattern:"[A-Za-z]{2}\\d{2}[A-Za-z]{4}[A-Za-z0-9]{16}",description:"This is the IBAN account number.  It should be a two letter country prefix followed by 2 digits, then 4 letters, and finally 16 letters or digits.",maxLength:24,placeholder:"RO49AAAA1B31007593840000"};break;case"SM":t={pattern:"[A-Za-z]{2}\\d{2}[A-Za-z]{1}\\d{10}[A-Za-z0-9]{12}",description:"This is the IBAN account number.  It should be a two letter country prefix followed by 2 digits, then 1 letter, then 10 digits, then finally 12 letters or digits.",maxLength:27,placeholder:"SM86U0322509800000000270100"};break;case"SA":t={pattern:"[A-Za-z]{2}\\d{4}[A-Za-z0-9]{18}",description:"This is the IBAN account number.  It should be a two letter country prefix followed by 4 digits, then 18 letters or digits.",maxLength:24,placeholder:"SA0380000000608010167519"};break;case"RS":t={pattern:"[A-Za-z]{2}\\d{20}",description:"This is the IBAN account number.  It should be a two letter country prefix followed by 20 digits.",maxLength:22,placeholder:"RS35260005601001611379"};break;case"SK":t={pattern:"[A-Za-z]{2}\\d{22}",description:"This is the IBAN account number.  It should be a two letter country prefix followed by 22 digits.",maxLength:24,placeholder:"SK3112000000198742637541"};break;case"SI":t={pattern:"[A-Za-z]{2}\\d{17}",description:"This is the IBAN account number.  It should be a two letter country prefix followed by 17 digits.",maxLength:19,placeholder:"SI56263300012039086"};break;case"ES":t={pattern:"[A-Za-z]{2}\\d{22}",description:"This is the IBAN account number.  It should be a two letter country prefix followed by 22 digits.",maxLength:24,placeholder:"ES9121000418450200051332"};break;case"SE":t={pattern:"[A-Za-z]{2}\\d{22}",description:"This is the IBAN account number.  It should be a two letter country prefix followed by 22 digits.",maxLength:24,placeholder:"SE4550000000058398257466"};break;case"CH":t={pattern:"[A-Za-z]{2}\\d{7}[A-Za-z0-9]{12}",description:"This is the IBAN account number.  It should be a two letter country prefix followed by 7 digits, and then 12 letters or numbers.",maxLength:21,placeholder:"CH9300762011623852957"};break;case"TN":t={pattern:"[A-Za-z]{2}\\d{22}",description:"This is the IBAN account number.  It should be a two letter country prefix followed by 22 digits.",maxLength:24,placeholder:"TN5910006035183598478831"};break;case"TR":t={pattern:"[A-Za-z]{2}\\d{7}[A-Za-z0-9]{17}",description:"This is the IBAN account number.  It should be a two letter country prefix followed by 7 digits, then 17 letters or numbers.",maxLength:26,placeholder:"TR330006100519786457841326"};break;case"AE":t={pattern:"[A-Za-z]{2}\\d{21}",description:"This is the IBAN account number.  It should be a two letter country prefix followed by 21 digits.",maxLength:23,placeholder:"AE070331234567890123456"};break;case"GB":t={pattern:"[A-Za-z]{2}\\d{2}[A-Za-z]{4}\\d{14}",description:"This is the IBAN account number.  It should be a two letter country prefix followed by 2 digits, then 4 letters, and then 14 digits.",maxLength:22,placeholder:"GB29NWBK60161331926819"};break;case"VG":t={pattern:"[A-Za-z]{2}\\d{2}[A-Za-z0-9]{4}\\d{16}",description:"This is the IBAN account number.  It should be a two letter country prefix followed by 2 digits, then 4 letters or numbers, and finally 16 digits.",maxLength:24,placeholder:"VG96VPVG0000012345678901"};break;default:t={pattern:"[A-Za-z]{2}\\d{20}",description:"This is the IBAN account number.  It should be a two letter country prefix followed by 20 digits.",maxLength:22,placeholder:"DE89370400440532013000",default:!0}}return t}return{forCountryCode:t,countrySupportsIBAN:function(e){return!t(e).default}}}]),e.directive("ibanNumberForCountry",["ibanProvider",function(i){return{restrict:"A",require:"ngModel",link:function(e,a,t,n){var o=null;t.ibanNumberForCountry?(n.$validators.ibanNumberForCountry=function(e,t){var n;return!o||(n=!1,(t=t||"").length<=o.maxLength&&t.match(o.pattern)&&(n=!0),!a.prop("required")||n)},e.$watch(t.ibanNumberForCountry,function(e){e&&(o=i.forCountryCode(e))&&(a.attr("placeholder",o.placeholder),a.attr("maxlength",o.maxLength),a.attr("pattern",o.pattern),n.$validate())})):console.log("Country code required")}}}]),e.directive("ibanHelpBlockText",["ibanProvider",function(a){return{restrict:"E",scope:{countryCode:"="},replace:!0,template:"<span>{{ data.description }}</span>",link:function(t,e,n){t.data={description:""},t.$watch("countryCode",function(e){e&&(e=a.forCountryCode(e))&&(t.data=e)})}}}])}(),function(){var e=angular.module("mv.banking.numbers.routing",[]);e.factory("bankRoutingProvider",["$q",function(e){return{forCountryCode:function(e){var t;switch(e){case"US":t={pattern:"\\d{9}",label:"Routing Number",maxLength:9,placeholder:"123456789",description:"This should be 9 digits and is found on the front of your check.",digitsOnly:!0};break;case"CA":t={pattern:"0\\d{8}",label:"Routing Number",maxLength:9,placeholder:"012345678",description:"This should be 9 digits starting with a 0.",digitsOnly:!0};break;case"AU":t={pattern:"\\d{6}",label:"BSB",maxLength:6,placeholder:"123456",description:"This should be 6 digits.",digitsOnly:!0};break;case"GB":t={pattern:"\\d{6}",label:"Routing Number",maxLength:6,placeholder:"123456",description:"This should be 6 digits.",digitsOnly:!0};break;default:t={pattern:".{3,}",label:"Bank identifier, routing number, sort code, Swift, or BSB",maxLength:35,description:"This should be your bank's routing, Swift, sort code or BSB code",placeholder:"",digitsOnly:!1}}return t}}}]),e.directive("bankRoutingLabel",["bankRoutingProvider",function(a){return{restrict:"E",scope:{countryCode:"="},replace:!0,template:"<span>{{ data.label }}</span>",link:function(t,e,n){t.data={label:"Bank identifier, routing number, sort code, or BSB"},t.$watch("countryCode",function(e){e&&(e=a.forCountryCode(e),t.data.label=e.label)})}}}]),e.directive("bankRoutingNumberForCountry",["bankRoutingProvider",function(l){return{restrict:"A",require:"ngModel",link:function(e,i,t,r){var s=null;function c(e){var t;if(e)return(t=e.replace(/[^0-9]/g,""))!==e&&(r.$setViewValue(t),r.$render()),t}t.bankRoutingNumberForCountry?(r.$validators.bankRoutingNumberForCountry=function(e,t){var n;return!s||(n=!1,(t=t||"").length<=s.maxLength&&t.match(s.pattern)&&(n=!0),!i.prop("required")||n)},e.$watch(t.bankRoutingNumberForCountry,function(e){var t,n,a,o;e&&(s=l.forCountryCode(e))&&(i.attr("placeholder",s.placeholder),i.attr("maxlength",s.maxLength),i.attr("pattern",s.pattern),e=r,t=c,n=s.digitsOnly,a=e.$parsers.indexOf(t),o=!1,n&&a<0?(e.$parsers.unshift(t),o=!0):!n&&0<=a&&(e.$parsers.splice(a,1),o=!0),o&&e.$validate(),r.$validate())})):console.log("Country code required")}}}]),e.directive("bankRoutingHelpBlockText",["bankRoutingProvider",function(a){return{restrict:"E",scope:{countryCode:"="},replace:!0,template:"<span>{{ data.description }}</span>",link:function(t,e,n){t.data={description:""},t.$watch("countryCode",function(e){e&&(e=a.forCountryCode(e))&&(e.description?t.data.description=e.description:t.data.description="")})}}}])}(),function(){var e=angular.module("mv.billing",["mv.configuration","mv.widgets"]);e.factory("creditCards",[function(){var e=/(\d{1,4})/g,a=[{type:"discover",pattern:/^(6011|65|64[4-9]|622)/,format:e,length:[16],cvcLength:[3],luhn:!0},{type:"mastercard",format:e,pattern:/^5[1-5]/,length:[16],cvcLength:[3],luhn:!0},{type:"amex",pattern:/^3[47]/,format:/(\d{1,4})(\d{1,6})?(\d{1,5})?/,length:[15],cvcLength:[4],luhn:!0},{type:"visa",pattern:/^4/,format:e,length:[13,14,15,16],cvcLength:[3],luhn:!0}];return{fromNumber:function(e){var t;for(e=(e+"").replace(/\D/g,""),t=0;t<a.length;t++){var n=a[t];if(n.pattern.test(e))return n}return null},fromType:function(e){for(var t=0;t<a.length;t++){var n=a[t];if(n.type===e)return n}},numberValidForCard:function(e,t){var t=(t+"").replace(/\D/g,""),n=!1;return n=0<=e.length.indexOf(t.length)?!e.luhn||function(e){for(var t=!0,n=0,a=(e+"").split("").reverse(),o=0;o<a.length;o++){var i=parseInt(a[o],10);(t=!t)&&(i*=2),9<i&&(i-=9),n+=i}return n%10==0}(t):n},formatCardNumber:function(e,t){var n,a;return e?(a=e.length[e.length.length-1],t=(t=t.replace(/\D/g,"")).slice(0,+a+1||9e9),e.format.global?null!=(a=t.match(e.format))?a.join(" "):void 0:(null!=(a=e.format.exec(t))&&(a.shift(),n=[],angular.forEach(a,function(e){e&&n.push(e)}),a=n),null!=a?a.join(" "):void 0)):t},cvcValidForCard:function(e,t){var t=(t+"").replace(/\D/g,""),n=!1;return n=0<=e.cvcLength.indexOf(t.length)?!0:n}}}]),e.directive("creditCardCvv",["creditCards",function(r){return{restrict:"A",require:"?ngModel",scope:{cardNumber:"=creditCardCvv"},link:function(o,i,e,n){n&&(void 0!==i.prop("id")&&""!==i.prop("id")||i.prop("id","cardCsc"),n.$validators.validSecurityCode=function(e,t){var n=!1,a=r.fromNumber(o.cardNumber),n=!(!a||!r.cvcValidForCard(a,t));return n=i.prop("required")?n:!0},n.$parsers.unshift(function(e){var t;if(e)return(t=e.replace(/[^0-9]/g,""))!==e&&(n.$setViewValue(t),n.$render()),t}),o.$watch(function(){return i.prop("required")},function(e){n.$validate()}),o.$watch("cardNumber",function(){var e=r.fromNumber(o.cardNumber);e?i.attr("maxLength",2==e.cvcLength.length?e.cvcLength[1]:e.cvcLength[0]):i.attr("maxLength",4),n.$validate()}))}}}]),e.directive("creditCardNumber",["creditCards","$timeout",function(s,c){return{restrict:"A",require:"?ngModel",scope:{cardType:"=?"},link:function(o,i,e,a){var r;a&&(void 0!==i.prop("id")&&""!==i.prop("id")||i.prop("id","cardNumber"),a.$validators.validCardNumber=function(e,t){var n,e=e||t,t=!1,a=s.fromNumber(e);return a?(o.cardType=a.type,n=e.replace(/ /g,""),n=e.length-n.length,i.attr("minLength",a.length[0]+n),i.attr("maxLength",a.length[a.length.length-1]+n),s.numberValidForCard(a,e)&&(t=!0)):(o.cardType=void 0,i.attr("minLength",13),i.attr("maxLength",16)),t=i.prop("required")?t:!0},a.$parsers.unshift(function(e){var t,n;if(e)return(t=(t=s.fromNumber(e))?s.formatCardNumber(t,e):e.replace(/[^0-9 ]/g,""))!==e&&(a.$setViewValue(t),a.$render(),"number"==typeof(n=t.length)&&(c.cancel(r),r=c(function(){var e=n+1,t=i[0];t.setSelectionRange?(t.focus(),t.setSelectionRange(n,e)):t.createTextRange&&((t=t.createTextRange()).collapse(!0),t.moveEnd("character",e),t.moveStart("character",n),t.select())}))),t}),o.$watch(function(){return i.prop("required")},function(e){a.$validate()}))}}}]),e.directive("creditCardExpirationMonth",function(){return{restrict:"A",require:"?ngModel",scope:{expirationYear:"="},link:function(o,i,e,t){if(t){if("SELECT"==i.prop("tagName"))for(var n=["January","February","March","April","May","June","July","August","September","October","November","December"],a=0;a<n.length;a++){var r=a+1,r=angular.element('<option value="'+r+'">'+r+" - "+n[a]+"</option>");i.append(r)}void 0!==i.prop("id")&&""!==i.prop("id")||i.prop("id","cardExpirationMonth"),t.$validators.validExpirationMonth=function(e,t){var n,a,e=e||t,t=!0;return o.expirationYear&&(n=parseInt(o.expirationYear),a=new Date,e=parseInt(e)-1,n==a.getFullYear()&&e<=a.getMonth()&&(t=!1)),t=i.prop("required")?t:!0},o.$watch("expirationYear",function(){t.$validate()}),o.$watch(function(){return i.prop("required")},function(e){t.$validate()})}}}}),e.directive("creditCardExpirationYear",function(){return{restrict:"A",require:"?ngModel",link:function(e,n,t,a){if(a){if("SELECT"==n.prop("tagName"))for(var o=new Date,i=0;i<10;i++){var r=o.getFullYear()+i,r=angular.element('<option value="'+r+'">'+r+"</option>");n.append(r)}void 0!==n.prop("id")&&""!==n.prop("id")||n.prop("id","cardExpirationYear"),a.$validators.validExpirationYear=function(e,t){e=e||t,t=new Date,e=!(parseInt(e)<t.getFullYear());return e=n.prop("required")?e:!0},e.$watch(function(){return n.prop("required")},function(e){a.$validate()})}}}}),e.directive("autofillExpirationFields",function(){var e="width: 1px; height: 1px; margin-left: -1000px; position: fixed; display: block;";return{restrict:"E",scope:{},template:'<input style="'+e+'" ng-model="afmonth" id="cardExpirationMonth" maxlength="2" ng-change="update()" tabindex="-1" type="text"><input tabindex="-1" style="'+e+'" id="cardExpirationYear" ng-model="afyear" maxlength="4" ng-change="update()" type="text">',link:function(e,t,n){e.update=function(){e.$parent.$emit("autofill-date",{year:e.afyear||"",month:e.afmonth||""})}}}}),e.directive("creditCardExpirationEntry",["$compile",function(n){return{restrict:"A",require:"?ngModel",scope:{year:"=",month:"=",yearDigits:"@?",ngModel:"="},link:function(t,o,e,a){var i=e.yearDigits?parseInt(e.yearDigits):2;function r(e){var t;return t=e&&2<=(e=e.replace(/[^0-9]/g,"")).length?parseInt(e.substr(0,2),10):t}function s(e){var t;return t=e&&(e=e.replace(/[^0-9]/g,"")).length==2+i?2==i?2e3+parseInt(e.substr(2,i),10):parseInt(e.substr(2,i),10):t}a&&(e=n("<autofill-expiration-fields></autofill-expiration-fields>")(t),o.parent().append(e),t.$on("autofill-date",function(e,t){var n;4==t.year.length&&1<=t.month.length&&(n="",n=1==t.month.length?"0"+t.month:t.month,n=(n+="/")+(2==i?t.year.substr(2):t.year),a.$setViewValue(n),a.$render())}),a.$validators.validExpirationDate=function(e,t){var n,e=e||t,t=s(e),e=r(e),a=!1;return void 0!==t&&void 0!==e&&(t>(n=new Date).getFullYear()||t==n.getFullYear()&&e>n.getMonth()+1)&&(a=!0),a=o.prop("required")?a:!0},a.$parsers.unshift(function(e){var t;if(e)return 2==(t=1==(t=e.replace(/[^0-9]/g,"")).length&&"0"!=t.substr(0,1)&&"1"!=t.substr(0,1)?"":t).length?"1"==t.substr(0,1)&&2<parseInt(t.substr(1,1),10)?t=t.substr(0,1):3<=e.length&&"/"==e.substr(2,1)&&(t=e.substr(0,3)):2<t.length&&(t=(t=t.substr(0,2)+"/"+t.substr(2)).substr(0,3+i)),t!==e&&(a.$setViewValue(t),a.$render()),t}),t.$watch(function(){return a.$modelValue},function(e){e?(t.month=""+r(e),t.year=""+s(e)):(t.month=void 0,t.year=void 0)}))}}}]),e.directive("creditCardInformation",["$mvConfiguration","creditCards",function(n,e){return{restrict:"E",templateUrl:function(e,t){return void 0!==t.templateUrl?t.templateUrl:void 0!==t.typeExpiration?n.templateBasePath+"credit-card-information-type-expiration.html":n.templateBasePath+"credit-card-information.html"},scope:{cardholderName:"=",cardNumber:"=",cardType:"=?",expirationMonth:"=",expirationYear:"=",securityCode:"=",saveCard:"=?",cardRequired:"=?"},link:function(t,e,n){t.state={months:[],allowCardSave:void 0!==t.saveCard,required:!0},t.$watch("cardRequired",function(e){t.state.required=void 0===e||e})}}}])}(),angular.module("mv.configuration",[]).provider("$mvConfiguration",function(){return{options:{templateBasePath:"defaultTemplatePath"},setTemplateBasePath:function(e){this.options.templateBasePath=e},$get:["$injector",function(e){return{templateBasePath:this.options.templateBasePath}}]}}),function(){var e=angular.module("mv.facebook",[]);e.provider("$mvFacebookConfiguration",function(){return{options:{applicationID:"",redirectURL:"",language:"en_US",debug:!1,facebookScriptURL:"//connect.facebook.net/en_US/all.js",scope:"email",fields:"email,first_name,last_name,name"},setLoginRequiredScope:function(e){this.options.scope=e},setDebugMode:function(e){this.options.debug=e},setApplicationID:function(e){this.options.applicationID=e},setRedirectURL:function(e){this.options.redirectURL=e},setLanguage:function(e){this.options.language=e},setFields:function(e){this.options.fields=e},$get:["$injector",function(e){var t,n;return{applicationID:this.options.applicationID,redirectURL:this.options.redirectURL,facebookScriptURL:(t=this.options.debug,n="//connect.facebook.net/"+(n=void 0===(n=this.options.language)?"en_US":n)+"/",n+=(t=void 0===t?!1:t)?"sdk/debug.js":"sdk.js"),scriptDOMElementID:"facebook-sdk-script",scope:this.options.scope,fields:this.options.fields}}]}}),e.service("loadFacebookJavascript",["$window","$q","$mvFacebookConfiguration",function(e,t,n){var a=t.defer();if(e.fbAsyncInit=function(){FB.init({appId:n.applicationID,status:!0,cookie:!0,xfbml:!0,version:"v14.0",redirect_url:n.redirectURL}),a.resolve()},!n.applicationID||0===n.applicationID.length)throw alert("You must configure the facebook application id!"),new Error("You must configure the facebook application id!");if(n.redirectURL&&0!==n.redirectURL.length)return document.getElementById(n.scriptDOMElementID)||((t=document.createElement("script")).id=n.scriptDOMElementID,t.src=n.facebookScriptURL,document.body.appendChild(t)),a.promise;throw alert("You must configure the facebook redirect URL!"),new Error("You must configure the facebook redirect URL!")}]),e.directive("facebookLoginButton",["loadFacebookJavascript","$timeout","$parse","$mvFacebookConfiguration",function(o,i,r,s){return{restrict:"A",link:function(t,e,n){if(!n.facebookLoginButton)throw new Error("You must supply a facebook callback");var a=r(n.facebookLoginButton);o.then(function(){e.on("click",function(){FB.login(function(e){e.authResponse?FB.api("/me",{fields:s.fields},function(e){i(function(){a(t,{status:"success",response:e})},50)}):i(function(){a(t,{status:"cancelled",response:e})},50)},{scope:s.scope,auth_type:"rerequest"})})},function(){a(t,{status:"loadingError",response:{}})})}}}]),e.directive("facebookPostButton",["loadFacebookJavascript","$timeout","$parse","$mvFacebookConfiguration",function(r,s,c,l){return{restrict:"A",link:function(t,e,n){if(!n.facebookPostButton)throw new Error("You must supply a facebook callback");var a=c(n.facebookPostButton),o=null;function i(){FB.ui({method:"feed",link:n.shareLink,picture:n.shareImage,name:n.shareName,description:n.shareDescription,display:"popup"},function(e){s(function(){a(t,e?{status:"success",response:e}:{status:"cancelled",response:e})},50)})}n.loginCallback&&(o=c(n.loginCallback)),r.then(function(){e.on("click",function(){FB.getLoginStatus(function(e){"connected"==e.status?i():FB.login(function(e){e.authResponse?(i(),o&&FB.api("/me",{fields:l.fields},function(e){s(function(){o(t,{status:"success",response:e})},50)})):s(function(){a(t,{status:"cancelled",response:e})},50)},{scope:l.scope})})})},function(){a(t,{status:"loadingError",response:{}})})}}}]),e.factory("facebookDetails",["$q","loadFacebookJavascript",function(i,r){return{getPhoto:function(e,t){return n=e,a=t,o=i.defer(),r.then(function(){window.FB.api("/me/picture?height="+n+"&width="+a+"&redirect=false",function(e){e&&!e.error?e.data.is_silhouette?o.reject("No profile image or only default silhouette available"):o.resolve(e.data.url):o.reject("Error with API")})}),o.promise;var n,a,o}}}])}(),function(){var e=angular.module("mv.filters",[]);e.filter("capitalize",function(){return function(e,t){return(e=null!=e?e.toLowerCase():e).substring(0,1).toUpperCase()+e.substring(1)}}),e.filter("max",function(){return function(e,t){e=e||"";e=parseInt(e);return""+(e=t<e?t:e)}})}(),function(){var e=angular.module("mv.forms",["mv.configuration","mv.widgets"]);e.service("mvCountryLoader",["$http","$q","$mvConfiguration",function(e,t,n){var a=t.defer(),t=e.get(n.templateBasePath+"countries.json");return void 0!==t.success?(t.success(function(e){a.resolve(e)}),t.error(function(e){a.reject(e)})):t.then(function(e){a.resolve(e.data)},function(e,t){a.reject(t)}),a.promise}]),e.directive("postalCode",function(){return{require:"?ngModel",restrict:"A",scope:{countryCode:"=postalCode"},link:function(n,a,e,o){o&&(o.$validators.validUSZip=function(e,t){var e=e||t,t=!1;return t="US"!=n.countryCode||(9==(e=e?e.replace(/[^0-9]/g,""):"").length||5==e.length),t=a.prop("required")?t:!0},o.$parsers.unshift(function(e){var t;return"US"!=n.countryCode?e:e?((t=e.replace(/[^0-9 \-]/g,""))!==e&&(o.$setViewValue(t),o.$render()),t):void 0}),n.$watch("countryCode",function(e,t){"US"==e?a.prop("placeholder")&&a.prop("placeholder","Zip"):void 0!==e&&a.prop("placeholder")&&a.prop("placeholder","Postal Code"),o.$validate()}),n.$watch(function(){return a.prop("required")},function(e){o.$validate()}))}}}),e.directive("mvAddress",["$mvConfiguration","$q","$http","mvCountryLoader",function(n,e,t,a){return{restrict:"E",templateUrl:function(e,t){return void 0!==t.templateUrl?t.templateUrl:n.templateBasePath+"address-elements.html"},scope:{street:"=",street2:"=?",city:"=",state:"=",zip:"=",country:"=",requiredFields:"=",useStreet2:"=?",fieldChanged:"&?",filterCountries:"&?",priorityCountries:"=?"},link:function(s,e,c){var o={};function t(){var e,t,n,a;o[s.country]?s.state=o[s.country]:void 0!==s.countryObject&&s.countryObject.States?(e=s.state,t=s.countryObject.States,a=null,void 0!==e&&(n=e.trim().toLowerCase(),angular.forEach(t,function(e){n!=e.Abbreviation.toLowerCase()&&n!=e.Name.toLowerCase()||(a=e)})),(e=a)&&(s.state=e.Abbreviation)):s.state=""}function l(t){var n;void 0!==s.countryObject&&t==s.countryObject.Code||(n=!1,angular.forEach(s.countries,function(e){e.Code==t&&(s.countryObject=e,n=!0)}),n||window.console.log("Change the country object; country "+t+" NOT FOUND!"))}function n(){a.then(function(e){var a,o,t,i=e,n=(s.priorityCountries&&s.priorityCountries.length&&(a=[],o=[],angular.forEach(s.priorityCountries,function(n){angular.forEach(i,function(e,t){e.Code==n&&(a.push(e),o.push(t))})}),angular.forEach(i,function(e,t){o.indexOf(t)<0&&a.push(e)}),i=a),c.filterCountries&&(t=[],angular.forEach(i,function(e){s.filterCountries({country:e})&&t.push(e)}),i=t),s.countries=i,!1),r=!1;angular.forEach(s.countries,function(e){"US"==e.Code&&(r=!0),s.country==e.Code&&(n=!0)}),n?l(s.country):c.defaultCountryCode?s.country=c.defaultCountryCode:s.country=r?"US":s.countries[0].Code})}s.countries=[],s.disabled=!1,void 0!==c.ngDisabled&&s.$parent.$watch(c.ngDisabled,function(e){s.disabled=e}),s.street||(s.street=""),s.useStreet2&&!s.street2&&(s.street2=""),s.city||(s.city=""),s.state||(s.state=""),s.zip||(s.zip=""),s.state&&s.country&&(o[s.country]=s.state),s.sendChange=function(e,t,n){s.fieldChanged&&s.fieldChanged({field:c[e],newValue:t,oldValue:n})},s.$watch("country",function(e){void 0!==e&&l(e)}),s.$watch("countryObject.Code",function(e){void 0!==e&&e!=s.country&&(s.country=e,t())}),s.$watch("state",function(e,t){e!==t&&(o[s.country]=e)}),s.stateRequired=function(){var e=!1;return e=void 0!==s.countryObject?!!(s.countryObject.States&&0<s.countryObject.States.length)&&(s.requiredFields&&s.requiredFields.state):e},s.$watch("priorityCountries",function(){n()}),n(),s.$on("mv-reload-countries",function(){n()})}}}])}(),angular.module("mv.widgets.datepicker",[]).directive("mvSelectDatepicker",["$mvConfiguration",function(n){var o=[{id:0,label:"January"},{id:1,label:"February"},{id:2,label:"March"},{id:3,label:"April"},{id:4,label:"May"},{id:5,label:"June"},{id:6,label:"July"},{id:7,label:"August"},{id:8,label:"September"},{id:9,label:"October"},{id:10,label:"November"},{id:11,label:"December"}];function i(e,t){for(var n=void 0===e||void 0===t?31:new Date(t,e+1,0).getDate(),a=[],o=1;o<=n;o++)a.push({id:o,label:o});return a}return{restrict:"E",require:"ngModel",scope:{firstYear:"@"},templateUrl:function(e,t){return void 0!==t.templateUrl?t.templateUrl:n.templateBasePath+"select-date-picker.html"},link:function(t,e,n,a){t.disabled=!1,void 0!==n.ngDisabled&&t.$parent.$watch(n.ngDisabled,function(e){t.disabled=e}),t.current={day:void 0,month:void 0,year:void 0,days:i(),months:o,years:function(e){var t,n=new Date,a=[];if(e.firstYear){for(t=parseInt(e.firstYear);t<=n.getFullYear();t++)a.push({id:t,label:t});a.reverse()}else for(t=n.getFullYear();t<=n.getFullYear()+10;t++)a.push({id:t,label:t});return a}(n)},a.$render=function(){var e;void 0!==a.$viewValue&&(e=new Date(a.$viewValue)),t.current.day=e?e.getUTCDate():void 0,t.current.month=e?e.getUTCMonth():void 0,t.current.year=e?e.getUTCFullYear():void 0,t.current.days=i(t.current.month,t.current.year)},t.fieldChanged=function(e){t.current.days=i(t.current.month,t.current.year),void 0!==t.current.day&&void 0!==t.current.month&&void 0!==t.current.year?a.$setViewValue(new Date(t.current.year,t.current.month,t.current.day)):a.$setViewValue(void 0)}}}}]),function(){var e=angular.module("mv.upload.button",[]);e.directive("mvInlineUploadButton",["$q","$http","$parse",function(o,c,e){return{restrict:"A",scope:!0,link:function(d,i,p){i.addClass("upload_button"),i.append('<input type="file" accept="'+p.accept+'">');var r=null,m=null,n=null,s=null,t=null;function g(){var e=i.find("input[type=file]");e.wrap("<form>").closest("form").get(0).reset(),e.unwrap()}function a(e){t&&t.assign(d,e)}function f(e,t){c.post(p.endpointUrl,{verb:"upload-parameters",filename:e,id:p.identifier,type:p.type,mimeType:t}).then(function(e){e.data.success?(r={postURL:e.data.result.url,uploadBucket:e.data.result.bucket,uploadParameters:e.data.result.params,uploadKey:e.data.result.params.key,mimeType:e.data.result.mimeType},a(!0),o(function(t,n){var e,a=new FormData;for(e in r.uploadParameters)a.append(e,r.uploadParameters[e]);a.append("success_action_status",201);var o=i.find("input[type=file]").get(0).files[0],o=(a.append("file",o),new XMLHttpRequest);o.upload.addEventListener("progress",function(e){var t;e.lengthComputable&&(t=Math.round(100*e.loaded/e.total),s&&t!=s(d)&&d.$apply(function(){s.assign(d,t)}))},!1),o.addEventListener("load",function(e){e&&201==e.currentTarget.status?d.$apply(function(){t()}):d.$apply(function(){n({reason:"loadFailed",evt:e.currentTarget})})},!1),o.addEventListener("error",function(e){d.$apply(function(){n({reason:"error",evt:e})})},!1),o.addEventListener("abort",function(e){d.$apply(function(){n({reason:"aborted"})})},!1),s&&s.assign(d,0),o.open("POST",r.postURL,!0),o.send(a)}).then(function(e){o(function(t,n){c.post(p.endpointUrl,{verb:"upload-complete",id:p.identifier,bucket:r.uploadBucket,key:r.uploadKey,type:p.type,mimeType:r.mimeType}).then(function(e){e.data.success?t(e.data):(alert(e.data.message),n())},n)}).then(function(e){n&&n(d,e.result),a(!1),g()},function(e){a(!1),g()})},function(e){switch(e.reason){case"loadFailed":case"error":alert("There was an error attempting to upload the file."+e.evt.response);break;case"aborted":alert("The upload has been canceled by the user or the browser dropped the connection.")}a(!1),g()})):(alert(e.data.message),g())})}p.previewImageSrc&&(m=e(p.previewImageSrc)),p.onCompletion&&(n=e(p.onCompletion)),p.uploadProgress&&(s=e(p.uploadProgress)),p.uploading&&(t=e(p.uploading)),i.find("input[type=file]").on("change",function(){if($(this).val()){var e=this.files||[];if(e.length){var t=$(this).val();p.identifier;if(t){var n,a,o=e[0].name,i=e[0].type,r=p.accept.split("/"),s=i.split("/"),c=!0;if(r.length==s.length)for(var l=0;l<r.length;l++)r[l]!=s[l]&&"*"!=r[l]&&(c=!1);if(c)window.FileReader?/^image/.test(i)?(n=p.minImageWidth||0,a=p.minImageHeight||0,(t=new FileReader).onloadend=function(){var e,t=this.result;(n||a)&&((e=new Image).onload=function(){var e;n&&this.width<n||a&&this.height<a?((e=[]).push("This image is too small."),n&&e.push("It must be at least "+n+" pixels wide (It is currently "+this.width+")"),a&&e.push("It must be at least "+a+" pixels tall (It is currently "+this.height+")"),alert(e.join("\n")),g()):d.$apply(function(){f(o,i)})},e.src=t),d.$apply(function(){m.assign(d,t),n||a||f(o,i)})},t.readAsDataURL(e[0])):(p.defaultPreviewImage&&m.assign(d,p.defaultPreviewImage),f(o,i)):f(o,i);else{var u="Invalid file type!";if(r.length)switch(r[0]){case"video":u="The selected file is not a valid video file.";break;case"image":u="The selected file is not a valid image file.";break;case"audio":u="The selected file is not a valid audio file."}alert(u),g()}}}}})}}}]),e.directive("mvUploadButtonWithProgress",["$q","$http",function(e,t){return{restrict:"E",scope:{title:"@",accept:"@",type:"@",identifier:"@",endpointUrl:"@",previewImageSrc:"=?",onCompletion:"&?",minImageWidth:"@?",minImageHeight:"@?",uploading:"=?"},template:'<div><progressbar ng-show="state.uploading" style="width: 100%;" value="state.progress"></progressbar><span ng-show="!state.uploading" class="btn btn-file btn-default btn-sm" mv-inline-upload-button type="{{ type }}" accept="{{ accept }}" identifier="{{ identifier }}" endpoint-url="{{ endpointUrl }}" preview-image-src="state.previewImageSrc" on-completion="complete(bucket, key, url)" upload-progress="state.progress" uploading="state.uploading" min-image-width="{{ minImageWidth }}" min-image-height="{{ minImageHeight }}" >{{ title }}</span></div>',link:function(a,e,t){a.state={uploading:!1,progress:0,previewImageSrc:null},a.$watch("state.previewImageSrc",function(e){a.previewImageSrc&&(a.previewImageSrc=e)}),t.uploading&&a.$watch("state.uploading",function(e){a.uploading=e}),a.complete=function(e,t,n){a.onCompletion&&a.onCompletion({bucket:e,key:t,url:n})}}}}])}(),function(){var e=angular.module("mv.utils",["mv.filters","mv.configuration","ui.bootstrap"]);e.directive("flagCheckbox",["$timeout",function(o){return{restrict:"A",scope:{flags:"=",flag:"@flagCheckbox"},link:function(e,t,n){var a=parseInt(e.flag);e.$watch("flags",function(e){void 0!==e&&(t[0].checked=!!(e&a))}),t.on("click",function(){o(function(){t[0].checked?e.flags|=a:e.flags&=~a},1)})}}}]),e.directive("compareTo",function(){return{require:"ngModel",scope:{otherModelValue:"=compareTo"},link:function(t,e,n,a){a.$validators.compareTo=function(e){return e==t.otherModelValue},t.$watch("otherModelValue",function(){a.$validate()})}}}),e.service("Dialogs",["$uibModal","$sce","$mvConfiguration",function(a,r,o){this.Confirm=function(e,t,n){return a.open({controller:["$scope","$uibModalInstance","message","title","buttons",function(e,t,n,a,o){e.message=r.trustAsHtml(n),e.title=a,e.buttons=o,e.clickButton=function(e){"cancel"==e.type?t.dismiss(e.name):t.close(e)}}],templateUrl:o.templateBasePath+"dialogs/confirm-modal.html",resolve:{message:function(){return e},buttons:function(){return void 0===n?[{name:"OK",type:"ok"},{name:"Cancel",type:"cancel"}]:n},title:function(){return void 0===t?"Confirm":t}}}).result},this.SingleTextAreaEntry=function(e,t,n){return a.open({controller:["$scope","$uibModalInstance","$mvConfiguration","message","title","buttons",function(t,n,e,a,o,i){t.message=r.trustAsHtml(a),t.title=o,t.buttons=i,t.params={textAreaEntry:""},t.clickButton=function(e){"cancel"==e.type?n.dismiss(e.name):n.close({button:e,textAreaEntry:t.params.textAreaEntry})}}],templateUrl:o.templateBasePath+"dialogs/single-text-area-modal.html",resolve:{message:function(){return e},buttons:function(){return void 0===n?[{name:"OK",type:"ok"},{name:"Cancel",type:"cancel"}]:n},title:function(){return void 0===t?"Confirm":t}}}).result}}]),e.service("UtilService",function(){this.CalculateTimeDeltas=function(e,t){var n=new Date,a=null,o=null,t=(t&&(t instanceof Date?a=t:"0000-00-00"!=t&&(a=Date.parse(t))),o=e?e instanceof Date?e:Date.parse(e):n,{days:0,hours:0,minutes:0,seconds:0,timeUnits:"",timeValue:""});return null!=a?(e=o<n?n:o)<a?(n=Math.abs(a-e)/1e3,n=(n=(n=(n-=86400*(o=Math.floor(n/86400)))-3600*(a=Math.floor(n/3600)%24))-60*(e=Math.floor(n/60)%60))%60,t.days=o,t.hours=a,t.minutes=e,t.seconds=n,0<o?(t.timeValue=o,t.timeUnits=1==o?"day left":"days left"):0<a?(t.timeValue=a,t.timeUnits=1==a?"hour left":"hours left"):0<e?(t.timeValue=e,t.timeUnits=1==e?"minute left":"minutes left"):0<n&&(t.timeValue=n,t.timeUnits=1==n?"second left":"seconds left")):t.timeValue="":(t.timeValue="Unknown",t.timeUnits="days left"),t}}),e.directive("onlyDigits",function(){return{restrict:"EA",require:"?ngModel",link:function(e,t,r,s){s&&(r.minDecimalDigits&&t.blur(function(){if(s.$viewValue){for(var e=s.$viewValue,t=0,n=e.indexOf("."),t=-1===n?(e+=".",r.minDecimalDigits):r.minDecimalDigits-(e.length-1-n),a=0;a<t;a++)e+="0";e!==s.$viewValue&&(s.$setViewValue(e),s.$render())}}),s.$parsers.unshift(function(e){var a=!1,o=0,i=r.allowDecimal&&"true"==r.allowDecimal,e=((r.maxDecimalDigits||r.minDecimalDigits)&&(i=!0),e.split("").filter(function(e,t){var n=!isNaN(e)&&" "!=e;return n&&o++,!n&&i&&"."==e&&!1===a&&(a=!0,n=!(o=0)),n=(n=!n&&r.allowNegative&&"true"==r.allowNegative?"-"==e&&0===parseInt(t):n)&&a&&r.maxDecimalDigits&&o>r.maxDecimalDigits?!1:n}).join(""));return r.maxNum&&!isNaN(r.maxNum)&&parseFloat(e)>parseFloat(r.maxNum)&&(e=r.maxNum),r.minNum&&!isNaN(r.minNum)&&parseFloat(e)<parseFloat(r.minNum)&&(e=r.minNum),s.$setViewValue(e),s.$render(),e}))}}}),e.directive("onlyNumber",function(){return{require:"ngModel",restrict:"AC",link:function(e,t,n,a){a.$parsers.push(function(e){var t;if(e)return(t=e.replace(/[^0-9]/g,""))!==e&&(a.$setViewValue(t),a.$render()),parseInt(t,10)})}}}),e.directive("thousandsComma",["$filter",function(o){return{require:"?ngModel",link:function(e,a,t,n){n&&(n.$formatters.unshift(function(){return""!==n.$modelValue?o("number")(n.$modelValue):""}),n.$parsers.unshift(function(e){var t,n;return""!==e?(n=e.replace(/[\,\.]/g,""),t=o("number")(n),a.val(t)):n=t="",a.val(t),n}),n.$parsers.unshift(function(e){var t;if(e)return(t=e.replace(/[^0-9\,]/g,""))!==e&&(n.$setViewValue(t),n.$render()),t}))}}}]),e.directive("mvEnter",function(){return function(t,e,n){e.bind("keydown keypress",function(e){13===e.which&&(t.$apply(function(){t.$eval(n.mvEnter)}),e.preventDefault())})}}),e.directive("mvElasticInput",function(){return{require:"?ngModel",restrict:"A",link:function(e,t,n,a){var o=angular.element('<div style="position:fixed; top:-999px; left:0;"></div>'),i=angular.element('<span style="white-space:pre;"></span>'),r="none"===t.css("maxWidth")?t.parent().innerWidth():t.css("maxWidth");function s(){n.placeholder?i.text(t.val()||n.placeholder):i.text(t.val()),t.css("width",i.outerWidth()+1)}t.css("minWidth",n.mvElasticInputMinwidth||t.css("minWidth")),t.css("maxWidth",n.mvElasticInputMaxwidth||r),angular.forEach(["fontFamily","fontSize","fontWeight","fontStyle","letterSpacing","textTransform","wordSpacing","textIndent","boxSizing","borderRightWidth","borderLeftWidth","borderLeftStyle","borderRightStyle","paddingLeft","paddingRight","marginLeft","marginRight"],function(e){i.css(e,t.css(e))}),angular.element("body").append(o.append(i)),s(),a?e.$watch(n.ngModel,function(){s()}):t.on("keydown keyup focus input propertychange change",function(){s()})}}})}(),function(){var e=angular.module("mv.widgets",["mv.widgets.datepicker"]);e.directive("showValidationIcon",function(){return{restrict:"A",require:"?ngModel",link:function(e,t,n,a){if(a){for(var o,i,r=void 0===n.delayValidation,s=t.parent();0<s.length;){if(s.hasClass("form-group")){s.addClass("has-feedback"),o=s;break}s=s.parent()}"INPUT"!=t.prop("tagName")||void 0!==o&&o.hasClass("input-group")||(i=angular.element('<span class="form-control-feedback glyphicon glyphicon-ok hidden"></span>'),t.after(i)),e.$watch(function(){return a.$dirty+"-"+a.$valid+"-"+a.$touched},function(){var e,t=r&&a.$dirty||a.$touched;e=a.$valid,t?e?(void 0!==o&&o.removeClass("has-error").addClass("has-success"),void 0!==i&&i.removeClass("hidden").removeClass("glyphicon-remove").addClass("glyphicon-ok")):(void 0!==o&&o.removeClass("has-success").addClass("has-error"),void 0!==i&&i.removeClass("hidden").removeClass("glyphicon-ok").addClass("glyphicon-remove")):(void 0!==o&&o.removeClass("has-success").removeClass("has-error"),void 0!==i&&i.addClass("hidden"))})}}}}),e.directive("flashAlert",["$timeout",function(a){return{restrict:"E",scope:{type:"=",message:"=",duration:"=?"},template:'<div ng-show="message" class="alert" ng-class="alertClass"><button type="button" class="close" ng-click="visible= false">x</button><strong>{{ strongText }}</strong> <span ng-bind-html="message"></span></div>',link:function(t,e,n){t.$watch("type",function(){if(t.type)switch(t.type){case"info":t.alertClass="alert-info",t.strongText="";break;case"warning":t.alertClass="alert-warning",t.strongText="Warning:";break;case"error":t.alertClass="alert-danger",t.strongText="Error:";break;case"success":t.alertClass="alert-success",t.strongText=""}}),t.$watch("message",function(e){e&&(e=t.duration||5e3,a(function(){t.message=void 0},e))})}}}]),e.directive("itemExpander",function(){return{restrict:"E",transclude:!0,scope:{title:"@",expanded:"=?"},template:'<h4><a href="#" ng-click="toggle($event)"><span class="glyphicon" ng-class="iconClass"></span>{{ title }}</a></h4><div ng-show="expanded"><ng-transclude></ng-transclude></div>',link:function(t,e,n){t.toggle=function(e){e.preventDefault(),t.expanded=!t.expanded},t.$watch("expanded",function(e){t.iconClass=e?"glyphicon-collapse-down":"glyphicon-collapse-up"})}}}),e.directive("audioPlayer",function(){return{restrict:"E",link:function(e,t,n){n.audioUrl?(t.append('<div id="'+n.containerId+'">Loading the player...</div>'),jwplayer(n.containerId).setup({file:n.audioUrl,supplied:"mp3",width:"100%",height:30})):t.append('<p class="text-center h4">This audio is still processing on the server.<br/>Please refresh this page in a few minutes.</p>')}}}),e.directive("videoPlayer",function(){return{restrict:"E",link:function(e,t,n){n.videoUrl?(t.append('<div id="'+n.containerId+'">Loading the player...</div>'),jwplayer(n.containerId).setup({file:n.videoUrl,image:n.imageUrl,width:"100%",aspectratio:n.width+":"+n.height,stretching:"exactfit"})):t.append('<p class="text-center h4">This video is still processing on the server.<br/>Please refresh this page in a few minutes to view.</p>')}}})}();
//# sourceMappingURL=scripts.min.js.map